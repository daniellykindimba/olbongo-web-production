var er=Object.defineProperty;var tr=(e,r,s)=>r in e?er(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s;var S=(e,r,s)=>(tr(e,typeof r!="symbol"?r+"":r,s),s);import{r as n,bJ as St,bK as Pt,bH as tt,bL as rr,bM as nr,w as se,bN as bt,bx as _e,bO as xt,bP as yt,bG as Ot,b8 as Tt,bQ as jt,bR as sr,bS as or,j as t,bT as Ve,bU as Nt,bV as Q,bW as Ct,bX as ir,bY as Re,bZ as Ee,b_ as ar,b$ as Oe,aV as Be,a0 as lr,aw as Ie,g as K,_ as T,c as rt,aR as cr,a7 as De,a_ as Te,c0 as Rt,aZ as ur,af as Ne,c1 as dr,c2 as hr,c3 as pr,c4 as fr,c5 as mr,c6 as gr,c7 as ge,c8 as vr,c9 as br,ca as xr,cb as yr,cc as jr,cd as Et,aW as fe,ce as Cr,cf as kr,cg as wr,aT as kt,ae as Ir,ch as Mr,ci as Xe,cj as Sr,ck as Pr,cl as wt,cm as Or,B as je,cn as Tr,co as Nr,cp as Me,cq as Fe,cr as Rr,cs as It}from"./index-ccfcd4da.js";import{C as Er}from"./change_password_form-ade9784a.js";import{D as me}from"./index-440571f1.js";import{T as Qe}from"./index-b8a04bf2.js";import{A as Ar}from"./index-8ddfcaf4.js";import{A as ve}from"./index-3bfb9ed3.js";import{G as nt}from"./index-efb9c68a.js";import{D as At}from"./index-3e3028c3.js";import{L as Ke}from"./index-885f566c.js";import{S as Lr}from"./school_switcher_component-025f893f.js";import{U as et}from"./index-200f56a0.js";import{T as Lt}from"./index-5c2e1e93.js";import{M as $r}from"./index-65dd5ac4.js";import"./transButton-719ccb9d.js";import"./index-a75cd6c4.js";import"./InfoCircleFilled-f916d949.js";import"./index-afc6ce50.js";import"./index-27f5ca3f.js";import"./ActionButton-3b8e0c74.js";import"./Upload-a74f9032.js";import"./fade-dd39912a.js";import"./DialogWrap-1d0538d4.js";import"./index-7da8bd4f.js";const zr=e=>{const r=n.useRef({});return n.useEffect(()=>{r.current=e}),r.current},$t=zr;function _r(e){const{badgeContent:r,invisible:s=!1,max:a=99,showZero:i=!1}=e,u=$t({badgeContent:r,max:a});let o=s;s===!1&&r===0&&!i&&(o=!0);const{badgeContent:c,max:d=a}=o?u:e,m=c&&Number(c)>d?`${d}+`:c;return{badgeContent:c,invisible:o,max:d,displayValue:m}}function Br(e){return Pt("MuiMenuItem",e)}const Fr=St("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),Se=Fr,Vr=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Dr=(e,r)=>{const{ownerState:s}=e;return[r.root,s.dense&&r.dense,s.divider&&r.divider,!s.disableGutters&&r.gutters]},Ur=e=>{const{disabled:r,dense:s,divider:a,disableGutters:i,selected:u,classes:o}=e,d=Nt({root:["root",s&&"dense",r&&"disabled",!i&&"gutters",a&&"divider",u&&"selected"]},Br,o);return se({},o,d)},qr=tt(rr,{shouldForwardProp:e=>nr(e)||e==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:Dr})(({theme:e,ownerState:r})=>se({},e.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!r.disableGutters&&{paddingLeft:16,paddingRight:16},r.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Se.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:_e(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${Se.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:_e(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${Se.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:_e(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:_e(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${Se.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Se.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${xt.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${xt.inset}`]:{marginLeft:52},[`& .${yt.root}`]:{marginTop:0,marginBottom:0},[`& .${yt.inset}`]:{paddingLeft:36},[`& .${bt.root}`]:{minWidth:36}},!r.dense&&{[e.breakpoints.up("sm")]:{minHeight:"auto"}},r.dense&&se({minHeight:32,paddingTop:4,paddingBottom:4},e.typography.body2,{[`& .${bt.root} svg`]:{fontSize:"1.25rem"}}))),Wr=n.forwardRef(function(r,s){const a=Ot({props:r,name:"MuiMenuItem"}),{autoFocus:i=!1,component:u="li",dense:o=!1,divider:c=!1,disableGutters:d=!1,focusVisibleClassName:m,role:j="menuitem",tabIndex:x,className:y}=a,b=Tt(a,Vr),C=n.useContext(jt),v=n.useMemo(()=>({dense:o||C.dense||!1,disableGutters:d}),[C.dense,o,d]),I=n.useRef(null);sr(()=>{i&&I.current&&I.current.focus()},[i]);const k=se({},a,{dense:v.dense,divider:c,disableGutters:d}),E=Ur(a),V=or(I,s);let W;return a.disabled||(W=x!==void 0?x:-1),t.jsx(jt.Provider,{value:v,children:t.jsx(qr,se({ref:V,role:j,tabIndex:W,component:u,focusVisibleClassName:Ve(E.focusVisible,m),className:Ve(E.root,y)},b,{ownerState:k,classes:E}))})}),Pe=Wr;function Hr(e){return Pt("MuiBadge",e)}const Gr=St("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),le=Gr,Kr=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],Je=10,Ye=4,Jr=e=>{const{color:r,anchorOrigin:s,invisible:a,overlap:i,variant:u,classes:o={}}=e,c={root:["root"],badge:["badge",u,a&&"invisible",`anchorOrigin${Q(s.vertical)}${Q(s.horizontal)}`,`anchorOrigin${Q(s.vertical)}${Q(s.horizontal)}${Q(i)}`,`overlap${Q(i)}`,r!=="default"&&`color${Q(r)}`]};return Nt(c,Hr,o)},Yr=tt("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,r)=>r.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Zr=tt("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,r)=>{const{ownerState:s}=e;return[r.badge,r[s.variant],r[`anchorOrigin${Q(s.anchorOrigin.vertical)}${Q(s.anchorOrigin.horizontal)}${Q(s.overlap)}`],s.color!=="default"&&r[`color${Q(s.color)}`],s.invisible&&r.invisible]}})(({theme:e,ownerState:r})=>se({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:Je*2,lineHeight:1,padding:"0 6px",height:Je*2,borderRadius:Je,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen})},r.color!=="default"&&{backgroundColor:(e.vars||e).palette[r.color].main,color:(e.vars||e).palette[r.color].contrastText},r.variant==="dot"&&{borderRadius:Ye,height:Ye*2,minWidth:Ye*2,padding:0},r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular"&&{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${le.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}},r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular"&&{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${le.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}},r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular"&&{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${le.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}},r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular"&&{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${le.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}},r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular"&&{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${le.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}},r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular"&&{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${le.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}},r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular"&&{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${le.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}},r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular"&&{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${le.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}},r.invisible&&{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})})),Xr=n.forwardRef(function(r,s){var a,i,u,o,c,d;const m=Ot({props:r,name:"MuiBadge"}),{anchorOrigin:j={vertical:"top",horizontal:"right"},className:x,component:y,components:b={},componentsProps:C={},children:v,overlap:I="rectangular",color:k="default",invisible:E=!1,max:V=99,badgeContent:W,slots:B,slotProps:D,showZero:O=!1,variant:H="standard"}=m,te=Tt(m,Kr),{badgeContent:M,invisible:N,max:U,displayValue:J}=_r({max:V,invisible:E,badgeContent:W,showZero:O}),z=$t({anchorOrigin:j,color:k,overlap:I,variant:H,badgeContent:W}),f=N||M==null&&H!=="dot",{color:g=k,overlap:w=I,anchorOrigin:R=j,variant:_=H}=f?z:m,Y=_!=="dot"?J:void 0,A=se({},m,{badgeContent:M,invisible:f,max:U,displayValue:Y,showZero:O,anchorOrigin:R,color:g,overlap:w,variant:_}),h=Jr(A),L=(a=(i=B==null?void 0:B.root)!=null?i:b.Root)!=null?a:Yr,G=(u=(o=B==null?void 0:B.badge)!=null?o:b.Badge)!=null?u:Zr,oe=(c=D==null?void 0:D.root)!=null?c:C.root,ie=(d=D==null?void 0:D.badge)!=null?d:C.badge,re=Ct({elementType:L,externalSlotProps:oe,externalForwardedProps:te,additionalProps:{ref:s,as:y},ownerState:A,className:Ve(oe==null?void 0:oe.className,h.root,x)}),ce=Ct({elementType:G,externalSlotProps:ie,ownerState:A,className:Ve(h.badge,ie==null?void 0:ie.className)});return t.jsxs(L,se({},re,{children:[v,t.jsx(G,se({},ce,{children:Y}))]}))}),Mt=Xr,Qr=ir(t.jsx("path",{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.39.08-.75.21-1.1.36l1.51 1.51c.32-.08.69-.13 1.09-.13zM5.47 3.92 4.06 5.33 7.5 8.77c0 2.08 1.56 3.22 3.91 3.91l3.51 3.51c-.34.49-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.83-.55 2.46-1.12l2.22 2.22 1.41-1.41L5.47 3.92z"}),"MoneyOffOutlined");var st={},en=Ee;Object.defineProperty(st,"__esModule",{value:!0});var zt=st.default=void 0,tn=en(Re()),rn=t,nn=(0,tn.default)((0,rn.jsx)("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"}),"Menu");zt=st.default=nn;var ot={},sn=Ee;Object.defineProperty(ot,"__esModule",{value:!0});var _t=ot.default=void 0,on=sn(Re()),an=t,ln=(0,on.default)((0,an.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z"}),"AccountCircle");_t=ot.default=ln;var it={},cn=Ee;Object.defineProperty(it,"__esModule",{value:!0});var Bt=it.default=void 0,un=cn(Re()),dn=t,hn=(0,un.default)((0,dn.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"}),"Mail");Bt=it.default=hn;var at={},pn=Ee;Object.defineProperty(at,"__esModule",{value:!0});var Ft=at.default=void 0,fn=pn(Re()),mn=t,gn=(0,fn.default)((0,mn.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"}),"Notifications");Ft=at.default=gn;var lt={},vn=Ee;Object.defineProperty(lt,"__esModule",{value:!0});var Vt=lt.default=void 0,bn=vn(Re()),xn=t,yn=(0,bn.default)((0,xn.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreVert");Vt=lt.default=yn;const jn=e=>{var d;const{data:r}=ar(),[s,a]=n.useState(!1),[i,u]=n.useState((d=e.user)==null?void 0:d.phone),o=async(m,j)=>{const{data:x}=await K.custom({url:"",method:"post",meta:{operation:"selfUpdateUserProfileInformations",variables:{phone:{value:j,type:"String",required:!1}},fields:["success","message"]}}).catch(y=>({data:null})).then(y=>y);x&&(x.success?(T.success(x.message),a(!1)):T.error(x.message))},c=async m=>{const{data:j}=await K.custom({url:"",method:"post",meta:{operation:"selfVerifyMobilePhoneNumber",variables:{phone:{value:m,type:"String",required:!0}},fields:["success","message","verified","otpSent"]}}).catch(x=>({data:null})).then(x=>x);if(j)if(j.success){if(j.otpSent)return!0}else T.error(j.message);return!1};return n.useEffect(()=>{},[e.randKey]),t.jsxs(t.Fragment,{children:[t.jsxs(me,{title:"",column:1,labelStyle:{fontSize:22,fontWeight:"bolder"},contentStyle:{fontSize:20},children:[t.jsx(me.Item,{label:"First Name",children:r==null?void 0:r.firstName}),t.jsx(me.Item,{label:"Middle Name",children:r==null?void 0:r.middleName}),t.jsx(me.Item,{label:"Last Name",children:r==null?void 0:r.lastName}),t.jsx(me.Item,{label:"Email Address",children:t.jsx(Qe.Title,{level:4,style:{fontSize:20,width:"100%",fontWeight:"normal",marginTop:3},children:r==null?void 0:r.email})}),t.jsx(me.Item,{label:"Gender",children:r==null?void 0:r.gender}),t.jsx(me.Item,{label:"Mobile Phone Number",children:t.jsxs(Qe.Title,{editable:{onChange:async m=>{m&&(u(m),await c(m)&&a(!0))}},level:4,style:{fontSize:20,fontWeight:"normal",marginTop:5},children:[i&&t.jsx(t.Fragment,{children:i}),!i&&t.jsx(t.Fragment,{children:r==null?void 0:r.phone})]})})]}),t.jsx(Oe,{title:"Mobile Phone Number Verification",open:s,onClose:m=>a(m),children:t.jsx(Cn,{user:r,phone:i,onFinish:o})})]})},Cn=e=>{const[r]=Be.useForm(),[s,a]=n.useState(!1),i=async(u,o)=>{const{data:c}=await K.custom({url:"",method:"post",meta:{operation:"selfVerifyMobilePhoneNumber",variables:{phone:{value:u,type:"String",required:!0},otp:{value:o,type:"String",required:!1}},fields:["success","message","verified","otpSent"]}}).catch(d=>({data:null})).then(d=>d);if(c)if(c.success){if(c.verified)return!0}else T.error(c.message);return!1};return t.jsxs(t.Fragment,{children:[t.jsx(Ar,{message:`Verification code sent to ${e.phone}, check a recent SMS with four digits`,type:"info"}),t.jsxs(Be,{layout:"vertical",form:r,onFinish:u=>{e.onFinish(u.otp,e.phone)},requiredMark:!0,children:[t.jsx(Be.Item,{name:"otp",label:"Verification Code",rules:[({getFieldValue:u})=>({async validator(o,c){return c.length>=4?(a(!0),await i(e.phone,c)?Promise.resolve():Promise.reject(new Error("Verification Code is not valid"))):Promise.reject(new Error("Verification Code must be 4 characters long"))}})],children:t.jsx(lr,{size:"large",placeholder:"Enter Verification Code ..."})}),t.jsx(Be.Item,{children:t.jsx(Ie,{size:"large",danger:!0,style:{float:"right"},disabled:!s,onClick:()=>{e.onFinish(r.getFieldValue("otp"),e.phone)},children:"Verify"})})]})]})},kn=e=>{const[r,s]=n.useTransition(),[a,i]=n.useState(!1),{push:u}=rt(),o=(c,d)=>c.length>d?c.substring(0,d)+"...":c;return t.jsx(t.Fragment,{children:t.jsx(cr,{span:e.colSize,children:t.jsx(Qe.Link,{disabled:!e.app.canAccess,children:t.jsx(De,{spinning:r,children:t.jsx("div",{onClick:()=>{e.app.isActive?s(()=>{u("/"+e.app.url),e.onClose()}):T("Under Construction")},onMouseOver:()=>{i(!0)},onMouseLeave:()=>{i(!1)},style:{position:a&&!e.last?"absolute":"static",zIndex:a&&!e.last?1:"auto",width:"100%",backgroundColor:a?"#f0f0f0":"transparent",borderRadius:10,border:a?"1px solid red":"1px solid transparent"},children:t.jsx("div",{style:{marginRight:10,marginTop:10},children:t.jsxs(Te,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center",textAlign:"center"},children:[t.jsx(ve,{size:{xs:24,sm:32,md:40,lg:40,xl:40,xxl:50},icon:t.jsx(Rt,{}),src:e.app.icon}),a?t.jsx("span",{style:{fontWeight:"bolder",fontSize:16},children:e.app.name}):t.jsx("span",{style:{fontWeight:"bolder",fontSize:16},children:o(e.app.name,9)})]})})})})})})})},Ce=()=>{const e=localStorage.getItem("apps");return e?JSON.parse(e):[]},wn=e=>{const[r,s]=n.useState(Ce()),[a,i]=n.useState(!0),o=!nt.useBreakpoint().lg,c=async()=>{i(!0);const{data:d}=await K.custom({url:"",method:"get",meta:{operation:"apps",fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","icon","url","created","updated","canAccess","isActive"]}]}});localStorage.setItem("apps",JSON.stringify(d.results)),s(d.results),i(!1)};return n.useEffect(()=>{c()},[]),t.jsxs(t.Fragment,{children:[Ce().length==0&&t.jsx("div",{style:{width:"100%",textAlign:"center",marginTop:20},children:t.jsx(De,{})}),Ce().length>0&&t.jsx(ur,{align:"top",style:{width:o?"100%":"500px"},children:Ce().map(d=>t.jsx(kn,{app:d,last:d.id===Ce()[Ce().length-1].id,colSize:o?12:8,onClose:()=>e.onClose()}))})]})},In=e=>{const[r,s]=n.useState([]),[a,i]=n.useState(!0);rt();const u=async()=>{const{data:c}=await K.custom({url:"",method:"get",meta:{operation:"myNotifications",fields:["pages","total","page","hasNext","hasPrev",{results:["id","message","url",{sender:["id","firstName","lastName","middleName","pic","fullName"]},{receiver:["id","firstName","lastName","middleName","pic","fullName"]},"isRead","created","updated","isActive"]}]}}).catch(d=>(T.error("Failed to get notifications"),{data:null})).then(d=>d);c&&s([...r,...c.results]),i(!1)},o=async()=>{const{data:c}=await K.custom({url:"",method:"post",meta:{operation:"clearNotifications",fields:["success","message"]}}).catch(d=>(T.error("Failed to clear notifications"),{data:null})).then(d=>d);c&&(c.success?(T.success(c.message),u()):T.error(c.message))};return n.useEffect(()=>{u()},[e.randKey,e.notifications]),t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{paddingLeft:20,display:"flex",justifyContent:"space-between",paddingTop:20},children:[t.jsx("h3",{children:"Notifications"}),t.jsxs("span",{children:[t.jsx(Ne,{title:"Clear All",children:t.jsx("a",{style:{marginRight:20},onClick:o,children:t.jsx(dr,{})})}),t.jsx("a",{style:{marginRight:20},onClick:()=>T("Notification Settings"),children:t.jsx(hr,{})})]})]}),t.jsx(At,{style:{marginTop:0,marginBottom:0}}),t.jsx("div",{style:{maxHeight:"70vh",overflowY:"auto",overflowX:"hidden",paddingLeft:"20px"},children:t.jsx(De,{spinning:a,children:t.jsx(Ke,{itemLayout:"horizontal",dataSource:e.notifications,renderItem:c=>t.jsx("a",{children:t.jsx(Ke.Item,{onClick:()=>{e.onNotificationClick(c)},children:t.jsx(Ke.Item.Meta,{avatar:t.jsx(ve,{src:c.sender.pic}),title:t.jsx("a",{children:c.message}),description:pr(c.created).fromNow()})})})})})})]})},{Dragger:Mn}=et,Sn=e=>{const[r,s]=n.useState([]),a=i=>{const u=["png","jpg","jpeg","gif","bmp","webp","tiff","svg","psd"],o=i.name.split(".").pop();return u.indexOf(o)===-1?(T.error("File type not supported"),et.LIST_IGNORE):i.size/1024/1024>50?(T.error("File size too large"),et.LIST_IGNORE):(s([i,...r]),!0)};return n.useEffect(()=>{s([])},[e.random]),t.jsx(t.Fragment,{children:t.jsxs(Mn,{customRequest:e.handleUpload,beforeUpload:a,fileList:r,multiple:!1,accept:"image/*",children:[t.jsx("p",{className:"ant-upload-drag-icon",children:t.jsx(fr,{})}),t.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload a Profile Picture"})]})})},{TabPane:Pn}=Lt,On=e=>{var o;const[r,s]=n.useState(!1),a=(c,d)=>{e.changeWidth(c),s(d)},i=async()=>{const{data:c}=await K.custom({url:"",method:"post",meta:{operation:"removeUserProfilePhoto",variables:{id:{value:parseInt(e.user.id),type:"Int",required:!0}},fields:["success","message"]}});c.success?(T.success(c.message),e.close(),window.location.reload()):T.error(c.message)},u=async c=>{const{onSuccess:d,onError:m,file:j,onProgress:x}=c,{data:y}=await K.custom({url:"",method:"post",meta:{operation:"uploadUserProfilePhoto",variables:{id:{value:parseInt(e.user.id),type:"Int",required:!0},photo:{value:j,type:"Upload",required:!0}},onUploadProgress:b=>{const{loaded:C,total:v}=b,I=Math.floor(C*100/v);x(I)},onError:b=>{m(b),T.error(b.message)},fields:["success","message",{user:["id","firstName","middleName","lastName","fullName","pic","email","isAdmin","isStaff","isActive"]}]}});if(y.success){d("ok"),T.success(y.message),localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(y.user));const b=localStorage.getItem("user"),{pic:C}=JSON.parse(b||"");y.user.pic===C&&window.location.reload()}else T.error(y.message)};return n.useEffect(()=>{e.triggerClose&&(s(!1),e.close())},[e.changeWidth]),t.jsx(t.Fragment,{children:r?t.jsx(Lt,{defaultActiveKey:"1",centered:!0,draggable:!0,children:t.jsxs(Pn,{tab:t.jsx("span",{style:{fontSize:18},children:"From Computer"}),children:[t.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:30,marginBottom:30},children:t.jsx(Sn,{user:e.user,handleUpload:u})}),t.jsx("span",{style:{marginRight:10},children:t.jsx(Ie,{icon:t.jsx(mr,{}),size:"large",onClick:()=>a(30,!1),children:"Back"})})]},"3")}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[t.jsx("span",{style:{fontSize:18,fontWeight:"bolder"},children:"Profile picture"}),t.jsx("span",{style:{display:"block",marginTop:10},children:"A picture helps people recognize you and lets you know when you’re signed in to your account"}),t.jsxs("span",{style:{display:"block",marginTop:10},children:[t.jsx(gr,{}),"Visible across ",ge.system_name," services.",t.jsx("a",{children:"Learn more"})]})]}),t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsx(ve,{src:(o=e.user)==null?void 0:o.pic,style:{width:225,height:225}})}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:30},children:[t.jsx("span",{style:{marginRight:10},children:t.jsx(Ie,{icon:t.jsx(vr,{}),size:"large",onClick:()=>a(60,!0),children:"Change"})}),t.jsx("span",{children:t.jsx(Ie,{icon:t.jsx(br,{}),size:"large",onClick:i,children:"Remove"})})]})]})})},{LogoutOutlined:Tn,UserOutlined:Nn}=Sr,Rn=()=>{const e=n.useContext(xr),{ready:r,value:s,send:a}=e,[i,u]=n.useTransition(),{data:o}=yr();jr();const[c,d]=n.useState(0),[m,j]=n.useState(!1),[x,y]=n.useState(30),[b,C]=n.useState(!1),[v,I]=n.useState(0),[k,E]=n.useState(!1),[V,W]=n.useState(!1),[B,D]=n.useState(!1),{mutate:O}=Et(),{push:H}=rt(),te=nt.useBreakpoint(),[M,N]=n.useState(!1),[U,J]=n.useState(!0),z=n.useRef(null),f=!te.lg,[g,w]=n.useState(!1),[R,_]=n.useState([]),[Y,A]=n.useState(!1),h=async()=>{const{data:p}=await K.custom({url:"",method:"get",meta:{operation:"myNotifications",fields:["pages","total","page","hasNext","hasPrev",{results:["id","message","url",{sender:["id","firstName","lastName","middleName","pic","fullName"]},{receiver:["id","firstName","lastName","middleName","pic","fullName"]},"isRead","created","updated","isActive"]}]}}).catch(()=>(T.remove(),T.error("Failed to get notifications"),{data:null})).then($=>$);if(p){const $=p.results.filter(Z=>!R.some(be=>be.id===Z.id));_([...$,...R])}},L=async p=>{const{data:$}=await K.custom({url:"",method:"post",meta:{operation:"markNotificationAsRead",variables:{notificationId:{value:parseInt(p.toString()),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>({data:null})).then(Z=>Z);$&&$.success&&(_(R.filter(Z=>Z.id.toString()!==p.toString())),d(c-1))},G=p=>{y(p)},oe=async()=>{const{data:p}=await K.custom({url:"",method:"get",meta:{operation:"totalNotifications",fields:["total"]}}).catch(()=>({data:null})).then($=>$);p&&d(p.total)},ie=()=>{y(30),C(!0),I(Math.random())};n.useEffect(()=>{if(console.log("value:",s),Notification.permission!=="granted"&&Notification.requestPermission(),Notification.permission==="granted"&&s!==null&&s!==""&&s!==void 0&&s!=="null"&&s!="Nil")try{const p=JSON.parse(s);console.log("data:",p),"Notification"in window?(Notification.requestPermission().then($=>{if($==="granted"){const Z=new Notification(p.message.title,{body:p.message.body})}else console.error("Notification permission denied")}),h()):console.error("Notification API not supported")}catch(p){console.error(p)}oe(),h(),w(f)},[r,s,a]);const re=t.jsx(De,{spinning:i,children:t.jsx(fe,{style:{width:400,backgroundColor:"white",padding:20},children:t.jsxs("span",{ref:z,style:{margin:10,padding:30},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[t.jsx(ve,{src:o==null?void 0:o.pic,style:{width:75,height:75}}),t.jsx(Ne,{title:"Change Profile Picture",color:"green",placement:"left",children:t.jsx(Ie,{shape:"circle",icon:t.jsx(Cr,{}),style:{position:"absolute",marginLeft:75,marginTop:40},onClick:()=>j(!0)})})]}),t.jsx("div",{style:{display:"flex",justifyContent:"center",fontWeight:"bolder",color:"black",marginTop:20,marginBottom:30,fontSize:24},children:o==null?void 0:o.fullName}),t.jsx(Lr,{}),t.jsx(At,{}),t.jsx(fe.Item,{onClick:()=>D(!0),icon:t.jsx(Nn,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Profile"},"profile"),o!=null&&o.isStaff||o!=null&&o.isAdmin?t.jsxs(t.Fragment,{children:[t.jsx(fe.Item,{onClick:()=>{u(()=>{H("/control/analytics")})},icon:t.jsx(kr,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Control Panel"},"controlpanel"),t.jsx(fe.Item,{onClick:()=>{u(()=>{H("/opay")})},style:{fontSize:18,color:"black"},icon:t.jsx(Qr,{style:{color:"red"}}),children:"Billing Management"},"controlpanel")]}):t.jsx(t.Fragment,{}),!(o!=null&&o.ldapAuth)&&t.jsx(Ne,{title:"Click to Change Your Password",color:"green",children:t.jsx(fe.Item,{onClick:()=>E(!0),icon:t.jsx(wr,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Change Password"},"accountChangePassword")}),t.jsx(fe.Item,{onClick:()=>O(),icon:t.jsx(Tn,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Logout"},"logout")]})})}),ce=t.jsx(fe,{style:{width:500,minHeight:50},children:t.jsx(In,{randKey:Math.random(),notifications:R,onNotificationClick:p=>{L(p.id),p.url&&(A(!1),H(p.url))}})});return t.jsxs(Te,{children:[t.jsx(Te,{style:{marginLeft:"0px",marginRight:"20px"},children:t.jsx(En,{})}),t.jsx(Te,{style:{marginLeft:"0px",marginRight:"20px"},children:t.jsx(kt,{overlay:ce,open:Y,trigger:["click"],overlayStyle:{zIndex:9999},children:t.jsx(Ne,{title:"Notifications",placement:"bottom",color:"green",children:t.jsx(Ir,{count:c,children:t.jsx("a",{onClick:()=>{A(!Y)},children:t.jsx(ve,{icon:t.jsx(Mr,{}),style:{backgroundColor:"silver"}})})})})})}),t.jsx(Te,{style:{marginLeft:"10px"},children:t.jsx(kt,{overlay:re,trigger:["click"],overlayStyle:{zIndex:9999},children:t.jsx("a",{onClick:()=>N(!M),children:(o==null?void 0:o.pic)&&t.jsx(ve,{src:o==null?void 0:o.pic,alt:o==null?void 0:o.fullName})})})}),t.jsx(Oe,{title:t.jsx(t.Fragment,{children:x>30&&t.jsx("span",{children:"Change Profile Picture"})||t.jsxs("span",{children:[ge.system_name," Account"]})}),open:m,width:x+"vw",onClose:p=>j(p),children:t.jsx(On,{user:o,changeWidth:G,triggerClose:b,close:ie})}),t.jsx(Oe,{title:"Change Password",open:k,width:"30vw",onClose:p=>E(p),children:t.jsx(Er,{onFinish:()=>{J(!1)}})}),t.jsx(Oe,{title:"Account Payment Settings",destroyOnClose:!0,closable:!0,open:V,width:"40vw",onClose:p=>W(p),children:t.jsx("p",{children:"Account Payment Settings"})}),t.jsx(Oe,{title:(o==null?void 0:o.fullName)+" Profile Information's",open:B,width:"60vw",onClose:p=>D(p),children:t.jsx(jn,{randKey:Math.random(),user:o})})]})};function En(){const[e,r]=n.useState(null),s=!!e;nt.useBreakpoint().lg;const i=o=>{r(o.currentTarget)},u=()=>{r(null)};return t.jsxs("div",{children:[t.jsx(Ne,{title:"Apps",color:"green",placement:"left",children:t.jsx("span",{id:"basic-button","aria-controls":s?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0,onClick:i,style:{cursor:"pointer"},children:t.jsx(ve,{icon:t.jsx(Rt,{}),style:{backgroundColor:"silver"}})})}),t.jsx(Xe,{id:"basic-menu",anchorEl:e,open:s,onClose:u,MenuListProps:{"aria-labelledby":"basic-button",style:{borderRadius:50,padding:10}},children:t.jsx(wn,{onClose:()=>{u()}})})]})}var An=Object.create,Dt=Object.defineProperty,Ln=Object.getOwnPropertyDescriptor,$n=Object.getOwnPropertyNames,zn=Object.getPrototypeOf,_n=Object.prototype.hasOwnProperty,Bn=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),Fn=(e,r,s,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of $n(r))!_n.call(e,i)&&i!==s&&Dt(e,i,{get:()=>r[i],enumerable:!(a=Ln(r,i))||a.enumerable});return e},Vn=(e,r,s)=>(s=e!=null?An(zn(e)):{},Fn(r||!e||!e.__esModule?Dt(s,"default",{value:e,enumerable:!0}):s,e)),Dn=Bn((e,r)=>{(function(s,a){typeof e=="object"&&typeof r<"u"?a(e):typeof define=="function"&&define.amd?define(["exports"],a):(s=typeof globalThis<"u"?globalThis:s||self,a(s.fastUniqueNumbers={}))})(e,function(s){var a=function(b){return function(C){var v=b(C);return C.add(v),v}},i=function(b){return function(C,v){return b.set(C,v),v}},u=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,c=o*2,d=function(b,C){return function(v){var I=C.get(v),k=I===void 0?v.size:I<c?I+1:0;if(!v.has(k))return b(v,k);if(v.size<o){for(;v.has(k);)k=Math.floor(Math.random()*c);return b(v,k)}if(v.size>u)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;v.has(k);)k=Math.floor(Math.random()*u);return b(v,k)}},m=new WeakMap,j=i(m),x=d(j,m),y=a(x);s.addUniqueNumber=y,s.generateUniqueNumber=x})});Vn(Dn());var ne=(typeof window>"u"?"undefined":typeof window)=="object",ee={setTimeout:ne?setTimeout.bind(window):setTimeout,clearTimeout:ne?clearTimeout.bind(window):clearTimeout,setInterval:ne?setInterval.bind(window):setInterval,clearInterval:ne?clearInterval.bind(window):clearInterval};function Un(e){ee.setTimeout=e.setTimeout,ee.clearTimeout=e.clearTimeout,ee.setInterval=e.setInterval,ee.clearInterval=e.clearInterval}var ke={},qn=class{constructor(e){S(this,"name");S(this,"closed",!1);S(this,"mc",new MessageChannel);this.name=e,ke[e]=ke[e]||[],ke[e].push(this),this.mc.port1.start(),this.mc.port2.start(),this.onStorage=this.onStorage.bind(this),window.addEventListener("storage",this.onStorage)}onStorage(e){if(e.storageArea!==window.localStorage||e.key.substring(0,this.name.length)!==this.name||e.newValue===null)return;let r=JSON.parse(e.newValue);this.mc.port2.postMessage(r)}postMessage(e){if(this.closed)throw new Error("InvalidStateError");let r=JSON.stringify(e),s=`${this.name}:${String(Date.now())}${String(Math.random())}`;window.localStorage.setItem(s,r),ee.setTimeout(()=>{window.localStorage.removeItem(s)},500),ke[this.name].forEach(a=>{a!==this&&a.mc.port2.postMessage(JSON.parse(r))})}close(){if(this.closed)return;this.closed=!0,this.mc.port1.close(),this.mc.port2.close(),window.removeEventListener("storage",this.onStorage);let e=ke[this.name].indexOf(this);ke[this.name].splice(e,1)}get onmessage(){return this.mc.port1.onmessage}set onmessage(e){this.mc.port1.onmessage=e}get onmessageerror(){return this.mc.port1.onmessageerror}set onmessageerror(e){this.mc.port1.onmessageerror=e}addEventListener(e,r){return this.mc.port1.addEventListener(e,r)}removeEventListener(e,r){return this.mc.port1.removeEventListener(e,r)}dispatchEvent(e){return this.mc.port1.dispatchEvent(e)}},Wn=typeof window>"u"?void 0:typeof window.BroadcastChannel=="function"?window.BroadcastChannel:qn;function Hn(e=0){return new Promise(r=>ee.setTimeout(r,e))}function Ut(){return Math.random().toString(36).substring(2)}var Gn=class{constructor(e,r){S(this,"options");S(this,"channel");S(this,"token",Ut());S(this,"isLeader",!1);S(this,"isDead",!1);S(this,"isApplying",!1);S(this,"reApply",!1);S(this,"intervals",[]);S(this,"listeners",[]);S(this,"deferred");this.channel=e,this.options=r,this.apply=this.apply.bind(this),this.awaitLeadership=this.awaitLeadership.bind(this),this.sendAction=this.sendAction.bind(this)}async apply(){if(this.isLeader||this.isDead)return!1;if(this.isApplying)return this.reApply=!0,!1;this.isApplying=!0;let e=!1,r=s=>{let{token:a,action:i}=s.data;a!==this.token&&(i===0&&a>this.token&&(e=!0),i===1&&(e=!0))};this.channel.addEventListener("message",r);try{return this.sendAction(0),await Hn(this.options.responseTime),this.channel.removeEventListener("message",r),this.isApplying=!1,e?this.reApply?this.apply():!1:(this.assumeLead(),!0)}catch{return!1}}awaitLeadership(){if(this.isLeader)return Promise.resolve();let e=!1,r=null;return new Promise(s=>{let a=()=>{if(e)return;e=!0;try{ee.clearInterval(r)}catch{}let u=this.intervals.indexOf(r);u>=0&&this.intervals.splice(u,1),this.channel.removeEventListener("message",i),s()};r=ee.setInterval(()=>{this.apply().then(()=>{this.isLeader&&a()})},this.options.fallbackInterval),this.intervals.push(r);let i=u=>{let{action:o}=u.data;o===2&&this.apply().then(()=>{this.isLeader&&a()})};this.channel.addEventListener("message",i)})}sendAction(e){this.channel.postMessage({action:e,token:this.token})}assumeLead(){this.isLeader=!0;let e=r=>{let{action:s}=r.data;s===0&&this.sendAction(1)};return this.channel.addEventListener("message",e),this.listeners.push(e),this.sendAction(1)}waitForLeadership(){return this.deferred?this.deferred:(this.deferred=this.awaitLeadership(),this.deferred)}close(){if(!this.isDead){this.isDead=!0,this.isLeader=!1,this.sendAction(2);try{this.listeners.forEach(e=>this.channel.removeEventListener("message",e)),this.intervals.forEach(e=>ee.clearInterval(e))}catch{}}}},Kn=class{constructor(e){S(this,"channel");S(this,"options");S(this,"elector");S(this,"token",Ut());S(this,"registry",new Map);S(this,"allIdle",!1);S(this,"isLastActive",!1);let{channelName:r}=e;if(this.options=e,this.channel=new Wn(r),this.registry.set(this.token,1),e.leaderElection){let s={fallbackInterval:2e3,responseTime:100};this.elector=new Gn(this.channel,s),this.elector.waitForLeadership()}this.channel.addEventListener("message",s=>{let{action:a,token:i,data:u}=s.data;switch(a){case 3:this.registry.set(i,2);break;case 4:this.registry.delete(i);break;case 5:this.idle(i);break;case 6:this.active(i);break;case 7:this.prompt(i);break;case 8:this.start(i);break;case 9:this.reset(i);break;case 10:this.activate(i);break;case 11:this.pause(i);break;case 12:this.resume(i);break;case 13:this.options.onMessage(u);break}}),this.send(3)}get isLeader(){if(!this.elector)throw new Error('❌ Leader election is not enabled. To Enable it set the "leaderElection" property to true.');return this.elector.isLeader}prompt(e=this.token){this.registry.set(e,0);let r=[...this.registry.values()].every(s=>s===0);e===this.token&&this.send(7),r&&this.options.onPrompt()}idle(e=this.token){this.registry.set(e,2);let r=[...this.registry.values()].every(s=>s===2);e===this.token&&this.send(5),!this.allIdle&&r&&(this.allIdle=!0,this.options.onIdle())}active(e=this.token){this.allIdle=!1,this.registry.set(e,1);let r=[...this.registry.values()].some(s=>s===1);e===this.token&&this.send(6),r&&this.options.onActive(),this.isLastActive=e===this.token}start(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(8):this.options.start(!0),this.isLastActive=e===this.token}reset(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(9):this.options.reset(!0),this.isLastActive=e===this.token}activate(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(10):this.options.activate(!0),this.isLastActive=e===this.token}pause(e=this.token){e===this.token?this.send(11):this.options.pause(!0)}resume(e=this.token){e===this.token?this.send(12):this.options.resume(!0)}message(e){try{this.channel.postMessage({action:13,token:this.token,data:e})}catch{}}send(e){try{this.channel.postMessage({action:e,token:this.token})}catch{}}close(){this.options.leaderElection&&this.elector.close(),this.send(4),this.channel.close()}},Jn=ne?document:null,Yn=["mousemove","keydown","wheel","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","MSPointerDown","MSPointerMove","visibilitychange","focus"];function Zn(e,r){let s;function a(...i){s&&clearTimeout(s),s=setTimeout(()=>{e(...i),s=null},r)}return a.cancel=function(){clearTimeout(s)},a}function Ze(e,r){let s=0;return function(...a){let i=new Date().getTime();if(!(i-s<r))return s=i,e(...a)}}var P=()=>Date.now(),we=2147483647;function Xn({timeout:e=1e3*60*20,promptTimeout:r=0,promptBeforeIdle:s=0,element:a=Jn,events:i=Yn,timers:u=void 0,immediateEvents:o=[],onPresenceChange:c=()=>{},onPrompt:d=()=>{},onIdle:m=()=>{},onActive:j=()=>{},onAction:x=()=>{},onMessage:y=()=>{},debounce:b=0,throttle:C=0,eventsThrottle:v=200,startOnMount:I=!0,startManually:k=!1,stopOnIdle:E=!1,crossTab:V=!1,name:W="idle-timer",syncTimers:B=0,leaderElection:D=!1,disabled:O=!1}={}){let H=n.useRef(P()),te=n.useRef(P()),M=n.useRef(null),N=n.useRef(null),U=n.useRef(0),J=n.useRef(0),z=n.useRef(0),f=n.useRef(0),g=n.useRef(!1),w=n.useRef(!1),R=n.useRef(!1),_=n.useRef(!0),Y=n.useRef(!1),A=n.useRef(null),h=n.useRef(null),L=n.useRef(e),G=n.useRef(0);n.useEffect(()=>{if(r&&console.warn("⚠️ IdleTimer -- The `promptTimeout` property has been deprecated in favor of `promptBeforeIdle`. It will be removed in the next major release."),s&&r)throw new Error("❌ Both promptTimeout and promptBeforeIdle can not be set. The promptTimeout property will be deprecated in a future version.");if(e>=we)throw new Error(`❌ The value for the timeout property must fit in a 32 bit signed integer, ${we}.`);if(r>=we)throw new Error(`❌ The value for the promptTimeout property must fit in a 32 bit signed integer, ${we}.`);if(s>=we)throw new Error(`❌ The value for the promptBeforeIdle property must fit in a 32 bit signed integer, ${we}.`);if(s>=e)throw new Error(`❌ The value for the promptBeforeIdle property must be less than the timeout property, ${e}.`);if(s?(L.current=e-s,G.current=s):(L.current=e,G.current=r),!_.current){if(k||O)return;g.current&&(xe.current(null,q),h.current&&h.current.active()),pe()}},[e,r,s,k,O]);let oe=n.useRef(E);n.useEffect(()=>{oe.current=E},[E]);let ie=n.useRef(o),re=n.useRef(a),ce=n.useRef([...new Set([...i,...o]).values()]),p=n.useRef(O);n.useEffect(()=>{p.current=O,!_.current&&(O?$e():k||pe())},[O]);let $=n.useRef(c);n.useEffect(()=>{$.current=c},[c]);let Z=n.useRef(d);n.useEffect(()=>{Z.current=d},[d]);let be=n.useRef(m);n.useEffect(()=>{be.current=m},[m]);let xe=n.useRef(j);n.useEffect(()=>{xe.current=j},[j]);let Ae=n.useRef(x);n.useEffect(()=>{Ae.current=x},[x]);let ye=n.useRef(y);n.useEffect(()=>{ye.current=y},[y]);let ue=n.useMemo(()=>{let l=(F,ze)=>Ae.current(F,ze);return b>0?Zn(l,b):C>0?Ze(l,C):l},[C,b]),ct=n.useRef();n.useEffect(()=>{V&&B&&(ct.current=Ze(()=>{h.current.active()},B))},[V,B]);let X=()=>{A.current!==null&&(ee.clearTimeout(A.current),A.current=null)},de=(l,F=!0)=>{X(),A.current=ee.setTimeout(qe,l||L.current),F&&(N.current=P())},ut=l=>{!w.current&&!g.current&&(Z.current(l,q),$.current({type:"active",prompted:!0},q)),f.current=0,z.current=P(),w.current=!0,de(G.current,!1)},dt=()=>{X(),g.current||(be.current(null,q),$.current({type:"idle"},q)),g.current=!0,M.current=P(),oe.current?he():w.current&&(z.current=0,w.current=!1)},Ue=l=>{X(),(g.current||w.current)&&(xe.current(l,q),$.current({type:"active",prompted:!1},q)),w.current=!1,z.current=0,g.current=!1,U.current+=P()-M.current,J.current+=P()-M.current,ae(),de()},qe=l=>{if(!g.current){ue.cancel&&ue.cancel();let F=P()-N.current;if(!(L.current+G.current<F)&&G.current>0&&!w.current){h.current?h.current.prompt():ut(l);return}h.current?h.current.idle():dt();return}h.current?h.current.active():Ue(l)},We=l=>{if(!I&&!N.current&&(N.current=P(),xe.current(null,q)),ue(l,q),w.current)return;if(X(),!g.current&&ie.current.includes(l.type)){qe(l);return}let F=P()-N.current;if(g.current&&!E||!g.current&&F>=L.current){qe(l);return}R.current=!1,f.current=0,z.current=0,de(),V&&B&&ct.current()},Le=n.useRef(We);n.useEffect(()=>{let l=Y.current;l&&he(),v>0?Le.current=Ze(We,v):Le.current=We,l&&ae()},[v,C,b,Ae,V,B]);let ae=()=>{ne&&re.current&&(Y.current||(ce.current.forEach(l=>{re.current.addEventListener(l,Le.current,{capture:!0,passive:!0})}),Y.current=!0))},he=(l=!1)=>{ne&&re.current&&(Y.current||l)&&(ce.current.forEach(F=>{re.current.removeEventListener(F,Le.current,{capture:!0})}),Y.current=!1)},pe=n.useCallback(l=>p.current?!1:(X(),ae(),g.current=!1,w.current=!1,R.current=!1,f.current=0,z.current=0,h.current&&!l&&h.current.start(),de(),!0),[A,g,p,L,h]),He=n.useCallback(l=>p.current?!1:(X(),ae(),te.current=P(),U.current+=P()-M.current,J.current+=P()-M.current,U.current=0,g.current=!1,w.current=!1,R.current=!1,f.current=0,z.current=0,h.current&&!l&&h.current.reset(),k||de(),!0),[A,g,L,k,p,h]),ht=n.useCallback(l=>p.current?!1:(X(),ae(),(g.current||w.current)&&Ue(),g.current=!1,w.current=!1,R.current=!1,f.current=0,z.current=0,te.current=P(),h.current&&!l&&h.current.activate(),de(),!0),[A,g,w,p,L,h]),$e=n.useCallback((l=!1)=>p.current||R.current?!1:(f.current=pt(),R.current=!0,he(),X(),h.current&&!l&&h.current.pause(),!0),[A,p,h]),Ge=n.useCallback((l=!1)=>p.current||!R.current?!1:(R.current=!1,w.current||ae(),g.current||de(f.current),z.current&&(z.current=P()),h.current&&!l&&h.current.resume(),!0),[A,L,p,f,h]),qt=n.useCallback((l,F)=>(h.current?(F&&ye.current(l,q),h.current.message(l)):F&&ye.current(l,q),!0),[y]),Wt=n.useCallback(()=>g.current,[g]),Ht=n.useCallback(()=>w.current,[w]),Gt=n.useCallback(()=>h.current?h.current.isLeader:null,[h]),Kt=n.useCallback(()=>h.current?h.current.isLastActive:null,[h]),Jt=n.useCallback(()=>h.current?h.current.token:null,[h]),pt=n.useCallback(()=>{if(R.current)return f.current;let l=f.current?f.current:G.current+L.current,F=N.current?P()-N.current:0,ze=Math.floor(l-F);return ze<0?0:Math.abs(ze)},[L,G,w,f,N]),ft=n.useCallback(()=>Math.round(P()-te.current),[te]),mt=n.useCallback(()=>Math.round(P()-H.current),[H]),Yt=n.useCallback(()=>M.current?new Date(M.current):null,[M]),Zt=n.useCallback(()=>N.current?new Date(N.current):null,[N]),gt=n.useCallback(()=>g.current?Math.round(P()-M.current+U.current):Math.round(U.current),[M,U]),vt=n.useCallback(()=>g.current?Math.round(P()-M.current+J.current):Math.round(J.current),[M,J]),Xt=n.useCallback(()=>{let l=Math.round(ft()-gt());return l>=0?l:0},[M,U]),Qt=n.useCallback(()=>{let l=Math.round(mt()-vt());return l>=0?l:0},[M,U]);n.useEffect(()=>{if(b>0&&C>0)throw new Error("❌ onAction can either be throttled or debounced, not both.");u&&Un(u);let l=()=>{h.current&&h.current.close(),ue.cancel&&ue.cancel(),X(),he(!0)};return ne&&window.addEventListener("beforeunload",l),()=>{ne&&window.removeEventListener("beforeunload",l),h.current&&h.current.close(),ue.cancel&&ue.cancel(),X(),he(!0)}},[]),n.useEffect(()=>{h.current&&h.current.close(),V?h.current=new Kn({channelName:W,leaderElection:D,onPrompt:()=>{ut()},onIdle:()=>{dt()},onActive:()=>{Ue()},onMessage:l=>{ye.current(l,q)},start:pe,reset:He,activate:ht,pause:$e,resume:Ge}):h.current=null},[V,W,D,Z,be,xe,ye,pe,He,$e,Ge]),n.useEffect(()=>{_.current||(X(),he(!0)),!(k||O)&&(I?pe():ae())},[k,I,O,_]),n.useEffect(()=>{if(!_.current){let l=[...new Set([...i,...o]).values()];if(he(),ce.current=l,re.current=a,ie.current=o,k||O)return;I?pe():ae()}},[a,JSON.stringify(i),JSON.stringify(o),_,O,k,I]),n.useEffect(()=>{_.current&&(_.current=!1)},[_]);let q={message:qt,start:pe,reset:He,activate:ht,pause:$e,resume:Ge,isIdle:Wt,isPrompted:Ht,isLeader:Gt,isLastActiveTab:Kt,getTabId:Jt,getRemainingTime:pt,getElapsedTime:ft,getTotalElapsedTime:mt,getLastIdleTime:Yt,getLastActiveTime:Zt,getIdleTime:gt,getTotalIdleTime:vt,getActiveTime:Xt,getTotalActiveTime:Qt,setOnPresenceChange:l=>{c=l,$.current=l},setOnPrompt:l=>{d=l,Z.current=l},setOnIdle:l=>{m=l,be.current=l},setOnActive:l=>{j=l,xe.current=l},setOnAction:l=>{x=l,Ae.current=l},setOnMessage:l=>{y=l,ye.current=l}};return q}var Qn=n.createContext(null);Qn.Consumer;const es=({onIdle:e,onAction:r,idleTime:s=1})=>{const a=1e3*s,[i,u]=n.useState(!1),o=()=>{u(!0)},c=Xn({timeout:a,promptTimeout:a/2,onPrompt:e,onIdle:o,debounce:500,crossTab:!0,onAction:r,events:["mousemove","keydown","mousedown","touchstart","scroll","click","focus","resize","visibilitychange","pagehide","pageshow","beforeunload"]});return{isIdle:i,setIdle:u,idleTimer:c}},Is=e=>{const r=Pr(),[s,a]=n.useState(!1),{mutate:i}=Et(),u=()=>{a(!0)},o=()=>{const f=localStorage.getItem("lastLoginAttemp"),g=new Date(f??new Date),w=parseInt(localStorage.getItem("expires")??"600");console.log(g),g.setSeconds(g.getSeconds()+w),g.getTime()-new Date().getTime()<2e4&&z()},{idleTimer:c}=es({onIdle:u,idleTime:parseInt(localStorage.getItem("expires")??"600"),onAction:o}),d=()=>{i(),a(!1)},m=wt(f=>f.collapsed),[j,x]=n.useState(null),[y,b]=n.useState(""),[C,v]=n.useState(null),I=!!j,k=!!C,E=wt(f=>f.hasSidebar),{setSiderCollapsed:V,setMobileSiderOpen:W}=Or(),B=f=>{x(f.currentTarget)},D=()=>{v(null)},O=()=>{x(null),D()},H=f=>{v(f.currentTarget)},te="primary-search-account-menu",M=t.jsxs(Xe,{anchorEl:j,anchorOrigin:{vertical:"top",horizontal:"right"},id:te,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:I,onClose:O,children:[t.jsx(Pe,{onClick:O,children:"Profile"}),t.jsx(Pe,{onClick:O,children:"My account"})]}),N="primary-search-account-menu-mobile",U=t.jsxs(Xe,{anchorEl:C,anchorOrigin:{vertical:"top",horizontal:"right"},id:N,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:k,onClose:D,children:[t.jsxs(Pe,{children:[t.jsx(Me,{size:"large","aria-label":"show 4 new mails",color:"inherit",children:t.jsx(Mt,{badgeContent:4,color:"error",children:t.jsx(Bt,{})})}),t.jsx("p",{children:"Messages"})]}),t.jsxs(Pe,{children:[t.jsx(Me,{size:"large","aria-label":"show 17 new notifications",color:"inherit",children:t.jsx(Mt,{badgeContent:17,color:"error",children:t.jsx(Ft,{})})}),t.jsx("p",{children:"Notifications"})]}),t.jsxs(Pe,{onClick:B,children:[t.jsx(Me,{size:"large","aria-label":"account of current user","aria-controls":"primary-search-account-menu","aria-haspopup":"true",color:"inherit",children:t.jsx(_t,{})}),t.jsx("p",{children:"Profile"})]})]}),J=ge.tenantNames,z=async()=>{const{data:f}=await K.custom({url:"",method:"post",meta:{operation:"refreshToken",variables:{token:{value:localStorage.getItem("token"),type:"String",required:!0},sessionKey:{value:localStorage.getItem("sessionKey"),type:"String",required:!1}},fields:["success","message","expires","token","sessionKey"]}}).catch(()=>({data:null})).then(g=>g);f!=null&&f.success?(localStorage.setItem("lastLoginAttemp",new Date().toString()),localStorage.setItem("token",f.token),localStorage.setItem("sessionKey",f.sessionKey),localStorage.setItem("expires",f.expires),a(!1),c.reset()):d()};return n.useEffect(()=>{b(r.pathname.split("/")[1].toString())},[r]),t.jsxs(je,{position:"fixed",sx:{width:"100%",zIndex:100},children:[t.jsx(Tr,{position:"fixed",children:t.jsxs(Nr,{children:[E&&t.jsx(Me,{size:"large",edge:"start",color:"inherit","aria-label":"open drawer",sx:{mr:2},onClick:()=>{W(!0)},children:t.jsx(zt,{})}),!E&&t.jsx(je,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:t.jsx(Fe,{to:"/",children:t.jsx(Rr,{src:ge.brandLogo,sx:{width:50,height:50,mr:1,border:"1px solid #ccc"}})})}),!m&&y.length==0&&t.jsx(It,{variant:"h6",noWrap:!0,component:Fe,to:"/",sx:{display:{xs:"none",sm:"block"},textDecoration:"none",textTransform:"none",color:"black",fontWeight:"bold"},children:ge.system_name}),(m||ge.appWithNoSidebar.includes(y))&&t.jsxs(It,{variant:"h6",noWrap:!0,component:Fe,to:"/",sx:{display:{xs:"none",sm:"block"},textDecoration:"none",textTransform:"none",color:"black",fontWeight:"bold"},children:[ge.system_name," | ",J[y]||y]}),t.jsx(je,{sx:{flexGrow:1}}),t.jsx(je,{sx:{display:{xs:"flex",md:"flex"}},children:t.jsx(Rn,{})}),t.jsx(je,{sx:{display:{xs:"none",md:"none"}},children:t.jsx(Me,{size:"large","aria-label":"show more","aria-controls":N,"aria-haspopup":"true",onClick:H,color:"inherit",children:t.jsx(Vt,{})})})]})}),U,M,t.jsx($r,{closable:!1,centered:!0,open:s,onOk:()=>{},onCancel:()=>{},footer:[],children:t.jsxs(je,{sx:{padding:"20px",textAlign:"center",fontSize:"1.4em"},children:[t.jsx("p",{children:"Your session has expired. Please log in again."}),t.jsx(Fe,{to:"/login",children:t.jsx(Ie,{children:"Login"})})]})})]})};export{Is as Header};
