import{r as a,F as S,m as W,j as e,R as Q,n as M,I as B,aN as X,e as V,a as C,at as Y,h4 as xe,h5 as pe,aI as ee,aA as z,bx as fe,av as te,aw as F,aE as se,ax as ne,ak as ae,A as je,aH as E,_ as r,g as D,aR as re,S as ye,aV as N,aK as Se,i as ve}from"./index-d9f4923f.js";import{e as $,f as be,g as Ae}from"./data_objects-446cebf4.js";import{R as ie}from"./ReactTimeAgo-cfa8a546.js";import{M as L}from"./index-c3f2bf11.js";import{C as Ie}from"./ckeditor-7cc783e5.js";import{D as ke}from"./index-ab184d43.js";const{Dragger:De}=E,J=window.innerHeight*.6,Ne=s=>{var K,G;const[o,m]=a.useState(!1),[g,x]=a.useState([]),[i,l]=a.useState(!1),[d,u]=a.useState(!0),[T,v]=a.useState(1),[j,O]=a.useState(10),[q,b]=a.useState(""),[_]=S.useForm(),[Z,H]=a.useState(0),[n,c]=a.useState(0),[p,y]=a.useState(!0);W();const R=t=>{const h=["pdf","xls","xlsx","xlx","docx","doc","odt","ods","ppt","pptx","txt"],A=t.name.split(".").pop();return h.indexOf(A)===-1?(r.error("File type not supported"),E.LIST_IGNORE):t.size/1024/1024>50?(r.error("File size too large"),E.LIST_IGNORE):!0},P=async t=>{l(!0);const{onSuccess:h,onError:A,file:f,onProgress:U}=t,{data:w}=await D.custom({url:"",method:"post",meta:{operation:"uploadDarasaAssignmentAttachment",variables:{file:{value:f,type:"Upload",required:!0},title:{value:f.name,type:"String",required:!1},size:{value:f.size,type:"Decimal",required:!1},id:{value:parseInt(s.assignment===void 0?"0":s.assignment.id.toString()),type:"Int",required:!0}},onUploadProgress:I=>{const{loaded:me,total:ge}=I,he=Math.floor(me*100/ge);U(he)},onError:I=>{A(I),r.error(I.message)},fields:["success","message",{attachment:$}]}}).catch(()=>(r.error("Error uploading file"),{data:null})).then(I=>I);w&&(w.success?(de(),h("ok"),r("File(s) uploaded successfully")):r.error(w.message)),l(!1)},k=async(t,h="",A=!1)=>{var U,w;u(!0);const{data:f}=await D.custom({url:"",method:"get",meta:{operation:"assignmentDocuments",variables:{page:{value:parseInt(t.toString()),type:"Int",required:!1},pageSize:{value:parseInt(j.toString()),type:"Int",required:!1},key:{value:h,type:"String",required:!1},id:{value:parseInt(((U=s.assignment)==null?void 0:U.id)===void 0?"0":(w=s.assignment)==null?void 0:w.id.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:$}]}}).catch(()=>(r.error("Error fetching attachments"),{data:null})).then(I=>I);f&&(c(f.total),H(f.pages),v(f.page+1),y(f.hasNext),x([...g,...f.results])),u(!1)},oe=async t=>{const{data:h}=await D.custom({url:"",method:"post",meta:{operation:"deleteDarasaAssignmentAttachment",variables:{id:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(r.error("Error deleting attachment"),{data:null})).then(A=>A);h&&(h.success?(r.success(h.message),x(g.filter(A=>A.id.toString()!==t.toString()))):r.error(h.message)),L.destroyAll()},le=t=>{L.confirm({title:"Confirm",icon:e.jsx(re,{}),content:"Are you sure you want to delete this attachment?",okText:"Yes",cancelText:"Cancel",onOk:()=>oe(t)})},de=async()=>{k(1)},ce=t=>{p&&!d&&t.currentTarget.scrollHeight-t.currentTarget.scrollTop===J&&k(T,q)},ue=async()=>{b(""),g.length=0,x([]),k(1)};return a.useEffect(()=>{x([]),k(1)},[s.assignment]),e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[!o&&e.jsxs(e.Fragment,{children:[e.jsx(M,{span:10,children:e.jsx(S,{layout:"vertical",form:_,onFinish:t=>{g.length=0,x([]),v(1),b(t.key),k(0,t.key,!0)},children:e.jsx(S.Item,{name:"key",children:e.jsx(B,{size:"large",placeholder:"Search Attachment(s)...",prefix:e.jsx(X,{}),autoComplete:"off",allowClear:!0,onChange:t=>{t.target.value===""&&ue()}})})})}),e.jsxs(M,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:[((K=s.assignment)==null?void 0:K.attachmentZippedFolderPath)&&e.jsx(V,{title:"Click To Download All Files Zipped",placement:"bottomRight",children:e.jsx(C,{size:"large",icon:e.jsx(Y,{}),onClick:()=>{var t;window.open((t=s.assignment)==null?void 0:t.attachmentZippedFolderPath,"_blank")},danger:!0,children:"Download All"})}),((G=s.assignment)==null?void 0:G.canUploadAttachment)&&e.jsx(V,{title:"Add more Assignment Attachments",placement:"bottomRight",children:e.jsx(C,{size:"large",icon:e.jsx(xe,{}),disabled:!s.canManage,onClick:()=>{m(!o)},danger:!0,children:"Add Attachement"})})]})]}),o&&e.jsx(e.Fragment,{children:e.jsx(M,{span:24,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(C,{size:"large",icon:e.jsx(pe,{}),onClick:()=>{m(!o)},children:"Attachments"})})})]}),o&&e.jsx("div",{style:{marginTop:30},children:e.jsxs(De,{customRequest:P,beforeUpload:R,multiple:!0,accept:".pdf, .xls, .xlsx, .xlx, .docx, .doc, .odt, .ods, .ppt,.pptx,.txt",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ee,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload"})]})}),!o&&e.jsxs("div",{children:[e.jsx(z,{split:!1,loading:d,size:"small",children:e.jsx(fe,{data:g,height:J,itemHeight:100,itemKey:t=>t.id.toString(),onScroll:ce,children:t=>e.jsx(z.Item,{style:{margin:0,padding:0},actions:[e.jsx(te,{trigger:["click"],placement:"topRight",overlay:e.jsxs(F,{children:[e.jsx(F.Item,{icon:e.jsx(Y,{}),children:e.jsx("a",{target:"_blank",href:t.file,rel:"noopener noreferrer",download:!0,children:"Download"})}),e.jsx(F.Item,{icon:e.jsx(se,{}),disabled:!t.canDelete,children:e.jsx("a",{rel:"noopener noreferrer",onClick:()=>le(t.id),children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:h=>h.preventDefault(),children:e.jsx(ne,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})],children:e.jsx(z.Item.Meta,{style:{paddingBottom:0,borderBottom:"1px solid #e8e8e8"},avatar:e.jsx(ae,{src:t.icon}),title:e.jsx("a",{children:t.title}),description:e.jsxs(e.Fragment,{children:[e.jsx("p",{}),e.jsxs("p",{children:[e.jsx("span",{style:{color:"orange"},children:t.size})," |",e.jsx(ie,{date:new Date(t.created),locale:"en-US"})]})]})})},"file-"+t.id)})}),g.length>0&&!p&&e.jsx("div",{style:{textAlign:"center",marginTop:20},children:e.jsx(je,{message:"No more attachments",type:"info"})})]})]})},Me=s=>{const[o,m]=a.useState([]),[g,x]=a.useState(!0),[i,l]=a.useState(1);a.useState(25);const[d]=S.useForm(),[u,T]=a.useState(0),[v,j]=a.useState(0),[O,q]=a.useState(!0);W();const b=async(n,c="",p=!1)=>{var R,P;const{data:y}=await D.custom({url:"",method:"get",meta:{operation:"assignmentSubmissions",variables:{page:{value:parseInt(n.toString()),type:"Int",required:!0},key:{value:c,type:"String",required:!1},id:{value:parseInt(((R=s.assignment)==null?void 0:R.id)===void 0?"0":(P=s.assignment)==null?void 0:P.id.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:be}]}}).catch(()=>(r.error("Error fetching submissions"),{data:null})).then(k=>k);y&&(j(y.total),T(y.pages),l(y.page),q(y.hasNext),(c.length>0||c.length===0&&p)&&m(y.results),y.results.length>0&&!p&&m(o.concat(y.results))),x(!1)},_=async n=>{const{data:c}=await D.custom({url:"",method:"post",meta:{operation:"deleteAssignmentSubmission",variables:{id:{value:n,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(r.error("Error deleting submission"),{data:null})).then(p=>p);c&&(c.success?(r.success(c.message),m(o.filter(p=>p.id.toString()!==n.toString()))):r.error(c.message)),L.destroyAll()},Z=async()=>{var c;const{data:n}=await D.custom({url:"",method:"post",meta:{operation:"downloadAssignmentSubmissionWorksZipped",variables:{assignmentId:{value:parseInt(((c=s.assignment)==null?void 0:c.id.toString())??"0"),type:"Int",required:!0}},fields:["success","message","zipFile"]}}).catch(()=>(r.error("Error downloading submissions"),{data:null})).then(p=>p);n&&(n.success?(r.success(n.message),window.open(n.zipFile,"_blank")):r.error(n.message))},H=n=>{L.confirm({title:"Confirm",icon:e.jsx(re,{}),content:"Are you sure you want to delete this Submission?",okText:"Yes",cancelText:"Cancel",onOk:()=>_(n)})};return a.useEffect(()=>{m([]),b(1)},[s.assignment]),e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[e.jsx(M,{span:14,children:e.jsx(S,{layout:"vertical",form:d,onFinish:n=>b(0,n.key,!0),children:e.jsx(S.Item,{name:"key",children:e.jsx(B,{size:"large",placeholder:"Search Assignment(s) Work ...",prefix:e.jsx(X,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(M,{span:10,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(C,{icon:e.jsx(Y,{}),size:"large",onClick:Z,disabled:o.length===0||s.canManage===!1,children:"Download All Zipped"})})]}),e.jsxs("div",{id:"scrollableDiv",style:{height:"60vh",overflow:"auto"},children:[e.jsx(ye,{spinning:g,children:e.jsx(z,{itemLayout:"horizontal",dataSource:o,renderItem:n=>e.jsx("div",{style:{background:"white",marginBottom:5,paddingLeft:10,paddingTop:10},children:e.jsx(z.Item,{style:{margin:0,padding:0},actions:[e.jsx(te,{trigger:["click"],overlay:e.jsxs(F,{children:[e.jsx(F.Item,{icon:e.jsx(Y,{}),children:e.jsx("a",{target:"_blank",href:n.file,rel:"noopener noreferrer",download:!0,children:"Download"})}),e.jsx(F.Item,{icon:e.jsx(se,{}),disabled:!n.canDelete,children:e.jsx("a",{rel:"noopener noreferrer",onClick:()=>H(n.id),children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:c=>c.preventDefault(),children:e.jsx(ne,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})],children:e.jsx(z.Item.Meta,{style:{paddingBottom:0,borderBottom:"1px solid #e8e8e8"},avatar:e.jsx(ae,{src:n.icon}),title:e.jsx("a",{children:n.student.user.firstName+" "+n.student.user.middleName+" "+n.student.user.lastName}),description:e.jsxs(e.Fragment,{children:[e.jsx("p",{}),e.jsxs("p",{children:[e.jsx("span",{style:{color:"orange"},children:n.size})," |",e.jsx(ie,{date:new Date(n.created),locale:"en-US"})]})]})})},"file-"+n.id)})})}),O&&e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:10},children:e.jsx(C,{type:"primary",onClick:()=>{b(i+1)},children:"Load More"})})]})]})},{Dragger:we}=E,Oe=s=>{const[o,m]=a.useState(!1);W();const g=i=>{const l=["pdf","xls","xlsx","xlx","docx","doc","odt","ods","ppt","pptx","txt"],d=i.name.split(".").pop();return l.indexOf(d)===-1?(r.error("File type not supported"),E.LIST_IGNORE):i.size/1024/1024>50?(r.error("File size too large"),E.LIST_IGNORE):!0},x=async i=>{m(!0);const{onSuccess:l,onError:d,file:u,onProgress:T}=i,{data:v}=await D.custom({url:"",method:"post",meta:{operation:"submittAssignmentWork",variables:{work:{value:u,type:"Upload",required:!0},extension:{value:u.name.split(".").pop(),type:"String",required:!1},size:{value:u.size,type:"Decimal",required:!1},id:{value:parseInt(s.assignment===void 0?"0":s.assignment.id.toString()),type:"Int",required:!0}},onUploadProgress:j=>{const{loaded:O,total:q}=j,b=Math.floor(O*100/q);T(b)},onError:j=>{d(j),r.error(j.message)},fields:["success","message",{assignment:Ae}]}}).catch(()=>(r.error("Error uploading file"),{data:null})).then(j=>j);v&&(v.success?(l("ok"),r("Assignment uploaded successfully"),s.onFinish(v.assignment)):(d(v.message),r.error(v.message))),m(!1)};return a.useEffect(()=>{},[s.assignment]),e.jsx(e.Fragment,{children:e.jsx("div",{style:{marginTop:30},children:e.jsxs(we,{customRequest:x,beforeUpload:g,multiple:!0,accept:".pdf, .xls, .xlsx, .xlx, .docx, .doc, .odt, .ods, .ppt,.pptx,.txt",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ee,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload"})]})})})},Re=s=>{const[o,m]=a.useState(!0),[g,x]=a.useState("");return a.useEffect(()=>{var i,l,d,u;s.form.setFieldsValue({title:(i=s.assignment)==null?void 0:i.title,description:(l=s.assignment)==null?void 0:l.description,deadline:N((d=s.assignment)==null?void 0:d.deadline),online:(u=s.assignment)==null?void 0:u.onlineSubmission})},[s.assignment,s.form]),e.jsx(e.Fragment,{children:e.jsxs(S,{layout:"vertical",form:s.form,onFinish:i=>{i.online=o,i.description=g,s.onFinish(i)},requiredMark:!1,children:[e.jsx(S.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Title"}],children:e.jsx(B,{size:"large",placeholder:"Enter Title ..."})}),e.jsx(S.Item,{name:"online",children:e.jsx(Se,{checked:o,onChange:()=>m(!o),children:"Online Submit Assignment Work"})}),e.jsx(S.Item,{name:"deadline",label:"Deadline",rules:[{required:!0,type:"date",message:"Please select Deadline"}],children:e.jsx(ke,{showTime:{format:"HH:mm"},onChange:()=>{console.log("change")},disabledDate:i=>{var d,u;let l;return N().isAfter(N((d=s.assignment)==null?void 0:d.deadline))?l=N((u=s.assignment)==null?void 0:u.deadline).format("YYYY-MM-DD"):l=N().format("YYYY-MM-DD"),i&&i<ve(l,"YYYY-MM-DD")},style:{width:"100%"},popupStyle:{zIndex:9999}})}),e.jsx("h3",{children:"Assignment Description"}),e.jsx(Ie,{onChange:i=>{x(i)}}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(C,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})};export{Ne as A,Re as E,Me as a,Oe as b};
