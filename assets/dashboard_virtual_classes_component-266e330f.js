import{r,F as p,m as B,j as e,aC as E,R as H,n as R,I as U,aN as W,B as X,aA as j,k as G,av as K,aw as c,at as Q,aE as Z,aX as $,aB as k,b4 as ee,e9 as te,ax as ae,ak as se,_ as n,ah as f,aV as b,a as re,M as I,g as u,aR as ne,S as ie,aj as le}from"./index-d9f4923f.js";import{E as oe}from"./edit_class_virtual_form-331bd0d2.js";import{M as ce}from"./index-c3f2bf11.js";import"./ckeditor-7cc783e5.js";import"./ckeditor-2d6c4104.js";import"./index-ab184d43.js";import"./index-0d548680.js";import"./PickerPanel-adf5703b.js";import"./localeData-7e1ac95b.js";import"./RangePicker-ba6ee425.js";import"./index-1e413543.js";import"./InputNumber-218fc870.js";import"./DialogWrap-994988aa.js";import"./index-6f06488e.js";const de=d=>{const[C,m]=r.useState(!1),[l,o]=r.useState([]),[h,N]=r.useState();r.useState();const[y,V]=r.useState(!0),[v,S]=r.useState(1),[ue,F]=r.useState(0),[T,w]=r.useState(!0),[q]=p.useForm();r.useState(!1);const{push:D}=B(),[Y]=p.useForm();r.useState(!1);const[A,x]=r.useState(!1),O=t=>{N(t),x(!0)},M=async(t,a)=>{const{data:s}=await u.custom({url:"",method:"post",meta:{operation:"endVirtualClass",variables:{id:{value:t,type:"Int",required:!0},stop:{value:a,type:"Boolean",required:!0}},fields:["success","message",{virtualClass:["id","name","description","startDate","endDate","duration","durationType","token","canJoin",{darasa:["id","name","code","description"]},{author:["id","firstName","lastName","middleName","fullName","email","pic"]},"created","canEdit","canDelete","canManage","updated","isActive","ended"]}]}}).catch(i=>(n.error("Error in Ending Virtual Class"),{data:null})).then(i=>i);s&&(s.success?(n(s.message),o(l.map(i=>i.id===t?s.virtualClass:i))):n.error(s.message))},_=async t=>{const{data:a}=await u.custom({url:"",method:"post",meta:{operation:"editVirtualClass",variables:{id:{value:t.id,type:"Int",required:!0},name:{value:t.name,type:"String",required:!0},description:{value:t.description,type:"String",required:!0},duration:{value:t.duration,type:"Int",required:!0},durationType:{value:t.durationType.toUpperCase(),type:"String",required:!0},startDate:{value:t.startDate,type:"DateTime",required:!0},isPublic:{value:!0,type:"Boolean",required:!0}},fields:["success","message",{virtual:["id","name","description","startDate","endDate","duration","durationType","token","canJoin",{darasa:["id","name","code","description"]},{author:["id","firstName","lastName","middleName","fullName","email","pic"]},"created","canEdit","canDelete","canManage","updated","isActive"]}]}}).catch(s=>(n.error("Error editing class"),{data:null})).then(s=>s);a&&(a.success?(n.success(a.message),o(l.map(s=>s.id===a.virtual.id?a.virtual:s)),x(!1)):n.error(a.message))},z=async t=>{const{data:a}=await u.custom({url:"",method:"post",meta:{operation:"deleteVirtualClass",variables:{id:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(s=>(n.error("Error deleting class"),{data:null})).then(s=>s);a&&(a.success?(n.success(a.message),o(l.filter(s=>s.id!==t))):n.error(a.message))},J=t=>{ce.confirm({title:"Deleting Virtual Class",icon:e.jsx(ne,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>z(t)})},g=async(t,a="",s=!1)=>{const{data:i}=await u.custom({url:"",method:"get",meta:{operation:"myVirtualClasses",variables:{page:{value:t,type:"Int",required:!0},key:{value:a,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","startDate","endDate","duration","durationType","token","canJoin","ended",{darasa:["id","name","code","description"]},{author:["id","firstName","lastName","middleName","fullName","email","pic"]},"created","canEdit","canDelete","canManage","updated","isActive"]}]}}).catch(()=>(n.error("Error fetching classes"),{data:null})).then(P=>P);i&&(F(i.total),S(i.page),w(i.hasNext),o(i.results)),V(!1)},L=async()=>{const{data:t}=await u.custom({url:"",method:"get",meta:{operation:"darasaAuth",variables:{},fields:["auth"]}}).catch(a=>(n.error("Error getting darasa auth"),{data:null})).then(a=>a);t&&m(t.auth.create_virtual_classes)};return r.useEffect(()=>{L(),g(v)},[]),y?e.jsx(e.Fragment,{children:e.jsx(E,{loading:y,active:!0})}):e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsx(R,{span:14,children:e.jsx(p,{layout:"vertical",form:q,onFinish:t=>{S(0),g(0,t.key,!0)},children:e.jsx(p.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search Public Virtual Classes...",prefix:e.jsx(W,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsxs(X,{sx:{height:"68vh"},children:[e.jsx(j,{loading:!1,itemLayout:"horizontal",loadMore:!1,dataSource:l,renderItem:t=>e.jsx(G,{children:e.jsx(j.Item,{actions:[e.jsx(K,{trigger:["click"],overlay:e.jsxs(c,{children:[e.jsx(c.Item,{icon:e.jsx(Q,{}),disabled:!t.canJoin,onClick:()=>D("/oclass/virtual/class/session/"+t.id+"/"+t.token),children:e.jsx("a",{children:"Join"})}),t.canDelete?e.jsx(c.Item,{disabled:!t.canDelete,icon:e.jsx(Z,{}),onClick:()=>J(t.id),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}):e.jsx(e.Fragment,{}),t.canManage&&e.jsx(c.Item,{icon:e.jsx($,{}),disabled:!t.canManage,onClick:()=>O(t),children:e.jsx("a",{children:"Edit"})}),t.ended?e.jsx(k,{title:"Un-Stoping Virtual Class",onConfirm:()=>M(t.id,!1),okText:"Yes",cancelText:"No",disabled:!t.canManage,overlayStyle:{zIndex:9999},children:e.jsx(c.Item,{icon:e.jsx(ee,{}),disabled:!t.canManage,children:e.jsx("a",{children:"Un-Stop"})})}):e.jsx(k,{title:"Ending/Stoping Virtual Class",onConfirm:()=>M(t.id,!0),okText:"Yes",cancelText:"No",disabled:!t.canManage,overlayStyle:{zIndex:9999},children:e.jsx(c.Item,{icon:e.jsx(te,{}),disabled:!t.canManage,children:e.jsx("a",{children:"End/Stop"})})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:a=>a.preventDefault(),children:e.jsx(ae,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})],children:e.jsx(E,{avatar:!0,title:!1,loading:!1,active:!0,children:e.jsx(j.Item.Meta,{avatar:e.jsx(se,{}),title:e.jsx("a",{onClick:()=>t.canJoin?D("/oclass/virtual/class/session/"+t.id+"/"+t.token):n("You can't join this class"),children:t.name}),description:e.jsxs(e.Fragment,{children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:t.description}}),e.jsxs("p",{children:[e.jsxs(f,{color:"green",children:["Start At:"," ",e.jsx("span",{style:{marginLeft:10},children:b(t.startDate).format("MMMM do, YYYY H:mma")})]}),e.jsxs(f,{color:"green",children:["End In:",e.jsx("span",{style:{marginLeft:10},children:b(t.endDate).format("MMMM do, YYYY H:mma")})]}),t.canJoin?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsx(f,{color:"red",children:"Not Joinable"})})]})]})})})})})}),T&&e.jsx("div",{style:{textAlign:"center",marginTop:12,height:32,lineHeight:"32px"},children:e.jsx(re,{type:"primary",onClick:()=>{g(v+1)},children:"Load More"})})]}),e.jsx(I,{title:"Editting "+(h==null?void 0:h.name),width:"40vw",open:A,onClose:t=>x(t),children:e.jsx(oe,{form:Y,darasa:h,onFinish:_})})]})},ke=d=>{var l;const[C,m]=r.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(ie,{spinning:d.loading,children:e.jsx("a",{onClick:()=>m(!0),children:e.jsx("span",{children:e.jsxs(le,{children:[e.jsx("span",{style:{marginRight:10,fontSize:24,color:"green",fontWeight:"bolder"},children:(l=d==null?void 0:d.data)==null?void 0:l.total_virtual_classes}),e.jsx("span",{style:{fontSize:18},children:"Virtual Classess"})]})})})}),e.jsx(I,{title:"Virtual Classes",width:"60vw",open:C,onClose:o=>m(o),footer:[],children:e.jsx(de,{})})]})};export{ke as DashboardVirtualClassesComponent};
