import{r as a,dI as xt,V as gt,j as e,F as c,R as Z,n as B,I as U,aN as ce,an as ge,aj as ae,e as W,a as q,b3 as Qe,b2 as we,g as E,_ as u,b5 as ye,ah as M,ag as Ie,dJ as xe,i as ne,aB as ee,aE as Ce,S as qe,af as yt,aK as _e,bz as pt,aD as jt,aF as Y,bm as Ze,dK as et,M as de,d as Ee,aU as G,aX as R,a$ as Pe,A as be,aA as me,b7 as Oe,am as le,aS as Se,by as tt,m as at,dL as ft,aY as st,be as nt,cX as bt,dM as St,k as vt,db as Re,av as rt,aw as he,ax as it,dN as Ge,aT as Ue,dO as Tt,b1 as It,dP as Ye}from"./index-8383052a.js";import{t as Ct}from"./text_truncate-315d9efa.js";import{D as ve}from"./index-05816c56.js";import{C as Et}from"./index-8daac8ac.js";import{D as Te}from"./index-98d518bb.js";import{R as Le}from"./ReactTimeAgo-50ae14ef.js";import{u as At}from"./utc-006f5c23.js";import{I as lt}from"./index-4a3eabae.js";import"./index-9a331c4e.js";import"./PickerPanel-03789d05.js";import"./localeData-23d6edf5.js";import"./RangePicker-2155f470.js";import"./memoize-one.esm-297ddbcb.js";import"./InputNumber-f580c739.js";var kt=globalThis&&globalThis.__rest||function(t,y){var i={};for(var m in t)Object.prototype.hasOwnProperty.call(t,m)&&y.indexOf(m)<0&&(i[m]=t[m]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,m=Object.getOwnPropertySymbols(t);r<m.length;r++)y.indexOf(m[r])<0&&Object.prototype.propertyIsEnumerable.call(t,m[r])&&(i[m[r]]=t[m[r]]);return i};const{TimePicker:_t,RangePicker:wt}=Te,qt=a.forwardRef((t,y)=>a.createElement(wt,Object.assign({},t,{picker:"time",mode:void 0,ref:y}))),Fe=a.forwardRef((t,y)=>{var{addon:i,renderExtraFooter:m}=t,r=kt(t,["addon","renderExtraFooter"]);const j=a.useMemo(()=>{if(m)return m;if(i)return i},[i,m]);return a.createElement(_t,Object.assign({},r,{mode:void 0,ref:y,renderExtraFooter:j}))}),ot=xt(Fe,"picker");Fe._InternalPanelDoNotUseOrYouWillBeFired=ot;Fe.RangePicker=qt;Fe._InternalPanelDoNotUseOrYouWillBeFired=ot;const ue=Fe,Ft=gt(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),Mt=t=>{a.useState();const[y,i]=a.useState([]),[m,r]=a.useState(0),[j,T]=a.useState(!0),[I,P]=a.useState(10),[_,n]=a.useState(""),[d]=c.useForm(),f=[{title:"Student",dataIndex:"student",fixed:!0,render:(w,A,v)=>e.jsx("span",{children:e.jsxs(ae,{direction:"vertical",children:[e.jsx("a",{children:A.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#"}),":"," ",A.member.registrationNumber]})]})})},{title:"",dataIndex:"status",render:(w,A,v)=>e.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[e.jsx("span",{style:{margin:5},children:e.jsx(W,{title:"Take as Present",color:"green",children:e.jsx(q,{icon:e.jsx(Qe,{style:{color:"green"}}),onClick:()=>C(A.id,t.event.id,1)})})}),e.jsx("span",{style:{margin:5},children:e.jsx(W,{title:"Take as Absent",color:"red",children:e.jsx(q,{icon:e.jsx(we,{style:{color:"red"}}),onClick:()=>C(A.id,t.event.id,2)})})})]})}],C=async(w,A,v)=>{const{data:b}=await E.custom({url:"",method:"post",meta:{operation:"takeAttendance",variables:{studentId:{value:w,type:"Int",required:!0},entryId:{value:A,type:"Int",required:!0},present:{value:v,type:"Int",required:!0}},fields:["success","message"]}}).catch(z=>({data:null})).then(z=>z);b&&b.success&&(u.success(b.message),F(1,"",10),t.onAdd()),T(!1)},F=async(w,A="",v=20)=>{T(!0);const{data:b}=await E.custom({url:"",method:"get",meta:{operation:"studentsToTakeAttendance",variables:{page:{value:w,type:"Int",required:!0},key:{value:A,type:"String",required:!1},pageSize:{value:v,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]}]}}).catch(z=>({data:null})).then(z=>z);b&&(r(b.total),i([...b.results])),T(!1)};return a.useEffect(()=>{F(1,"",10)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{style:{marginTop:10},children:e.jsx(B,{span:24,children:e.jsx(c,{layout:"vertical",form:d,onFinish:w=>{n(w.key),y.length=0,F(1,w.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:j,columns:f,dataSource:y,pagination:{onChange:(w,A)=>{P(A),F(w,_,A)},total:m,pageSize:I,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"68vh"}})]})},Dt=t=>{const[y,i]=a.useState([]),[m,r]=a.useState(0),[j,T]=a.useState(!0),[I,P]=a.useState(20),[_,n]=a.useState(""),[d]=c.useForm(),C=!ye.useBreakpoint().lg,F=[{title:"Student",dataIndex:"student",fixed:!0,render:(A,v,b)=>e.jsx("span",{children:e.jsxs(ae,{direction:"vertical",children:[e.jsx("a",{children:v.student.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#:"}),e.jsx("span",{style:{marginLeft:10},children:v.student.member.registrationNumber})]})]})})},{title:"Status",dataIndex:"status",render:(A,v,b)=>e.jsx("span",{children:v.status===1?e.jsx("a",{children:e.jsx(M,{color:"green",children:v.statusDisplay})}):e.jsx("a",{children:e.jsx(M,{color:"red",children:v.statusDisplay})})})}],w=async(A,v="",b=20)=>{T(!0);const{data:z}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelAttendancesByDate",variables:{page:{value:A,type:"Int",required:!0},key:{value:v,type:"String",required:!1},pageSize:{value:b,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0},date:{value:t.date.format("YYYY/MM/DD"),type:"String",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(u.error("Error occured while fetching roles"),{data:null})).then(p=>p);z&&(r(z.total),i([...z.results])),T(!1)};return a.useEffect(()=>{w(1,"",20)},[t.randKey,t.date,t.event]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:C?24:16,children:e.jsx(c,{layout:"vertical",form:d,onFinish:A=>{n(A.key),y.length=0,w(1,A.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:C?24:2,children:e.jsx(q,{icon:e.jsx(ce,{}),size:"large",onClick:()=>d.submit()})})]}),e.jsx(ge,{loading:j,columns:F,dataSource:y,pagination:{onChange:(A,v)=>{P(v),w(A,_,v)},total:m,pageSize:I,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(100vh - 470px)"}})]})},$e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Nt=t=>{var K,oe;const[y,i]=a.useState([]),[m,r]=a.useState(0),[j,T]=a.useState(!0),[I,P]=a.useState(20),[_,n]=a.useState(""),[d]=c.useForm(),C=!ye.useBreakpoint().lg,[F,w]=a.useState(!1),[A,v]=a.useState(!1),[b,z]=a.useState(!1),[p,L]=a.useState(),S=async V=>{L(V),z(!0)},h=async V=>{v(!1),w(V)},l=[{title:"Student",dataIndex:"student",fixed:!0,render:(V,H,$)=>e.jsx("span",{children:e.jsxs(ae,{direction:"vertical",children:[e.jsx("a",{children:H.student.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#:"}),e.jsx("span",{style:{marginLeft:10},children:H.student.member.registrationNumber})]})]})})},{title:"Status",dataIndex:"status",render:(V,H,$)=>e.jsx("span",{children:H.status===1?e.jsx(ee,{title:"Are you sure to mark Absent?",onConfirm:()=>x(H.id,2),onCancel:()=>{},okText:"Absent",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{children:e.jsx(M,{color:"green",children:H.statusDisplay})})}):e.jsx(ee,{title:"Are you sure to mark as Present?",onConfirm:()=>x(H.id,1),onCancel:()=>{},okText:"Present",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{children:e.jsx(M,{color:"red",children:H.statusDisplay})})})})},{title:"",dataIndex:"status",render:(V,H,$)=>e.jsx(ee,{title:"Are you sure to delete this Attendance Entry?",onConfirm:()=>g(H.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ce,{})})})}],s=async(V,H="",$=20)=>{T(!0);const{data:te}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelAttendances",variables:{page:{value:V,type:"Int",required:!0},key:{value:H,type:"String",required:!1},pageSize:{value:$,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(u.error("Error occured while fetching roles"),{data:null})).then(Ae=>Ae);te&&(r(te.total),i([...te.results])),T(!1)},g=async V=>{const{data:H}=await E.custom({url:"",method:"post",meta:{operation:"deleteStudentAttendance",variables:{attendanceId:{value:parseInt(V.toString()),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(u.error("Error occured while deleting attendance entry"),{data:null})).then($=>$);H&&(H.success?(u.success(H.message),i(y.filter($=>$.id!==V))):u.error(H.message))},x=async(V,H)=>{const{data:$}=await E.custom({url:"",method:"post",meta:{operation:"updateStudentAttendance",variables:{attendanceId:{value:parseInt(V.toString()),type:"Int",required:!0},present:{value:H,type:"Int",required:!0}},fields:["success","message",{attendance:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(u.error("Error occured while updating attendance"),{data:null})).then(te=>te);$&&($.success?(u.success($.message),i(y.map(te=>parseInt(te.id.toString())===parseInt($.attendance.id.toString())?$.attendance:te))):u.error($.message)),T(!1)},D=async()=>{s(1,"",20)};return a.useEffect(()=>{s(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:C?24:16,children:e.jsx(c,{layout:"vertical",form:d,onFinish:V=>{n(V.key),y.length=0,s(1,V.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{disabled:A,size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:C?24:2,children:e.jsx(q,{disabled:A,icon:e.jsx(ce,{}),size:"large",onClick:()=>d.submit()})}),t.event.canTakeAttendance&&e.jsx(B,{span:C?24:6,children:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(W,{title:"Start Taking Attendance",children:e.jsx(q,{icon:e.jsx(Ie,{}),size:"large",onClick:()=>h(!0),children:"Take Attendance"})}),e.jsx(W,{title:"View Taken Attendances",children:e.jsx(q,{disabled:A,icon:e.jsx(xe,{}),size:"large",onClick:()=>v(!0),children:"View Attendances"})})]})}),!t.event.canTakeAttendance&&e.jsx(B,{span:C?24:6,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(W,{title:"View Taken Attendances",children:e.jsx(q,{disabled:A,icon:e.jsx(xe,{}),size:"large",onClick:()=>v(!0),children:"View Attendances"})})})})]}),A?e.jsx(e.Fragment,{children:e.jsx("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:e.jsx(Et,{onSelect:V=>{var H;if(V<ne().endOf("day")){const $=$e.indexOf((H=t==null?void 0:t.entry)==null?void 0:H.name)+1,te=V.day();$===te?S(V):u("No attendance taken on this day")}},disabledDate:V=>{var te;const H=$e.indexOf((te=t==null?void 0:t.entry)==null?void 0:te.name)+1,$=V.day();return V&&V>ne().endOf("day")||H!==$}})})}):e.jsx(ge,{loading:j,columns:l,dataSource:y,pagination:{onChange:(V,H)=>{P(H),s(V,_,H)},total:m,pageSize:I,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(100vh - 470px)"}}),e.jsx(ve,{title:"Taking Attendance",width:"28vw",anchor:"right",onClose:V=>w(V),open:F,children:e.jsx(Mt,{event:t.event,randKey:Math.random(),onAdd:D})}),e.jsx(ve,{title:((K=t.event)==null?void 0:K.subject.name)+" - "+((oe=t.event)==null?void 0:oe.educationLevel.name)+" Attendance taken on "+(p==null?void 0:p.format("YYYY MMM, DD")),width:"50vw",anchor:"left",onClose:V=>z(V),open:b,children:e.jsx(Dt,{event:t.event,date:p,randKey:Math.random()})})]})},{TextArea:Pt}=U,Lt=t=>{const[y,i]=a.useState(!1),[m,r]=a.useState(!1),[j,T]=a.useState([]),[I,P]=a.useState(null),[_,n]=a.useState(null),[d]=c.useForm(),[f,C]=a.useState(!1),[F,w]=a.useState(!1),v=!ye.useBreakpoint().lg,b=(S,h)=>{P(h),n(S),C(!0)},z=async S=>{const{data:h}=await E.custom({url:"",method:"post",meta:{operation:"openTimetableEntry",variables:{entryId:{value:S,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(u.error("Something Went Wrong ..."),{data:null})).then(l=>l);h&&(h.success?(u.success(h.message),L()):u.error(h.message))},p=async S=>{const{data:h}=await E.custom({url:"",method:"post",meta:{operation:"cancelTimetableEntry",variables:{entryId:{value:S.entryId,type:"Int",required:!0},reason:{value:S.reason,type:"String",required:!0},verify:{value:S.notify,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(()=>(u.error("Something Went Wrong ..."),{data:null})).then(l=>l);h&&(h.success?(u.success(h.message),d.resetFields(),L()):u.error(h.message))},L=async()=>{i(!0);const{data:S}=await E.custom({url:"",method:"get",meta:{operation:"myWeeklyTimetableEntries",fields:["entries","hasTimetable"]}}).catch(()=>(u.error("Something Went Wrong ..."),{data:null})).then(h=>h);S&&(console.error("data",S),r(S.hasTimetable),T(S.entries)),i(!1)};return a.useEffect(()=>{L()},[]),e.jsxs(e.Fragment,{children:[e.jsxs(qe,{spinning:y,children:[!m&&!y&&e.jsx(e.Fragment,{children:e.jsx(Z,{align:"middle",style:{height:"80vh",display:"flex",justifyContent:"center"},children:e.jsx(yt,{description:e.jsx(e.Fragment,{children:e.jsx("span",{style:{fontSize:22},children:"You are not Connected to any published Timetable"})})})})}),m&&e.jsx(Z,{style:{overflowX:"auto",marginTop:v?65:0,marginLeft:10},wrap:!1,children:j.map(S=>e.jsxs("span",{style:{width:v?"100vw":"14.1vw",margin:"1px",padding:"0px"},children:[e.jsx(Z,{style:{display:"flex",justifyContent:"space-between",backgroundColor:"white"},children:e.jsxs("span",{style:{marginLeft:10,marginRight:10,display:"flex",justifyContent:"space-between",width:"100%",height:35,paddingTop:2},children:[e.jsx("span",{style:{fontSize:19,fontWeight:"bolder"},children:S.name}),e.jsx("span",{children:e.jsx(W,{title:"Bulk Processing of Action(s)",color:"red",placement:"left",children:e.jsx(q,{icon:e.jsx(we,{})})})})]})}),e.jsx("div",{style:{maxHeight:"83vh",overflowY:"auto",overflowX:"hidden",marginTop:5,marginRight:5},children:S.events.map(h=>e.jsx("div",{style:{backgroundColor:"white",paddingLeft:5},children:e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:18},children:[h.isTeacher&&e.jsx(e.Fragment,{children:e.jsxs("div",{style:{borderBottom:"1"},children:[e.jsx("span",{style:{marginLeft:5},children:e.jsx(W,{title:"View/Take Attendance",color:"green",children:e.jsx(q,{size:"small",onClick:()=>b(h,S),children:e.jsx(xe,{})})})}),h.canCancell&&!h.isCancelled&&!h.isExam&&e.jsx("span",{style:{marginLeft:5},children:e.jsx(ee,{title:e.jsx(e.Fragment,{children:e.jsxs(ae,{direction:"vertical",children:[e.jsx("span",{children:"Are you sure to Cancel?"}),e.jsx("span",{style:{fontWeight:"bolder"},children:"Reason"}),e.jsx("span",{children:e.jsxs(c,{layout:"vertical",form:d,initialValues:{notify:!0},onFinish:l=>{l.entryId=h.id,p(l)},onFinishFailed:()=>{},autoComplete:"off",children:[e.jsx(c.Item,{name:"reason",rules:[{required:!0,message:"Please input your reason!"}],children:e.jsx(Pt,{rows:6,onChange:l=>{l.target.value.length>0?w(!0):w(!1)}})}),e.jsx(c.Item,{name:"notify",valuePropName:"checked",children:e.jsx(_e,{children:"Notify Students"})})]})})]})}),onConfirm:()=>{d.submit()},onCancel:()=>{},okText:"Yes",cancelText:"No",okButtonProps:{disabled:!F},overlayStyle:{zIndex:9999},children:e.jsx(q,{size:"small",children:e.jsx(pt,{color:"red",style:{color:"red"}})})})}),e.jsx("span",{style:{float:"right"},children:e.jsx(W,{title:"Click to see all about this timetable Entry",color:"green",children:e.jsx(q,{icon:e.jsx(jt,{})})})})]})}),e.jsxs("span",{style:{display:"block"},children:[!h.advanced&&e.jsx(W,{overlayInnerStyle:{fontSize:19},title:"Subject: "+h.subject.name,color:"green",placement:"right",children:Ct(h.subject.name,15)}),h.advanced&&e.jsx(W,{overlayInnerStyle:{fontSize:19},title:"Module: "+h.module.name,color:"green",placement:"right",children:h.module.code})]}),!h.advanced&&e.jsx(ae,{children:h.group&&e.jsx(e.Fragment,{children:e.jsx(M,{color:"orange",children:h.group.name})})})]}),e.jsxs("span",{style:{fontSize:18},children:[e.jsx(W,{title:"Venue: "+h.venue.name,color:"green",children:e.jsx(M,{color:"red",children:h.venue.name})}),e.jsx(W,{title:e.jsxs(e.Fragment,{children:[!h.advanced&&e.jsx(e.Fragment,{children:h.isExam?e.jsxs(Y,{title:"Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.supervisor.firstName," ",h.supervisor.middleName," ",h.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:h.supervisor.phone})]}):e.jsxs(Y,{title:"Teacher Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.teacher.firstName," ",h.teacher.middleName," ",h.teacher.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.teacher.email}),e.jsx(Y.Item,{label:"Phone",children:h.teacher.phone})]})}),h.advanced&&e.jsx(e.Fragment,{children:h.isExam?e.jsxs(Y,{title:"Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.supervisor.firstName," ",h.supervisor.middleName," ",h.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:h.supervisor.phone})]}):e.jsxs(Y,{title:"Lecturer Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.lecturer.firstName," ",h.lecturer.middleName," ",h.lecturer.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.lecturer.email}),e.jsx(Y.Item,{label:"Phone",children:h.lecturer.phone})]})})]}),color:"white",overlayInnerStyle:{color:"black"},children:e.jsx(q,{type:"primary",shape:"circle",icon:e.jsx(Ze,{})})})]}),h.isCancelled&&e.jsx("span",{children:e.jsxs(M,{color:"red",style:{fontSize:24,padding:10,marginTop:10},children:["Cancelled",h.isTeacher&&h.canCancell&&e.jsx(ee,{title:"Are you sure to Open?",onConfirm:()=>z(h.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{style:{marginLeft:2},size:"small",children:"Re-open"})})]})}),e.jsxs(et,{children:[h.isExam&&e.jsx("p",{style:{fontSize:"18px"},children:ne(h.dueDate).format("YYYY MMM, DD")}),h.startAt," - ",h.endAt]})]})}))})]}))})]}),e.jsx(de,{title:e.jsx(e.Fragment,{children:e.jsxs(ae,{direction:"vertical",children:[e.jsxs("span",{children:[_==null?void 0:_.subject.name," - ",_==null?void 0:_.educationLevel.name," - Attendance",e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:I==null?void 0:I.name})})]}),e.jsxs("span",{children:[_==null?void 0:_.startAt," - ",_==null?void 0:_.endAt]})]})}),width:"70vw",open:f,onClose:S=>C(S),children:e.jsx(Nt,{event:_,entry:I,randKey:Math.random()})})]})},zt=()=>(a.useEffect(()=>(document.title=Ee.system_name+": Timetable Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsx("div",{style:{marginTop:10},children:e.jsx(Lt,{})})),{Option:De}=G,Ne="HH:mm",Vt=t=>{const[y,i]=a.useState(!1),[m,r]=a.useState(!0),[j,T]=a.useState([]),[I,P]=a.useState([]),[_,n]=a.useState([]),[d,f]=a.useState([]),C=()=>{i(!0)},F=p=>{t.form.setFieldsValue({teacher:void 0}),v(1,p)},w=async(p,L="",S=100)=>{const{data:h}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:p,type:"Int",required:!0},key:{value:L,type:"String",required:!1},pageSize:{value:S,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(()=>(u.error("Error occured while loading Venues"),{data:null})).then(l=>l);h&&f(h.results)},A=async(p,L="",S=20)=>{var l;const{data:h}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjects",variables:{schoolEducationLevelId:{value:parseInt(((l=t.schoolTimetableEducationLevel)==null?void 0:l.schoolEducationLevel.id.toString())??"0")},page:{value:p,type:"Int",required:!0},key:{value:L,type:"String",required:!1},pageSize:{value:S,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolSubject:[{subject:["id","name"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(s=>(u.error("Error occured while loading Subjects"),{data:null})).then(s=>s);h&&T(h.results)},v=async(p,L,S="",h=20)=>{r(!0);const{data:l}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjectTeachers",variables:{schoolEducationLevelSubjectId:{value:parseInt(L.toString()??"0")},page:{value:p,type:"Int",required:!0},key:{value:S,type:"String",required:!1},pageSize:{value:h,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolMember:["id","registrationNumber",{user:["id","firstName","lastName","middleName","fullName"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(s=>(u.error("Error occured while loading Teachers"),{data:null})).then(s=>s);l&&P(l.results),r(!1)},b=async(p,L="",S=20)=>{var l;const{data:h}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelGroups",variables:{schoolEducationLevelId:{value:parseInt(((l=t.schoolTimetableEducationLevel)==null?void 0:l.schoolEducationLevel.id.toString())??"0")},page:{value:p,type:"Int",required:!0},key:{value:L,type:"String",required:!1},pageSize:{value:S,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(s=>(u.error("Error occured while loading Groups"),{data:null})).then(s=>s);h&&n(h.results)},z=async p=>{const{data:L}=await E.custom({url:"",method:"post",meta:{operation:"createTimetableEntry",variables:{subjectId:{value:p.subject_id,type:"Int",required:!0},teacherId:{value:p.teacher_id,type:"Int",required:!0},timetableId:{value:p.timetable_id,type:"Int",required:!0},groupId:{value:p.group_id,type:"Int",required:!1},venueId:{value:p.venue_id,type:"Int",required:!0},day:{value:p.day,type:"String",required:!0},startAt:{value:p.start_at,type:"String",required:!0},endAt:{value:p.end_at,type:"String",required:!0}},fields:["success","message"]}}).catch(S=>(u.error("Error occured while creating school timetable"),{data:null})).then(S=>S);L&&(L.success?(u.success(L.message),t.form.resetFields(),t.onFinish()):u.error(L.message))};return a.useEffect(()=>{b(1),w(1),A(1)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(c,{layout:"vertical",form:t.form,onFinish:p=>{var L;p.start_at=ne(p.start_at).format("HH:mm"),p.end_at=ne(p.end_at).format("HH:mm"),p.day=t.entry.name,p.timetable_id=parseInt(((L=t.schoolTimetableEducationLevel)==null?void 0:L.id.toString())??"0"),z(p)},requiredMark:!1,children:[e.jsx(c.Item,{name:"subject_id",label:"Subject",rules:[{required:!0,type:"integer",message:"Please Choose Subject"}],children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Choose Subject",allowClear:!0,showSearch:!0,onChange:F,dropdownStyle:{zIndex:9999},children:j.map(p=>e.jsx(De,{value:p.id,children:p.schoolSubject.subject.name},p.id))})}),e.jsx(c.Item,{name:"teacher_id",label:"Teacher",rules:[{required:!0,type:"integer",message:"Please Choose Teacher"}],children:e.jsx(G,{size:"large",loading:m,disabled:m,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:I.map(p=>e.jsxs(De,{value:p.id,children:[p.schoolMember.user.fullName,p.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:p.schoolMember.registrationNumber})})]},p.id))})}),e.jsx(c.Item,{name:"group_id",label:"Group",rules:[{required:!1,type:"integer",message:"Please Choose Groups"}],children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Choose Groups",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:_.map(p=>e.jsx(De,{value:parseInt(p.id.toString()),children:p.name},p.id))})}),e.jsx(c.Item,{name:"venue_id",label:"Venue",rules:[{required:!0,type:"integer",message:"Please Choose Venue"}],children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Choose Venue",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:d.map(p=>e.jsx(De,{value:parseInt(p.id.toString()),children:p.name},p.id))})}),e.jsxs(Z,{children:[e.jsx(B,{span:6,children:e.jsx(c.Item,{name:"start_at",label:e.jsx(e.Fragment,{children:e.jsxs(ae,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Start At"}),e.jsx(q,{type:"link",onClick:()=>C(),children:"Check Slots"})]})}),initialValue:R("07:00","HH:mm"),children:e.jsx(ue,{size:"large",allowClear:!0,defaultValue:R("07:00",Ne),hourStep:1,minuteStep:45,format:Ne,style:{width:"100%"},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:6,children:e.jsx(c.Item,{name:"end_at",label:e.jsx(e.Fragment,{children:e.jsxs(ae,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"End At"}),e.jsx(q,{type:"link",onClick:()=>C(),children:"Check Slots"})]})}),initialValue:R("07:45","HH:mm"),children:e.jsx(ue,{size:"large",allowClear:!0,defaultValue:R("07:45",Ne),hourStep:1,minuteStep:45,format:Ne,inputReadOnly:!0,style:{width:"100%"},popupStyle:{zIndex:9999}})})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",disabled:!0,children:"Save"})})]}),e.jsx(ve,{title:"Available Time Slots",anchor:"right",onClose:p=>i(p),open:y,children:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Some contents..."}),e.jsx("p",{children:"Some contents..."}),e.jsx("p",{children:"Some contents..."})]})})]})},{Option:je}=G,Xe="HH:mm",Yt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Je=t=>{var k,J,re,fe,Me,We,Be,Ke;const[y,i]=a.useState(!1),[m,r]=a.useState(!1),[j,T]=a.useState(!0),[I,P]=a.useState([]),[_,n]=a.useState([]),[d,f]=a.useState([]),[C,F]=a.useState([]),[w,A]=a.useState([]);a.useState(),a.useState();const[v,b]=a.useState([]);a.useState(!1),a.useState(!1);const[z,p]=a.useState("07:00"),[L,S]=a.useState("07:45");Pe();const[h,l]=a.useState([]),[s,g]=a.useState([]),[x,D]=a.useState([]),[K]=c.useForm(),oe=()=>{r(!0)},V=o=>{var O;t.form.setFieldsValue({teacher:void 0}),((O=t==null?void 0:t.schoolTimetable)==null?void 0:O.forExamination)===!0?te(1):Ae(1,o)},H=async(o,O="",X=100)=>{const{data:se}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:o,type:"Int",required:!0},key:{value:O,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(ie=>(u.error("Error occured while loading Venues"),{data:null})).then(ie=>ie);se&&A(se.results)},$=async(o,O="",X=20)=>{var ie;const{data:se}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjects",variables:{schoolEducationLevelId:{value:parseInt(((ie=t.schoolTimetableEducationLevel)==null?void 0:ie.schoolEducationLevel.id.toString())??"0")},page:{value:o,type:"Int",required:!0},key:{value:O,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolSubject:[{subject:["id","name"]}]},"subjectType","subjectTypeDisplay","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(u.error("Error occured while loading Subjects"),{data:null})).then(pe=>pe);se&&P(se.results)},te=async(o,O="",X=20)=>{T(!0);const{data:se}=await E.custom({url:"",method:"get",meta:{operation:"schoolMembers",variables:{page:{value:o,type:"Int",required:!0},key:{value:O,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1},rolesString:{value:["Teacher"],type:"[String]",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","registrationNumber","firstName","middleName","lastName","fullName","email","phone",{user:["id","firstName","lastName","middleName","fullName"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(ie=>(u.error("Error occured while loading Teachers"),{data:null})).then(ie=>ie);se&&f(se.results),T(!1)},Ae=async(o,O,X="",se=20)=>{T(!0);const{data:ie}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjectTeachers",variables:{schoolEducationLevelSubjectId:{value:parseInt(O.toString()??"0")},page:{value:o,type:"Int",required:!0},key:{value:X,type:"String",required:!1},pageSize:{value:se,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolMember:["id","registrationNumber",{user:["id","firstName","lastName","middleName","fullName"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(u.error("Error occured while loading Teachers"),{data:null})).then(pe=>pe);ie&&n(ie.results),T(!1)},ze=async(o,O="",X=20)=>{var ie;const{data:se}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelGroups",variables:{schoolEducationLevelId:{value:parseInt(((ie=t.schoolTimetableEducationLevel)==null?void 0:ie.schoolEducationLevel.id.toString())??"0")},page:{value:o,type:"Int",required:!0},key:{value:O,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(u.error("Error occured while loading Groups"),{data:null})).then(pe=>pe);se&&F(se.results)},Ve=async o=>{i(!0);const{data:O}=await E.custom({url:"",method:"post",meta:{operation:"createTimetableEntry",variables:{advanced:{value:t.advanced,type:"Boolean",required:!1},moduleId:{value:o.module_id,type:"Int",required:!1},subjectId:{value:o.subject_id,type:"Int",required:!1},teacherId:{value:o.teacher_id,type:"Int",required:!1},timetableId:{value:o.timetable_id,type:"Int",required:!0},groupId:{value:o.group_id,type:"Int",required:!1},venueId:{value:o.venue_id,type:"Int",required:!0},day:{value:o.day,type:"String",required:!0},startAt:{value:o.start_at,type:"String",required:!0},endAt:{value:o.end_at,type:"String",required:!0},supervisorId:{value:o.supervisor_id,type:"Int",required:!1},dueDate:{value:o.due_date,type:"String",required:!1}},fields:["success","message"]}}).catch(X=>(u.error("Error occured while creating school timetable"),{data:null})).then(X=>X);i(!1),O&&(O.success?(u.success(O.message),b([]),t.form.resetFields(),t.onFinish()):b(O.message))},ke=async()=>{var X;const o=((X=t==null?void 0:t.studyCourse)==null?void 0:X.id)??"0",{data:O}=await E.custom({url:"",method:"get",meta:{operation:"timetableStudyCourseModules",variables:{timetableStudyCourseId:{value:parseInt(o.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(se=>(u.error("Something Went Wrong ..."),{data:null})).then(se=>se);O&&l(O.results)},N=async o=>{T(!0);const{data:O}=await E.custom({url:"",method:"get",meta:{operation:"moduleMembers",variables:{moduleId:{value:o,type:"Int",required:!0},memberType:{value:"Teacher",type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{module:["id"]},{schoolMember:["id","registrationNumber","firstName","middleName","lastName","email","phone",{user:["id","firstName","middleName","lastName","email","fullName","pic"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(X=>(u.error("Something Went Wrong ..."),{data:null})).then(X=>X);T(!1),O&&D(O.results)};return a.useEffect(()=>{ke(),ze(1),H(1),$(1)},[t.randKey]),e.jsxs(e.Fragment,{children:[((k=t==null?void 0:t.schoolTimetable)==null?void 0:k.forExamination)&&e.jsx("div",{style:{marginBottom:10},children:e.jsx(be,{type:"info",message:e.jsx(e.Fragment,{children:e.jsxs("p",{style:{fontSize:18},children:[e.jsx("b",{children:"Notice:"})," This timetable is for examination. You can only add entries for examination.",e.jsx("p",{style:{color:"red"},children:"Validation wont apply against Non-Examination Timetable"})," ","But it will be applied against Examination Timetable"]})})})}),e.jsx("div",{children:v.map(o=>e.jsx(be,{message:o,type:"error",style:{fontSize:18,marginBottom:"3px"},onClose:()=>{b([])},closable:!0}))}),e.jsxs(c,{layout:"vertical",form:K,onFinish:o=>{var O,X;o.start_at=z,o.end_at=L,o.day=t.entry.name,t.advanced?o.timetable_id=parseInt(((O=t==null?void 0:t.studyCourse)==null?void 0:O.id.toString())??"0"):o.timetable_id=parseInt(((X=t==null?void 0:t.schoolTimetableEducationLevel)==null?void 0:X.id.toString())??"0"),Ve(o)},children:[t.advanced?e.jsx(c.Item,{name:"module_id",label:"Module",rules:[{required:!0,type:"integer",message:"Please Choose Module"}],children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Choose Module",allowClear:!0,showSearch:!0,onChange:o=>{K.setFieldsValue({teacher_id:void 0}),N(o)},dropdownStyle:{zIndex:9999},children:h.map(o=>e.jsx(je,{value:parseInt(o.id.toString()),children:o.name},o.id))})}):e.jsx(c.Item,{name:"subject_id",label:"Subject",rules:[{required:!0,type:"integer",message:"Please Choose Subject"}],children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Choose Subject",allowClear:!0,showSearch:!0,onChange:V,dropdownStyle:{zIndex:9999},children:I.map(o=>e.jsxs(je,{value:o.id,children:[o.schoolSubject.subject.name,e.jsx(M,{style:{marginLeft:5},color:"green",children:o.subjectTypeDisplay})]},o.id))})}),!t.advanced&&e.jsx(e.Fragment,{children:(J=t==null?void 0:t.schoolTimetable)!=null&&J.forExamination?e.jsx(c.Item,{name:"supervisor_id",label:e.jsx(e.Fragment,{children:"Teachers Supervising"}),rules:[{required:(re=t==null?void 0:t.schoolTimetable)==null?void 0:re.forExamination,type:"integer",message:"Please Choose Supervisor"}],children:e.jsx(G,{size:"large",loading:j,disabled:j,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:d.map(o=>e.jsxs(je,{value:parseInt(o.id.toString()),children:[o.user.fullName,o.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:o.registrationNumber})}),e.jsxs("p",{style:{marginTop:3},children:[e.jsx("span",{style:{color:"red"},children:"Email:"})," ",e.jsx(M,{children:o==null?void 0:o.email}),","," ",e.jsx("span",{style:{color:"red"},children:"Phone:"})," ",e.jsx(M,{children:o==null?void 0:o.phone})]})]},o.id))})}):e.jsx(c.Item,{name:"teacher_id",label:e.jsx(e.Fragment,{children:"Teacher"}),rules:[{required:!((fe=t==null?void 0:t.schoolTimetable)!=null&&fe.forExamination),type:"integer",message:"Please Choose Teacher"}],children:e.jsx(G,{size:"large",loading:j,disabled:j,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:_.map(o=>e.jsxs(je,{value:o.id,children:[o.schoolMember.user.fullName,o.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:o.schoolMember.registrationNumber})})]},o.id))})})}),t.advanced&&e.jsx(e.Fragment,{children:(Me=t==null?void 0:t.schoolTimetable)!=null&&Me.forExamination?e.jsx(c.Item,{name:"supervisor_id",label:e.jsx(e.Fragment,{children:"Lecturer/Tutor Supervising"}),rules:[{required:(We=t==null?void 0:t.schoolTimetable)==null?void 0:We.forExamination,type:"integer",message:"Please Choose Supervisor"}],children:e.jsx(G,{size:"large",loading:j,disabled:j,style:{width:"100%"},placeholder:"Please Choose Lecturer/Tutor",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:s.map(o=>e.jsxs(je,{value:parseInt(o.id.toString()),children:[o.user.fullName,o.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:o.registrationNumber})}),e.jsxs("p",{style:{marginTop:3},children:[e.jsx("span",{style:{color:"red"},children:"Email:"})," ",e.jsx(M,{children:o==null?void 0:o.email}),","," ",e.jsx("span",{style:{color:"red"},children:"Phone:"})," ",e.jsx(M,{children:o==null?void 0:o.phone})]})]},o.id))})}):e.jsx(c.Item,{name:"teacher_id",label:e.jsx(e.Fragment,{children:"Lecturer/Tutor"}),rules:[{required:!((Be=t==null?void 0:t.schoolTimetable)!=null&&Be.forExamination),type:"integer",message:"Please Choose Lecturer/Tutor"}],children:e.jsx(G,{size:"large",loading:j,disabled:j,style:{width:"100%"},placeholder:"Please Choose Lecturer/Tutor",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:x.map(o=>{var O;return e.jsxs(je,{value:parseInt(o.schoolMember.id.toString()),children:[(O=o==null?void 0:o.schoolMember.user)==null?void 0:O.fullName,o.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:o.schoolMember.registrationNumber})})]},o.id)})})})}),!t.advanced&&e.jsx(c.Item,{name:"group_id",label:"Group",rules:[{required:!1,type:"integer",message:"Please Choose Groups"}],children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Choose Groups",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:C.map(o=>e.jsx(je,{value:parseInt(o.id.toString()),children:o.name},o.id))})}),e.jsx(c.Item,{name:"venue_id",label:"Venue",rules:[{required:!0,type:"integer",message:"Please Choose Venue"}],children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Choose Venue",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:w.map(o=>e.jsx(je,{value:parseInt(o.id.toString()),children:o.name},o.id))})}),e.jsxs(Z,{children:[((Ke=t==null?void 0:t.schoolTimetable)==null?void 0:Ke.forExamination)&&e.jsx(B,{span:8,children:e.jsx(c.Item,{name:"due_date",label:"Due Date",rules:[{required:!0,type:"object",message:"Please Choose Due Date"}],children:e.jsx(Te,{size:"large",style:{width:"100%"},placeholder:"Please Choose Due Date",disabledDate:o=>!(o.day()===Yt.indexOf(t.entry.name)+1),popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:8,children:e.jsx(c.Item,{name:"start_at",rules:[{required:!0,type:"object",message:"Please Choose Start Time"}],label:e.jsx(e.Fragment,{children:e.jsxs(ae,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Start At"}),e.jsx(q,{type:"link",onClick:()=>oe(),children:"Check Slots"})]})}),initialValue:R("07:00","HH:mm"),children:e.jsx(ue,{allowClear:!0,hourStep:1,minuteStep:45,format:Xe,defaultValue:R("07:00","HH:mm"),style:{width:"100%"},size:"large",onChange:o=>{p((o==null?void 0:o.hour().toString())+":"+(o==null?void 0:o.minute().toString()))},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:8,children:e.jsx(c.Item,{name:"end_at",rules:[{required:!0,type:"object",message:"Please Choose End Time"}],label:e.jsx(e.Fragment,{children:e.jsxs(ae,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"End At"}),e.jsx(q,{type:"link",onClick:()=>oe(),children:"Check Slots"})]})}),initialValue:R("07:45","HH:mm"),children:e.jsx(ue,{allowClear:!0,hourStep:1,minuteStep:45,format:Xe,inputReadOnly:!0,defaultValue:R("07:45","HH:mm"),style:{width:"100%"},size:"large",onChange:o=>{S((o==null?void 0:o.hour().toString())+":"+(o==null?void 0:o.minute().toString()))},popupStyle:{zIndex:9999}})})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",loading:y,disabled:y,children:"Save"})})]}),e.jsx(ve,{title:"Available Time Slots",width:"30vw",anchor:"right",onClose:o=>r(o),open:m,children:e.jsx("span",{children:"Slot Schecker"})})]})},dt=t=>{const[y,i]=a.useState(!1),[m,r]=a.useState(),[j,T]=a.useState([]),[I,P]=a.useState(),[_,n]=a.useState(!1),[d,f]=a.useState(!1),[C,F]=a.useState(!1),[w]=c.useForm();c.useForm();const A=Pe(),v=async(S,h)=>{P(S),r(h),f(!0)},b=async()=>{p()},z=async S=>{P(S),t.advanced?F(!0):n(!0)},p=async()=>{i(!0);const{data:S}=await E.custom({url:"",method:"get",meta:{operation:"weeklyTimetableEntries",variables:{schoolEducationLevelTimetableId:{value:parseInt(A.id),type:"Int",required:!0}},fields:["entries"]}}).catch(h=>(u.error("Something Went Wrong ..."),{data:null})).then(h=>h);S&&T(S.entries),i(!1)},L=async S=>{const{data:h}=await E.custom({url:"",method:"post",meta:{operation:"deleteTimetableEntry",variables:{timetableEntryId:{value:S,type:"Int",required:!0}},fields:["success","message"]}}).catch(l=>(u.error("Something Went Wrong ..."),{data:null})).then(l=>l);h&&(h.success?(u.success(h.message),p()):u.error(h.message)),i(!1)};return a.useEffect(()=>{p()},[]),e.jsxs(e.Fragment,{children:[e.jsx(qe,{spinning:y,children:e.jsx(Z,{style:{overflowX:"auto"},wrap:!1,children:j.map(S=>{var h,l;return e.jsxs("span",{style:{width:"14.1vw",margin:"1px",padding:"0px"},children:[e.jsxs(Z,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{marginLeft:5},children:e.jsx("h2",{children:S.name})}),e.jsx("span",{style:{position:"relative",right:"0px",marginTop:8},children:e.jsx(W,{title:"Click to Start Scheduling for "+S.name,color:"green",placement:"left",children:e.jsx(q,{disabled:t.advanced?(h=t.studyCourse)==null?void 0:h.published:(l=t.schoolTimetableEducationLevel)==null?void 0:l.published,size:"small",icon:e.jsx(Ie,{}),onClick:()=>z(S),children:"Add"})})})]}),e.jsx("div",{style:{maxHeight:"83vh",overflowY:"auto",overflowX:"hidden"},children:e.jsx(me,{style:{margin:"0px",padding:"0px"},bordered:!0,dataSource:S.events,renderItem:s=>e.jsxs(e.Fragment,{children:[e.jsx(me.Item,{children:e.jsxs(ae,{direction:"vertical",children:[e.jsxs("span",{style:{fontSize:18},children:[s.advanced?e.jsx(e.Fragment,{children:e.jsx(W,{title:s.module.name,color:"green",children:e.jsx(M,{color:"green",children:s.module.code})})}):e.jsx(e.Fragment,{children:s.subject.name}),!s.advanced&&e.jsxs(ae,{children:[e.jsx(M,{color:"green",style:{marginLeft:10},children:s.educationLevel.name}),s.group&&e.jsx(e.Fragment,{children:e.jsx(M,{color:"green",children:s.group.name})})]})]}),e.jsx("span",{style:{fontSize:18},children:e.jsxs(ae,{children:[e.jsx(M,{color:"green",children:s.venue.name}),e.jsx(ee,{title:"Are you sure to delete this Timetable Entry?",onConfirm:()=>L(s.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ce,{})})}),e.jsx(q,{icon:e.jsx(Oe,{}),onClick:()=>v(S,s.id)}),e.jsx(W,{title:e.jsxs(e.Fragment,{children:[!s.advanced&&e.jsxs(e.Fragment,{children:[s.teacher.firstName&&e.jsxs(Y,{title:"Teacher Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.teacher.firstName," ",s.teacher.middleName," ",s.teacher.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.teacher.email}),e.jsx(Y.Item,{label:"Phone",children:s.teacher.phone})]}),s.supervisor.firstName&&e.jsxs(Y,{title:"Exam Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.supervisor.firstName," ",s.supervisor.middleName," ",s.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:s.supervisor.phone})]})]}),s.advanced&&e.jsxs(e.Fragment,{children:[s.lecturer.firstName&&e.jsxs(Y,{title:"Lecturer Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.lecturer.firstName," ",s.lecturer.middleName," ",s.lecturer.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.lecturer.email}),e.jsx(Y.Item,{label:"Phone",children:s.lecturer.phone})]}),s.supervisor.firstName&&e.jsxs(Y,{title:"Exam Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.supervisor.firstName," ",s.supervisor.middleName," ",s.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:s.supervisor.phone})]})]})]}),color:"white",overlayInnerStyle:{color:"black"},children:e.jsx(q,{type:"primary",shape:"circle",icon:e.jsx(Ze,{})})})]})})]})}),s.isExam&&e.jsx(me.Item,{children:e.jsx("span",{style:{fontSize:18},children:ne(s.dueDate).format("YYYY MMM, DD")})}),e.jsxs(et,{children:[s.startAt," - ",s.endAt]})]})})})]})})})}),e.jsx(de,{title:(I==null?void 0:I.name)+" Scheduler",width:"45vw",open:_,onClose:S=>n(S),children:e.jsx(Je,{advanced:t.advanced,schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:w,entry:I,onFinish:b})}),e.jsx(de,{title:(I==null?void 0:I.name)+" Scheduler",width:"45vw",open:C,onClose:S=>F(S),children:e.jsx(Je,{advanced:t.advanced,schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:w,entry:I,onFinish:b,studyCourse:t.studyCourse})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[I==null?void 0:I.name," Scheduler"]}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:"Editting"})})]}),width:"45vw",open:d,onClose:S=>f(S),children:e.jsx(Vt,{schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:w,entry:I,onFinish:b})})]})},Ht=()=>{var P,_,n,d,f;const[t,y]=a.useState(),[i,m]=a.useState(),r=Pe(),j=async(C,F)=>{const{data:w}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolStudyCourseTimetable",variables:{schoolStudyCourseTimetableId:{value:C,type:"Int",required:!0},published:{value:F,type:"Boolean",required:!0}},fields:["success","message",{schoolStudyCourseTimetable:["id",{studyCourse:["id","year","semester","semesterDisplay","level","levelDisplay",{course:["id","name"]}]},"published","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(A=>(u.error("Something Went Wrong ..."),{data:null})).then(A=>A);w&&(w.success?(m(w.schoolStudyCourseTimetable),u.success(w.message)):u.error(w.message))},T=async()=>{const{data:C}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCourse",variables:{id:{value:parseInt(r.id),type:"Int",required:!0}},fields:["id",{studyCourse:["id","year","semester","semesterDisplay","level","levelDisplay",{course:["id","name"]}]},"published","created","updated","isActive","canEdit","canDelete","canManage"]}}).catch(F=>(u.error("Something Went Wrong ..."),{data:null})).then(F=>F);C&&m(C)},I=async()=>{const{data:C}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetable",variables:{id:{value:parseInt(r.tid),type:"Int",required:!0}},fields:["id","title","description",{school:["id"]},"forExamination","created","updated","isActive","canEdit","canDelete","canManage"]}}).catch(F=>(u.error("Something Went Wrong ..."),{data:null})).then(F=>F);C&&y(C)};return a.useEffect(()=>{document.title=Ee.system_name+": Timetable Scheduler",I(),T()},[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(le,{children:[e.jsx(le.Item,{children:e.jsx(Se,{to:"/timetable",children:"Home"})}),e.jsx(le.Item,{children:e.jsxs(Se,{to:"/timetable/timetables",children:["Timetables - ",t==null?void 0:t.title]})}),e.jsxs(le.Item,{children:["Scheduler - ",(_=(P=i==null?void 0:i.studyCourse)==null?void 0:P.course)==null?void 0:_.name," -"," ",(n=i==null?void 0:i.studyCourse)==null?void 0:n.year," -"," ",(d=i==null?void 0:i.studyCourse)==null?void 0:d.semesterDisplay," -"," ",(f=i==null?void 0:i.studyCourse)==null?void 0:f.levelDisplay]})]}),e.jsxs("div",{children:[!(i!=null&&i.published)&&e.jsx(q,{size:"large",icon:e.jsx(we,{style:{color:"red"}}),onClick:()=>j(i==null?void 0:i.id,!0),children:"Not Published"}),(i==null?void 0:i.published)&&e.jsx(q,{size:"large",icon:e.jsx(tt,{style:{color:"green"}}),onClick:()=>j(i==null?void 0:i.id,!1),children:"Published"})]})]}),e.jsx(dt,{advanced:!0,schoolTimetable:t,studyCourse:i})]})},Ot=t=>{const[y,i]=a.useState([]),[m,r]=a.useState(0),[j,T]=a.useState(20),[I,P]=a.useState(""),[_,n]=a.useState(!0),[d]=c.useForm(),C=!ye.useBreakpoint().lg,F=[{title:"Name",dataIndex:"name",fixed:!0,render:(v,b)=>e.jsxs("span",{children:[e.jsx("a",{children:b.educationLevel.name}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:b.educationLevel.schoolType.name})})]})},{title:"",dataIndex:"action",render:(v,b)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ee,{title:"Are you sure to delete this task?",onConfirm:()=>w(b.id),onCancel:()=>{},okText:"Yes",cancelText:"No",disabled:!b.canManage,overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ie,{}),children:"Add"})})})}],w=async v=>{var z;const{data:b}=await E.custom({url:"",method:"post",meta:{operation:"createSchoolEducationLevelTimetable",variables:{schoolTimetableId:{value:parseInt(((z=t.schoolTimetable)==null?void 0:z.id.toString())??"0"),type:"Int",required:!0},schoolEducationLevelId:{value:parseInt(v.toString()),type:"Int",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(p=>(u.error("Something Went Wrong ..."),{data:null})).then(p=>p);b&&(b.success?(u.success(b.message),t.onAdd(b.schoolEducationLevelTimetable),i(y.filter(p=>p.id.toString()!==v.toString()))):u.error(b.message)),n(!1)},A=async(v,b="",z=20)=>{var L;const{data:p}=await E.custom({url:"",method:"get",meta:{operation:"timetableNotAssignedSchoolEducationLevels",variables:{schoolTimetableId:{value:parseInt(((L=t.schoolTimetable)==null?void 0:L.id.toString())??"0"),type:"Int",required:!0},page:{value:v,type:"Int",required:!0},key:{value:b,type:"String",required:!1},pageSize:{value:z,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{school:["id","name"]},{educationLevel:["id","name",{schoolType:["id","name","code"]}]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(S=>(u.error("Something Went Wrong ..."),{data:null})).then(S=>S);p&&(r(p.total),i([...p.results])),n(!1)};return a.useEffect(()=>{A(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{style:{marginTop:10},children:e.jsx(B,{span:C?24:20,children:e.jsx(c,{layout:"vertical",form:d,onFinish:v=>{P(v.key),y.length=0,A(1,v.key,j)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:_,columns:F,dataSource:y,pagination:{onChange:(v,b)=>{T(b),A(v,I,b)},total:m,pageSize:j,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})]})},ct=t=>{var l,s;const[y,i]=a.useState([]),[m,r]=a.useState(1),[j,T]=a.useState(0),[I,P]=a.useState(!1),[_,n]=a.useState(!0),{push:d}=at(),[f]=c.useForm();c.useForm(),ye.useBreakpoint().lg;const[F,w]=a.useState(!1),A=async g=>{i([g,...y])},v=async g=>{const{data:x}=await E.custom({url:"",method:"post",meta:{operation:"synchronizeTimetableEducationLevels",variables:{timetableId:{value:parseInt(g),type:"Int",required:!0}},fields:["success","message"]}}).catch(D=>(u.error("Error in synchronizing Timetable Education Levels"),{data:null})).then(D=>D);x&&(x.success?(u(x.message),S(1,"")):u.error(x.message))},b=async g=>{const{data:x}=await E.custom({url:"",method:"post",meta:{operation:"deleteSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(g.toString()),type:"Int",required:!0}},fields:["success","message"]}});x.success?(u.success(x.message),i(y.filter(D=>D.id!==g))):u.error(x.message)},z=async(g,x)=>{const{data:D}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(g.toString()),type:"Int",required:!0},publish:{value:x,type:"Boolean",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});D.success?(u.success(D.message),i(y.map(K=>K.id===D.schoolEducationLevelTimetable.id?D.schoolEducationLevelTimetable:K))):u.error(D.message)},p=()=>{u("Canceled")},L=[{title:"Name",dataIndex:"name",fixed:!0,render:(g,x,D)=>e.jsx("span",{children:e.jsx("a",{children:x.schoolEducationLevel.educationLevel.name})})},{title:"Has Entries",dataIndex:"hasEntries",fixed:!0,render:(g,x,D)=>e.jsx("span",{children:x.hasEntries?e.jsx(e.Fragment,{children:e.jsx(M,{color:"green",children:"Yes"})}):e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",children:"No"})})})},{title:"Created",dataIndex:"created",render:(g,x,D)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:e.jsx(Le,{date:new Date(x.created)})})})},{title:"Status",dataIndex:"isActive",render:(g,x,D)=>e.jsx("a",{children:x!=null&&x.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"Published",dataIndex:"published",render:(g,x,D)=>e.jsx("a",{children:x!=null&&x.published?e.jsx(ee,{title:"Are you sure to Un-publish?",onConfirm:()=>z(x.id,!1),onCancel:()=>{},okText:"Unpublish",cancelText:"No",okButtonProps:{disabled:!x.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"green",children:"Published"})}):e.jsx(ee,{title:"Are you sure to Publish?",onConfirm:()=>z(x.id,!0),onCancel:()=>{},okText:"Publish",cancelText:"No",okButtonProps:{disabled:!x.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"red",children:"Not Published"})})})},{title:"",dataIndex:"action",render:(g,x,D)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(W,{title:"Schedule",placement:"left",children:e.jsx(q,{icon:e.jsx(xe,{}),disabled:!x.canManage,onClick:()=>{var K;return d("/timetable/education/level/scheduler/"+((K=t==null?void 0:t.schoolTimetable)==null?void 0:K.id)+"/"+x.id)}})}),e.jsx(ee,{title:"Are you sure to delete this School Education Level Timetable?",onConfirm:()=>b(x==null?void 0:x.id),onCancel:()=>p,okText:"Yes",cancelText:"No",disabled:!(x!=null&&x.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ce,{}),disabled:!(x!=null&&x.canDelete)})})]})}],S=async(g,x="")=>{var K;const{data:D}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableEducationLevels",variables:{schoolTimetableId:{value:parseInt(((K=t.schoolTimetable)==null?void 0:K.id.toString())??"0"),type:"Int",required:!0},page:{value:g,type:"Int",required:!0},key:{value:x,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(oe=>(u.error("Failed loading School Timetable Education Levels"),{data:null})).then(oe=>oe);D&&(r(D.page),T(D.total),P(D.hasNext),i([...D.results])),n(!1)},h=async g=>{var D;const{data:x}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetables",variables:{timetableId:{value:parseInt(((D=t==null?void 0:t.schoolTimetable)==null?void 0:D.id.toString())??"0"),type:"Int",required:!0},publish:{value:g,type:"Boolean",required:!0}},fields:["success","message"]}});x.success?(u.success(x.message),y.length=0,i([]),S(1)):u.error(x.message)};return a.useEffect(()=>{S(m)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:12,children:e.jsx(c,{layout:"vertical",form:f,onFinish:g=>{r(1),y.length=0,S(1,g.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(B,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(W,{title:"Click to Publish All timetables Listed Below",color:"green",children:e.jsx(q,{size:"large",icon:e.jsx(ft,{style:{color:"green"}}),onClick:()=>h(!0),children:"Publish All"})}),e.jsx(W,{title:"Click to Unpublish All Timetables listed Below",color:"red",children:e.jsx(q,{size:"large",icon:e.jsx(we,{style:{color:"red"}}),onClick:()=>h(!1),children:"Unpublish All"})}),e.jsx(q,{size:"large",icon:e.jsx(st,{}),onClick:()=>w(!0),children:"Add"}),((l=t.schoolTimetable)==null?void 0:l.forExamination)&&e.jsx(W,{title:"Synchronization All Education Levels Related to Examination",placement:"top",color:"green",children:e.jsx(q,{size:"large",icon:e.jsx(nt,{}),onClick:()=>{var g;return v((g=t.schoolTimetable)==null?void 0:g.id)},children:"Sync"})})]})]}),e.jsx(ge,{loading:_,columns:L,dataSource:y,pagination:!1,scroll:{y:"60vh"}}),e.jsx(ve,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Adding School Education Levels to "}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:(s=t.schoolTimetable)==null?void 0:s.title})})]}),width:"45vw",anchor:"right",onClose:g=>w(g),open:F,children:e.jsx(Ot,{randKey:Math.random(),schoolTimetable:t.schoolTimetable,onAdd:A})})]})},Wt=()=>{const[t,y]=a.useState(),[i,m]=a.useState(),[r,j]=a.useState(!1),T=Pe(),I=async()=>{const{data:n}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableEducationLevel",variables:{id:{value:parseInt(T.id),type:"Int",required:!0}},fields:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},"created","updated","isActive","published","canEdit","canDelete","canManage"]}}).catch(d=>(u.error("Something Went Wrong ..."),{data:null})).then(d=>d);n&&m(n)},P=async()=>{const{data:n}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetable",variables:{id:{value:parseInt(T.tid),type:"Int",required:!0}},fields:["id","title","description",{school:["id"]},"forExamination","created","updated","isActive","isPublished","canEdit","canDelete","canManage"]}}).catch(d=>(u.error("Something Went Wrong ..."),{data:null})).then(d=>d);n&&y(n)},_=async(n,d)=>{const{data:f}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(n.toString()),type:"Int",required:!0},publish:{value:d,type:"Boolean",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});f.success?(u.success(f.message),m(f.schoolEducationLevelTimetable)):u.error(f.message)};return a.useEffect(()=>{document.title=Ee.system_name+": School Timetable Education Level Scheduler",P(),I()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(le,{children:[e.jsx(le.Item,{children:e.jsx(Se,{to:"/timetable",children:"Home"})}),e.jsx(le.Item,{children:e.jsxs(Se,{to:"/timetable/timetables",children:["Timetables - ",t==null?void 0:t.title]})}),e.jsxs(le.Item,{children:["Scheduler -"," ",i==null?void 0:i.schoolEducationLevel.educationLevel.name]}),(i==null?void 0:i.published)&&e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",style:{fontSize:16,padding:3},children:"To Continue Scheduling this Timetable, you first need to Unpublish"})})]}),e.jsxs("div",{style:{float:"right"},children:[(i==null?void 0:i.published)&&e.jsx(ee,{title:"Are you sure to Unpublish Timetable",placement:"left",onConfirm:()=>_(i==null?void 0:i.id,!1),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(bt,{style:{color:"red"}}),style:{float:"right"},children:"Unpublish"})}),!(i!=null&&i.published)&&e.jsx(e.Fragment,{children:e.jsx(ee,{title:"Are you sure to Publish Timetable",placement:"left",onConfirm:()=>_(i==null?void 0:i.id,!0),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(tt,{style:{color:"green"}}),style:{float:"right"},children:"Publish"})})}),e.jsx(W,{title:"Click to Switch to Other Related Timetables, so as to continue scheduling",color:"green",placement:"left",children:e.jsx(q,{icon:e.jsx(St,{style:{color:"green"}}),style:{float:"right"},onClick:()=>j(!0),children:"Switch"})})]}),e.jsx("div",{style:{marginTop:45},children:e.jsx(dt,{advanced:!1,schoolTimetable:t,schoolTimetableEducationLevel:i})})]}),e.jsx(de,{title:"Timetable Switcher",width:"70vw",open:r,onClose:n=>j(n),children:e.jsx(ct,{schoolTimetable:t,randKey:Math.random()})})]})};R.extend(At);const Q="HH:mm",Bt=t=>{const[y,i]=a.useState(!1),[m]=c.useForm(),[r,j]=a.useState(),[T,I]=a.useState(!0),[P,_]=a.useState(!1),[n,d]=a.useState(!1),[f,C]=a.useState(!1),[F,w]=a.useState(!1),[A,v]=a.useState(!1),[b,z]=a.useState(!1),[p,L]=a.useState(!1),S=async l=>{i(!0);const{data:s}=await E.custom({url:"",method:"post",meta:{operation:"updateSchoolTimetablingSettings",variables:{perPeriodDuration:{value:l.per_period_duration,type:"Int",required:!0},periodsStartsAt:{value:l.periods_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"),type:"String",required:!1},periodsEndsAt:{value:l.periods_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"),type:"String",required:!1},breaktimeStartAt:{value:l.breaktime_start_at?l.breaktime_start_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},breaktimeEndAt:{value:l.breaktime_end_at?l.breaktime_end_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},allowSaturdayScheduling:{value:l.allow_saturday_scheduling??!1,type:"Boolean",required:!1},allowSundayScheduling:{value:l.allow_sunday_scheduling??!1,type:"Boolean",required:!1},morningSessionStartsAt:{value:l.morning_session_starts_at?l.morning_session_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},morningSessionEndsAt:{value:l.morning_session_ends_at?l.morning_session_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},eveningSessionStartsAt:{value:l.evening_session_starts_at?l.evening_session_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},eveningSessionEndsAt:{value:l.evening_session_ends_at?l.evening_session_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1}},fields:["success","message",{schoolTimetablingSettings:["id",{school:Re},"perPeriodDuration","periodsStartsAt","periodsEndsAt","breaktimeStartAt","breaktimeEndAt","morningSessionStartsAt","morningSessionEndsAt","eveningSessionStartsAt","eveningSessionEndsAt","allowSaturdayScheduling","allowSundayScheduling","created","updated","canEdit","canDelete","canManage"]}]}}).catch(g=>(console.error(g),u.error("Error occured while updating Timetabling Settings"),{data:null})).then(g=>g);s?s.success&&(u.success(s.message),s.periodsStartsAt=R(s.periodsStartsAt).utc(),s.periodsEndsAt=R(s.periodsEndsAt).utc(),s.breaktimeStartAt=R(s.breaktimeStartAt).utc(),s.breaktimeEndAt=R(s.breaktimeEndAt).utc(),j(s.schoolTimetablingSettings)):u.error("Something Went Wrong ... please try again ..."),i(!1)},h=async()=>{i(!0);const{data:l}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetablingSetting",fields:["id",{school:Re},"perPeriodDuration","periodsStartsAt","periodsEndsAt","breaktimeStartAt","breaktimeEndAt","morningSessionStartsAt","morningSessionEndsAt","eveningSessionStartsAt","eveningSessionEndsAt","allowSaturdayScheduling","allowSundayScheduling","created","updated","canEdit","canDelete","canManage"]}}).catch(s=>(console.error(s),u.error("Error occured while getting Timetabling Settings"),{data:null})).then(s=>s);l&&j(l),i(!1)};return a.useEffect(()=>{h()},[]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:y,children:r&&e.jsx(Z,{style:{marginTop:10},children:e.jsx(B,{span:24,children:e.jsx(vt,{children:e.jsxs(c,{layout:"horizontal",form:m,onFinish:l=>{console.log(l),S(l)},requiredMark:!0,initialValues:{per_period_duration:(r==null?void 0:r.perPeriodDuration)??60,periods_starts_at:r!=null&&r.periodsEndsAt?R(r==null?void 0:r.periodsStartsAt,Q):void 0,periods_ends_at:r!=null&&r.periodsEndsAt?R(r==null?void 0:r.periodsEndsAt,Q):void 0,breaktime_start_at:r!=null&&r.breaktimeStartAt?R(r==null?void 0:r.breaktimeStartAt,Q):void 0,breaktime_end_at:r!=null&&r.breaktimeEndAt?R(r==null?void 0:r.breaktimeEndAt,Q):void 0,allow_saturday_scheduling:(r==null?void 0:r.allowSaturdayScheduling)??!1,allow_sunday_scheduling:(r==null?void 0:r.allowSundayScheduling)??!1,morning_session_starts_at:r!=null&&r.morningSessionStartsAt?R(r==null?void 0:r.morningSessionStartsAt,Q):void 0,morning_session_ends_at:r!=null&&r.morningSessionEndsAt?R(r==null?void 0:r.morningSessionEndsAt,Q):void 0,evening_session_starts_at:r!=null&&r.eveningSessionStartsAt?R(r==null?void 0:r.eveningSessionStartsAt,Q):void 0,evening_session_ends_at:r!=null&&r.eveningSessionEndsAt?R(r==null?void 0:r.eveningSessionEndsAt,Q):void 0},children:[e.jsx(c.Item,{label:"Per Period Duration in Minutes",name:"per_period_duration",rules:[{required:!0,message:"Please input Per Period Duration in Minutes!"}],style:{width:"50%"},children:e.jsx(U,{})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(ae,{direction:"horizontal",children:[e.jsx(c.Item,{label:"Periods Start At(24 Hours Format)",name:"periods_starts_at",rules:[{required:T,message:"Please input Periods Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:R("12:00",Q),format:Q,minuteStep:15,hourStep:1,onChange:l=>{_(!!l)}})}),e.jsx(c.Item,{label:"Periods End At(24 Hours Format)",name:"periods_ends_at",rules:[{required:P,message:"Please input Periods End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Q,minuteStep:15,hourStep:1,onChange:l=>{I(!!l)},disabledHours:()=>m.getFieldValue("periods_starts_at")?Array.from({length:m.getFieldValue("periods_starts_at").hour()},(l,s)=>s):[],disabledMinutes:l=>m.getFieldValue("periods_starts_at")&&m.getFieldValue("periods_starts_at").hour()===l?Array.from({length:m.getFieldValue("periods_starts_at").minute()},(s,g)=>g):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(ae,{direction:"horizontal",children:[e.jsx(c.Item,{label:"Morning Session Start At(24 Hours Format)",name:"morning_session_starts_at",rules:[{required:F,message:"Please input Morning Session Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:R("12:00",Q),format:Q,minuteStep:15,hourStep:1,onChange:l=>{v(!!l)}})}),e.jsx(c.Item,{label:"Morning Session End At(24 Hours Format)",name:"morning_session_ends_at",rules:[{required:A,message:"Please input Morning Session End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Q,minuteStep:15,hourStep:1,onChange:l=>{w(!!l)},disabledHours:()=>m.getFieldValue("morning_session_starts_at")?Array.from({length:m.getFieldValue("morning_session_starts_at").hour()},(l,s)=>s):[],disabledMinutes:l=>m.getFieldValue("morning_session_starts_at")&&m.getFieldValue("morning_session_starts_at").hour()===l?Array.from({length:m.getFieldValue("morning_session_starts_at").minute()},(s,g)=>g):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(ae,{direction:"horizontal",children:[e.jsx(c.Item,{label:"Evening Session Start At(24 Hours Format)",name:"evening_session_starts_at",rules:[{required:b,message:"Please input Evening Session Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:R("12:00",Q),format:Q,minuteStep:15,hourStep:1,onChange:l=>{L(!!l)}})}),e.jsx(c.Item,{label:"Evening Session End At(24 Hours Format)",name:"evening_session_ends_at",rules:[{required:p,message:"Please input Evening Session End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Q,minuteStep:15,hourStep:1,onChange:l=>{z(!!l)},disabledHours:()=>m.getFieldValue("evening_session_starts_at")?Array.from({length:m.getFieldValue("evening_session_starts_at").hour()},(l,s)=>s):[],disabledMinutes:l=>m.getFieldValue("evening_session_starts_at")&&m.getFieldValue("evening_session_starts_at").hour()===l?Array.from({length:m.getFieldValue("evening_session_starts_at").minute()},(s,g)=>g):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(ae,{direction:"horizontal",children:[e.jsx(c.Item,{label:"Break start At (24 Hours Format)",name:"breaktime_start_at",rules:[{required:n,message:"Please input Break Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Q,minuteStep:15,hourStep:1,onChange:l=>{C(!!l)}})}),e.jsx(c.Item,{label:"Break End At (24 Hours Format)",name:"breaktime_end_at",rules:[{required:f,message:"Please input Break End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Q,minuteStep:15,hourStep:1,onChange:l=>{d(!!l)},disabledHours:()=>m.getFieldValue("breaktime_start_at")?Array.from({length:m.getFieldValue("breaktime_start_at").hour()},(l,s)=>s):[],disabledMinutes:l=>m.getFieldValue("breaktime_start_at")&&m.getFieldValue("breaktime_start_at").hour()===l?Array.from({length:m.getFieldValue("breaktime_start_at").minute()},(s,g)=>g):[]})})]})}),e.jsx(c.Item,{label:"Allow Saturday Scheduling",name:"allow_saturday_scheduling",rules:[{required:!1,type:"boolean",message:"Allow Saturday Scheduling"}],style:{width:"50%"},valuePropName:"checked",children:e.jsx(_e,{defaultChecked:(r==null?void 0:r.allowSaturdayScheduling)??!1})}),e.jsx(c.Item,{label:"Allow Sunday Scheduling",name:"allow_sunday_scheduling",rules:[{type:"boolean",required:!1,message:"Allow Sunday Scheduling"}],style:{width:"50%"},valuePropName:"checked",children:e.jsx(_e,{})}),e.jsx(c.Item,{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",htmlType:"submit",children:"Save"})})]})})})})})})},Kt=()=>(a.useEffect(()=>(document.title=Ee.system_name+": Timetable Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsx("div",{style:{marginTop:10},children:e.jsx(Bt,{})})),{TextArea:Rt}=U,{Option:Gt}=G,Ut=t=>{const[y,i]=a.useState(!1),[m,r]=a.useState([]),[j,T]=a.useState(),I=n=>{T(n)},P=async(n=1,d="")=>{i(!0);const{data:f}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenueTypes",variables:{page:{value:n,type:"Int",required:!0},key:{value:d,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","isActive","created","updated","canEdit","canDelete","canManage"]}]}});r(f.results),i(!1)},_=async n=>{const{data:d}=await E.custom({url:"",method:"post",meta:{operation:"createSchoolVenue",variables:{name:{value:n.name,type:"String",required:!0},code:{value:n.code,type:"String",required:!0},schoolVenueTypeId:{value:parseInt(n.school_venue_type_id),type:"Int",required:!0},description:{value:n.description,type:"String",required:!1},capacity:{value:parseInt(n.capacity),type:"Int",required:!1},longitude:{value:n.longitude,type:"Float",required:!1},latitude:{value:n.latitude,type:"Float",required:!1}},fields:["success","message",{schoolVenue:["id","name","code","description",{schoolVenueType:["id","name"]},"capacity","latitude","longitude","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(f=>(u.error("Error occured while creating school venue"),{data:null})).then(f=>f);d&&(d.success?(u.success(d.message),t.onFinish(d.schoolVenue),t.form.resetFields()):u.error(d.message))};return a.useEffect(()=>{P()},[t.randKey]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:y,children:e.jsxs(c,{layout:"vertical",form:t.form,onFinish:n=>{n.school_venue_type_id=j,_(n)},children:[e.jsx(c.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Name ..."})}),e.jsx(c.Item,{name:"code",label:"Code",rules:[{required:!0,type:"string",message:"Please input Code"}],children:e.jsx(U,{size:"large",placeholder:"Enter Code ..."})}),e.jsx(c.Item,{name:"capacity",label:"Capacity",children:e.jsx(lt,{size:"large",min:0,defaultValue:45,style:{width:"100%"}})}),e.jsx(c.Item,{label:"School Type",rules:[{required:!0,type:"string",message:"Please choose School Type"}],children:e.jsx(G,{showSearch:!0,size:"large",placeholder:"Select a School Venue Type",optionFilterProp:"children",onChange:I,onSearch:n=>{},filterOption:(n,d)=>d.children.toLowerCase().includes(n.toLowerCase()),dropdownStyle:{zIndex:9999},children:m.map((n,d)=>e.jsx(Gt,{value:n.id,children:n.name}))})}),e.jsx(c.Item,{name:"latitude",label:"Latitude",rules:[{required:!1,type:"number",message:"Please input Latidue"}],children:e.jsx(U,{size:"large",placeholder:"Enter Latitude ..."})}),e.jsx(c.Item,{name:"longitude",label:"Longitude",rules:[{required:!1,type:"number",message:"Please input Longitude"}],children:e.jsx(U,{size:"large",placeholder:"Enter Longitude ..."})}),e.jsx(c.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(Rt,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})})},{TextArea:$t}=U,{Option:Xt}=G,Jt=t=>{var n;const[y,i]=a.useState(!1),[m,r]=a.useState([]),[j,T]=a.useState(),I=d=>{T(d)},P=async(d=1,f="")=>{i(!0);const{data:C}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenueTypes",variables:{page:{value:d,type:"Int",required:!0},key:{value:f,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","isActive","created","updated","canEdit","canDelete","canManage"]}]}});r(C.results),i(!1)},_=async d=>{const{data:f}=await E.custom({url:"",method:"post",meta:{operation:"updateSchoolVenue",variables:{schoolVenueId:{value:parseInt(d.school_venue_id),type:"Int",required:!0},name:{value:d.name,type:"String",required:!0},code:{value:d.code,type:"String",required:!0},schoolVenueTypeId:{value:parseInt(d.school_venue_type_id),type:"Int",required:!0},description:{value:d.description,type:"String",required:!1},capacity:{value:parseInt(d.capacity),type:"Int",required:!1},longitude:{value:d.longitude,type:"Float",required:!1},latitude:{value:d.latitude,type:"Float",required:!1}},fields:["success","message",{schoolVenue:["id","name","code","description",{schoolVenueType:["id","name"]},"capacity","latitude","longitude","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(C=>(u.error("Error occured while Updating school venue"),{data:null})).then(C=>C);f&&(f.success?(u.success(f.message),t.onFinish(f.schoolVenue),t.form.resetFields()):u.error(f.message))};return a.useEffect(()=>{var d,f,C,F,w,A,v,b;P(),t.form.setFieldsValue({name:(d=t.venue)==null?void 0:d.name,code:(f=t.venue)==null?void 0:f.code,capacity:(C=t.venue)==null?void 0:C.capacity,description:(F=t.venue)==null?void 0:F.description,school_venue_type_id:(w=t.venue)==null?void 0:w.schoolVenueType.id,longitude:(A=t.venue)==null?void 0:A.longitude,latitude:(v=t.venue)==null?void 0:v.latitude}),I((b=t.venue)==null?void 0:b.schoolVenueType.id)},[t.randKey]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:y,children:e.jsxs(c,{layout:"vertical",form:t.form,onFinish:d=>{var f;d.school_venue_type_id=j,d.school_venue_id=(f=t.venue)==null?void 0:f.id,_(d)},requiredMark:!1,children:[e.jsx(c.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Name ..."})}),e.jsx(c.Item,{name:"code",label:"Code",rules:[{required:!0,type:"string",message:"Please input Code"}],children:e.jsx(U,{size:"large",placeholder:"Enter Code ..."})}),e.jsx(c.Item,{name:"capacity",label:"Capacity",children:e.jsx(lt,{min:0,defaultValue:45,style:{width:"100%"}})}),e.jsx(c.Item,{label:"School Type",rules:[{required:!0,type:"string",message:"Please choose School Type"}],children:e.jsx(G,{showSearch:!0,placeholder:"Select a School Venue Type",optionFilterProp:"children",onChange:I,defaultValue:(n=t.venue)==null?void 0:n.schoolVenueType.id,onSearch:d=>{},filterOption:(d,f)=>f.children.toLowerCase().includes(d.toLowerCase()),dropdownStyle:{zIndex:9999},children:m.map((d,f)=>e.jsx(Xt,{value:d.id,children:d.name}))})}),e.jsx(c.Item,{name:"latitude",label:"Latitude",rules:[{required:!1,type:"number",message:"Please input Latidue"}],children:e.jsx(U,{size:"large",placeholder:"Enter Latitude ..."})}),e.jsx(c.Item,{name:"longitude",label:"Longitude",rules:[{required:!1,type:"number",message:"Please input Longitude"}],children:e.jsx(U,{size:"large",placeholder:"Enter Longitude ..."})}),e.jsx(c.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx($t,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})})},Qt=t=>{const[y,i]=a.useState(),[m,r]=a.useState([]),[j,T]=a.useState(0),[I,P]=a.useState(!0),[_,n]=a.useState(20),[d,f]=a.useState(""),[C]=c.useForm(),[F]=c.useForm(),A=!ye.useBreakpoint().lg,[v,b]=a.useState(!1),[z,p]=a.useState(!1),L=g=>{i(g),p(!0)},S=async g=>{const{data:x}=await E.custom({url:"",method:"post",meta:{operation:"deleteSchoolVenue",variables:{schoolVenueId:{value:g,type:"Int",required:!0}},fields:["success","message"]}}).catch(D=>(u.error("Error occured while Deleting School Venue"),{data:null})).then(D=>D);x&&(x.success?(u.success(x.message),r(m.filter(D=>D.id.toString()!==g.toString()))):u.error(x.message))},h=async g=>{r([g,...m]),F.resetFields()},l=async g=>{const x=m.findIndex(D=>D.id===g.id);m[x]=g,r([...m]),F.resetFields(),i(void 0),p(!1)},s=async(g,x="",D=20)=>{P(!0);const{data:K}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:g,type:"Int",required:!0},key:{value:x,type:"String",required:!1},pageSize:{value:D,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","capacity","description","latitude","longitude",{school:["id"]},{schoolVenueType:["id","name"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(oe=>(u.error("Error occured while fetching roles"),{data:null})).then(oe=>oe);K&&(T(K.total),r([...K.results])),P(!1)};return a.useEffect(()=>{s(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:A?24:10,children:e.jsx(c,{layout:"vertical",form:C,onFinish:g=>{f(g.key),m.length=0,s(1,g.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:A?24:2,children:e.jsx(q,{icon:e.jsx(ce,{}),size:"large",onClick:()=>C.submit()})}),e.jsx(B,{span:A?24:12,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(W,{title:"Register a New Venue/Class",children:e.jsx(q,{icon:e.jsx(Ie,{}),size:"large",onClick:()=>b(!0),children:"Add Venue"})})})})]}),e.jsx(ge,{loading:I,columns:[{title:"Name",dataIndex:"name",fixed:!0,render:(g,x,D)=>e.jsx("span",{children:e.jsx("a",{children:x.name})})},{title:"Code",dataIndex:"code",render:(g,x,D)=>e.jsx("span",{children:x.code})},{title:"Venue Type",dataIndex:"venue_type",render:(g,x,D)=>{var K;return e.jsx("span",{children:e.jsx(M,{color:"green",children:(K=x==null?void 0:x.schoolVenueType)==null?void 0:K.name})})}},{title:"Capacity",dataIndex:"capacity",render:(g,x,D)=>e.jsx("span",{children:x.capacity})},{title:"Date Created",dataIndex:"created",render:(g,x,D)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:e.jsx(Le,{date:new Date(x.created)})})})},{title:"Status",dataIndex:"isActive",render:(g,x,D)=>e.jsx("span",{children:x!=null&&x.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(g,x,D)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(rt,{trigger:["click"],overlay:e.jsxs(he,{children:[e.jsx(he.Item,{icon:e.jsx(Ce,{}),disabled:!x.canDelete,children:e.jsx(ee,{placement:"topLeft",title:`Are you sure you want to delete ${x.name} Venue?`,onConfirm:()=>S(parseInt(x.id)),okText:"Yes",cancelText:"No",children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(he.Item,{icon:e.jsx(Oe,{}),disabled:!x.canEdit,onClick:()=>L(x),children:e.jsx("a",{rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:K=>K.preventDefault(),children:e.jsx(it,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}],dataSource:m,pagination:{onChange:(g,x)=>{n(x),s(g,d,x)},total:j,pageSize:_,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(80vh - 80px)"}}),e.jsx(de,{title:"Register New Venue/Class",width:"30vw",open:v,onClose:g=>b(g),children:e.jsx(Ut,{randKey:Math.random(),form:F,onFinish:h})}),e.jsx(de,{title:"Edditing Venue/Class",width:"30vw",open:z,onClose:g=>p(g),children:e.jsx(Jt,{randKey:Math.random(),form:F,onFinish:l,venue:y})})]})},Zt=()=>(a.useEffect(()=>(document.title=Ee.system_name+": School Venues",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(le,{children:[e.jsx(le.Item,{children:e.jsx(Se,{to:"/timetable",children:"Home"})}),e.jsx(le.Item,{children:"Venues/Classes"})]}),e.jsx(Qt,{})]})),{TextArea:ea}=U,{Option:He}=G,ut=[];for(let t=2022;t<new Date().getFullYear()+3;t++)ut.push(e.jsx(He,{value:t,children:t.toString()},t.toString()));const ta=t=>{const[y,i]=a.useState(!1),[m,r]=a.useState([]),[j,T]=a.useState([]),I=async()=>{const{data:n}=await E.custom({url:"",method:"get",meta:{operation:"schoolExaminations",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(d=>(u.error("Failed to get school Examinations"),{data:null})).then(d=>d);n&&r(n.results)},P=async()=>{const{data:n}=await E.custom({url:"",method:"get",meta:{operation:"schoolTypes",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(d=>(u.error("Error occured while fetching school types"),{data:null})).then(d=>d);n&&T(n.results)},_=async n=>{const{data:d}=await E.custom({url:"",method:"post",meta:{operation:"createSchoolTimetable",variables:{title:{value:n.title,type:"String",required:!0},description:{value:n.description,type:"String",required:!1},startAt:{value:n.start_at,type:"DateTime",required:!0},endAt:{value:n.end_at,type:"DateTime",required:!0},year:{value:n.year,type:"Int",required:!0},timetableType:{value:parseInt(n.timetable_type),type:"Int",required:!0},forExamination:{value:n.for_examination,type:"Boolean",required:!1},schoolExaminationId:{value:parseInt(n.school_examination_id),type:"Int",required:!1}},fields:["success","message",{schoolTimetable:["id","title","description","startAt","endAt","timetableType","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id","name"]},{schoolExamination:["id","name"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(f=>(u.error("Error occured while creating school timetable"),{data:null})).then(f=>f);d&&(d.success?(u.success(d.message),t.onFinish(d.schoolTimetable),t.form.resetFields()):u.error(d.message))};return a.useEffect(()=>{I(),P()},[t.randKey]),e.jsx(e.Fragment,{children:e.jsxs(c,{layout:"vertical",form:t.form,onFinish:n=>{n.for_examination=y,n.year?n.year=parseInt(n.year):n.year=new Date().getFullYear(),_(n)},children:[e.jsx(c.Item,{name:"timetable_type",label:"Timetable Type",rules:[{required:!0,type:"string",message:"Please select Timetable Type"}],children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Timetable Type ...",dropdownStyle:{zIndex:9999},children:j.map(n=>e.jsx(He,{value:n.id,children:n.name},n.id))})}),e.jsx(c.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Title"}],children:e.jsx(U,{size:"large",placeholder:"Enter Title ..."})}),e.jsx(c.Item,{name:"year",label:"Academic Year",children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Select Year",defaultValue:new Date().getFullYear(),dropdownStyle:{zIndex:9999},children:ut})}),e.jsx(c.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(ea,{rows:4})}),e.jsxs(Z,{children:[e.jsx(B,{span:12,children:e.jsx(c.Item,{name:"start_at",label:"Start At",rules:[{required:!0,type:"date",message:"Please input Start At Date"}],children:e.jsx(Te,{style:{width:"100%"},disabledDate:n=>{const d=ne().format("YYYY-MM-DD");return n&&n<ne(d,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:12,children:e.jsx(c.Item,{name:"end_at",label:"End At",rules:[{required:!0,type:"date",message:"Please input End At Date"}],children:e.jsx(Te,{style:{width:"100%"},disabledDate:n=>{const d=ne().format("YYYY-MM-DD");return n&&n<ne(d,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})})]}),e.jsx(c.Item,{name:"for_examination",valuePropName:"checked",children:e.jsx(_e,{onChange:n=>{n.target.checked?i(!0):i(!1)},children:"For Examination"})}),y&&e.jsx(c.Item,{name:"school_examination_id",label:"Examination",rules:[{required:y,type:"string",message:"Please select Examination"}],children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Choose Examination ...",dropdownStyle:{zIndex:9999},children:m==null?void 0:m.map(n=>e.jsx(He,{value:n.id.toString(),children:n.name},n.id))})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{Option:ht}=G,{TextArea:aa}=U,mt=[];for(let t=2022;t<new Date().getFullYear()+3;t++)mt.push(e.jsx(ht,{value:t,children:t.toString()},t.toString()));const sa=t=>{const[y,i]=a.useState([]),m=async()=>{const{data:j}=await E.custom({url:"",method:"get",meta:{operation:"schoolTypes",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(T=>(u.error("Error occured while fetching school types"),{data:null})).then(T=>T);j&&i(j.results)},r=async j=>{const{data:T}=await E.custom({url:"",method:"post",meta:{operation:"updateSchoolTimetable",variables:{schoolTimetableId:{value:parseInt(j.school_timetable_id),type:"Int",required:!0},title:{value:j.title,type:"String",required:!0},description:{value:j.description,type:"String",required:!1},startAt:{value:j.start_at,type:"DateTime",required:!0},endAt:{value:j.end_at,type:"DateTime",required:!0},year:{value:j.year,type:"Int",required:!0},timetableType:{value:parseInt(j.timetable_type),type:"Int",required:!0},forExamination:{value:j.for_examination,type:"Boolean",required:!1}},fields:["success","message",{schoolTimetable:["id","title","description","startAt","endAt","timetableType","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id","name"]},{schoolExamination:["id","name"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(I=>(u.error("Error occured while creating school timetable"),{data:null})).then(I=>I);T&&(T.success?(u.success(T.message),t.onFinish(T.schoolTimetable),t.form.resetFields()):u.error(T.message))};return a.useEffect(()=>{var j,T,I,P,_,n,d,f;m(),t.form.setFieldsValue({title:(j=t==null?void 0:t.schoolTimetable)==null?void 0:j.title,description:(T=t==null?void 0:t.schoolTimetable)==null?void 0:T.description,start_at:R((I=t==null?void 0:t.schoolTimetable)==null?void 0:I.startAt),end_at:R((P=t==null?void 0:t.schoolTimetable)==null?void 0:P.endAt),timetable_type:(n=(_=t==null?void 0:t.schoolTimetable)==null?void 0:_.timetableSchoolType)==null?void 0:n.id,year:(d=t==null?void 0:t.schoolTimetable)==null?void 0:d.year,for_examination:(f=t==null?void 0:t.schoolTimetable)==null?void 0:f.forExamination})},[t.randKey]),e.jsx(e.Fragment,{children:e.jsxs(c,{layout:"vertical",form:t.form,onFinish:j=>{var T;j.school_timetable_id=(T=t.schoolTimetable)==null?void 0:T.id,r(j)},children:[e.jsx(c.Item,{name:"timetable_type",label:"Timetable Type",children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Timetable Type ...",disabled:!0,dropdownStyle:{zIndex:9999},children:y.map(j=>e.jsx(ht,{value:j.id,children:j.name},j.id))})}),e.jsx(c.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Title"}],children:e.jsx(U,{size:"large",placeholder:"Enter Title ..."})}),e.jsx(c.Item,{name:"year",label:"Academic Year",children:e.jsx(G,{size:"large",style:{width:"100%"},placeholder:"Please Select Year",defaultValue:new Date().getFullYear(),dropdownStyle:{zIndex:9999},children:mt})}),e.jsx(c.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(aa,{rows:4,maxLength:6})}),e.jsxs(Z,{children:[e.jsx(B,{span:12,children:e.jsx(c.Item,{name:"start_at",label:"Start At",rules:[{required:!0,type:"date",message:"Please input Start At Date"}],children:e.jsx(Te,{style:{width:"100%"},disabledDate:j=>{var I;const T=ne((I=t.schoolTimetable)==null?void 0:I.startAt).format("YYYY-MM-DD");return j&&j<ne(T,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:12,children:e.jsx(c.Item,{name:"end_at",label:"End At",rules:[{required:!0,type:"date",message:"Please input End At Date"}],children:e.jsx(Te,{style:{width:"100%"},disabledDate:j=>{var I;const T=ne((I=t.schoolTimetable)==null?void 0:I.startAt).format("YYYY-MM-DD");return j&&j<ne(T,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})})]}),e.jsx(c.Item,{name:"for_examination",valuePropName:"checked",children:e.jsx(_e,{disabled:!0,children:"For Examination"})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},na=t=>{const[y,i]=a.useState([]),[m,r]=a.useState(0),[j,T]=a.useState(20),[I,P]=a.useState(""),[_,n]=a.useState(!0),[d]=c.useForm(),C=!ye.useBreakpoint().lg,F=[{title:"Name",dataIndex:"name",fixed:!0,render:(v,b)=>e.jsx("span",{children:b.course.name})},{title:"Year",dataIndex:"year",fixed:!0,render:(v,b)=>e.jsx("span",{children:b.year})},{title:"Semester",dataIndex:"Semester",fixed:!0,render:(v,b)=>e.jsx("span",{children:b.semesterDisplay})},{title:"",dataIndex:"action",render:(v,b)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ee,{title:"Are you sure to delete this task?",onConfirm:()=>w(b.id),onCancel:()=>{},okText:"Yes",cancelText:"No",disabled:!b.canManage,overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ie,{}),children:"Add"})})})}],w=async v=>{var z;const{data:b}=await E.custom({url:"",method:"post",meta:{operation:"createTimetableStudyCourse",variables:{schoolTimetableId:{value:parseInt(((z=t.schoolTimetable)==null?void 0:z.id.toString())??"0"),type:"Int",required:!0},studyCourseId:{value:parseInt(v.toString()),type:"Int",required:!0}},fields:["success","message",{timetableStudyCourse:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(p=>(u.error("Something Went Wrong ..."),{data:null})).then(p=>p);b&&(b.success?(u.success(b.message),t.onAdd(b.timetableStudyCourse),i(y.filter(p=>p.id.toString()!==v.toString()))):u.error(b.message)),n(!1)},A=async(v,b="",z=20)=>{var L;const{data:p}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCoursesToAdd",variables:{schoolTimetableId:{value:parseInt(((L=t.schoolTimetable)==null?void 0:L.id.toString())??"0"),type:"Int",required:!0},page:{value:v,type:"Int",required:!0},key:{value:b,type:"String",required:!1},pageSize:{value:z,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{course:["id","name"]},"year","semester","semesterDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(S=>(u.error("Something Went Wrong ..."),{data:null})).then(S=>S);p&&(r(p.total),i([...p.results])),n(!1)};return a.useEffect(()=>{A(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{style:{marginTop:10},children:e.jsx(B,{span:C?24:20,children:e.jsx(c,{layout:"vertical",form:d,onFinish:v=>{P(v.key),y.length=0,A(1,v.key,j)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:_,columns:F,dataSource:y,pagination:{onChange:(v,b)=>{T(b),A(v,I,b)},total:m,pageSize:j,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})]})},ra=t=>{var h;const[y,i]=a.useState([]),[m,r]=a.useState(1),[j,T]=a.useState(0),[I,P]=a.useState(!1),[_,n]=a.useState(!0),{push:d}=at(),[f]=c.useForm();c.useForm(),ye.useBreakpoint().lg;const[F,w]=a.useState(!1),A=async l=>{i([l,...y])},v=async l=>{const{data:s}=await E.custom({url:"",method:"post",meta:{operation:"deleteTimetableStudyCourse",variables:{id:{value:parseInt(l.toString()),type:"Int",required:!0}},fields:["success","message"]}});s.success?(u.success(s.message),i(y.filter(g=>g.id!==l))):u.error(s.message)},b=async(l,s)=>{const{data:g}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolStudyCourseTimetable",variables:{schoolStudyCourseTimetableId:{value:parseInt(l.toString()),type:"Int",required:!0},published:{value:s,type:"Boolean",required:!0}},fields:["success","message",{schoolStudyCourseTimetable:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});g.success?(u.success(g.message),i(y.map(x=>x.id===g.schoolStudyCourseTimetable.id?g.schoolStudyCourseTimetable:x))):u.error(g.message)},z=()=>{u("Canceled")},p=[{title:"Name",dataIndex:"name",fixed:!0,render:(l,s,g)=>e.jsx("span",{children:e.jsx("a",{children:s.studyCourse.course.name})})},{title:"Year",dataIndex:"year",fixed:!0,render:(l,s,g)=>e.jsx("span",{children:s.studyCourse.year})},{title:"Semester",dataIndex:"Semester",fixed:!0,render:(l,s,g)=>e.jsx("span",{children:s.studyCourse.semesterDisplay})},{title:"Has Entries",dataIndex:"hasEntries",fixed:!0,render:(l,s,g)=>e.jsx("span",{children:s.hasEntries?e.jsx(e.Fragment,{children:e.jsx(M,{color:"green",children:"Yes"})}):e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",children:"No"})})})},{title:"Created",dataIndex:"created",render:(l,s,g)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:e.jsx(Le,{date:new Date(s.created)})})})},{title:"Status",dataIndex:"isActive",render:(l,s,g)=>e.jsx("a",{children:s!=null&&s.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"Published",dataIndex:"published",render:(l,s,g)=>e.jsx("a",{children:s!=null&&s.published?e.jsx(ee,{title:"Are you sure to Un-publish?",onConfirm:()=>b(s.id,!1),onCancel:()=>{},okText:"Unpublish",cancelText:"No",okButtonProps:{disabled:!s.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"green",children:"Published"})}):e.jsx(ee,{title:"Are you sure to Publish?",onConfirm:()=>b(s.id,!0),onCancel:()=>{},okText:"Publish",cancelText:"No",okButtonProps:{disabled:!s.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"red",children:"Not Published"})})})},{title:"",dataIndex:"action",render:(l,s,g)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(W,{title:"Schedule",placement:"left",children:e.jsx(q,{icon:e.jsx(xe,{}),disabled:!s.canManage,onClick:()=>{var x;return d("/timetable/study/course/scheduler/"+((x=t==null?void 0:t.schoolTimetable)==null?void 0:x.id)+"/"+s.id)}})}),e.jsx(ee,{title:"Are you sure to delete this Timetable Study Course?",onConfirm:()=>v(s==null?void 0:s.id),onCancel:()=>z,okText:"Yes",cancelText:"No",disabled:!(s!=null&&s.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ce,{}),disabled:!(s!=null&&s.canDelete)})})]})}],L=async(l,s="")=>{var x;const{data:g}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCourses",variables:{schoolTimetableId:{value:parseInt(((x=t.schoolTimetable)==null?void 0:x.id.toString())??"0"),type:"Int",required:!0},page:{value:l,type:"Int",required:!0},key:{value:s,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(D=>(u.error("Failed loading School Timetable Education Levels"),{data:null})).then(D=>D);g&&(r(g.page),T(g.total),P(g.hasNext),i([...g.results])),n(!1)},S=async l=>{var g;const{data:s}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishAllSchoolStudyCourseTimetables",variables:{schoolTimetableId:{value:parseInt(((g=t.schoolTimetable)==null?void 0:g.id.toString())??"0"),type:"Int",required:!0},published:{value:l,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(x=>(u.error("Failed to publish/unpublish all study courses"),{data:null})).then(x=>x);s&&(s.success?(u.success(s.message),L(1)):u.error(s.message))};return a.useEffect(()=>{L(m)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:12,children:e.jsx(c,{layout:"vertical",form:f,onFinish:l=>{r(1),y.length=0,L(1,l.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(B,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(W,{title:"Click to Publish All Timetables",color:"green",children:e.jsx(q,{size:"large",icon:e.jsx(Qe,{style:{color:"green"}}),onClick:()=>S(!0),children:"Publish All"})}),e.jsx(W,{title:"Click to Unpublish All Timetables",color:"red",children:e.jsx(q,{size:"large",icon:e.jsx(we,{style:{color:"red"}}),onClick:()=>S(!1),children:"Unpublish All"})}),e.jsx(W,{title:"Auto Generate Timetable",color:"red",children:e.jsx(q,{size:"large",icon:e.jsx(nt,{style:{color:"red"}}),onClick:()=>t.autoGenerate(),children:"Auto Generate"})}),e.jsx(q,{size:"large",icon:e.jsx(st,{}),onClick:()=>w(!0),children:"Add"})]})]}),e.jsx(ge,{loading:_,columns:p,dataSource:y,pagination:!1,scroll:{y:"60vh"}}),e.jsx(ve,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Adding Study Courses to "}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:(h=t.schoolTimetable)==null?void 0:h.title})})]}),width:"45vw",anchor:"right",onClose:l=>w(l),open:F,children:e.jsx(na,{randKey:Math.random(),schoolTimetable:t.schoolTimetable,onAdd:A})})]})},ia=t=>{const[y,i]=a.useState([]),[m,r]=a.useState({}),[j,T]=a.useState([]),I=async()=>{var d;const{data:n}=await E.custom({url:"",method:"post",meta:{operation:"uniTimetableAutoScheduler",variables:{schoolTimetableId:{value:parseInt(((d=t.schoolTimetable)==null?void 0:d.id.toString())??"0"),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(u.error("Something Went Wrong ..."),{data:null})).then(f=>f);n&&(n.success?u.success(n.message):u.error(n.message))},P=async()=>{var d;const{data:n}=await E.custom({url:"",method:"get",meta:{operation:"autoTimetableSchedulerValidityCheck",variables:{timetableId:{value:parseInt(((d=t.schoolTimetable)==null?void 0:d.id.toString())??"0"),type:"Int",required:!0}},fields:["data"]}}).catch(f=>(u.error("Something Went Wrong ..."),{data:null})).then(f=>f);n&&(r(n.data),i(n.data.validities.map(f=>({title:e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Course Name",children:f.name}),"- ",e.jsx(W,{title:"Maximum Number of Students",children:e.jsxs(M,{color:"green",children:[f.maxStudents," Max Students"]})}),!f.capacityFit&&e.jsxs(M,{color:"red",children:["No available Venue with capacity of ",f.maxStudents," Students for this course"]})]}),key:"sc-"+f.id,icon:e.jsx(Ye,{}),children:f.modules.length>0?f.modules.map(C=>({title:e.jsxs(e.Fragment,{children:[e.jsxs(W,{title:"Module Name",children:[C.name,e.jsx(M,{color:"green",children:C.code})]}),e.jsx(W,{title:"Number of Periods per Week",children:e.jsxs(M,{color:"green",children:[C.periodsPerWeek," Periods/Week"]})})]}),key:"sc-"+f.id+"-"+C.id,icon:e.jsx(Ye,{}),children:C.teachers.length>0?C.teachers.map(F=>({title:e.jsxs(e.Fragment,{children:[F.fullName," - ",e.jsx(M,{color:"green",children:F.phone})," ",e.jsx(M,{color:"blue",children:F.email})]}),key:"sc-"+f.id+"-"+C.id+"-"+F.id})):[{title:e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",children:"No available Teacher for this course"})}),key:"sc-"+f.id+"-"+C.id+"-0"}]})):[{title:"No Module Found",key:"sc-"+f.id+"-0",icon:e.jsx(Ye,{})}]}))),T(n.data.map(f=>"sc-"+f.id)))},_=[{key:"1",label:"Validity Check Summary",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[m.canGenerate&&e.jsx(be,{message:"Timetable can be generated, no errors found",type:"success"}),!m.canGenerate&&e.jsxs(e.Fragment,{children:[e.jsx(be,{message:"Timetable can't be generated, please fix the errors highlited",type:"error"}),e.jsx(me,{bordered:!0,dataSource:m.issues,renderItem:n=>e.jsx(me.Item,{children:e.jsx(me.Item.Meta,{avatar:e.jsx(Ge,{style:{color:"red"}}),title:e.jsx(Ue.Text,{children:n})})})})]})]})},{key:"2",label:"Validity Check Details Tree",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[y.length>0&&e.jsx(Tt,{showLine:!0,showIcon:!0,autoExpandParent:!0,expandedKeys:j,onExpand:n=>{T(n)},treeData:y}),y.length<=0&&e.jsx(be,{message:"No Data Found",type:"error"})]})},{key:"3",label:"Venues",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[m.venues&&e.jsx(me,{bordered:!0,dataSource:m.venues,renderItem:n=>e.jsx(me.Item,{children:e.jsx(me.Item.Meta,{avatar:n.capacity>0?e.jsx(Ft,{style:{color:"green"}}):e.jsx(Ge,{style:{color:"red"}}),title:e.jsxs(Ue.Text,{children:[n.name,e.jsxs(M,{color:"green",style:{marginLeft:"10px"},children:[n.capacity," Max Students"]})]})})})}),!m.venues&&e.jsx(be,{message:"No Venue Registered",type:"error"})]})}];return a.useEffect(()=>{P()},[t.randKey]),e.jsx("div",{style:{maxHeight:"80vh",minHeight:"80vh",overflowY:"auto",overflowX:"hidden"},children:e.jsx(It,{defaultActiveKey:"1",items:_,onChange:n=>{console.log(n)},tabBarExtraContent:e.jsxs(e.Fragment,{children:[m.canGenerate&&e.jsx(q,{type:"default",onClick:()=>I(),children:"Generate Timetable"}),!m.canGenerate&&e.jsx(be,{message:"Timetable can't be generated, please fix the errors highlited",type:"error"})]})})})},la=t=>{const[y,i]=a.useState(),[m,r]=a.useState([]),[j,T]=a.useState(0),[I,P]=a.useState(!0),[_,n]=a.useState(20),[d,f]=a.useState(""),[C]=c.useForm(),[F]=c.useForm(),[w]=c.useForm(),v=!ye.useBreakpoint().lg,[b,z]=a.useState(!1),[p,L]=a.useState(!1),[S,h]=a.useState(!1),[l,s]=a.useState(!1),[g,x]=a.useState(!1),[D,K]=a.useState(!1),oe=N=>{i(N),K(!0)},V=N=>{i(N),x(!0)},H=N=>{i(N),s(!0)},$=N=>{i(N),h(!0)},te=N=>{i(N),L(!0)},Ae=async N=>{const{data:k}=await E.custom({url:"",method:"post",meta:{operation:"deleteSchoolTimetable",variables:{schoolTimetableId:{value:N,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(u.error("Error occured while Deleting School Venue"),{data:null})).then(J=>J);k&&(k.success?(u.success(k.message),r(m.filter(J=>J.id.toString()!==N.toString()))):u.error(k.message))},ze=async N=>{r([N,...m]),F.resetFields()},Ve=async N=>{const k=m.findIndex(J=>J.id===N.id);m[k]=N,r([...m]),w.resetFields(),i(void 0),L(!1)},ke=async(N,k="",J=20)=>{P(!0);const{data:re}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetables",variables:{page:{value:N,type:"Int",required:!0},key:{value:k,type:"String",required:!1},pageSize:{value:J,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","isPublished","startAt","endAt","timetableType","timetableTypeDisplay","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id"]},{author:["id","firstName","middleName","lastName","fullName"]},{schoolExamination:["id","name"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(u.error("Error occured while fetching roles"),{data:null})).then(fe=>fe);re&&(T(re.total),r([...re.results])),P(!1)};return a.useEffect(()=>{ke(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:v?24:10,children:e.jsx(c,{layout:"vertical",form:C,onFinish:N=>{f(N.key),m.length=0,ke(1,N.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:v?24:2,children:e.jsx(q,{icon:e.jsx(ce,{}),size:"large",onClick:()=>C.submit()})}),e.jsx(B,{span:v?24:12,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(W,{title:"Register a New Venue/Class",children:e.jsx(q,{icon:e.jsx(Ie,{}),size:"large",onClick:()=>z(!0),children:"Add Timetable"})})})})]}),e.jsx(ge,{loading:I,columns:[{title:"Title",dataIndex:"title",fixed:!0,render:(N,k,J)=>{var re;return e.jsx("span",{children:e.jsxs("a",{children:[k.title,k.forExamination&&e.jsx(M,{color:"red",style:{marginLeft:10},children:(re=k==null?void 0:k.schoolExamination)==null?void 0:re.name})]})})}},{title:"Examination",dataIndex:"examination",fixed:!0,render:(N,k,J)=>e.jsx("span",{children:e.jsx("a",{children:k.forExamination?e.jsx(M,{color:"green",children:"Yes"}):e.jsx(M,{color:"red",children:"No"})})})},{title:"Year",dataIndex:"year",fixed:!0,render:(N,k,J)=>e.jsx("span",{children:e.jsx("a",{children:k.year})})},{title:"Timetable Type",dataIndex:"Timetable Type",fixed:!0,render:(N,k,J)=>{var re;return e.jsx("span",{children:e.jsx("a",{children:(re=k==null?void 0:k.timetableSchoolType)==null?void 0:re.name})})}},{title:"Start AT",dataIndex:"startAt",fixed:!0,render:(N,k,J)=>e.jsx("span",{children:ne(new Date(k.startAt)).format("MMM Do Y")})},{title:"End At",dataIndex:"endAt",fixed:!0,render:(N,k,J)=>e.jsx("span",{children:ne(new Date(k.endAt)).format("MMM Do Y")})},{title:"Date Created",dataIndex:"created",render:(N,k,J)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:e.jsx(Le,{date:new Date(k.created)})})})},{title:"Status",dataIndex:"isActive",render:(N,k,J)=>e.jsx("a",{children:k!=null&&k.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(N,k,J)=>{var re,fe;return e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(rt,{trigger:["click"],overlay:e.jsxs(he,{children:[e.jsx(he.Item,{icon:e.jsx(Ce,{}),disabled:!k.canDelete,children:e.jsx(ee,{placement:"topLeft",title:`Are you sure you want to delete ${k.name} Timetable?`,onConfirm:()=>Ae(parseInt(k.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(he.Item,{icon:e.jsx(Oe,{}),disabled:!k.canEdit,onClick:()=>te(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Edit"})}),["pr","osc","asc","	tert"].includes((re=k==null?void 0:k.timetableSchoolType)==null?void 0:re.code)&&e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>$(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Scheduler"})}),["uni","poly","col","ous"].includes((fe=k==null?void 0:k.timetableSchoolType)==null?void 0:fe.code)&&e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>H(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Scheduler"})}),e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>oe(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Auto Generate"})}),e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>V(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Schedules Drafts"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:Me=>Me.preventDefault(),children:e.jsx(it,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}}],dataSource:m,pagination:{onChange:(N,k)=>{n(k),ke(N,d,k)},total:j,pageSize:_,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(80vh - 80px)"}}),e.jsx(de,{title:"Creating New School Timetable",width:"30vw",open:b,onClose:N=>z(N),children:e.jsx(ta,{randKey:Math.random(),form:F,onFinish:ze})}),e.jsx(de,{title:"Edditing School Timetable",width:"30vw",open:p,onClose:N=>L(N),children:e.jsx(sa,{randKey:Math.random(),form:w,onFinish:Ve,schoolTimetable:y})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"School Timetable Education Levels"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:y==null?void 0:y.title})})]}),width:"60vw",open:S,onClose:N=>h(N),children:e.jsx(ct,{schoolTimetable:y,randKey:Math.random()})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetable Study Courses"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:y==null?void 0:y.title})})]}),width:"80vw",open:l,onClose:N=>s(N),children:e.jsx(ra,{schoolTimetable:y,randKey:Math.random(),autoGenerate:()=>{K(!0)}})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetables Schedules Drafts"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:y==null?void 0:y.title})})]}),width:"90vw",open:g,onClose:N=>x(N),children:e.jsx(e.Fragment,{children:"Drafts"})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetable Auto Generation"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:y==null?void 0:y.title})})]}),width:"60vw",open:D,onClose:N=>K(N),children:e.jsx(ia,{schoolTimetable:y,randKey:Math.random()})})]})},oa=()=>(a.useEffect(()=>(document.title=Ee.system_name+": School Timetables",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(le,{children:[e.jsx(le.Item,{children:e.jsx(Se,{to:"/timetable",children:"Home"})}),e.jsx(le.Item,{children:"Timetables"})]}),e.jsx(la,{})]})),Ta=t=>{const{page:y}=t;return y==="SchoolTimetablesPage"?e.jsx(oa,{}):y==="SchoolVenuesPage"?e.jsx(Zt,{}):y==="SchoolTimetableEducationLevelSchedulerPage"?e.jsx(Wt,{}):y==="SchoolTimetableStudyCourseSchedulerPage"?e.jsx(Ht,{}):y==="TimetableDashboardPage"?e.jsx(zt,{}):y==="SchoolTimetableSettingsPage"?e.jsx(Kt,{}):e.jsx("div",{children:"Page not found ..."})};export{Ta as TimetablePages};
