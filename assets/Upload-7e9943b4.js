import{r as y,fw as de,gL as ve,fv as Z,fu as ae,cT as O,h as U,c as ne,gC as he,fm as se,fn as oe,K as ie,_ as $,J as ce,ft as T,R as K,fp as me,gX as ye,gY as z}from"./index-2fc17c3b.js";var ge={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},ke=function(){var n=y.useRef([]),s=y.useRef(null);return y.useEffect(function(){var e=Date.now(),t=!1;n.current.forEach(function(r){if(r){t=!0;var o=r.style;o.transitionDuration=".3s, .3s, .3s, .06s",s.current&&e-s.current<100&&(o.transitionDuration="0s, 0s")}}),t&&(s.current=Date.now())}),n.current},Q=0,be=ve();function Ce(){var a;return be?(a=Q,Q+=1):a="TEST_OR_SSR",a}const De=function(a){var n=y.useState(),s=de(n,2),e=s[0],t=s[1];return y.useEffect(function(){t("rc_progress_".concat(Ce()))},[]),a||e};var Se=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function ee(a){return+a.replace("%","")}function re(a){var n=a??[];return Array.isArray(n)?n:[n]}var M=100,x=function(n,s,e,t,r,o,i,l,c,p){var d=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,f=e/100*360*((360-o)/360),h=o===0?0:{bottom:0,top:180,left:90,right:-90}[i],v=(100-t)/100*s;return c==="round"&&t!==100&&(v+=p/2,v>=s&&(v=s-.01)),{stroke:typeof l=="string"?l:void 0,strokeDasharray:"".concat(s,"px ").concat(n),strokeDashoffset:v+d,transform:"rotate(".concat(r+f+h,"deg)"),transformOrigin:"0 0",transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Ie=function(n){var s=Z(Z({},ge),n),e=s.id,t=s.prefixCls,r=s.steps,o=s.strokeWidth,i=s.trailWidth,l=s.gapDegree,c=l===void 0?0:l,p=s.gapPosition,d=s.trailColor,f=s.strokeLinecap,h=s.style,v=s.className,C=s.strokeColor,S=s.percent,g=ae(s,Se),w=De(e),b="".concat(w,"-gradient"),D=M/2-o/2,u=Math.PI*2*D,k=c>0?90+c/2:-90,m=u*((360-c)/360),W=O(r)==="object"?r:{count:r,space:2},P=W.count,J=W.space,le=x(u,m,0,100,k,c,p,d,f,o),V=re(S),A=re(C),_=A.find(function(E){return E&&O(E)==="object"}),G=ke(),ue=function(){var F=0;return V.map(function(L,R){var I=A[R]||A[A.length-1],j=I&&O(I)==="object"?"url(#".concat(b,")"):void 0,q=x(u,m,F,L,k,c,p,I,f,o);return F+=L,y.createElement("circle",{key:R,className:"".concat(t,"-circle-path"),r:D,cx:0,cy:0,stroke:j,strokeLinecap:f,strokeWidth:o,opacity:L===0?0:1,style:q,ref:function(N){G[R]=N}})}).reverse()},pe=function(){var F=Math.round(P*(V[0]/100)),L=100/P,R=0;return new Array(P).fill(null).map(function(I,j){var q=j<=F-1?A[0]:d,Y=q&&O(q)==="object"?"url(#".concat(b,")"):void 0,N=x(u,m,R,L,k,c,p,q,"butt",o,J);return R+=(m-N.strokeDashoffset+J)*100/m,y.createElement("circle",{key:j,className:"".concat(t,"-circle-path"),r:D,cx:0,cy:0,stroke:Y,strokeWidth:o,opacity:1,style:N,ref:function(fe){G[j]=fe}})})};return y.createElement("svg",U({className:ne("".concat(t,"-circle"),v),viewBox:"".concat(-M/2," ").concat(-M/2," ").concat(M," ").concat(M),style:h,id:e,role:"presentation"},g),_&&y.createElement("defs",null,y.createElement("linearGradient",{id:b,x1:"100%",y1:"0%",x2:"0%",y2:"0%"},Object.keys(_).sort(function(E,F){return ee(E)-ee(F)}).map(function(E,F){return y.createElement("stop",{key:F,offset:E,stopColor:_[E]})}))),!P&&y.createElement("circle",{className:"".concat(t,"-circle-trail"),r:D,cx:0,cy:0,stroke:d,strokeLinecap:f,strokeWidth:i||o,style:le}),P?pe():ue())};function we(a,n){var s="cannot ".concat(a.method," ").concat(a.action," ").concat(n.status,"'"),e=new Error(s);return e.status=n.status,e.method=a.method,e.url=a.action,e}function te(a){var n=a.responseText||a.response;if(!n)return n;try{return JSON.parse(n)}catch{return n}}function Ee(a){var n=new XMLHttpRequest;a.onProgress&&n.upload&&(n.upload.onprogress=function(r){r.total>0&&(r.percent=r.loaded/r.total*100),a.onProgress(r)});var s=new FormData;a.data&&Object.keys(a.data).forEach(function(t){var r=a.data[t];if(Array.isArray(r)){r.forEach(function(o){s.append("".concat(t,"[]"),o)});return}s.append(t,r)}),a.file instanceof Blob?s.append(a.filename,a.file,a.file.name):s.append(a.filename,a.file),n.onerror=function(r){a.onError(r)},n.onload=function(){return n.status<200||n.status>=300?a.onError(we(a,n),te(n)):a.onSuccess(te(n),n)},n.open(a.method,a.action,!0),a.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);var e=a.headers||{};return e["X-Requested-With"]!==null&&n.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(e).forEach(function(t){e[t]!==null&&n.setRequestHeader(t,e[t])}),n.send(s),{abort:function(){n.abort()}}}var Fe=+new Date,Pe=0;function B(){return"rc-upload-".concat(Fe,"-").concat(++Pe)}const X=function(a,n){if(a&&n){var s=Array.isArray(n)?n:n.split(","),e=a.name||"",t=a.type||"",r=t.replace(/\/.*$/,"");return s.some(function(o){var i=o.trim();if(/^\*(\/\*)?$/.test(o))return!0;if(i.charAt(0)==="."){var l=e.toLowerCase(),c=i.toLowerCase(),p=[c];return(c===".jpg"||c===".jpeg")&&(p=[".jpg",".jpeg"]),p.some(function(d){return l.endsWith(d)})}return/\/\*$/.test(i)?r===i.replace(/\/.*$/,""):t===i?!0:/^\w+$/.test(i)?(he(!1,"Upload takes an invalidate 'accept' type '".concat(i,"'.Skip for check.")),!0):!1})}return!0};function Re(a,n){var s=a.createReader(),e=[];function t(){s.readEntries(function(r){var o=Array.prototype.slice.apply(r);e=e.concat(o);var i=!o.length;i?n(e):t()})}t()}var Ae=function(n,s,e){var t=function r(o,i){o.path=i||"",o.isFile?o.file(function(l){e(l)&&(o.fullPath&&!l.webkitRelativePath&&(Object.defineProperties(l,{webkitRelativePath:{writable:!0}}),l.webkitRelativePath=o.fullPath.replace(/^\//,""),Object.defineProperties(l,{webkitRelativePath:{writable:!1}})),s([l]))}):o.isDirectory&&Re(o,function(l){l.forEach(function(c){r(c,"".concat(i).concat(o.name,"/"))})})};n.forEach(function(r){t(r.webkitGetAsEntry())})},Le=["component","prefixCls","className","disabled","id","style","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave"],je=function(a){se(s,a);var n=oe(s);function s(){var e;ie(this,s);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return e=n.call.apply(n,[this].concat(r)),e.state={uid:B()},e.reqs={},e.fileInput=void 0,e._isMounted=void 0,e.onChange=function(i){var l=e.props,c=l.accept,p=l.directory,d=i.target.files,f=$(d).filter(function(h){return!p||X(h,c)});e.uploadFiles(f),e.reset()},e.onClick=function(i){var l=e.fileInput;if(l){var c=e.props,p=c.children,d=c.onClick;if(p&&p.type==="button"){var f=l.parentNode;f.focus(),f.querySelector("button").blur()}l.click(),d&&d(i)}},e.onKeyDown=function(i){i.key==="Enter"&&e.onClick(i)},e.onFileDrop=function(i){var l=e.props.multiple;if(i.preventDefault(),i.type!=="dragover")if(e.props.directory)Ae(Array.prototype.slice.call(i.dataTransfer.items),e.uploadFiles,function(p){return X(p,e.props.accept)});else{var c=$(i.dataTransfer.files).filter(function(p){return X(p,e.props.accept)});l===!1&&(c=c.slice(0,1)),e.uploadFiles(c)}},e.uploadFiles=function(i){var l=$(i),c=l.map(function(p){return p.uid=B(),e.processFile(p,l)});Promise.all(c).then(function(p){var d=e.props.onBatchStart;d==null||d(p.map(function(f){var h=f.origin,v=f.parsedFile;return{file:h,parsedFile:v}})),p.filter(function(f){return f.parsedFile!==null}).forEach(function(f){e.post(f)})})},e.processFile=function(){var i=ye(z().mark(function l(c,p){var d,f,h,v,C,S,g,w,b;return z().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(d=e.props.beforeUpload,f=c,!d){u.next=14;break}return u.prev=3,u.next=6,d(c,p);case 6:f=u.sent,u.next=12;break;case 9:u.prev=9,u.t0=u.catch(3),f=!1;case 12:if(f!==!1){u.next=14;break}return u.abrupt("return",{origin:c,parsedFile:null,action:null,data:null});case 14:if(h=e.props.action,typeof h!="function"){u.next=21;break}return u.next=18,h(c);case 18:v=u.sent,u.next=22;break;case 21:v=h;case 22:if(C=e.props.data,typeof C!="function"){u.next=29;break}return u.next=26,C(c);case 26:S=u.sent,u.next=30;break;case 29:S=C;case 30:return g=(O(f)==="object"||typeof f=="string")&&f?f:c,g instanceof File?w=g:w=new File([g],c.name,{type:c.type}),b=w,b.uid=c.uid,u.abrupt("return",{origin:c,data:S,parsedFile:b,action:v});case 35:case"end":return u.stop()}},l,null,[[3,9]])}));return function(l,c){return i.apply(this,arguments)}}(),e.saveFileInput=function(i){e.fileInput=i},e}return ce(s,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(t){var r=this,o=t.data,i=t.origin,l=t.action,c=t.parsedFile;if(this._isMounted){var p=this.props,d=p.onStart,f=p.customRequest,h=p.name,v=p.headers,C=p.withCredentials,S=p.method,g=i.uid,w=f||Ee,b={action:l,filename:h,data:o,file:c,headers:v,withCredentials:C,method:S||"post",onProgress:function(u){var k=r.props.onProgress;k==null||k(u,c)},onSuccess:function(u,k){var m=r.props.onSuccess;m==null||m(u,c,k),delete r.reqs[g]},onError:function(u,k){var m=r.props.onError;m==null||m(u,k,c),delete r.reqs[g]}};d(i),this.reqs[g]=w(b)}}},{key:"reset",value:function(){this.setState({uid:B()})}},{key:"abort",value:function(t){var r=this.reqs;if(t){var o=t.uid?t.uid:t;r[o]&&r[o].abort&&r[o].abort(),delete r[o]}else Object.keys(r).forEach(function(i){r[i]&&r[i].abort&&r[i].abort(),delete r[i]})}},{key:"render",value:function(){var t,r=this.props,o=r.component,i=r.prefixCls,l=r.className,c=r.disabled,p=r.id,d=r.style,f=r.multiple,h=r.accept,v=r.capture,C=r.children,S=r.directory,g=r.openFileDialogOnClick,w=r.onMouseEnter,b=r.onMouseLeave,D=ae(r,Le),u=ne((t={},T(t,i,!0),T(t,"".concat(i,"-disabled"),c),T(t,l,l),t)),k=S?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},m=c?{}:{onClick:g?this.onClick:function(){},onKeyDown:g?this.onKeyDown:function(){},onMouseEnter:w,onMouseLeave:b,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:"0"};return K.createElement(o,U({},m,{className:u,role:"button",style:d}),K.createElement("input",U({},me(D,{aria:!0,data:!0}),{id:p,type:"file",ref:this.saveFileInput,onClick:function(P){return P.stopPropagation()},key:this.state.uid,style:{display:"none"},accept:h},k,{multiple:f,onChange:this.onChange},v!=null?{capture:v}:{})),C)}}]),s}(y.Component);function H(){}var qe=function(a){se(s,a);var n=oe(s);function s(){var e;ie(this,s);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return e=n.call.apply(n,[this].concat(r)),e.uploader=void 0,e.saveUploader=function(i){e.uploader=i},e}return ce(s,[{key:"abort",value:function(t){this.uploader.abort(t)}},{key:"render",value:function(){return K.createElement(je,U({},this.props,{ref:this.saveUploader}))}}]),s}(y.Component);qe.defaultProps={component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:H,onError:H,onSuccess:H,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0};export{Ie as C,qe as U,ge as d,ke as u};
