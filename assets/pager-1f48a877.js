import{r as t,c as se,aU as m,j as e,aY as H,aQ as f,$ as U,c$ as Q,av as D,aT as he,dz as Te,dp as Le,a$ as Y,aZ as ne,c6 as ie,g as N,_ as c,a_ as ye,ad as oe,d9 as te,ar as pe,dA as G,S as Ce,dl as _e,dB as Ke,dC as Be,aS as ce,aV as O,cc as de,du as Ie,dD as Ve,cS as ue,c2 as $,d2 as je,co as Oe,dE as Ne,ca as ee,aO as E,ct as L,cH as me,cb as xe,c3 as Ue,aW as Re,cJ as He,cQ as Ye,c7 as We,d3 as Fe}from"./index-351477c3.js";import{L as fe}from"./index-a79ac33a.js";import{C as _}from"./index-e245930b.js";import{A as ke}from"./index-6af680ed.js";import{S as W}from"./index-e9f79efd.js";import{A as le}from"./index-204a1fd3.js";import{S as Ee}from"./Skeleton-8f0e80db.js";import{F as Pe}from"./index-45b375c6.js";import{M as ge}from"./index-8b72edfc.js";import{l as be}from"./index-6b812589.js";import{G as $e}from"./index-ba2e3766.js";import{P as Se}from"./index-81b1f6d5.js";import{U as Qe}from"./index-a5d8814c.js";import"./index-d9a31a18.js";import"./index-cbd0288c.js";import"./InfoCircleFilled-9eecc8d9.js";import"./ActionButton-40b0160f.js";import"./DialogWrap-e5db41da.js";import"./index-20e3f79b.js";import"./fade-8ee215b5.js";import"./defineProperty-cad3b133.js";import"./useNotification-c56c34f9.js";import"./index-7b9f9af3.js";import"./localeData-365ad521.js";import"./SinglePicker-279a4acc.js";import"./useMutateObserver-a2c9d48f.js";import"./index-9b61db8d.js";import"./InputNumber-e7f57cfa.js";import"./Image-0a920d6e.js";import"./Upload-9b869cab.js";import"./Rate-6e1c6086.js";import"./index-88abecb7.js";import"./index-f080e680.js";const Je=()=>{const[a,i]=t.useState([]),[r,s]=t.useState(!1),[u,n]=t.useState(!1),[d,l]=t.useState(20),[h,j]=t.useState(0),[I,P]=t.useState(1);t.useState(""),se();const[z]=m.useForm(),q=async(w,F,C=20)=>{s(!0);const{data:y}=await N.custom({url:"",method:"get",meta:{operation:"messagesDispatches",variables:{page:{value:w,type:"Int",required:!0},key:{value:F,type:"String",required:!1},pageSize:{value:C,type:"Int",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","receipientPhoneNumber","carrier",{channelMessage:["id","message",{channel:["id","name","code"]}]},{receipient:["id","firstName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(M=>(c.error("Error fetching Recently Messages Dispatched"),{data:null})).then(M=>M);y&&(j(y.total),P(y.page+1),i([...a,...y.results])),s(!1),n(!1)},K=w=>{w.currentTarget.scrollHeight-w.currentTarget.scrollTop===window.innerHeight/1.4&&q(I,"",20)};return t.useEffect(()=>{q(I,"",20)},[]),e.jsx(e.Fragment,{children:e.jsxs(H,{children:[e.jsx(f,{children:e.jsx("span",{style:{fontSize:16,fontWeight:"bolder"},children:"Recently Dispatched Messages"})}),e.jsx(f,{span:20,style:{height:45},children:e.jsx(m,{layout:"vertical",form:z,onFinish:w=>{n(!0),q(I,w.key,d)},children:e.jsx(m.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:u,placeholder:"Search Phone Number(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-start",height:45},children:e.jsx(D,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{z.submit()},loading:u||r,disabled:u||r})}),e.jsxs(f,{span:24,children:[a.length===0&&e.jsx(he,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No recently dispatched message ..."})}),e.jsx(fe,{style:{paddingRight:10},children:e.jsx(Te,{data:a,height:window.innerHeight/1.4,itemHeight:47,itemKey:"phoneNumber",onScroll:K,children:w=>{var F,C;return e.jsx(_,{children:e.jsx(fe.Item,{children:e.jsx(fe.Item.Meta,{avatar:e.jsx(ke,{icon:e.jsx(Le,{})}),title:e.jsxs("a",{children:[w.receipientPhoneNumber,e.jsxs("span",{style:{marginLeft:5},children:[e.jsx(Y,{color:"green",children:(C=(F=w==null?void 0:w.channelMessage)==null?void 0:F.channel)==null?void 0:C.name}),w.carrier&&e.jsx(Y,{color:"red",children:w.carrier})]})]}),description:e.jsx(e.Fragment,{children:e.jsxs(ne,{direction:"vertical",children:[e.jsx("span",{children:w.channelMessage.message.length>100?w.channelMessage.message.substring(0,100)+"...":w.channelMessage.message}),e.jsxs("span",{children:[e.jsx("b",{children:"Dispatched"}),":"," ",ie(w.created).format("lll")]})]})})})},w.receipientPhoneNumber)})}})})]})]})})},Ge=a=>{const[i,r]=t.useState([]);t.useState();const[s,u]=t.useState(!1),[n,d]=t.useState(!1),[l,h]=t.useState(20),[j,I]=t.useState(0),[P,z]=t.useState("");se();const[q]=m.useForm(),K=async(F,C,y=20)=>{u(!0);const{data:M}=await N.custom({url:"",method:"get",meta:{operation:"channelMessageDispatches",variables:{page:{value:F,type:"Int",required:!0},key:{value:C,type:"String",required:!1},pageSize:{value:y,type:"Int",required:!1},filterType:{value:a.filterType,type:"String",required:!0},messageId:{value:a.messageId,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","receipientPhoneNumber","status","statusColor","carrier","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(b=>(c.error("Error fetching Dispatches"),{data:null})).then(b=>b);M&&(I(M.total),r(M.results)),u(!1),d(!1)},w=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(F,C,y)=>e.jsx("a",{onClick:()=>{},children:C.receipientPhoneNumber})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(F,C,y)=>e.jsx(Y,{color:"green",children:C.carrier})},{title:"Created",dataIndex:"created",key:"created",render:(F,C,y)=>e.jsx(oe,{title:ie(C.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:ie(C.created).format("Y-mm-d hh:mm:ss")})})},{title:"Status",dataIndex:"status",key:"status",render:(F,C,y)=>e.jsx(Y,{color:C.statusColor,children:C.status})},{title:"",dataIndex:"Action",key:"action",render:(F,C,y)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"}})}];return t.useEffect(()=>{K(1,"",20)},[a.randKey,a.filterType]),e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsx(f,{span:24,children:e.jsx(m,{layout:"vertical",form:q,onFinish:F=>{d(!0),K(0,F.key,l)},children:e.jsx(m.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:n,placeholder:"Search Phone Number(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ye,{loading:s,columns:w,dataSource:i,pagination:{onChange:(F,C)=>{h(C),K(F,P,C)},total:j,pageSize:l,position:["bottomCenter"],showQuickJumper:!0},scroll:{x:!0,y:"40vh"}})]})},Ze=["receipients","delivered","notdelivered","failed"],Xe=["All Receipients","All Delivered","All Not Delivered","All Failed"],Me=a=>{var h;te(),se();const[i,r]=t.useState(!1),[s,u]=t.useState(),[n,d]=t.useState("receipients"),l=async()=>{var I;r(!0);const{data:j}=await N.custom({url:"",method:"get",meta:{operation:"channelMessageDispatchAnalytics",variables:{messageId:{value:(I=a.channelMessage)==null?void 0:I.id,type:"Int",required:!0}},fields:["analytics"]}}).catch(P=>(c.error("Error fetching Message Dispatch analytics"),{data:null})).then(P=>P);j&&u(j.analytics),r(!1)};return t.useEffect(()=>{l()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(pe,{spinning:i,children:[e.jsxs(H,{style:{display:"flex",justifyContent:"center",marginTop:2},children:[e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>d("receipients"),children:e.jsx(_,{children:e.jsx(W,{title:"Total Receipients",value:s==null?void 0:s.total_receipients,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>d("delivered"),children:e.jsx(_,{children:e.jsx(W,{title:"Delivered",value:s==null?void 0:s.total_delivered,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>d("notdelivered"),children:e.jsx(_,{children:e.jsx(W,{title:"Not Delievered",value:s==null?void 0:s.total_not_delivered,precision:0,valueStyle:{color:"#5E0321"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>d("failed"),children:e.jsx(_,{children:e.jsx(W,{title:"Failed",value:s==null?void 0:s.total_failed,precision:0,valueStyle:{color:"#700107"},prefix:e.jsx(G,{})})})})})]}),e.jsxs("div",{style:{marginTop:2},children:[e.jsx("h3",{children:Xe[Ze.indexOf(n)]}),e.jsx(Ge,{randKey:Math.random(),filterType:n,messageId:(h=a.channelMessage)==null?void 0:h.id})]})]})})},{TextArea:es}=U,ss=a=>{const[i,r]=t.useState([]),[s,u]=t.useState([]),n=async(j=1,I=25,P="")=>{const{data:z}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:j,type:"Int",required:!0},pageSize:{value:I,type:"Int",required:!0},key:{value:P,type:"String",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code"]}]}}).catch(()=>(c.remove(),c.error("Error fetching Channels"),{data:null})).then(q=>q);z&&r(z.results)},d=async j=>{console.error(j);const{data:I}=await N.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelMessage",variables:{channels:{value:j.channels,type:"[Int]",required:!0},message:{value:j.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessages:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","dispatched","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(P=>(console.error(P),c.remove(),c.error("Error creating channel message"),{data:null})).then(P=>P);console.log(I),I&&(I.success?(c.success(I.message),a.onFinish(I.njiwaChannelMessages)):c.error(I.message))},l=j=>{u(j)},h=j=>{};return t.useEffect(()=>{n()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:j=>{console.log("values",j),j.channels=s,d(j)},requiredMark:!0,children:[e.jsx(m.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(es,{rows:4})}),e.jsx(m.Item,{name:"channels",label:"Channels",rules:[{required:!0,type:"array",message:"Please Choose Channels ..."}],children:e.jsx(Ce,{size:"large",showSearch:!0,allowClear:!0,mode:"multiple",placeholder:"Select a Channel ...",optionFilterProp:"children",onChange:l,onSearch:h,filterOption:(j,I)=>((I==null?void 0:I.label)??"").toLowerCase().includes(j.toLowerCase()),options:i.map(j=>({value:j.id,label:j.name+" --> "+j.code})),dropdownStyle:{zIndex:9999}})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},ts=a=>{const[i,r]=t.useState(!1),[s,u]=t.useState(),[n,d]=t.useState(""),[l,h]=t.useState(""),[j,I]=t.useState(!1),[P,z]=t.useState(""),[q,K]=t.useState(""),w=async C=>{r(!0);const{data:y}=await N.custom({url:"",method:"post",meta:{operation:"messagePreDispatchSummary",variables:{messageId:{value:C,type:"Int",required:!0}},fields:["success","message",{data:["data"]}]}}).catch(M=>(console.error(M),c.remove(),c.error(M.message),{data:null})).then(M=>M);y&&(u(y.data.data),y.success?d(y.message):h(y.message)),r(!1)},F=async C=>{r(!0);const{data:y}=await N.custom({url:"",method:"post",meta:{operation:"dispatchChannelMessage",variables:{channelMessageId:{value:C,type:"Int",required:!0}},fields:["success","message",{channelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","dispatched","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(M=>(c.remove(),c.error(M.message),{data:null})).then(M=>M);c.remove(),y&&(I(!0),y.success?(K(y.message),a.onDispatch(y.channelMessage)):z(y.message))};return t.useEffect(()=>{w(a.channelMessage.id)},[a.channelMessage.id]),j?e.jsxs(e.Fragment,{children:[q.length>0&&e.jsx(le,{message:q,type:"success",showIcon:!0}),P.length>0&&e.jsx(le,{message:P,type:"error",showIcon:!0})]}):e.jsxs(Ee,{loading:i,active:!0,children:[n.length>0&&e.jsx(le,{message:n,type:"success",showIcon:!0}),l.length>0&&e.jsx(le,{message:l,type:"error",showIcon:!0}),e.jsxs("div",{children:[e.jsxs("p",{children:["Message Count: ",s==null?void 0:s.totalMessages]}),e.jsxs("p",{children:["Message Units: ",s==null?void 0:s.messageUnits]}),e.jsxs("p",{children:["Total Contacts: ",s==null?void 0:s.totalContacts]})]}),e.jsx(Pe,{gap:10,style:{marginTop:20},justify:"flex-end",children:e.jsx(D,{disabled:!(s!=null&&s.dispatchable),type:"primary",onClick:()=>F(a.channelMessage.id),children:"Dispatch"})})]})},De=a=>{const[i,r]=t.useState([]),[s,u]=t.useState(),[n,d]=t.useState(!1),[l,h]=t.useState(!1),[j,I]=t.useState(20);t.useState(""),se(),m.useForm();const[P]=m.useForm(),[z,q]=t.useState(!1),[K,w]=t.useState(!1),[F,C]=t.useState(!1),y=async p=>{u(p),q(!0)},M=p=>{u(p),C(!0)},b=async p=>{const{data:R}=await N.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannelMessage",variables:{id:{value:p,type:"Int",required:!0}},fields:["success","message"]}});c.remove(),R.success?(c.success(R.message),r(i.filter(Z=>Z.id.toString()!==p.toString()))):c.error(R.message)},k=async p=>{r(i.map(R=>R.id===p.id?p:R))},S=p=>{ge.confirm({title:"Deleting Njiwa Channel Message",icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>b(parseInt(p.toString()))})},T=async(p,R,Z=20)=>{d(!0);const{data:ae}=await N.custom({url:"",method:"get",meta:{operation:"njiwaChannelsMessages",variables:{page:{value:p,type:"Int",required:!0},key:{value:R,type:"String",required:!1},pageSize:{value:Z,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"dispatched","messageCount","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>({data:null})).then(re=>re);ae&&r(ae.results),d(!1),h(!1)},J=async p=>{r([...p,...i]),w(!1)};return t.useEffect(()=>{T(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(m,{layout:"vertical",form:P,onFinish:p=>{h(!0),T(0,p.key,j)},children:e.jsx(m.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Channel Message(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",autoFocus:!0,allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(D,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{P.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(oe,{title:"Click to Create Message",placement:"top",color:"green",children:e.jsx(D,{size:"large",icon:e.jsx(_e,{}),onClick:()=>{w(!0)},loading:l||n,disabled:l||n,style:{marginRight:30}})})})]}),e.jsx(pe,{spinning:n,children:e.jsx("div",{style:{maxHeight:a.dash?"69vh":"",overflowY:"auto"},children:e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(he,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Message Found ..."})})}),i.map(p=>{var R;return e.jsx(f,{span:24,children:e.jsxs(_,{hoverable:p.isActive,style:{marginRight:10,marginBottom:3},children:[e.jsxs(ne,{style:{right:0,position:"absolute"},children:[p.dispatched?e.jsx(e.Fragment,{children:e.jsx(oe,{title:"Dispatched",placement:"top",color:"green",children:e.jsx(Ke,{style:{color:"green"}})})}):e.jsx(e.Fragment,{children:e.jsx(oe,{title:"Not Dispatched",placement:"top",color:"red",children:e.jsx(Be,{style:{color:"red"}})})}),e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{icon:e.jsx(de,{}),onClick:()=>{S(p.id)},disabled:!(p!=null&&p.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}),!p.dispatched&&e.jsx(O.Item,{icon:e.jsx(Ie,{}),disabled:!(p!=null&&p.canDelete),onClick:()=>{M(p)},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch"})}),e.jsx(O.Item,{icon:e.jsx(Ve,{}),disabled:!(p!=null&&p.canDelete),onClick:()=>y(p),children:e.jsx("a",{rel:"noopener noreferrer",children:"Dispatch Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:Z=>Z.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})]}),e.jsxs(ne,{direction:"vertical",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created By:"}),e.jsx("span",{style:{marginLeft:5},children:(R=p==null?void 0:p.creator)==null?void 0:R.fullName})]}),e.jsx("span",{children:p.message}),e.jsxs(ne,{direction:"horizontal",children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created On:"}),e.jsx("span",{style:{marginLeft:5},children:ie(p.created).format("YYYY/MM/DD HH:MM")})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Channel:"}),e.jsxs("span",{style:{marginLeft:5},children:[p==null?void 0:p.channel.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:p==null?void 0:p.channel.code})})]})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Message Count:"}),e.jsx("span",{style:{marginLeft:5},children:e.jsx(Y,{color:"green",children:p==null?void 0:p.messageCount})})]})]})]})]})})})]})})}),e.jsx($,{title:"Dispatch Report",width:"80vw",open:z,onClose:p=>q(p),children:e.jsx(Me,{randKey:Math.random(),channelMessage:s})}),e.jsx($,{title:"Creating Message",open:K,width:"40vw",onClose:p=>w(p),children:e.jsx(ss,{onFinish:J})}),e.jsx($,{title:"Dispatching Message",open:F,width:"40vw",onClose:p=>C(p),children:e.jsx(ts,{channelMessage:s,onDispatch:p=>k(p)})})]})},ns=a=>{const[i,r]=t.useState(),[s,u]=t.useState(!1),[n]=m.useForm(),[d,l]=t.useState(1),[h,j]=t.useState(),[I,P]=t.useState(""),[z,q]=t.useState(!1);t.useState(!0);const[K,w]=t.useState("Congratulations! Your payment has been received successfully");Oe(b=>b.socketMessage);const F=async()=>{u(!0);const{data:b}=await N.custom({url:"",method:"get",meta:{operation:"systemSettings",fields:["smsCostPerUnit"]}}).catch(()=>(c.remove(),c.error("Error fetching system settings"),{data:null})).then(k=>k);b&&j(b),u(!1)},C=async b=>{const{data:k}=await N.custom({url:"",method:"get",meta:{operation:"schoolNjiwaAccountBilling",variables:{id:{value:b,type:"Int",required:!0}},fields:["id","isPaid","billNumber","amount","phone","paymentDate","receiptNumber","created","updated","isActive"]}}).catch(()=>(c.remove(),c.error("Error fetching billing details"),{data:null})).then(S=>S);k&&r(k)},y=async b=>{console.log(b);const{data:k}=await N.custom({url:"",method:"post",meta:{operation:"purchaseSmsOrder",variables:{messages:{value:b.messages,type:"Int",required:!0},phone:{value:b.phone,type:"String",required:!0}},fields:["success","message",{bill:["id","isPaid","billNumber","amount","phone","paymentDate","receiptNumber","created","updated","isActive"]}]}}).catch(S=>(c.remove(),console.error(S),c.error("Error creating order"),{data:null})).then(S=>S);k&&(k.success?(r(k.bill),c.success(k.message),l(3)):(P(k.message),q(!0)))},M=b=>b.toLocaleString("en-US",{style:"currency",currency:"TZS"});return t.useEffect(()=>{F();const b=setInterval(()=>{i&&!i.isPaid&&C(i.id)},5e3);return()=>clearInterval(b)},[a.randKey]),i&&i.isPaid?e.jsx(e.Fragment,{children:e.jsx(le,{message:K,type:"success",showIcon:!0})}):e.jsxs(Ee,{loading:s,active:!0,children:[z&&d===2&&e.jsx(le,{message:I,type:"error",showIcon:!0}),d===1&&e.jsxs(m,{layout:"vertical",form:n,onFinish:()=>{P(""),q(!1),l(2)},requiredMark:!0,children:[e.jsx(le,{message:"Please note that the minimum number of messages is 100",type:"info",showIcon:!0}),e.jsx(Pe,{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",marginBottom:"10px"},children:e.jsx("div",{children:e.jsxs("h3",{children:["Cost per message: ",h==null?void 0:h.smsCostPerUnit," Tsh"]})})}),e.jsx(m.Item,{name:"messages",label:"Total Messages (5 Tsh per message)",rules:[{type:"number",min:100,message:"Minimum number of messages is 100"}],children:e.jsx(be.InputNumber,{min:100,style:{width:"100%"}})}),e.jsx(m.Item,{name:"phone",label:"Phone Number (will be used for payment)",rules:[{required:!0,message:"Please Enter Phone Number ..."}],children:e.jsx(U,{placeholder:"Enter Phone Number"})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{type:"primary",size:"large",htmlType:"submit",children:"Purchase"})})]}),d===2&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["Total Messages: ",n.getFieldValue("messages")," "]}),e.jsxs("h3",{children:["Total Amount:"," ",M(parseInt(n.getFieldValue("messages"))*parseFloat((h==null?void 0:h.smsCostPerUnit.toString())??"0.0"))," "]}),e.jsxs("h3",{children:["Phone Number: ",n.getFieldValue("phone")," "]})]}),e.jsxs("div",{children:[e.jsx(D,{type:"primary",size:"large",style:{float:"left"},onClick:()=>l(1),children:"Back"}),e.jsx(D,{type:"primary",size:"large",style:{float:"right"},onClick:()=>{y({messages:n.getFieldValue("messages"),phone:n.getFieldValue("phone")})},children:"Pay"})]})]}),d===3&&e.jsxs("div",{children:[e.jsxs("h3",{children:["Payment request sent to ",n.getFieldValue("phone"),", please check your phone and confirm the payment"]}),e.jsxs("div",{children:[e.jsx(D,{type:"primary",size:"large",style:{float:"left"},onClick:()=>l(2),children:"Back"}),e.jsx(D,{type:"primary",size:"large",style:{float:"right"},onClick:()=>a.onFinish(),children:"Finish"})]})]})]})},as=a=>{const[i,r]=t.useState(!1),[s,u]=t.useState(),{push:n}=se(),[d,l]=t.useState(!1),j=!$e.useBreakpoint().lg,I=async()=>{r(!0);const{data:P}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolAnalytic",fields:["analytics"]}}).catch(()=>(c.remove(),c.error("Error fetching analytics"),{data:null})).then(z=>z);P&&u(P.analytics),r(!1)};return t.useEffect(()=>{I()},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(be.Skeleton,{loading:i,children:[e.jsxs(H,{style:{display:"flex",justifyContent:"center"},children:[e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>l(!0),children:e.jsx(_,{children:e.jsx(W,{title:"Balances (Units)",value:s==null?void 0:s.balances,precision:0,valueStyle:{color:"#3f8600"}})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/channels"),children:e.jsx(_,{children:e.jsx(W,{title:"Channels",value:s==null?void 0:s.channels,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/contacts/phonenumbers"),children:e.jsx(_,{children:e.jsx(W,{title:"Phone Numbers",value:s==null?void 0:s.phone_numbers,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/contacts/emails"),children:e.jsx(_,{children:e.jsx(W,{title:"Emails",value:s==null?void 0:s.emails,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages"),children:e.jsx(_,{children:e.jsx(W,{title:"Messages",value:s==null?void 0:s.messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/sent"),children:e.jsx(_,{children:e.jsx(W,{title:"Pending Messages",value:s==null?void 0:s.sent_messages,precision:0,valueStyle:{color:"#770622"},prefix:e.jsx(Ne,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/sent"),children:e.jsx(_,{children:e.jsx(W,{title:"Sent Messages",value:s==null?void 0:s.sent_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/failed"),children:e.jsx(_,{children:e.jsx(W,{title:"Failed Messages",value:s==null?void 0:s.failed_messages,precision:0,valueStyle:{color:"#861400"},prefix:e.jsx(Ne,{})})})})})]}),e.jsxs(H,{children:[e.jsx(f,{span:12,children:e.jsxs("div",{style:{marginTop:20},children:[e.jsx("span",{style:{fontSize:16,fontWeight:"bolder"},children:"Messages"}),e.jsx(De,{dash:!0})]})}),e.jsx(f,{span:12,children:e.jsx("div",{style:{marginTop:20},children:e.jsx(Je,{})})})]})]}),e.jsx($,{title:"Purchase Messages",open:d,onClose:P=>{I(),l(P)},width:j?"100vw":"30vw",children:e.jsx(ns,{onFinish:()=>l(!1)})})]})},rs=()=>(t.useEffect(()=>{document.title=ee.system_name+": Njiwa"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Channels"})]})}),e.jsx(as,{})]})),{TextArea:is}=U,ve=a=>{const i=async r=>{const{data:s}=await N.custom({url:"",method:"post",meta:{operation:"createNjiwaChannel",variables:{name:{value:r.name,type:"String",required:!0},description:{value:r.description,type:"String",required:!1}},fields:["success","message",{njiwaChannel:["id","name","description","code","icon","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(u=>(c.error("Error creating channel"),{data:null})).then(u=>u);s&&(s.success?(c.success(s.message),a.onFinish(s.njiwaChannel)):c.error(s.message))};return t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,children:[e.jsx(m.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Channel Name ..."}],children:e.jsx(U,{size:"large",placeholder:"Enter Channel Name ..."})}),e.jsx(m.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(is,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{TextArea:ls}=U,os=a=>{const i=async r=>{var u;const{data:s}=await N.custom({url:"",method:"post",meta:{operation:"updateNjiwaChannel",variables:{channelId:{value:(u=a.channel)==null?void 0:u.id,type:"Int",required:!0},name:{value:r.name,type:"String",required:!0},description:{value:r.description,type:"String",required:!1}},fields:["success","message",{njiwaChannel:["id","name","description","code","icon","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(n=>(c.error("Error Updating channel"),{data:null})).then(n=>n);s&&(s.success?(c.success(s.message),a.onFinish(s.njiwaChannel)):c.error(s.message))};return t.useEffect(()=>{var r,s;a.form.setFieldsValue({name:(r=a.channel)==null?void 0:r.name,description:(s=a.channel)==null?void 0:s.description})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,autoComplete:"off",children:[e.jsx(m.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Channel Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Channel Name ..."})}),e.jsx(m.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(ls,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},cs=a=>{const[i,r]=t.useState([]),[s,u]=t.useState(),[n,d]=t.useState(!1),[l,h]=t.useState(!1),[j,I]=t.useState(0),[P,z]=t.useState(1),[q,K]=t.useState(30),[w,F]=t.useState(""),{push:C}=se(),[y,M]=t.useState(!1),[b,k]=t.useState(!1),[S]=m.useForm(),[T]=m.useForm(),[J]=m.useForm(),p=o=>{z(o),B(o,w,q)},R=o=>{u(o),k(!0)},Z=()=>{M(!0)},ae=async o=>{r([o,...i]),S.resetFields(),M(!1)},re=async o=>{const x=i.findIndex(v=>v.id===o.id);i[x]=o,r([...i]),T.resetFields(),k(!1)},g=async o=>{const{data:x}=await N.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{channelId:{value:o,type:"Int",required:!0}},fields:["success","message"]}}).catch(v=>(c.error(v.message),{data:null})).then(v=>v);x&&(x.success?(c.success(x.message),r(i.filter(v=>v.id.toString()!==o.toString()))):c.error(x.message))},A=o=>{ge.confirm({title:e.jsxs(e.Fragment,{children:["Deleting ",o.name," Channel"]}),icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Yes",cancelText:"Cancel",onOk:()=>g(parseInt(o.id.toString()))})},B=async(o,x,v=20)=>{d(!0);const{data:V}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:o,type:"Int",required:!0},key:{value:x,type:"String",required:!1},pageSize:{value:v,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(X=>(c.error("Error fetching channels"),{data:null})).then(X=>X);V&&(I(V.total),r(V.results)),d(!1),h(!1)};return t.useEffect(()=>{B(1,w,q)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(m,{layout:"vertical",form:J,onFinish:o=>{F(o.key),h(!0),B(0,o.key,q)},children:e.jsx(m.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Channel(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(D,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{J.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(D,{size:"large",disabled:n||l,onClick:()=>{S.resetFields(),Z()},children:[e.jsx(me,{}),"Create Channel"]})})]}),e.jsxs(pe,{spinning:n,size:"large",children:[e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(he,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(D,{type:"primary",onClick:()=>{S.resetFields(),Z()},children:"Create Channel Now"})})}),i.map(o=>e.jsx(f,{span:4,children:e.jsxs(_,{hoverable:o.isActive,style:{marginRight:10},children:[e.jsx(ne,{style:{right:0,position:"absolute"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{icon:e.jsx(xe,{}),onClick:()=>{R(o)},disabled:!(o!=null&&o.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(O.Item,{icon:e.jsx(de,{}),onClick:()=>{A(o)},disabled:!(o!=null&&o.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:x=>x.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsx("a",{onClick:()=>C("/njiwa/channel/"+o.id+"/"+o.name),children:e.jsxs(ne,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsx(ke,{size:{xs:24,sm:32,md:40,lg:40,xl:40,xxl:80},icon:e.jsx(Ue,{}),src:o.icon}),e.jsx(oe,{title:o.name,children:o.name.length>10?o.name.substring(0,10)+"...":o.name}),e.jsx("span",{children:e.jsx(Y,{color:"green",children:o.code})})]})})]})}))]}),i.length>0&&e.jsx(H,{style:{display:"flex",justifyContent:"center"},children:e.jsx("span",{style:{marginTop:20},children:e.jsx(Re,{showQuickJumper:!0,showTotal:(o,x)=>`Total ${o} Channels`,defaultCurrent:P,total:j,pageSize:q,onChange:p,showSizeChanger:!0,onShowSizeChange:(o,x)=>{K(x),B(o,w,x)},disabled:n||l})})})]}),e.jsx($,{title:"Create Njiwa Channel",width:"40vw",open:y,onClose:o=>M(o),children:e.jsx(ve,{form:S,randKey:Math.random(),onFinish:ae})}),e.jsx($,{title:"Edit "+(s==null?void 0:s.name)+" Channel",width:"40vw",open:b,onClose:o=>k(o),children:e.jsx(os,{form:T,randKey:Math.random(),onFinish:re,channel:s})})]})},ds=()=>(t.useEffect(()=>{document.title=ee.system_name+": Channels"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:5,marginBottom:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Channels"})]})}),e.jsx(cs,{randKey:Math.random()})]})),us=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Emails"})})),hs=a=>{const[i,r]=t.useState(!1),[s,u]=t.useState(),n=te(),d=async()=>{r(!0);const{data:l}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(h=>(c.error("Error fetching channel"),{data:null})).then(h=>h);l&&u(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel Emails",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:5,marginBottom:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(E.Item,{children:e.jsxs(L,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Emails"})]})}),e.jsx(us,{randKey:Math.random(),channel:s})]})},ms=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Failed Messages"})})),xs=a=>{const[i,r]=t.useState(!1),[s,u]=t.useState(),n=te(),d=async()=>{r(!0);const{data:l}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(h=>(c.error("Error fetching channel"),{data:null})).then(h=>h);l&&u(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Failed Messages",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(E.Item,{children:e.jsxs(L,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx(E.Item,{children:"Messages"}),e.jsx("span",{children:"Failed"})]})}),e.jsx(ms,{randKey:Math.random(),channel:s})]})},{TextArea:ps}=U,js=a=>{const i=te(),r=async s=>{const{data:u}=await N.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelMessage",variables:{channelId:{value:parseInt(i.channelId),type:"Int",required:!0},message:{value:s.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(n=>(c.error("Error creating channel message"),{data:null})).then(n=>n);u&&(u.success?(c.success(u.message),a.onFinish(u.njiwaChannelMessage)):c.error(u.message))};return t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:s=>{r(s)},requiredMark:!0,children:[e.jsx(m.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(ps,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{TextArea:gs}=U,fs=a=>{te();const i=async r=>{const{data:s}=await N.custom({url:"",method:"post",meta:{operation:"updateNjiwaChannelMessage",variables:{channelMessageId:{value:r.channel_message_id,type:"Int",required:!0},message:{value:r.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(u=>(c.error("Error creating channel message"),{data:null})).then(u=>u);s&&(s.success?(c.success(s.message),a.onFinish(s.njiwaChannelMessage)):c.error(s.message))};return t.useEffect(()=>{var r;a.form.setFieldsValue({message:(r=a==null?void 0:a.channelMessage)==null?void 0:r.message})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:r=>{var s;r.channel_message_id=(s=a.channelMessage)==null?void 0:s.id,i(r)},requiredMark:!0,children:[e.jsx(m.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(gs,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},ys=a=>{const[i,r]=t.useState([]),[s,u]=t.useState(),[n,d]=t.useState(!1),[l,h]=t.useState(!1),[j,I]=t.useState(20);t.useState(""),se();const[P,z]=t.useState(!1),[q,K]=t.useState(!1),[w,F]=t.useState(!1),[C]=m.useForm(),[y]=m.useForm(),[M]=m.useForm(),b=te(),k=g=>{u(g),F(!0)},S=g=>{u(g),K(!0)},T=()=>{z(!0)},J=async g=>{r([g,...i]),C.resetFields(),z(!1)},p=async g=>{r(i.map(A=>A.id.toString()===g.id.toString()?g:A)),y.resetFields(),K(!1)},R=async g=>{const{data:A}=await N.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannelMessage",variables:{channelMessageId:{value:g,type:"Int",required:!0}},fields:["success","message"]}});A.success?(c.success(A.message),r(i.filter(B=>B.id.toString()!==g.toString()))):c.error(A.message)},Z=async g=>{c("dispatching");const{data:A}=await N.custom({url:"",method:"post",meta:{operation:"dispatchChannelMessage",variables:{channelMessageId:{value:g,type:"Int",required:!0}},fields:["success","message"]}}).catch(B=>(c.error(B.message),{data:null})).then(B=>B);A&&(A.success?c.success(A.message):c.error(A.message))},ae=g=>{ge.confirm({title:"Deleting Njiwa Channel Message",icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>R(parseInt(g.toString()))})},re=async(g,A,B=20)=>{const{data:o}=await N.custom({url:"",method:"get",meta:{operation:"njiwaChannelMessages",variables:{page:{value:g,type:"Int",required:!0},key:{value:A,type:"String",required:!1},pageSize:{value:B,type:"Int",required:!1},channelId:{value:parseInt(b.channelId),type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(x=>(c.error("Failed to fetch Channel Messages"),{data:null})).then(x=>x);o&&r(o.results),d(!1),h(!1)};return t.useEffect(()=>{re(1,"",20)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(m,{layout:"vertical",form:M,onFinish:g=>{h(!0),re(0,g.key,j)},children:e.jsx(m.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Channel Message(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(D,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{M.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(D,{size:"large",disabled:n||l,onClick:()=>{C.resetFields(),T()},children:[e.jsx(me,{}),"Create Message"]})})]}),e.jsx(pe,{spinning:n,children:e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(he,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(D,{type:"primary",onClick:()=>{C.resetFields(),T()},children:"Create Message"})})}),i.map(g=>{var A;return e.jsx(f,{span:24,children:e.jsxs(_,{hoverable:g.isActive,style:{marginRight:10},children:[e.jsx(ne,{style:{right:0,position:"absolute"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{icon:e.jsx(xe,{}),onClick:()=>{S(g)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(O.Item,{icon:e.jsx(de,{}),onClick:()=>{ae(g.id)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}),e.jsx(O.Item,{icon:e.jsx(Ie,{}),disabled:!(g!=null&&g.canDelete),children:e.jsx(Se,{title:"Are you sure to Start Sending/Dispatching SMS?",onConfirm:()=>Z(g.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch"})})}),e.jsx(O.Item,{icon:e.jsx(He,{}),onClick:()=>{k(g)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:B=>B.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsxs(ne,{direction:"vertical",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsx("span",{children:g.message}),e.jsxs(ne,{direction:"horizontal",children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created On:"}),e.jsx("span",{style:{marginLeft:5},children:ie(g.created).format("YYYY/MM/DD HH:MM")})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created By:"}),e.jsx("span",{style:{marginLeft:5},children:(A=g==null?void 0:g.creator)==null?void 0:A.fullName})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Channel:"}),e.jsx("span",{style:{marginLeft:5},children:g==null?void 0:g.channel.name})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Message Count:"}),e.jsx("span",{style:{marginLeft:5},children:e.jsx(Y,{color:"green",children:g==null?void 0:g.messageCount})})]})]})]})]})})})]})}),e.jsx($,{title:"Create Njiwa Channel Message",width:"40vw",open:P,onClose:g=>z(g),children:e.jsx(js,{form:C,randKey:Math.random(),onFinish:J})}),e.jsx($,{title:"Edit Njiwa Channel Message",width:"40vw",open:q,onClose:g=>K(g),children:e.jsx(fs,{form:y,randKey:Math.random(),onFinish:p,channelMessage:s})}),e.jsx($,{title:"Dispatch Report",width:"50vw",open:w,onClose:g=>F(g),children:e.jsx(Me,{randKey:Math.random(),channelMessage:s})})]})},Cs=a=>{const[i,r]=t.useState(!1),[s,u]=t.useState(),n=te(),d=async()=>{r(!0);const{data:l}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(h=>(c.error("Error fetching channel"),{data:null})).then(h=>h);l&&u(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel Messages",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(E.Item,{children:e.jsxs(L,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Messages"})]})}),e.jsx(ys,{randKey:Math.random(),channel:s})]})},bs=a=>{const i=te(),{push:r}=se(),[s,u]=t.useState(!1),[n,d]=t.useState(),l=async()=>{u(!0);const{data:h}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannelAnalytic",variables:{channelId:{value:parseInt(i.channelId),type:"Int",required:!0}},fields:["analytics"]}}).catch(j=>(c.error("Error fetching analytics"),{data:null})).then(j=>j);h&&d(h.analytics),u(!1)};return t.useEffect(()=>{l()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(H,{style:{display:"flex",justifyContent:"center",marginTop:10},children:[e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{var h,j;return r("/njiwa/channel/"+((h=a.channel)==null?void 0:h.id)+"/"+((j=a.channel)==null?void 0:j.name)+"/phonenumbers")},children:e.jsx(_,{children:e.jsx(W,{title:"Phone Numbers",value:n==null?void 0:n.phone_numbers,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Emails",value:n==null?void 0:n.emails_addresses,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{var h,j;return r("/njiwa/channel/"+((h=a.channel)==null?void 0:h.id)+"/"+((j=a.channel)==null?void 0:j.name)+"/messages")},children:e.jsx(_,{children:e.jsx(W,{title:"Messages",value:n==null?void 0:n.messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Pending Messages",value:n==null?void 0:n.pending_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Sent Messages",value:n==null?void 0:n.sent_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Failed Messages",value:n==null?void 0:n.failed_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})})]})})},Ss=a=>{const[i,r]=t.useState(!1),[s,u]=t.useState(),n=te(),d=async()=>{r(!0);const{data:l}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(h=>(c.error("Error fetching channel"),{data:null})).then(h=>h);l&&u(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsxs("span",{children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})]})}),e.jsx(bs,{randKey:Math.random(),channel:s})]})},qe=a=>{const[i,r]=t.useState([]),s=async n=>{const{data:d}=await N.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelsPhoneNumber",variables:{phoneNumber:{value:n.phoneNumber,type:"String",required:!0},name:{value:n.name,type:"String",required:!1},channels:{value:n.channels,type:"[Int]",required:!0}},fields:["success","message"]}}).catch(l=>(c.error("Error creating channels phone number"),{data:null})).then(l=>l);d&&(d.success?(c.success(d.message),a.onFinish(d.njiwaChannel)):c.error(d.message))},u=async(n,d,l=20)=>{const{data:h}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:n,type:"Int",required:!0},key:{value:d,type:"String",required:!1},pageSize:{value:l,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(j=>(c.error("Error fetching channels"),{data:null})).then(j=>j);h&&r(h.results)};return t.useEffect(()=>{u(1,"",50)},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:n=>{n.channels=a.channel?[a.channel.id]:[],s(n)},requiredMark:!0,autoComplete:"off",children:[e.jsx(m.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,type:"string",message:"Please input Phone Number"}],children:e.jsx(U,{size:"large",placeholder:"Enter Phone Number ..."})}),e.jsx(m.Item,{name:"name",label:"Full Name",rules:[{required:!1,type:"string",message:"Please input Full Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Full Name ..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},ze=a=>{const i=async r=>{var u;const{data:s}=await N.custom({url:"",method:"post",meta:{operation:"updateNjiwaPhoneNumber",variables:{phoneNumberId:{value:(u=a.phoneNumber)==null?void 0:u.id,type:"Int",required:!0},phoneNumber:{value:r.phoneNumber,type:"String",required:!0},name:{value:r.name,type:"String",required:!1}},fields:["success","message",{phoneNumber:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(n=>(c.error("Error Updating Phone number"),{data:null})).then(n=>n);s&&(s.success?(c.success(s.message),a.onFinish(s.phoneNumber)):c.error(s.message))};return t.useEffect(()=>{var r,s;a.form.setFieldsValue({phoneNumber:(r=a.phoneNumber)==null?void 0:r.phoneNumber,name:(s=a.phoneNumber)==null?void 0:s.name})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,autoComplete:"off",children:[e.jsx(m.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,type:"string",message:"Please input Phone Number"}],children:e.jsx(U,{size:"large",placeholder:"Enter Phone Number ..."})}),e.jsx(m.Item,{name:"name",label:"Full Name",rules:[{required:!1,type:"string",message:"Please input Full Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Full Name ..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{type:"primary",size:"large",htmlType:"submit",children:"Update"})})]})})},{Option:vs}=Ce,ws=a=>Array.isArray(a)?a:a==null?void 0:a.fileList,Ae=a=>{const[i,r]=t.useState([]),s=async n=>{const{data:d}=await N.custom({url:"",method:"post",meta:{operation:"uploadNjiwaChannelsPhoneNumbers",variables:{channels:{value:n.channels,type:"[Int]",required:!0},file:{value:n.file,type:"Upload",required:!0}},fields:["success","message"]}}).catch(l=>(c.error("Error creating channels phone number"),{data:null})).then(l=>l);d&&(d.success?(c.success(d.message),a.onFinish(d.njiwaChannel)):c.error(d.message))},u=async(n,d,l=20)=>{const{data:h}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:n,type:"Int",required:!0},key:{value:d,type:"String",required:!1},pageSize:{value:l,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(j=>(c.error("Error fetching channels"),{data:null})).then(j=>j);h&&r(h.results)};return t.useEffect(()=>{u(1,"",50)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsxs("a",{target:"_blank",href:ee.base_url+"/static/templates/njiwa_channels_phone_numbers_template.xlsx",rel:"noreferrer",children:["Download Excel Template ",e.jsx(Ye,{})]})}),e.jsxs(m,{layout:"vertical",form:a.form,onFinish:n=>{n.channels=n.channels.map(d=>parseInt(d)),s(n)},requiredMark:!0,autoComplete:"off",children:[e.jsx(m.Item,{label:"Contacts File(Excel)",children:e.jsx(m.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:ws,noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload students excel file"}],children:e.jsxs(Qe.Dragger,{name:"file",accept:".xls, .xlsx",multiple:!1,beforeUpload:()=>!1,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(We,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload."})]})})}),e.jsx(m.Item,{name:"channels",label:"Channels",rules:[{required:!0,type:"array",message:"Please select Channel(s)..."}],children:e.jsx(Ce,{size:"large",mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"Please select",defaultValue:[],dropdownStyle:{zIndex:9999},children:i.map(n=>e.jsxs(vs,{value:n.id,children:[n.name,e.jsx("span",{style:{marginLeft:5},children:e.jsx(Y,{color:"green",children:n.code})})]},n.id))})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})]})},Ns=a=>{const[i,r]=t.useState([]),[s,u]=t.useState(),[n,d]=t.useState(!1),[l,h]=t.useState(!1),[j,I]=t.useState(20),[P,z]=t.useState(0),[q,K]=t.useState("");se();const[w,F]=t.useState(!1),[C,y]=t.useState(!1),[M,b]=t.useState(!1),[k]=m.useForm(),[S]=m.useForm(),[T]=m.useForm(),[J]=m.useForm(),p=te(),R=x=>{u(x),y(!0)},Z=()=>{F(!0)},ae=async()=>{B(1,"",20),F(!1),k.resetFields()},re=async x=>{r(i.map(v=>v.id.toString()===x.id.toString()?x:v)),S.resetFields(),y(!1)},g=async()=>{B(1,"",20),T.resetFields(),b(!1)},A=async x=>{const{data:v}=await N.custom({url:"",method:"post",meta:{operation:"deleteChannelPhoneNumber",variables:{id:{value:x,type:"Int",required:!0}},fields:["success","message"]}});v.success?(c.success(v.message),r(i.filter(V=>V.id.toString()!==x.toString()))):c.error(v.message)},B=async(x,v,V=20)=>{d(!0);const{data:X}=await N.custom({url:"",method:"get",meta:{operation:"njiwaChannelPhoneNumbers",variables:{page:{value:x,type:"Int",required:!0},key:{value:v,type:"String",required:!1},pageSize:{value:V,type:"Int",required:!1},channelId:{value:parseInt(p.channelId),type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id",{phoneContact:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]}]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(we=>(c.error("Error fetching phone numbers"),{data:null})).then(we=>we);X&&(z(X.total),r(X.results)),d(!1),h(!1)},o=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(x,v,V)=>e.jsx("a",{onClick:()=>{},children:v.phoneContact.phoneNumber})},{title:"Full Name",dataIndex:"fullName",key:"name",render:(x,v,V)=>e.jsx("span",{children:v.phoneContact.name})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(x,v,V)=>{var X;return e.jsx(Y,{color:"green",children:(X=v.phoneContact.carrier)==null?void 0:X.name})}},{title:"Created",dataIndex:"created",key:"created",render:(x,v,V)=>e.jsx(oe,{title:ie(v.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:ie(v.created).format("Y-mm-d hh:mm:ss")})})},{title:"",dataIndex:"Action",key:"action",render:(x,v,V)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{disabled:!v.canDelete,icon:e.jsx(de,{}),onClick:()=>{},children:e.jsx(Se,{placement:"topLeft",title:"Deleting Phone Number",onConfirm:()=>A(parseInt(v.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(O.Item,{disabled:!v.canEdit,icon:e.jsx(xe,{}),onClick:()=>R(v),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:X=>X.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}];return t.useEffect(()=>{B(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:8,children:e.jsx(m,{layout:"vertical",form:J,onFinish:x=>{h(!0),B(0,x.key,j)},children:e.jsx(m.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Phone Number(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(D,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{J.submit()},loading:l||n,disabled:l||n})}),e.jsxs(f,{span:10,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(D,{size:"large",disabled:n||l,onClick:()=>{k.resetFields(),Z()},icon:e.jsx(me,{}),children:"Add Phone Number"}),e.jsx(D,{size:"large",disabled:n||l,onClick:()=>b(!0),icon:e.jsx(Fe,{}),children:"Upload Phone Numbers"})]})]}),e.jsx(ye,{loading:n,columns:o,dataSource:i,pagination:{onChange:(x,v)=>{I(v),B(x,q,v)},total:P,pageSize:j,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}}),e.jsx($,{title:"Adding Phone Number",width:"40vw",open:w,onClose:x=>F(x),children:e.jsx(qe,{form:k,onFinish:ae,randKey:Math.random(),channel:a.channel})}),e.jsx($,{title:"Editting Phone Number",width:"40vw",open:C,onClose:x=>y(x),children:e.jsx(ze,{form:S,onFinish:re,randKey:Math.random()})}),e.jsx($,{title:"Uploading Phone Numbers",width:"40vw",open:M,onClose:x=>b(x),children:e.jsx(Ae,{form:T,onFinish:g,randKey:Math.random()})})]})},Is=a=>{const[i,r]=t.useState(!1),[s,u]=t.useState(),n=te(),d=async()=>{r(!0);const{data:l}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(h=>(c.error("Error fetching channel"),{data:null})).then(h=>h);l&&u(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Phone Numbers",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(E.Item,{children:e.jsxs(L,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Phone Numbers"})]})}),e.jsx(Ns,{randKey:Math.random(),channel:s})]})},Fs=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Sent Messages"})})),ks=a=>{const[i,r]=t.useState(!1),[s,u]=t.useState(),n=te(),d=async()=>{r(!0);const{data:l}=await N.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(h=>(c.error("Error fetching channel"),{data:null})).then(h=>h);l&&u(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Sent Messages",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(E.Item,{children:e.jsxs(L,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx(E.Item,{children:"Messages"}),e.jsx("span",{children:"Sent"})]})}),e.jsx(Fs,{randKey:Math.random(),channel:s})]})},Es="/assets/nodata-fff54bfe.png",Ps=a=>{const[i,r]=t.useState([]),[s,u]=t.useState(),[n,d]=t.useState(!1),[l,h]=t.useState(!1),[j,I]=t.useState(20);t.useState(""),se();const[P,z]=t.useState(!1),[q,K]=t.useState(!1),[w]=m.useForm();m.useForm();const[F]=m.useForm(),C=S=>{u(S),K(!0)},y=()=>{z(!0)},M=async S=>{const{data:T}=await N.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{id:{value:S,type:"Int",required:!0}},fields:["success","message"]}});T.success?(c.success(T.message),r(i.filter(J=>J.id.toString()!==S.toString()))):c.error(T.message)},b=S=>{ge.confirm({title:"Deleting Njiwa Email Address",icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>M(parseInt(S.toString()))})},k=async(S,T,J=20)=>{const{data:p}=await N.custom({url:"",method:"get",meta:{operation:"njiwaChannels",variables:{control:{value:!0,type:"Boolean",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","icon","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}});r(p.results),d(!1),h(!1)};return t.useEffect(()=>{k(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(m,{layout:"vertical",form:F,onFinish:S=>{h(!0),k(0,S.key,j)},children:e.jsx(m.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Channel(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(D,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{F.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(D,{size:"large",disabled:n||l,onClick:()=>{},children:[e.jsx(me,{}),"Add Email Address"]})})]}),e.jsxs(H,{align:"top",children:[i.length===0&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(he,{image:Es,imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(D,{type:"primary",onClick:()=>{w.resetFields(),y()},children:"Create Email Address Now"})})}),i.map(S=>e.jsx(f,{span:4,children:e.jsxs(_,{hoverable:S.isActive,style:{marginRight:10},children:[e.jsx(ne,{style:{right:0,position:"absolute"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{icon:e.jsx(xe,{}),onClick:()=>{C(S)},disabled:!(S!=null&&S.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(O.Item,{icon:e.jsx(de,{}),onClick:()=>{b(S.id)},disabled:!(S!=null&&S.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:T=>T.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsx(ne,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:S.emailAddress})]})}))]}),e.jsx($,{title:"Create Njiwa Email Address",width:"40vw",open:P,onClose:S=>z(S),children:e.jsx(ve,{})})]})},Ms=()=>(t.useEffect(()=>{document.title=ee.system_name+": Emails"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Emails Addresses"})]})}),e.jsx(Ps,{})]})),Ds=()=>(t.useEffect(()=>{document.title=ee.system_name+": Messages"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Messages"})]})}),e.jsx(De,{})]})),qs=a=>(t.useEffect(()=>{},[]),e.jsx(e.Fragment,{children:e.jsx("span",{children:"Settings"})})),zs=()=>(t.useEffect(()=>{document.title=ee.system_name+": Settings"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Settings"})]})}),e.jsx(qs,{})]})),As=a=>{const[i,r]=t.useState([]),[s,u]=t.useState(),[n,d]=t.useState(!1),[l,h]=t.useState(!1),[j,I]=t.useState(20),[P,z]=t.useState(0),[q,K]=t.useState("");se();const[w,F]=t.useState(!1),[C,y]=t.useState(!1),[M,b]=t.useState(!1),[k]=m.useForm(),[S]=m.useForm(),[T]=m.useForm(),[J]=m.useForm(),p=o=>{u(o),y(!0)},R=()=>{F(!0)},Z=async()=>{A(1,"",20),F(!1),k.resetFields()},ae=async o=>{r(i.map(x=>x.id.toString()===o.id.toString()?o:x)),S.resetFields(),y(!1)},re=async()=>{A(1,"",20),T.resetFields(),b(!1)},g=async o=>{const{data:x}=await N.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{id:{value:o,type:"Int",required:!0}},fields:["success","message"]}});x.success?(c.success(x.message),r(i.filter(v=>v.id.toString()!==o.toString()))):c.error(x.message)},A=async(o,x,v=20)=>{d(!0);const{data:V}=await N.custom({url:"",method:"get",meta:{operation:"njiwaChannelsPhoneContacts",variables:{page:{value:o,type:"Int",required:!0},key:{value:x,type:"String",required:!1},pageSize:{value:v,type:"Int",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(X=>(c.error("Error fetching phone numbers"),{data:null})).then(X=>X);V&&(z(V.total),r(V.results)),d(!1),h(!1)},B=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(o,x,v)=>e.jsx("a",{onClick:()=>{},children:x.phoneNumber})},{title:"Full Name",dataIndex:"fullName",key:"name",render:(o,x,v)=>e.jsx("span",{children:x.name})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(o,x,v)=>{var V;return e.jsx(Y,{color:"green",children:(V=x.carrier)==null?void 0:V.name})}},{title:"Created",dataIndex:"created",key:"created",render:(o,x,v)=>e.jsx(oe,{title:ie(x.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:ie(x.created).format("Y-mm-d hh:mm:ss")})})},{title:"",dataIndex:"Action",key:"action",render:(o,x,v)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{disabled:!x.canDelete,icon:e.jsx(de,{}),onClick:()=>{},children:e.jsx(Se,{placement:"topLeft",title:"Deleting Phone Number",onConfirm:()=>g(parseInt(x.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(O.Item,{disabled:!x.canEdit,icon:e.jsx(xe,{}),onClick:()=>p(x),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:V=>V.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}];return t.useEffect(()=>{A(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:8,children:e.jsx(m,{layout:"vertical",form:J,onFinish:o=>{h(!0),A(0,o.key,j)},children:e.jsx(m.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Phone Number(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(D,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{J.submit()},loading:l||n,disabled:l||n})}),e.jsxs(f,{span:10,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(D,{size:"large",disabled:n||l,onClick:()=>{k.resetFields(),R()},icon:e.jsx(me,{}),children:"Add Phone Number"}),e.jsx(D,{size:"large",disabled:n||l,onClick:()=>b(!0),icon:e.jsx(Fe,{}),children:"Upload Phone Numbers"})]})]}),e.jsx(ye,{loading:n,columns:B,dataSource:i,pagination:{onChange:(o,x)=>{I(x),A(o,q,x)},total:P,pageSize:j,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}}),e.jsx($,{title:"Adding Phone Number",width:"40vw",open:w,onClose:o=>F(o),children:e.jsx(qe,{form:k,onFinish:Z,randKey:Math.random()})}),e.jsx($,{title:"Editting Phone Number",width:"40vw",open:C,onClose:o=>y(o),children:e.jsx(ze,{phoneNumber:s,form:S,onFinish:ae,randKey:Math.random()})}),e.jsx($,{title:"Uploading Phone Numbers",width:"40vw",open:M,onClose:o=>b(o),children:e.jsx(Ae,{form:T,onFinish:re,randKey:Math.random()})})]})},Ts=()=>(t.useEffect(()=>{document.title=ee.system_name+": Phone Numbers"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Phone Numbers"})]})}),e.jsx(As,{})]})),Ls=a=>{const[i,r]=t.useState([]);t.useState();const[s,u]=t.useState(!1),[n,d]=t.useState(!1),[l,h]=t.useState(20),[j,I]=t.useState(0),[P,z]=t.useState(1),[q,K]=t.useState("");se();const[w,F]=t.useState(!1);t.useState(!1),m.useForm(),m.useForm();const[C]=m.useForm(),y=async(b,k,S=20)=>{const{data:T}=await N.custom({url:"",method:"get",meta:{operation:"schoolNjiwaAccountBillings",variables:{control:{value:!0,type:"Boolean",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","created","updated","canEdit","canDelete","canManage"]}]}});r(T.results),I(T.total),z(T.page),u(!1),d(!1)},M=[{title:"Bill #",dataIndex:"billNumber",key:"billNumber"},{title:"Amount",dataIndex:"amount",key:"amount",render:(b,k)=>k.amount.toFixed(2)},{title:"Units",dataIndex:"units",key:"units"},{title:"Status",dataIndex:"status",key:"status",render:(b,k)=>k.isPaid?e.jsx(Y,{color:"green",children:"Paid"}):e.jsx(Y,{color:"red",children:"Unpaid"})}];return t.useEffect(()=>{y(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(m,{layout:"vertical",form:C,onFinish:b=>{d(!0),y(0,b.key,l)},children:e.jsx(m.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:n,placeholder:"Search Bill(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(D,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{C.submit()},loading:n||s,disabled:n||s})})]}),e.jsx(H,{children:e.jsx(f,{span:24,children:e.jsx(be.Table,{dataSource:i,columns:M,pagination:{position:["bottomCenter"],pageSize:l,showSizeChanger:!0,showQuickJumper:!0,total:j,current:P,onChange:(b,k)=>{y(b,q,k)},onShowSizeChange:(b,k)=>{h(k),y(b,q,k)}}})})}),e.jsx($,{title:"Create Njiwa Email Address",width:"40vw",open:w,onClose:b=>F(b),children:e.jsx(ve,{})})]})},_s=()=>(t.useEffect(()=>{document.title=ee.system_name+": Emails"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(E,{children:[e.jsx(E.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Payments"})]})}),e.jsx(Ls,{})]})),ft=a=>{const{page:i}=a;return i==="PhoneNumbersPage"?e.jsx(Ts,{}):i==="NjiwaSettingsPage"?e.jsx(zs,{}):i==="MessagesPage"?e.jsx(Ds,{}):i==="EmailsPage"?e.jsx(Ms,{}):i==="ChannelSentMessagesPage"?e.jsx(ks,{}):i==="ChannelPhoneNumbersPage"?e.jsx(Is,{}):i==="ChannelPage"?e.jsx(Ss,{}):i==="ChannelMessagesPage"?e.jsx(Cs,{}):i==="ChannelFailedMessagesPage"?e.jsx(xs,{}):i==="ChannelEmailsPage"?e.jsx(hs,{}):i==="ChannelsPage"?e.jsx(ds,{}):i==="NjiwaDashboardPage"?e.jsx(rs,{}):i==="NjiwaPaymentsPage"?e.jsx(_s,{}):e.jsx("div",{children:"Page not found ..."})};export{ft as NjiwaPages};
