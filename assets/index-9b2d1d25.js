import{ak as T,_ as B,g as A,m as F,fm as b,fn as O,K as U,r as m,J as I,c as S,o as L,R as u,fo as w,C as E}from"./index-2fc17c3b.js";function C(n){let s;const r=t=>()=>{s=null,n.apply(void 0,B(t))},e=function(){if(s==null){for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];s=T(r(o))}};return e.cancel=()=>{T.cancel(s),s=null},e}const D=n=>{const{componentCls:s}=n;return{[s]:{position:"fixed",zIndex:n.zIndexPopup}}},M=A("Affix",n=>{const s=F(n,{zIndexPopup:n.zIndexBase+10});return[D(s)]});function g(n){return n!==window?n.getBoundingClientRect():{top:0,bottom:window.innerHeight}}function R(n,s,r){if(r!==void 0&&s.top>n.top-r)return r+s.top}function P(n,s,r){if(r!==void 0&&s.bottom<n.bottom+r){const e=window.innerHeight-s.bottom;return r+e}}const N=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"];function _(){return typeof window<"u"?window:null}var h;(function(n){n[n.None=0]="None",n[n.Prepare=1]="Prepare"})(h||(h={}));let z=function(n){b(r,n);var s=O(r);function r(){var e;return U(this,r),e=s.apply(this,arguments),e.state={status:h.None,lastAffix:!1,prevTarget:null},e.placeholderNodeRef=m.createRef(),e.fixedNodeRef=m.createRef(),e.addListeners=()=>{const t=e.getTargetFunc(),o=t==null?void 0:t(),{prevTarget:i}=e.state;i!==o&&(N.forEach(f=>{i==null||i.removeEventListener(f,e.lazyUpdatePosition),o==null||o.addEventListener(f,e.lazyUpdatePosition)}),e.updatePosition(),e.setState({prevTarget:o}))},e.removeListeners=()=>{e.timer&&(clearTimeout(e.timer),e.timer=null);const{prevTarget:t}=e.state,o=e.getTargetFunc(),i=o==null?void 0:o();N.forEach(f=>{i==null||i.removeEventListener(f,e.lazyUpdatePosition),t==null||t.removeEventListener(f,e.lazyUpdatePosition)}),e.updatePosition.cancel(),e.lazyUpdatePosition.cancel()},e.getOffsetTop=()=>{const{offsetBottom:t,offsetTop:o}=e.props;return t===void 0&&o===void 0?0:o},e.getOffsetBottom=()=>e.props.offsetBottom,e.measure=()=>{const{status:t,lastAffix:o}=e.state,{onChange:i}=e.props,f=e.getTargetFunc();if(t!==h.Prepare||!e.fixedNodeRef.current||!e.placeholderNodeRef.current||!f)return;const d=e.getOffsetTop(),p=e.getOffsetBottom(),l=f();if(l){const c={status:h.None},a=g(e.placeholderNodeRef.current);if(a.top===0&&a.left===0&&a.width===0&&a.height===0)return;const x=g(l),v=R(a,x,d),y=P(a,x,p);v!==void 0?(c.affixStyle={position:"fixed",top:v,width:a.width,height:a.height},c.placeholderStyle={width:a.width,height:a.height}):y!==void 0&&(c.affixStyle={position:"fixed",bottom:y,width:a.width,height:a.height},c.placeholderStyle={width:a.width,height:a.height}),c.lastAffix=!!c.affixStyle,i&&o!==c.lastAffix&&i(c.lastAffix),e.setState(c)}},e.prepareMeasure=()=>{e.setState({status:h.Prepare,affixStyle:void 0,placeholderStyle:void 0})},e.updatePosition=C(()=>{e.prepareMeasure()}),e.lazyUpdatePosition=C(()=>{const t=e.getTargetFunc(),{affixStyle:o}=e.state;if(t&&o){const i=e.getOffsetTop(),f=e.getOffsetBottom(),d=t();if(d&&e.placeholderNodeRef.current){const p=g(d),l=g(e.placeholderNodeRef.current),c=R(l,p,i),a=P(l,p,f);if(c!==void 0&&o.top===c||a!==void 0&&o.bottom===a)return}}e.prepareMeasure()}),e}return I(r,[{key:"getTargetFunc",value:function(){const{getTargetContainer:t}=this.context,{target:o}=this.props;return o!==void 0?o:t??_}},{key:"componentDidMount",value:function(){this.timer=setTimeout(this.addListeners)}},{key:"componentDidUpdate",value:function(t){this.addListeners(),(t.offsetTop!==this.props.offsetTop||t.offsetBottom!==this.props.offsetBottom)&&this.updatePosition(),this.measure()}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"render",value:function(){const{affixStyle:t,placeholderStyle:o}=this.state,{affixPrefixCls:i,rootClassName:f,children:d}=this.props,p=S(t&&f,{[i]:!!t});let l=L(this.props,["prefixCls","offsetTop","offsetBottom","target","onChange","affixPrefixCls","rootClassName"]);return u.createElement(w,{onResize:this.updatePosition},u.createElement("div",Object.assign({},l,{ref:this.placeholderNodeRef}),t&&u.createElement("div",{style:o,"aria-hidden":"true"}),u.createElement("div",{className:p,ref:this.fixedNodeRef,style:t},u.createElement(w,{onResize:this.updatePosition},d))))}}]),r}(u.Component);z.contextType=E;const j=m.forwardRef((n,s)=>{const{prefixCls:r,rootClassName:e}=n,{getPrefixCls:t}=m.useContext(E),o=t("affix",r),[i,f]=M(o),d=Object.assign(Object.assign({},n),{affixPrefixCls:o,rootClassName:S(e,f)});return i(u.createElement(z,Object.assign({},d,{ref:s})))}),H=j;export{H as A,C as t};
