import{r as a,c as f,l as Z,av as $,aB as ee,j as e,R as p,d,a as te,k as U,C as se,B as h,ai as B,b1 as ae,I as re,e as oe,aW as ne,dn as ie,y as le,z as ce,M,g as y,dq as de,_ as u,dp as ue}from"./index-0218b022.js";import{U as pe,a as he}from"./upload_folder-664e6ba3.js";import{D as me}from"./drive_info-9382e844.js";import{F as xe}from"./files_component-498a758c.js";import{B as m}from"./Breadcrumb-8d007733.js";import"./index-bc50efac.js";import"./toConsumableArray-d4f18d80.js";import"./addEventListener-a1a8dbaa.js";import"./Tree-c957e1a9.js";import"./index-13ee89b5.js";import"./index-53281e87.js";import"./file_item_component-abbfb25a.js";import"./index-27724231.js";import"./index-ab36f351.js";import"./index.esm-d9d36c7b.js";import"./iconBase-fea8a0f2.js";import"./index-1de60405.js";const ge=z=>{const[x,q]=a.useState(!1),[t,A]=a.useState(),[g,v]=a.useState([]),[C,F]=a.useState(!0),[i,P]=a.useState(1),[je,E]=a.useState(0),[j,R]=a.useState(20),[K,N]=a.useState(0),[fe,O]=a.useState(!0),[S,H]=a.useState(""),[L]=f.useForm(),{push:T}=Z(),[Y,V]=a.useState(Math.random()),[_,w]=a.useState(!1),o=$(),[G,b]=a.useState(!1),I=!ee.useBreakpoint().lg,J=()=>{V(Math.random()),w(!0)},k=async s=>{const{data:r}=await y.custom({url:"",method:"get",meta:{operation:"drive",variables:{id:{value:s,type:"Int",required:!0}},fields:de}}).catch(()=>(u.error("Error occured while fetching drive data"),{data:null})).then(c=>c);r&&(A(r),q(!0))},D=s=>{v([...s,...g])},l=async(s,r="",c=20)=>{F(!0);const{data:n}=await y.custom({url:"",method:"get",meta:{operation:"driveFiles",variables:{id:{value:parseInt(o.drive.toString()),type:"Int",required:!0},page:{value:s,type:"Int",required:!0},key:{value:r,type:"String",required:!1},pageSize:{value:c,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:ue}]}}).catch(()=>(u.error("Error occured while fetching files"),{data:null})).then(X=>X);n&&(N(n.total),P(n.page),E(n.pages),O(n.hasNext),v(n.results)),F(!1)},Q=(s,r)=>{R(r),l(i,S,r)},W=async s=>{const{data:r}=await y.custom({url:"",method:"post",meta:{operation:"connectDrive",variables:{id:{value:s,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(u.error("Drive connection failed"),{data:null})).then(c=>c);r&&(r.success?(u(r.message),k(parseInt(o.drive.toString())),l(i,"",20)):u.error(r.message))};return a.useEffect(()=>{k(parseInt(o.drive.toString())),l(i,"",20)},[o.drive]),x?t!=null&&t.isBlocked?e.jsx("div",{children:e.jsx(U,{message:"You can not Access this Drive, you are blocked",type:"error",showIcon:!0})}):t!=null&&t.isConnected?e.jsxs(e.Fragment,{children:[t&&e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsxs(d,{span:24,style:{display:"flex",justifyContent:"space-between",marginBottom:10},children:[e.jsxs(m,{children:[e.jsx(m.Item,{children:e.jsx(B,{to:"/odrive",children:"Home"})}),e.jsx(m.Item,{children:e.jsx(B,{to:"/odrive/drives",children:"Drives"})}),e.jsxs(m.Item,{children:[t==null?void 0:t.name," - Files"]})]}),e.jsx("div",{children:e.jsx(h,{size:"large",icon:e.jsx(ae,{}),disabled:!(t!=null&&t.canManage)||(t==null?void 0:t.isArchived),onClick:()=>T("/odrive/drive/"+o.drive+"/"+o.code+"/members"),children:"Members"})})]})}),e.jsxs(p,{children:[e.jsx(d,{span:12,children:e.jsx(f,{layout:"vertical",form:L,onFinish:s=>{H(s.key),l(1,s.key,j)},children:e.jsx(f.Item,{name:"key",children:e.jsx(re,{size:"large",placeholder:"Search file(s)...",prefix:e.jsx(oe,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(d,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(h,{size:"large",icon:e.jsx(ne,{}),onClick:()=>J(),loading:!x,disabled:!(t!=null&&t.isAuthor)||(t==null?void 0:t.isArchived),children:"Upload File(s)"}),e.jsx(h,{size:"large",icon:e.jsx(ie,{}),onClick:()=>b(!0),loading:!x,disabled:!(t!=null&&t.isAuthor)||(t==null?void 0:t.isArchived),children:"Upload Folder"})]})]}),e.jsx(le,{sx:{maxHeight:"calc(100vh - 270px)",overflowY:"auto"},children:e.jsx(xe,{loading:C,data:g,min:z.min??!1})})]}),!C&&g.length>0&&e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:10,marginTop:15},children:e.jsx(ce,{showSizeChanger:!0,showQuickJumper:!0,defaultCurrent:i,current:i,total:K,pageSize:j,onShowSizeChange:Q,onChange:s=>l(s,S,j)})}),e.jsx(M,{title:"Uploading Files",open:_,onClose:s=>w(s),width:I?"100vw":"50vw",children:e.jsx(pe,{onFinish:D,random:Y,mode:"drive"})}),e.jsx(M,{title:"Uploading Folder",open:G,onClose:s=>b(s),width:I?"100vw":"50vw",children:e.jsx(he,{onFinish:s=>D(s),mode:"drive",drive:t})})]}):e.jsx(p,{style:{display:"flex",justifyContent:"center"},children:e.jsx(d,{span:12,children:e.jsxs(se,{children:[e.jsx(U,{message:"You can not Access this Drive, you are not connected, Please Click Connect button Below",type:"error",showIcon:!0,style:{marginBottom:30}}),e.jsx(me,{id:t==null?void 0:t.id}),e.jsx(h,{type:"primary",size:"large",style:{float:"right"},onClick:()=>W(t==null?void 0:t.id),children:"Connect"})]})})}):e.jsx(p,{children:e.jsx(d,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(te,{})})})},Re=()=>e.jsx("div",{style:{marginTop:10},children:e.jsx(ge,{})});export{Re as DriveFilesPage};
