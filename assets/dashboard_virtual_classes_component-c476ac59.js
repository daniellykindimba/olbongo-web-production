import{r as c,aT as h,c as M,j as e,aW as E,aP as y,a1 as H,B,a8 as L,cm as k,aX as V,aR as R,aU as u,_ as i,aZ as j,cQ as S,g as p,cv as U}from"./index-05772eb7.js";import{E as W}from"./edit_class_virtual_form-8f6e61d9.js";import{l as _}from"./index-2dc20dbd.js";import{r as x}from"./remove_html_tags-be9c976e.js";import{S as Q}from"./Skeleton-4d93f06a.js";import{A as X}from"./index-951488b4.js";import{C as I}from"./index-7b68fa8b.js";import{P as b}from"./index-1461aa9c.js";import{S as Z,E as G}from"./StopOutlined-164b9f39.js";import{A as K}from"./index-26ba155a.js";import{M as $}from"./index-013e811c.js";import{S as ee}from"./SearchOutlined-0e97f4a9.js";import{D as ae}from"./DownloadOutlined-581febce.js";import{D as te}from"./DeleteOutlined-9fe75e98.js";import{E as re}from"./EditOutlined-2e749454.js";import{C as se}from"./CheckOutlined-9c8d4839.js";import{E as ie}from"./ExclamationCircleOutlined-0a20a855.js";import"./ckeditor-32df5e5c.js";import"./ckeditor-2288a1dc.js";import"./index-67b86639.js";import"./index-6d2464e0.js";import"./index-cedb4c3d.js";import"./localeData-ea0dd020.js";import"./SwapRightOutlined-c4e52b1e.js";import"./SinglePicker-9fafe884.js";import"./index-c1d7a4fa.js";import"./UpOutlined-7082c42f.js";import"./InputNumber-677354a2.js";import"./defineProperty-4d9f4f1d.js";import"./useNotification-fddf6c6b.js";import"./DialogWrap-c515d700.js";import"./index-88e92a4a.js";import"./useMutateObserver-3cfc8689.js";import"./index-fa9d428a.js";import"./Image-256411dd.js";import"./Upload-890ff9ff.js";import"./Rate-fbbf0fc9.js";import"./index-849a35e1.js";import"./index-ad8bef66.js";import"./DotChartOutlined-f39c986e.js";import"./InfoCircleFilled-219488c9.js";import"./InfoCircleFilled-baaa675e.js";import"./index-54251132.js";import"./ActionButton-e20fca38.js";import"./index-fe2fbeda.js";import"./fade-6bc080d2.js";import"./DownloadOutlined-6cd35f11.js";import"./DeleteOutlined-25685737.js";import"./EditOutlined-401a1613.js";const{Meta:ne}=I,oe=l=>{const[n,a]=c.useState([]),[o,m]=c.useState(),[g,C]=c.useState(!0),[N,v]=c.useState(1),[F]=h.useForm();M();const[w]=h.useForm(),[T,f]=c.useState(!1),q=t=>{m(t),f(!0)},Y=async(t,s)=>{const{data:r}=await p.custom({url:"",method:"post",meta:{operation:"endVirtualClass",variables:{id:{value:t,type:"Int",required:!0},stop:{value:s,type:"Boolean",required:!0}},fields:["success","message",{virtualClass:["id","name","description","cover","startDate","endDate","duration","durationType","token","canJoin",{darasa:["id","name","code","description"]},{author:["id","firstName","lastName","middleName","fullName","email","pic"]},"created","canEdit","canDelete","canManage","updated","isActive","ended"]}]}}).catch(()=>(i.error("Error in Ending Virtual Class"),{data:null})).then(d=>d);r&&(r.success?(i(r.message),a(n.map(d=>d.id===t?r.virtualClass:d))):i.error(r.message))},A=async t=>{const{data:s}=await p.custom({url:"",method:"post",meta:{operation:"editVirtualClass",variables:{id:{value:t.id,type:"Int",required:!0},name:{value:t.name,type:"String",required:!0},description:{value:t.description,type:"String",required:!0},duration:{value:t.duration,type:"Int",required:!0},durationType:{value:t.durationType.toUpperCase(),type:"String",required:!0},startDate:{value:t.startDate,type:"DateTime",required:!0},isPublic:{value:!0,type:"Boolean",required:!0}},fields:["success","message",{virtual:["id","name","description","cover","startDate","endDate","duration","durationType","token","canJoin",{darasa:["id","name","code","description"]},{author:["id","firstName","lastName","middleName","fullName","email","pic"]},"created","canEdit","canDelete","canManage","updated","isActive"]}]}}).catch(r=>(i.error("Error editing class"),{data:null})).then(r=>r);s&&(s.success?(i.success(s.message),a(n.map(r=>r.id===s.virtual.id?s.virtual:r)),f(!1)):i.error(s.message))},O=async t=>{const{data:s}=await p.custom({url:"",method:"post",meta:{operation:"deleteVirtualClass",variables:{id:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(r=>(i.error("Error deleting class"),{data:null})).then(r=>r);s&&(s.success?(i.success(s.message),a(n.filter(r=>r.id!==t))):i.error(s.message))},J=t=>{$.confirm({title:"Deleting Virtual Class",icon:e.jsx(ie,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>O(t)})},D=async(t,s="",r=!1)=>{C(!0);const{data:d}=await p.custom({url:"",method:"get",meta:{operation:"myVirtualClasses",variables:{page:{value:t,type:"Int",required:!0},key:{value:s,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","cover","startDate","endDate","duration","durationType","token","canJoin","ended",{darasa:["id","name","code","description"]},{author:["id","firstName","lastName","middleName","fullName","email","pic"]},"created","canEdit","canDelete","canManage","updated","isActive"]}]}}).catch(()=>(i.error("Error fetching classes"),{data:null})).then(z=>z);d&&(v(d.page),a(d.results)),C(!1)},P=async()=>{await p.custom({url:"",method:"get",meta:{operation:"darasaAuth",variables:{},fields:["auth"]}}).catch(()=>(i.error("Error getting darasa auth"),{data:null})).then(t=>t)};return c.useEffect(()=>{P(),D(N)},[]),g?e.jsx(e.Fragment,{children:e.jsx(Q,{loading:g,active:!0})}):e.jsxs(e.Fragment,{children:[e.jsx(E,{children:e.jsx(y,{span:14,children:e.jsx(h,{layout:"vertical",form:F,onFinish:t=>{v(0),D(0,t.key,!0)},children:e.jsx(h.Item,{name:"key",children:e.jsx(H,{size:"large",placeholder:"Search Public Virtual Classes...",prefix:e.jsx(ee,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(B,{sx:{maxHeight:"68vh",overflowY:"auto"},children:e.jsx(L,{spinning:g,children:e.jsxs(E,{children:[n.map(t=>e.jsx(le,{darasa:t,handleDarasaDelete:J,handleDarasaEdit:q,handleDarasaEnd:Y},t.id)),n.length===0&&e.jsx(y,{span:24,children:e.jsx(X,{message:"No Virtual Class Found",type:"info",showIcon:!0})})]})})}),e.jsx(k,{title:"Editting "+(o==null?void 0:o.name),width:"40vw",open:T,onClose:t=>f(t),children:e.jsx(W,{form:w,darasa:o,onFinish:A})})]})},le=l=>{var o;const{push:n}=M(),a=c.useMemo(()=>l.darasa,[l.darasa]);return e.jsx(y,{span:12,xs:24,sm:24,md:12,children:e.jsx(I,{style:{margin:"5px"},bodyStyle:{minHeight:"180px"},cover:e.jsx("img",{alt:"example",src:a.cover,style:{height:"200px",objectFit:"cover"}}),actions:[e.jsx(V,{style:{float:"right"},children:e.jsx(R,{trigger:["click"],overlay:e.jsxs(u,{children:[e.jsx(u.Item,{icon:e.jsx(ae,{}),disabled:!a.canJoin,onClick:()=>n("/oclass/virtual/class/session/"+a.id+"/"+a.token),children:e.jsx("a",{children:"Join"})}),a.canDelete?e.jsx(u.Item,{disabled:!a.canDelete,icon:e.jsx(te,{}),onClick:()=>l.handleDarasaDelete(a.id),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}):e.jsx(e.Fragment,{}),a.canManage&&e.jsx(u.Item,{icon:e.jsx(re,{}),disabled:!a.canManage,onClick:()=>l.handleDarasaEdit(a),children:e.jsx("a",{children:"Edit"})}),a.ended?e.jsx(b,{title:"Un-Stoping Virtual Class",onConfirm:()=>l.handleDarasaEnd(a.id,!1),okText:"Yes",cancelText:"No",disabled:!a.canManage,overlayStyle:{zIndex:9999},children:e.jsx(u.Item,{icon:e.jsx(se,{}),disabled:!a.canManage,children:e.jsx("a",{children:"Un-Stop"})})}):e.jsx(b,{title:"Ending/Stoping Virtual Class",onConfirm:()=>l.handleDarasaEnd(a.id,!0),okText:"Yes",cancelText:"No",disabled:!a.canManage,overlayStyle:{zIndex:9999},children:e.jsx(u.Item,{icon:e.jsx(Z,{}),disabled:!a.canManage,children:e.jsx("a",{children:"End/Stop"})})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:m=>m.preventDefault(),children:e.jsx(G,{style:{color:"orange",fontSize:28,fontWeight:"bold"}},"ellipsis")})})})],children:e.jsx(ne,{avatar:e.jsx(K,{src:(o=a==null?void 0:a.author)==null?void 0:o.pic}),title:e.jsx(_.Tooltip,{title:x(a.name),placement:"top",children:e.jsx("a",{onClick:()=>a.canJoin?n("/oclass/virtual/class/session/"+a.id+"/"+a.token):i("You can't join this class"),children:x(a.name).substring(0,20)+" "+(x(a.name).length>20?"...":"")})}),description:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:x(a.description).substring(0,100)}),e.jsxs("p",{children:[e.jsxs(j,{color:"green",children:["Start At:"," ",e.jsx("span",{style:{marginLeft:10},children:S(a.startDate).format("MMMM do, YYYY H:mma")})]}),e.jsxs(j,{color:"green",children:["End In:",e.jsx("span",{style:{marginLeft:10},children:S(a.endDate).format("MMMM do, YYYY H:mma")})]}),a.canJoin?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsx(j,{color:"red",children:"Not Joinable"})})]})]})})})},a.id)},sa=l=>{const[n,a]=c.useState(!1),o=U(m=>m.totalVirtualClasses);return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx("a",{onClick:()=>a(!0),children:e.jsx("span",{children:e.jsxs(V,{children:[e.jsx("span",{style:{marginRight:10,fontSize:24,color:"green",fontWeight:"bolder"},children:o}),e.jsx("span",{style:{fontSize:18},children:"Virtual Classess"})]})})})}),e.jsx(k,{title:"Virtual Classes",width:"60vw",open:n,onClose:m=>a(m),footer:[],children:e.jsx(oe,{})})]})};export{sa as DashboardVirtualClassesComponent};
