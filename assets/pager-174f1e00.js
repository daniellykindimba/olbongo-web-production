import{ch as mt,j as e,r as a,aT as c,aW as ee,aP as B,a1 as U,aY as ge,aX as se,af as O,av as F,g as C,_ as s,aZ as M,ce as Te,cm as ne,a8 as qe,aS as xt,aO as _e,cl as de,cn as Ie,cL as Ce,aN as J,S as R,cP as G,u as Pe,cz as be,c as Xe,ez as Be,aR as Je,aU as he,eA as Ke,a_ as gt}from"./index-3fd7f13b.js";import{t as yt}from"./text_truncate-315d9efa.js";import{S as ce}from"./SearchOutlined-ecf9dac0.js";import{C as Qe}from"./CheckOutlined-60076e80.js";import{C as Fe}from"./CloseOutlined-8ffd71c9.js";import{G as ye}from"./index-c712b740.js";import{D as ve}from"./index-8b6b3568.js";import{C as xe,b as pt,a as Ve}from"./CheckCircleOutlined-80d9d71b.js";import{C as jt}from"./index-4d7f7a52.js";import{P as te}from"./index-e19e8fa9.js";import{D as Ee}from"./DeleteOutlined-59a1eb9c.js";import{D as Y}from"./index-8a153cba.js";import{D as Ze}from"./index-d7696a51.js";import{C as ft}from"./CloseCircleOutlined-07f78452.js";import{I as St}from"./InfoOutlined-bbf805e8.js";import{U as et}from"./UserOutlined-663643a1.js";import{T as ue}from"./index-5206f9c9.js";import{A as Se}from"./index-1914b305.js";import{D as we}from"./index-6d461898.js";import{C as tt}from"./index-04e1a8e1.js";import{L as me}from"./index-f4e848a4.js";import{C as at}from"./CheckCircleFilled-0aa5cac2.js";import{P as st}from"./PlusCircleOutlined-ec8b7644.js";import{S as rt}from"./SyncOutlined-117adc60.js";import{C as bt,S as vt}from"./SwitcherOutlined-0a2ff52b.js";import{u as Tt}from"./utc-08a53123.js";import{I as nt}from"./index-4f2a380d.js";import{E as it}from"./EditOutlined-dae09423.js";import{M as lt}from"./MoreOutlined-dd08292b.js";import{T as Ge}from"./index-fa873666.js";import{T as It}from"./index-bb42f71b.js";import"./SwapRightOutlined-c4e52b1e.js";import"./index-a1333c14.js";import"./index-f6743604.js";import"./localeData-47498326.js";import"./index-da5d94d5.js";import"./ActionButton-48d88ba2.js";import"./DeleteOutlined-25685737.js";import"./InfoCircleFilled-b90f3a64.js";import"./InfoCircleFilled-baaa675e.js";import"./SinglePicker-f4348261.js";import"./Skeleton-b232d1c4.js";import"./DotChartOutlined-f39c986e.js";import"./UpOutlined-7082c42f.js";import"./InputNumber-be03144d.js";import"./EditOutlined-401a1613.js";import"./transButton-bc924565.js";import"./index-25197a99.js";const Ct=mt(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),Et=t=>{a.useState();const[j,i]=a.useState([]),[f,n]=a.useState(0),[p,T]=a.useState(!0),[w,z]=a.useState(10),[_,r]=a.useState(""),[o]=c.useForm(),S=[{title:"Student",dataIndex:"student",fixed:!0,render:(q,E,v)=>e.jsx("span",{children:e.jsxs(se,{direction:"vertical",children:[e.jsx("a",{children:E.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#"}),":"," ",E.member.registrationNumber]})]})})},{title:"",dataIndex:"status",render:(q,E,v)=>e.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[e.jsx("span",{style:{margin:5},children:e.jsx(O,{title:"Take as Present",color:"green",children:e.jsx(F,{icon:e.jsx(Qe,{style:{color:"green"}}),onClick:()=>I(E.id,t.event.id,1)})})}),e.jsx("span",{style:{margin:5},children:e.jsx(O,{title:"Take as Absent",color:"red",children:e.jsx(F,{icon:e.jsx(Fe,{style:{color:"red"}}),onClick:()=>I(E.id,t.event.id,2)})})})]})}],I=async(q,E,v)=>{const{data:b}=await C.custom({url:"",method:"post",meta:{operation:"takeAttendance",variables:{studentId:{value:q,type:"Int",required:!0},entryId:{value:E,type:"Int",required:!0},present:{value:v,type:"Int",required:!0}},fields:["success","message"]}}).catch(A=>({data:null})).then(A=>A);s.remove(),b&&b.success&&(s.success(b.message),D(1,"",10),t.onAdd()),T(!1)},D=async(q,E="",v=20)=>{T(!0);const{data:b}=await C.custom({url:"",method:"get",meta:{operation:"studentsToTakeAttendance",variables:{page:{value:q,type:"Int",required:!0},key:{value:E,type:"String",required:!1},pageSize:{value:v,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]}]}}).catch(A=>({data:null})).then(A=>A);b&&(n(b.total),i([...b.results])),T(!1)};return a.useEffect(()=>{D(1,"",10)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ee,{style:{marginTop:10},children:e.jsx(B,{span:24,children:e.jsx(c,{layout:"vertical",form:o,onFinish:q=>{r(q.key),j.length=0,D(1,q.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:p,columns:S,dataSource:j,pagination:{onChange:(q,E)=>{z(E),D(q,_,E)},total:f,pageSize:w,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"68vh"}})]})},At=t=>{const[j,i]=a.useState([]),[f,n]=a.useState(0),[p,T]=a.useState(!0),[w,z]=a.useState(20),[_,r]=a.useState(""),[o]=c.useForm(),I=!ye.useBreakpoint().lg,D=[{title:"Student",dataIndex:"student",fixed:!0,render:(E,v,b)=>e.jsx("span",{children:e.jsxs(se,{direction:"vertical",children:[e.jsx("a",{children:v.student.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#:"}),e.jsx("span",{style:{marginLeft:10},children:v.student.member.registrationNumber})]})]})})},{title:"Status",dataIndex:"status",render:(E,v,b)=>e.jsx("span",{children:v.status===1?e.jsx("a",{children:e.jsx(M,{color:"green",children:v.statusDisplay})}):e.jsx("a",{children:e.jsx(M,{color:"red",children:v.statusDisplay})})})}],q=async(E,v="",b=20)=>{T(!0);const{data:A}=await C.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelAttendancesByDate",variables:{page:{value:E,type:"Int",required:!0},key:{value:v,type:"String",required:!1},pageSize:{value:b,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0},date:{value:t.date.format("YYYY/MM/DD"),type:"String",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(s.remove(),s.error("Error occured while fetching roles"),{data:null})).then(m=>m);A&&(n(A.total),i([...A.results])),T(!1)};return a.useEffect(()=>{q(1,"",20)},[t.randKey,t.date,t.event]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:I?24:16,children:e.jsx(c,{layout:"vertical",form:o,onFinish:E=>{r(E.key),j.length=0,q(1,E.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:I?24:2,children:e.jsx(F,{icon:e.jsx(ce,{}),size:"large",onClick:()=>o.submit()})})]}),e.jsx(ge,{loading:p,columns:D,dataSource:j,pagination:{onChange:(E,v)=>{z(v),q(E,_,v)},total:f,pageSize:w,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(100vh - 470px)"}})]})},Re=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],kt=t=>{var K,oe;const[j,i]=a.useState([]),[f,n]=a.useState(0),[p,T]=a.useState(!0),[w,z]=a.useState(20),[_,r]=a.useState(""),[o]=c.useForm(),I=!ye.useBreakpoint().lg,[D,q]=a.useState(!1),[E,v]=a.useState(!1),[b,A]=a.useState(!1),[m,N]=a.useState(),g=async V=>{N(V),A(!0)},y=async V=>{v(!1),q(V)},d=[{title:"Student",dataIndex:"student",fixed:!0,render:(V,H,$)=>e.jsx("span",{children:e.jsxs(se,{direction:"vertical",children:[e.jsx("a",{children:H.student.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#:"}),e.jsx("span",{style:{marginLeft:10},children:H.student.member.registrationNumber})]})]})})},{title:"Status",dataIndex:"status",render:(V,H,$)=>e.jsx("span",{children:H.status===1?e.jsx(te,{title:"Are you sure to mark Absent?",onConfirm:()=>h(H.id,2),onCancel:()=>{},okText:"Absent",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{children:e.jsx(M,{color:"green",children:H.statusDisplay})})}):e.jsx(te,{title:"Are you sure to mark as Present?",onConfirm:()=>h(H.id,1),onCancel:()=>{},okText:"Present",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{children:e.jsx(M,{color:"red",children:H.statusDisplay})})})})},{title:"",dataIndex:"status",render:(V,H,$)=>e.jsx(te,{title:"Are you sure to delete this Attendance Entry?",onConfirm:()=>x(H.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(F,{icon:e.jsx(Ee,{})})})}],u=async(V,H="",$=20)=>{T(!0);const{data:ae}=await C.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelAttendances",variables:{page:{value:V,type:"Int",required:!0},key:{value:H,type:"String",required:!1},pageSize:{value:$,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(s.remove(),s.error("Error occured while fetching roles"),{data:null})).then(Ae=>Ae);ae&&(n(ae.total),i([...ae.results])),T(!1)},x=async V=>{const{data:H}=await C.custom({url:"",method:"post",meta:{operation:"deleteStudentAttendance",variables:{attendanceId:{value:parseInt(V.toString()),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(s.remove(),s.error("Error occured while deleting attendance entry"),{data:null})).then($=>$);H&&(H.success?(s.remove(),s.success(H.message),i(j.filter($=>$.id!==V))):(s.remove(),s.error(H.message)))},h=async(V,H)=>{const{data:$}=await C.custom({url:"",method:"post",meta:{operation:"updateStudentAttendance",variables:{attendanceId:{value:parseInt(V.toString()),type:"Int",required:!0},present:{value:H,type:"Int",required:!0}},fields:["success","message",{attendance:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(s.remove(),s.error("Error occured while updating attendance"),{data:null})).then(ae=>ae);s.remove(),$&&($.success?(s.success($.message),i(j.map(ae=>parseInt(ae.id.toString())===parseInt($.attendance.id.toString())?$.attendance:ae))):s.error($.message)),T(!1)},P=async()=>{u(1,"",20)};return a.useEffect(()=>{u(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:I?24:16,children:e.jsx(c,{layout:"vertical",form:o,onFinish:V=>{r(V.key),j.length=0,u(1,V.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{disabled:E,size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:I?24:2,children:e.jsx(F,{disabled:E,icon:e.jsx(ce,{}),size:"large",onClick:()=>o.submit()})}),t.event.canTakeAttendance&&e.jsx(B,{span:I?24:6,children:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(O,{title:"Start Taking Attendance",children:e.jsx(F,{icon:e.jsx(Te,{}),size:"large",onClick:()=>y(!0),children:"Take Attendance"})}),e.jsx(O,{title:"View Taken Attendances",children:e.jsx(F,{disabled:E,icon:e.jsx(xe,{}),size:"large",onClick:()=>v(!0),children:"View Attendances"})})]})}),!t.event.canTakeAttendance&&e.jsx(B,{span:I?24:6,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(O,{title:"View Taken Attendances",children:e.jsx(F,{disabled:E,icon:e.jsx(xe,{}),size:"large",onClick:()=>v(!0),children:"View Attendances"})})})})]}),E?e.jsx(e.Fragment,{children:e.jsx("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:e.jsx(jt,{onSelect:V=>{var H;if(V<ne().endOf("day")){const $=Re.indexOf((H=t==null?void 0:t.entry)==null?void 0:H.name)+1,ae=V.day();$===ae?g(V):s("No attendance taken on this day")}},disabledDate:V=>{var ae;const H=Re.indexOf((ae=t==null?void 0:t.entry)==null?void 0:ae.name)+1,$=V.day();return V&&V>ne().endOf("day")||H!==$}})})}):e.jsx(ge,{loading:p,columns:d,dataSource:j,pagination:{onChange:(V,H)=>{z(H),u(V,_,H)},total:f,pageSize:w,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(100vh - 470px)"}}),e.jsx(ve,{title:"Taking Attendance",width:"28vw",anchor:"right",onClose:V=>q(V),open:D,noOverFlow:!0,children:e.jsx(Et,{event:t.event,randKey:Math.random(),onAdd:P})}),e.jsx(ve,{title:((K=t.event)==null?void 0:K.subject.name)+" - "+((oe=t.event)==null?void 0:oe.educationLevel.name)+" Attendance taken on "+(m==null?void 0:m.format("YYYY MMM, DD")),width:"50vw",anchor:"left",onClose:V=>A(V),open:b,noOverFlow:!0,children:e.jsx(At,{event:t.event,date:m,randKey:Math.random()})})]})},{TextArea:_t}=U,wt=t=>{const[j,i]=a.useState(!1),[f,n]=a.useState(!1),[p,T]=a.useState([]),[w,z]=a.useState(null),[_,r]=a.useState(null),[o]=c.useForm(),[S,I]=a.useState(!1),[D,q]=a.useState(!1),v=!ye.useBreakpoint().lg,b=(g,y)=>{z(y),r(g),I(!0)},A=async g=>{const{data:y}=await C.custom({url:"",method:"post",meta:{operation:"openTimetableEntry",variables:{entryId:{value:g,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(d=>d);y&&(y.success?(s.success(y.message),N()):s.error(y.message))},m=async g=>{const{data:y}=await C.custom({url:"",method:"post",meta:{operation:"cancelTimetableEntry",variables:{entryId:{value:g.entryId,type:"Int",required:!0},reason:{value:g.reason,type:"String",required:!0},verify:{value:g.notify,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(()=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(d=>d);y&&(y.success?(s.success(y.message),o.resetFields(),N()):s.error(y.message))},N=async()=>{i(!0);const{data:g}=await C.custom({url:"",method:"get",meta:{operation:"myWeeklyTimetableEntries",fields:["entries","hasTimetable"]}}).catch(()=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(y=>y);g&&(console.error("data",g),n(g.hasTimetable),T(g.entries)),i(!1)};return a.useEffect(()=>{N()},[]),e.jsxs(e.Fragment,{children:[e.jsxs(qe,{spinning:j,children:[!f&&!j&&e.jsx(e.Fragment,{children:e.jsx(ee,{align:"middle",style:{height:"80vh",display:"flex",justifyContent:"center"},children:e.jsx(xt,{description:e.jsx(e.Fragment,{children:e.jsx("span",{style:{fontSize:22},children:"You are not Connected to any published Timetable"})})})})}),f&&e.jsx(ee,{style:{overflowX:"auto",marginTop:v?65:0,marginLeft:10},wrap:!1,children:p.map(g=>e.jsxs("span",{style:{width:v?"100vw":"14.1vw",margin:"1px",padding:"0px"},children:[e.jsx(ee,{style:{display:"flex",justifyContent:"space-between",backgroundColor:"white"},children:e.jsxs("span",{style:{marginLeft:10,marginRight:10,display:"flex",justifyContent:"space-between",width:"100%",height:35,paddingTop:2},children:[e.jsx("span",{style:{fontSize:19,fontWeight:"bolder"},children:g.name}),e.jsx("span",{children:e.jsx(O,{title:"Bulk Processing of Action(s)",color:"red",placement:"left",children:e.jsx(F,{icon:e.jsx(Fe,{})})})})]})}),e.jsx("div",{style:{maxHeight:"83vh",overflowY:"auto",overflowX:"hidden",marginTop:5,marginRight:5},children:g.events.map(y=>e.jsx("div",{style:{backgroundColor:"white",paddingLeft:5},children:e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:18},children:[y.isTeacher&&e.jsx(e.Fragment,{children:e.jsxs("div",{style:{borderBottom:"1"},children:[e.jsx("span",{style:{marginLeft:5},children:e.jsx(O,{title:"View/Take Attendance",color:"green",children:e.jsx(F,{size:"small",onClick:()=>b(y,g),children:e.jsx(xe,{})})})}),y.canCancell&&!y.isCancelled&&!y.isExam&&e.jsx("span",{style:{marginLeft:5},children:e.jsx(te,{title:e.jsx(e.Fragment,{children:e.jsxs(se,{direction:"vertical",children:[e.jsx("span",{children:"Are you sure to Cancel?"}),e.jsx("span",{style:{fontWeight:"bolder"},children:"Reason"}),e.jsx("span",{children:e.jsxs(c,{layout:"vertical",form:o,initialValues:{notify:!0},onFinish:d=>{d.entryId=y.id,m(d)},onFinishFailed:()=>{},autoComplete:"off",children:[e.jsx(c.Item,{name:"reason",rules:[{required:!0,message:"Please input your reason!"}],children:e.jsx(_t,{rows:6,onChange:d=>{d.target.value.length>0?q(!0):q(!1)}})}),e.jsx(c.Item,{name:"notify",valuePropName:"checked",children:e.jsx(_e,{children:"Notify Students"})})]})})]})}),onConfirm:()=>{o.submit()},onCancel:()=>{},okText:"Yes",cancelText:"No",okButtonProps:{disabled:!D},overlayStyle:{zIndex:9999},children:e.jsx(F,{size:"small",children:e.jsx(ft,{color:"red",style:{color:"red"}})})})}),e.jsx("span",{style:{float:"right"},children:e.jsx(O,{title:"Click to see all about this timetable Entry",color:"green",children:e.jsx(F,{icon:e.jsx(St,{})})})})]})}),e.jsxs("span",{style:{display:"block"},children:[!y.advanced&&e.jsx(O,{overlayInnerStyle:{fontSize:19},title:"Subject: "+y.subject.name,color:"green",placement:"right",children:yt(y.subject.name,15)}),y.advanced&&e.jsx(O,{overlayInnerStyle:{fontSize:19},title:"Module: "+y.module.name,color:"green",placement:"right",children:y.module.code})]}),!y.advanced&&e.jsx(se,{children:y.group&&e.jsx(e.Fragment,{children:e.jsx(M,{color:"orange",children:y.group.name})})})]}),e.jsxs("span",{style:{fontSize:18},children:[e.jsx(O,{title:"Venue: "+y.venue.name,color:"green",children:e.jsx(M,{color:"red",children:y.venue.name})}),e.jsx(O,{title:e.jsxs(e.Fragment,{children:[!y.advanced&&e.jsx(e.Fragment,{children:y.isExam?e.jsxs(Y,{title:"Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[y.supervisor.firstName," ",y.supervisor.middleName," ",y.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:y.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:y.supervisor.phone})]}):e.jsxs(Y,{title:"Teacher Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[y.teacher.firstName," ",y.teacher.middleName," ",y.teacher.lastName]}),e.jsx(Y.Item,{label:"Email",children:y.teacher.email}),e.jsx(Y.Item,{label:"Phone",children:y.teacher.phone})]})}),y.advanced&&e.jsx(e.Fragment,{children:y.isExam?e.jsxs(Y,{title:"Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[y.supervisor.firstName," ",y.supervisor.middleName," ",y.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:y.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:y.supervisor.phone})]}):e.jsxs(Y,{title:"Lecturer Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[y.lecturer.firstName," ",y.lecturer.middleName," ",y.lecturer.lastName]}),e.jsx(Y.Item,{label:"Email",children:y.lecturer.email}),e.jsx(Y.Item,{label:"Phone",children:y.lecturer.phone})]})})]}),color:"white",overlayInnerStyle:{color:"black"},children:e.jsx(F,{type:"primary",shape:"circle",icon:e.jsx(et,{})})})]}),y.isCancelled&&e.jsx("span",{children:e.jsxs(M,{color:"red",style:{fontSize:24,padding:10,marginTop:10},children:["Cancelled",y.isTeacher&&y.canCancell&&e.jsx(te,{title:"Are you sure to Open?",onConfirm:()=>A(y.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(F,{style:{marginLeft:2},size:"small",children:"Re-open"})})]})}),e.jsxs(Ze,{children:[y.isExam&&e.jsx("p",{style:{fontSize:"18px"},children:ne(y.dueDate).format("YYYY MMM, DD")}),y.startAt," - ",y.endAt]})]})}))})]}))})]}),e.jsx(de,{title:e.jsx(e.Fragment,{children:e.jsxs(se,{direction:"vertical",children:[e.jsxs("span",{children:[_==null?void 0:_.subject.name," - ",_==null?void 0:_.educationLevel.name," - Attendance",e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:w==null?void 0:w.name})})]}),e.jsxs("span",{children:[_==null?void 0:_.startAt," - ",_==null?void 0:_.endAt]})]})}),width:"70vw",open:S,onClose:g=>I(g),children:e.jsx(kt,{event:_,entry:w,randKey:Math.random()})})]})},qt=()=>(a.useEffect(()=>(document.title=Ie.system_name+": Timetable Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{marginBottom:10},children:e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx("a",{href:"/",children:"Home"})}),e.jsx(J.Item,{children:e.jsx("a",{href:"/timetable",children:"Timetable"})}),e.jsx("span",{children:"Dashboard"})]})})}),e.jsx(wt,{})]})),{Option:De}=R,Ne="HH:mm",Ft=t=>{const[j,i]=a.useState(!1),[f,n]=a.useState(!0),[p,T]=a.useState([]),[w,z]=a.useState([]),[_,r]=a.useState([]),[o,S]=a.useState([]),I=()=>{i(!0)},D=m=>{t.form.setFieldsValue({teacher:void 0}),v(1,m)},q=async(m,N="",g=100)=>{const{data:y}=await C.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:m,type:"Int",required:!0},key:{value:N,type:"String",required:!1},pageSize:{value:g,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(()=>(s.error("Error occured while loading Venues"),{data:null})).then(d=>d);y&&S(y.results)},E=async(m,N="",g=20)=>{var d;const{data:y}=await C.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjects",variables:{schoolEducationLevelId:{value:parseInt(((d=t.schoolTimetableEducationLevel)==null?void 0:d.schoolEducationLevel.id.toString())??"0")},page:{value:m,type:"Int",required:!0},key:{value:N,type:"String",required:!1},pageSize:{value:g,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolSubject:[{subject:["id","name"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(u=>(s.error("Error occured while loading Subjects"),{data:null})).then(u=>u);y&&T(y.results)},v=async(m,N,g="",y=20)=>{n(!0);const{data:d}=await C.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjectTeachers",variables:{schoolEducationLevelSubjectId:{value:parseInt(N.toString()??"0")},page:{value:m,type:"Int",required:!0},key:{value:g,type:"String",required:!1},pageSize:{value:y,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolMember:["id","registrationNumber",{user:["id","firstName","lastName","middleName","fullName"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(u=>(s.error("Error occured while loading Teachers"),{data:null})).then(u=>u);d&&z(d.results),n(!1)},b=async(m,N="",g=20)=>{var d;const{data:y}=await C.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelGroups",variables:{schoolEducationLevelId:{value:parseInt(((d=t.schoolTimetableEducationLevel)==null?void 0:d.schoolEducationLevel.id.toString())??"0")},page:{value:m,type:"Int",required:!0},key:{value:N,type:"String",required:!1},pageSize:{value:g,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(u=>(s.error("Error occured while loading Groups"),{data:null})).then(u=>u);y&&r(y.results)},A=async m=>{const{data:N}=await C.custom({url:"",method:"post",meta:{operation:"createTimetableEntry",variables:{subjectId:{value:m.subject_id,type:"Int",required:!0},teacherId:{value:m.teacher_id,type:"Int",required:!0},timetableId:{value:m.timetable_id,type:"Int",required:!0},groupId:{value:m.group_id,type:"Int",required:!1},venueId:{value:m.venue_id,type:"Int",required:!0},day:{value:m.day,type:"String",required:!0},startAt:{value:m.start_at,type:"String",required:!0},endAt:{value:m.end_at,type:"String",required:!0}},fields:["success","message"]}}).catch(g=>(s.error("Error occured while creating school timetable"),{data:null})).then(g=>g);N&&(N.success?(s.success(N.message),t.form.resetFields(),t.onFinish()):s.error(N.message))};return a.useEffect(()=>{b(1),q(1),E(1)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(c,{layout:"vertical",form:t.form,onFinish:m=>{var N;m.start_at=ne(m.start_at).format("HH:mm"),m.end_at=ne(m.end_at).format("HH:mm"),m.day=t.entry.name,m.timetable_id=parseInt(((N=t.schoolTimetableEducationLevel)==null?void 0:N.id.toString())??"0"),A(m)},requiredMark:!1,children:[e.jsx(c.Item,{name:"subject_id",label:"Subject",rules:[{required:!0,type:"integer",message:"Please Choose Subject"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Subject",allowClear:!0,showSearch:!0,onChange:D,dropdownStyle:{zIndex:9999},children:p.map(m=>e.jsx(De,{value:m.id,children:m.schoolSubject.subject.name},m.id))})}),e.jsx(c.Item,{name:"teacher_id",label:"Teacher",rules:[{required:!0,type:"integer",message:"Please Choose Teacher"}],children:e.jsx(R,{size:"large",loading:f,disabled:f,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:w.map(m=>e.jsxs(De,{value:m.id,children:[m.schoolMember.user.fullName,m.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:m.schoolMember.registrationNumber})})]},m.id))})}),e.jsx(c.Item,{name:"group_id",label:"Group",rules:[{required:!1,type:"integer",message:"Please Choose Groups"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Groups",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:_.map(m=>e.jsx(De,{value:parseInt(m.id.toString()),children:m.name},m.id))})}),e.jsx(c.Item,{name:"venue_id",label:"Venue",rules:[{required:!0,type:"integer",message:"Please Choose Venue"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Venue",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:o.map(m=>e.jsx(De,{value:parseInt(m.id.toString()),children:m.name},m.id))})}),e.jsxs(ee,{children:[e.jsx(B,{span:6,children:e.jsx(c.Item,{name:"start_at",label:e.jsx(e.Fragment,{children:e.jsxs(se,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Start At"}),e.jsx(F,{type:"link",onClick:()=>I(),children:"Check Slots"})]})}),initialValue:G("07:00","HH:mm"),children:e.jsx(ue,{size:"large",allowClear:!0,defaultValue:G("07:00",Ne),hourStep:1,minuteStep:45,format:Ne,style:{width:"100%"},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:6,children:e.jsx(c.Item,{name:"end_at",label:e.jsx(e.Fragment,{children:e.jsxs(se,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"End At"}),e.jsx(F,{type:"link",onClick:()=>I(),children:"Check Slots"})]})}),initialValue:G("07:45","HH:mm"),children:e.jsx(ue,{size:"large",allowClear:!0,defaultValue:G("07:45",Ne),hourStep:1,minuteStep:45,format:Ne,inputReadOnly:!0,style:{width:"100%"},popupStyle:{zIndex:9999}})})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(F,{type:"primary",size:"large",htmlType:"submit",disabled:!0,children:"Save"})})]}),e.jsx(ve,{title:"Available Time Slots",anchor:"right",onClose:m=>i(m),open:j,noOverFlow:!0,children:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Some contents..."}),e.jsx("p",{children:"Some contents..."}),e.jsx("p",{children:"Some contents..."})]})})]})},{Option:je}=R,Ue="HH:mm",Mt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],$e=t=>{var k,Q,ie,fe,Me,He,We,Oe;const[j,i]=a.useState(!1),[f,n]=a.useState(!1),[p,T]=a.useState(!0),[w,z]=a.useState([]),[_,r]=a.useState([]),[o,S]=a.useState([]),[I,D]=a.useState([]),[q,E]=a.useState([]);a.useState(),a.useState();const[v,b]=a.useState([]);a.useState(!1),a.useState(!1);const[A,m]=a.useState("07:00"),[N,g]=a.useState("07:45");Pe();const[y,d]=a.useState([]),[u,x]=a.useState([]),[h,P]=a.useState([]),[K]=c.useForm(),oe=()=>{n(!0)},V=l=>{var W;t.form.setFieldsValue({teacher:void 0}),((W=t==null?void 0:t.schoolTimetable)==null?void 0:W.forExamination)===!0?ae(1):Ae(1,l)},H=async(l,W="",X=100)=>{const{data:re}=await C.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:l,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(le=>(s.error("Error occured while loading Venues"),{data:null})).then(le=>le);re&&E(re.results)},$=async(l,W="",X=20)=>{var le;const{data:re}=await C.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjects",variables:{schoolEducationLevelId:{value:parseInt(((le=t.schoolTimetableEducationLevel)==null?void 0:le.schoolEducationLevel.id.toString())??"0")},page:{value:l,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolSubject:[{subject:["id","name"]}]},"subjectType","subjectTypeDisplay","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(s.error("Error occured while loading Subjects"),{data:null})).then(pe=>pe);re&&z(re.results)},ae=async(l,W="",X=20)=>{T(!0);const{data:re}=await C.custom({url:"",method:"get",meta:{operation:"schoolMembers",variables:{page:{value:l,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1},rolesString:{value:["Teacher"],type:"[String]",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","registrationNumber","firstName","middleName","lastName","fullName","email","phone",{user:["id","firstName","lastName","middleName","fullName"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(le=>(s.error("Error occured while loading Teachers"),{data:null})).then(le=>le);re&&S(re.results),T(!1)},Ae=async(l,W,X="",re=20)=>{T(!0);const{data:le}=await C.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjectTeachers",variables:{schoolEducationLevelSubjectId:{value:parseInt(W.toString()??"0")},page:{value:l,type:"Int",required:!0},key:{value:X,type:"String",required:!1},pageSize:{value:re,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolMember:["id","registrationNumber",{user:["id","firstName","lastName","middleName","fullName"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(s.error("Error occured while loading Teachers"),{data:null})).then(pe=>pe);le&&r(le.results),T(!1)},Le=async(l,W="",X=20)=>{var le;const{data:re}=await C.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelGroups",variables:{schoolEducationLevelId:{value:parseInt(((le=t.schoolTimetableEducationLevel)==null?void 0:le.schoolEducationLevel.id.toString())??"0")},page:{value:l,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(s.error("Error occured while loading Groups"),{data:null})).then(pe=>pe);re&&D(re.results)},ze=async l=>{i(!0);const{data:W}=await C.custom({url:"",method:"post",meta:{operation:"createTimetableEntry",variables:{advanced:{value:t.advanced,type:"Boolean",required:!1},moduleId:{value:l.module_id,type:"Int",required:!1},subjectId:{value:l.subject_id,type:"Int",required:!1},teacherId:{value:l.teacher_id,type:"Int",required:!1},timetableId:{value:l.timetable_id,type:"Int",required:!0},groupId:{value:l.group_id,type:"Int",required:!1},venueId:{value:l.venue_id,type:"Int",required:!0},day:{value:l.day,type:"String",required:!0},startAt:{value:l.start_at,type:"String",required:!0},endAt:{value:l.end_at,type:"String",required:!0},supervisorId:{value:l.supervisor_id,type:"Int",required:!1},dueDate:{value:l.due_date,type:"String",required:!1}},fields:["success","message"]}}).catch(X=>(s.error("Error occured while creating school timetable"),{data:null})).then(X=>X);i(!1),W&&(W.success?(s.success(W.message),b([]),t.form.resetFields(),t.onFinish()):b(W.message))},ke=async()=>{var X;const l=((X=t==null?void 0:t.studyCourse)==null?void 0:X.id)??"0",{data:W}=await C.custom({url:"",method:"get",meta:{operation:"timetableStudyCourseModules",variables:{timetableStudyCourseId:{value:parseInt(l.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(re=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(re=>re);W&&d(W.results)},L=async l=>{T(!0);const{data:W}=await C.custom({url:"",method:"get",meta:{operation:"moduleMembers",variables:{moduleId:{value:l,type:"Int",required:!0},memberType:{value:"Teacher",type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{module:["id"]},{schoolMember:["id","registrationNumber","firstName","middleName","lastName","email","phone",{user:["id","firstName","middleName","lastName","email","fullName","pic"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(X=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(X=>X);T(!1),W&&P(W.results)};return a.useEffect(()=>{ke(),Le(1),H(1),$(1)},[t.randKey]),e.jsxs(e.Fragment,{children:[((k=t==null?void 0:t.schoolTimetable)==null?void 0:k.forExamination)&&e.jsx("div",{style:{marginBottom:10},children:e.jsx(Se,{type:"info",message:e.jsx(e.Fragment,{children:e.jsxs("p",{style:{fontSize:18},children:[e.jsx("b",{children:"Notice:"})," This timetable is for examination. You can only add entries for examination.",e.jsx("p",{style:{color:"red"},children:"Validation wont apply against Non-Examination Timetable"})," ","But it will be applied against Examination Timetable"]})})})}),e.jsx("div",{children:v.map(l=>e.jsx(Se,{message:l,type:"error",style:{fontSize:18,marginBottom:"3px"},onClose:()=>{b([])},closable:!0}))}),e.jsxs(c,{layout:"vertical",form:K,onFinish:l=>{var W,X;l.start_at=A,l.end_at=N,l.day=t.entry.name,t.advanced?l.timetable_id=parseInt(((W=t==null?void 0:t.studyCourse)==null?void 0:W.id.toString())??"0"):l.timetable_id=parseInt(((X=t==null?void 0:t.schoolTimetableEducationLevel)==null?void 0:X.id.toString())??"0"),ze(l)},children:[t.advanced?e.jsx(c.Item,{name:"module_id",label:"Module",rules:[{required:!0,type:"integer",message:"Please Choose Module"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Module",allowClear:!0,showSearch:!0,onChange:l=>{K.setFieldsValue({teacher_id:void 0}),L(l)},dropdownStyle:{zIndex:9999},children:y.map(l=>e.jsx(je,{value:parseInt(l.id.toString()),children:l.name},l.id))})}):e.jsx(c.Item,{name:"subject_id",label:"Subject",rules:[{required:!0,type:"integer",message:"Please Choose Subject"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Subject",allowClear:!0,showSearch:!0,onChange:V,dropdownStyle:{zIndex:9999},children:w.map(l=>e.jsxs(je,{value:parseInt(l.id.toString()),children:[l.schoolSubject.subject.name,e.jsx(M,{style:{marginLeft:5},color:"green",children:l.subjectTypeDisplay})]},l.id))})}),!t.advanced&&e.jsx(e.Fragment,{children:(Q=t==null?void 0:t.schoolTimetable)!=null&&Q.forExamination?e.jsx(c.Item,{name:"supervisor_id",label:e.jsx(e.Fragment,{children:"Teachers Supervising"}),rules:[{required:(ie=t==null?void 0:t.schoolTimetable)==null?void 0:ie.forExamination,type:"integer",message:"Please Choose Supervisor"}],children:e.jsx(R,{size:"large",loading:p,disabled:p,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:o.map(l=>e.jsxs(je,{value:parseInt(l.id.toString()),children:[l.user.fullName,l.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:l.registrationNumber})}),e.jsxs("p",{style:{marginTop:3},children:[e.jsx("span",{style:{color:"red"},children:"Email:"})," ",e.jsx(M,{children:l==null?void 0:l.email}),","," ",e.jsx("span",{style:{color:"red"},children:"Phone:"})," ",e.jsx(M,{children:l==null?void 0:l.phone})]})]},l.id))})}):e.jsx(c.Item,{name:"teacher_id",label:e.jsx(e.Fragment,{children:"Teacher"}),rules:[{required:!((fe=t==null?void 0:t.schoolTimetable)!=null&&fe.forExamination),type:"integer",message:"Please Choose Teacher"}],children:e.jsx(R,{size:"large",loading:p,disabled:p,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:_.map(l=>e.jsxs(je,{value:parseInt(l.id.toString()),children:[l.schoolMember.user.fullName,l.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:l.schoolMember.registrationNumber})})]},l.id))})})}),t.advanced&&e.jsx(e.Fragment,{children:(Me=t==null?void 0:t.schoolTimetable)!=null&&Me.forExamination?e.jsx(c.Item,{name:"supervisor_id",label:e.jsx(e.Fragment,{children:"Lecturer/Tutor Supervising"}),rules:[{required:(He=t==null?void 0:t.schoolTimetable)==null?void 0:He.forExamination,type:"integer",message:"Please Choose Supervisor"}],children:e.jsx(R,{size:"large",loading:p,disabled:p,style:{width:"100%"},placeholder:"Please Choose Lecturer/Tutor",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:u.map(l=>e.jsxs(je,{value:parseInt(l.id.toString()),children:[l.user.fullName,l.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:l.registrationNumber})}),e.jsxs("p",{style:{marginTop:3},children:[e.jsx("span",{style:{color:"red"},children:"Email:"})," ",e.jsx(M,{children:l==null?void 0:l.email}),","," ",e.jsx("span",{style:{color:"red"},children:"Phone:"})," ",e.jsx(M,{children:l==null?void 0:l.phone})]})]},l.id))})}):e.jsx(c.Item,{name:"teacher_id",label:e.jsx(e.Fragment,{children:"Lecturer/Tutor"}),rules:[{required:!((We=t==null?void 0:t.schoolTimetable)!=null&&We.forExamination),type:"integer",message:"Please Choose Lecturer/Tutor"}],children:e.jsx(R,{size:"large",loading:p,disabled:p,style:{width:"100%"},placeholder:"Please Choose Lecturer/Tutor",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:h.map(l=>{var W;return e.jsxs(je,{value:parseInt(l.schoolMember.id.toString()),children:[(W=l==null?void 0:l.schoolMember.user)==null?void 0:W.fullName,l.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:l.schoolMember.registrationNumber})})]},l.id)})})})}),!t.advanced&&e.jsx(c.Item,{name:"group_id",label:"Group",rules:[{required:!1,type:"integer",message:"Please Choose Groups"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Groups",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:I.map(l=>e.jsx(je,{value:parseInt(l.id.toString()),children:l.name},l.id))})}),e.jsx(c.Item,{name:"venue_id",label:"Venue",rules:[{required:!0,type:"integer",message:"Please Choose Venue"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Venue",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:q.map(l=>e.jsx(je,{value:parseInt(l.id.toString()),children:l.name},l.id))})}),e.jsxs(ee,{children:[((Oe=t==null?void 0:t.schoolTimetable)==null?void 0:Oe.forExamination)&&e.jsx(B,{span:8,children:e.jsx(c.Item,{name:"due_date",label:"Due Date",rules:[{required:!0,type:"object",message:"Please Choose Due Date"}],children:e.jsx(we,{size:"large",style:{width:"100%"},placeholder:"Please Choose Due Date",disabledDate:l=>!(l.day()===Mt.indexOf(t.entry.name)+1),popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:8,children:e.jsx(c.Item,{name:"start_at",rules:[{required:!0,type:"object",message:"Please Choose Start Time"}],label:e.jsx(e.Fragment,{children:e.jsxs(se,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Start At"}),e.jsx(F,{type:"link",onClick:()=>oe(),children:"Check Slots"})]})}),initialValue:G("07:00","HH:mm"),children:e.jsx(ue,{allowClear:!0,hourStep:1,minuteStep:45,format:Ue,defaultValue:G("07:00","HH:mm"),style:{width:"100%"},size:"large",onChange:l=>{m((l==null?void 0:l.hour().toString())+":"+(l==null?void 0:l.minute().toString()))},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:8,children:e.jsx(c.Item,{name:"end_at",rules:[{required:!0,type:"object",message:"Please Choose End Time"}],label:e.jsx(e.Fragment,{children:e.jsxs(se,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"End At"}),e.jsx(F,{type:"link",onClick:()=>oe(),children:"Check Slots"})]})}),initialValue:G("07:45","HH:mm"),children:e.jsx(ue,{allowClear:!0,hourStep:1,minuteStep:45,format:Ue,inputReadOnly:!0,defaultValue:G("07:45","HH:mm"),style:{width:"100%"},size:"large",onChange:l=>{g((l==null?void 0:l.hour().toString())+":"+(l==null?void 0:l.minute().toString()))},popupStyle:{zIndex:9999}})})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(F,{type:"primary",size:"large",htmlType:"submit",loading:j,disabled:j,children:"Save"})})]}),e.jsx(ve,{title:"Available Time Slots",width:"30vw",anchor:"right",onClose:l=>n(l),open:f,noOverFlow:!0,children:e.jsx("span",{children:"Slot Schecker"})})]})},ot=t=>{const[j,i]=a.useState(!1);a.useState();const[f,n]=a.useState([]),[p,T]=a.useState(),[w,z]=a.useState(!1),[_,r]=a.useState(!1),[o,S]=a.useState(!1),[I]=c.useForm();c.useForm();const D=Pe(),q=async()=>{v()},E=async A=>{T(A),t.advanced?S(!0):z(!0)},v=async()=>{i(!0);const{data:A}=await C.custom({url:"",method:"get",meta:{operation:"weeklyTimetableEntries",variables:{schoolEducationLevelTimetableId:{value:parseInt(D.id),type:"Int",required:!0}},fields:["entries"]}}).catch(m=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(m=>m);A&&n(A.entries),i(!1)},b=async A=>{const{data:m}=await C.custom({url:"",method:"post",meta:{operation:"deleteTimetableEntry",variables:{timetableEntryId:{value:A,type:"Int",required:!0}},fields:["success","message"]}}).catch(N=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(N=>N);m&&(m.success?(s.success(m.message),v()):s.error(m.message)),i(!1)};return a.useEffect(()=>{v()},[]),e.jsxs(e.Fragment,{children:[e.jsx(qe,{spinning:j,children:e.jsx("div",{children:f.map(A=>{var m,N;return e.jsxs(tt,{style:{width:"33%",margin:"1px",padding:"0px"},children:[e.jsxs(ee,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{marginLeft:5},children:e.jsx("h2",{children:A.name})}),e.jsx("span",{style:{position:"relative",right:"0px",marginTop:8},children:e.jsx(O,{title:"Click to Start Scheduling for "+A.name,color:"green",placement:"left",children:e.jsx(F,{disabled:t.advanced?(m=t.studyCourse)==null?void 0:m.published:(N=t.schoolTimetableEducationLevel)==null?void 0:N.published,size:"small",icon:e.jsx(Te,{}),onClick:()=>E(A),children:"Add"})})})]}),e.jsx("div",{style:{maxHeight:"83vh",overflowY:"auto",overflowX:"hidden"},children:e.jsx(me,{style:{margin:"0px",padding:"0px"},bordered:!0,dataSource:A.events,renderItem:g=>e.jsxs(e.Fragment,{children:[e.jsx(me.Item,{children:e.jsxs(se,{direction:"vertical",children:[e.jsxs("span",{style:{fontSize:18},children:[g.advanced?e.jsx(e.Fragment,{children:e.jsx(O,{title:g.module.name,color:"green",children:e.jsx(M,{color:"green",children:g.module.code})})}):e.jsx(e.Fragment,{children:g.subject.name}),!g.advanced&&e.jsxs(se,{children:[e.jsx(M,{color:"green",style:{marginLeft:10},children:g.educationLevel.name}),g.group&&e.jsx(e.Fragment,{children:e.jsx(M,{color:"green",children:g.group.name})})]})]}),e.jsx("span",{style:{fontSize:18},children:e.jsxs(se,{children:[e.jsx(M,{color:"green",children:g.venue.name}),e.jsx(te,{title:"Are you sure to delete this Timetable Entry?",onConfirm:()=>b(g.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(F,{icon:e.jsx(Ee,{})})}),e.jsx(O,{title:e.jsxs(e.Fragment,{children:[!g.advanced&&e.jsxs(e.Fragment,{children:[g.teacher.firstName&&e.jsxs(Y,{title:"Teacher Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[g.teacher.firstName," ",g.teacher.middleName," ",g.teacher.lastName]}),e.jsx(Y.Item,{label:"Email",children:g.teacher.email}),e.jsx(Y.Item,{label:"Phone",children:g.teacher.phone})]}),g.supervisor.firstName&&e.jsxs(Y,{title:"Exam Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[g.supervisor.firstName," ",g.supervisor.middleName," ",g.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:g.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:g.supervisor.phone})]})]}),g.advanced&&e.jsxs(e.Fragment,{children:[g.lecturer.firstName&&e.jsxs(Y,{title:"Lecturer Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[g.lecturer.firstName," ",g.lecturer.middleName," ",g.lecturer.lastName]}),e.jsx(Y.Item,{label:"Email",children:g.lecturer.email}),e.jsx(Y.Item,{label:"Phone",children:g.lecturer.phone})]}),g.supervisor.firstName&&e.jsxs(Y,{title:"Exam Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[g.supervisor.firstName," ",g.supervisor.middleName," ",g.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:g.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:g.supervisor.phone})]})]})]}),color:"white",overlayInnerStyle:{color:"black"},children:e.jsx(F,{type:"primary",shape:"circle",icon:e.jsx(et,{})})})]})})]})}),g.isExam&&e.jsx(me.Item,{children:e.jsx("span",{style:{fontSize:18},children:ne(g.dueDate).format("YYYY MMM, DD")})}),e.jsxs(Ze,{children:[g.startAt," - ",g.endAt]})]})})})]})})})}),e.jsx(de,{title:(p==null?void 0:p.name)+" Scheduler",width:"45vw",open:w,onClose:A=>z(A),children:e.jsx($e,{advanced:t.advanced,schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:I,entry:p,onFinish:q})}),e.jsx(de,{title:(p==null?void 0:p.name)+" Scheduler",width:"45vw",open:o,onClose:A=>S(A),children:e.jsx($e,{advanced:t.advanced,schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:I,entry:p,onFinish:q,studyCourse:t.studyCourse})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[p==null?void 0:p.name," Scheduler"]}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:"Editting"})})]}),width:"45vw",open:_,onClose:A=>r(A),children:e.jsx(Ft,{schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:I,entry:p,onFinish:q})})]})},Dt=()=>{var z,_,r,o,S;const[t,j]=a.useState(),[i,f]=a.useState(),n=Pe(),p=async(I,D)=>{const{data:q}=await C.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolStudyCourseTimetable",variables:{schoolStudyCourseTimetableId:{value:I,type:"Int",required:!0},published:{value:D,type:"Boolean",required:!0}},fields:["success","message",{schoolStudyCourseTimetable:["id",{studyCourse:["id","year","semester","semesterDisplay","level","levelDisplay",{course:["id","name"]}]},"published","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(E=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(E=>E);q&&(q.success?(f(q.schoolStudyCourseTimetable),s.success(q.message)):s.error(q.message))},T=async()=>{const{data:I}=await C.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCourse",variables:{id:{value:parseInt(n.id),type:"Int",required:!0}},fields:["id",{studyCourse:["id","year","semester","semesterDisplay","level","levelDisplay",{course:["id","name"]}]},"published","created","updated","isActive","canEdit","canDelete","canManage"]}}).catch(D=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(D=>D);I&&f(I)},w=async()=>{const{data:I}=await C.custom({url:"",method:"get",meta:{operation:"schoolTimetable",variables:{id:{value:parseInt(n.tid),type:"Int",required:!0}},fields:["id","title","description",{school:["id"]},"forExamination","created","updated","isActive","canEdit","canDelete","canManage"]}}).catch(D=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(D=>D);I&&j(I)};return a.useEffect(()=>{document.title=Ie.system_name+": Timetable Scheduler",w(),T()},[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(J.Item,{children:e.jsxs(be,{to:"/timetable/timetables",children:["Timetables - ",t==null?void 0:t.title]})}),e.jsxs(J.Item,{children:["Scheduler - ",(_=(z=i==null?void 0:i.studyCourse)==null?void 0:z.course)==null?void 0:_.name," -"," ",(r=i==null?void 0:i.studyCourse)==null?void 0:r.year," -"," ",(o=i==null?void 0:i.studyCourse)==null?void 0:o.semesterDisplay," -"," ",(S=i==null?void 0:i.studyCourse)==null?void 0:S.levelDisplay]})]})}),e.jsxs("div",{children:[!(i!=null&&i.published)&&e.jsx(F,{size:"large",icon:e.jsx(Fe,{style:{color:"red"}}),onClick:()=>p(i==null?void 0:i.id,!0),children:"Not Published"}),(i==null?void 0:i.published)&&e.jsx(F,{size:"large",icon:e.jsx(at,{style:{color:"green"}}),onClick:()=>p(i==null?void 0:i.id,!1),children:"Published"})]})]}),e.jsx(ot,{advanced:!0,schoolTimetable:t,studyCourse:i})]})},Nt=t=>{const[j,i]=a.useState([]),[f,n]=a.useState(0),[p,T]=a.useState(20),[w,z]=a.useState(""),[_,r]=a.useState(!0),[o]=c.useForm(),I=!ye.useBreakpoint().lg,D=[{title:"Name",dataIndex:"name",fixed:!0,render:(v,b)=>e.jsxs("span",{children:[e.jsx("a",{children:b.educationLevel.name}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:b.educationLevel.schoolType.name})})]})},{title:"",dataIndex:"action",render:(v,b)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(te,{title:"Are you sure to delete this task?",onConfirm:()=>q(b.id),onCancel:()=>{},okText:"Yes",cancelText:"No",disabled:!b.canManage,overlayStyle:{zIndex:9999},children:e.jsx(F,{icon:e.jsx(Te,{}),children:"Add"})})})}],q=async v=>{var A;const{data:b}=await C.custom({url:"",method:"post",meta:{operation:"createSchoolEducationLevelTimetable",variables:{schoolTimetableId:{value:parseInt(((A=t.schoolTimetable)==null?void 0:A.id.toString())??"0"),type:"Int",required:!0},schoolEducationLevelId:{value:parseInt(v.toString()),type:"Int",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(m=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(m=>m);b&&(b.success?(s.success(b.message),t.onAdd(b.schoolEducationLevelTimetable),i(j.filter(m=>m.id.toString()!==v.toString()))):s.error(b.message)),r(!1)},E=async(v,b="",A=20)=>{var N;const{data:m}=await C.custom({url:"",method:"get",meta:{operation:"timetableNotAssignedSchoolEducationLevels",variables:{schoolTimetableId:{value:parseInt(((N=t.schoolTimetable)==null?void 0:N.id.toString())??"0"),type:"Int",required:!0},page:{value:v,type:"Int",required:!0},key:{value:b,type:"String",required:!1},pageSize:{value:A,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{school:["id","name"]},{educationLevel:["id","name",{schoolType:["id","name","code"]}]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(g=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(g=>g);m&&(n(m.total),i([...m.results])),r(!1)};return a.useEffect(()=>{E(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ee,{style:{marginTop:10},children:e.jsx(B,{span:I?24:20,children:e.jsx(c,{layout:"vertical",form:o,onFinish:v=>{z(v.key),j.length=0,E(1,v.key,p)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:_,columns:D,dataSource:j,pagination:{onChange:(v,b)=>{T(b),E(v,w,b)},total:f,pageSize:p,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})]})},dt=t=>{var d,u;const[j,i]=a.useState([]),[f,n]=a.useState(1),[p,T]=a.useState(0),[w,z]=a.useState(!1),[_,r]=a.useState(!0),{push:o}=Xe(),[S]=c.useForm();c.useForm(),ye.useBreakpoint().lg;const[D,q]=a.useState(!1),E=async x=>{i([x,...j])},v=async x=>{const{data:h}=await C.custom({url:"",method:"post",meta:{operation:"synchronizeTimetableEducationLevels",variables:{timetableId:{value:parseInt(x),type:"Int",required:!0}},fields:["success","message"]}}).catch(P=>(s.error("Error in synchronizing Timetable Education Levels"),{data:null})).then(P=>P);h&&(h.success?(s(h.message),g(1,"")):s.error(h.message))},b=async x=>{const{data:h}=await C.custom({url:"",method:"post",meta:{operation:"deleteSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(x.toString()),type:"Int",required:!0}},fields:["success","message"]}});h.success?(s.success(h.message),i(j.filter(P=>P.id!==x))):s.error(h.message)},A=async(x,h)=>{const{data:P}=await C.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(x.toString()),type:"Int",required:!0},publish:{value:h,type:"Boolean",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});P.success?(s.success(P.message),i(j.map(K=>K.id===P.schoolEducationLevelTimetable.id?P.schoolEducationLevelTimetable:K))):s.error(P.message)},m=()=>{s("Canceled")},N=[{title:"Name",dataIndex:"name",fixed:!0,render:(x,h,P)=>e.jsx("span",{children:e.jsx("a",{children:h.schoolEducationLevel.educationLevel.name})})},{title:"Has Entries",dataIndex:"hasEntries",fixed:!0,render:(x,h,P)=>e.jsx("span",{children:h.hasEntries?e.jsx(e.Fragment,{children:e.jsx(M,{color:"green",children:"Yes"})}):e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",children:"No"})})})},{title:"Created",dataIndex:"created",render:(x,h,P)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(h.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(x,h,P)=>e.jsx("a",{children:h!=null&&h.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"Published",dataIndex:"published",render:(x,h,P)=>e.jsx("a",{children:h!=null&&h.published?e.jsx(te,{title:"Are you sure to Un-publish?",onConfirm:()=>A(h.id,!1),onCancel:()=>{},okText:"Unpublish",cancelText:"No",okButtonProps:{disabled:!h.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"green",children:"Published"})}):e.jsx(te,{title:"Are you sure to Publish?",onConfirm:()=>A(h.id,!0),onCancel:()=>{},okText:"Publish",cancelText:"No",okButtonProps:{disabled:!h.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"red",children:"Not Published"})})})},{title:"",dataIndex:"action",render:(x,h,P)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(O,{title:"Schedule",placement:"left",children:e.jsx(F,{icon:e.jsx(xe,{}),disabled:!h.canManage,onClick:()=>{var K;return o("/timetable/education/level/scheduler/"+((K=t==null?void 0:t.schoolTimetable)==null?void 0:K.id)+"/"+h.id)}})}),e.jsx(te,{title:"Are you sure to delete this School Education Level Timetable?",onConfirm:()=>b(h==null?void 0:h.id),onCancel:()=>m,okText:"Yes",cancelText:"No",disabled:!(h!=null&&h.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(F,{icon:e.jsx(Ee,{}),disabled:!(h!=null&&h.canDelete)})})]})}],g=async(x,h="")=>{var K;const{data:P}=await C.custom({url:"",method:"get",meta:{operation:"schoolTimetableEducationLevels",variables:{schoolTimetableId:{value:parseInt(((K=t.schoolTimetable)==null?void 0:K.id.toString())??"0"),type:"Int",required:!0},page:{value:x,type:"Int",required:!0},key:{value:h,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(oe=>(s.error("Failed loading School Timetable Education Levels"),{data:null})).then(oe=>oe);P&&(n(P.page),T(P.total),z(P.hasNext),i([...P.results])),r(!1)},y=async x=>{var P;const{data:h}=await C.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetables",variables:{timetableId:{value:parseInt(((P=t==null?void 0:t.schoolTimetable)==null?void 0:P.id.toString())??"0"),type:"Int",required:!0},publish:{value:x,type:"Boolean",required:!0}},fields:["success","message"]}});h.success?(s.success(h.message),j.length=0,i([]),g(1)):s.error(h.message)};return a.useEffect(()=>{g(f)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:12,children:e.jsx(c,{layout:"vertical",form:S,onFinish:x=>{n(1),j.length=0,g(1,x.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(B,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(O,{title:"Click to Publish All timetables Listed Below",color:"green",children:e.jsx(F,{size:"large",icon:e.jsx(pt,{style:{color:"green"}}),onClick:()=>y(!0),children:"Publish All"})}),e.jsx(O,{title:"Click to Unpublish All Timetables listed Below",color:"red",children:e.jsx(F,{size:"large",icon:e.jsx(Fe,{style:{color:"red"}}),onClick:()=>y(!1),children:"Unpublish All"})}),e.jsx(F,{size:"large",icon:e.jsx(st,{}),onClick:()=>q(!0),children:"Add"}),((d=t.schoolTimetable)==null?void 0:d.forExamination)&&e.jsx(O,{title:"Synchronization All Education Levels Related to Examination",placement:"top",color:"green",children:e.jsx(F,{size:"large",icon:e.jsx(rt,{}),onClick:()=>{var x;return v((x=t.schoolTimetable)==null?void 0:x.id)},children:"Sync"})})]})]}),e.jsx(ge,{loading:_,columns:N,dataSource:j,pagination:!1,scroll:{y:"60vh"}}),e.jsx(ve,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Adding School Education Levels to "}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:(u=t.schoolTimetable)==null?void 0:u.title})})]}),width:"45vw",anchor:"right",onClose:x=>q(x),open:D,noOverFlow:!0,children:e.jsx(Nt,{randKey:Math.random(),schoolTimetable:t.schoolTimetable,onAdd:E})})]})},Pt=()=>{const[t,j]=a.useState(),[i,f]=a.useState(),[n,p]=a.useState(!1),T=Pe(),w=async()=>{const{data:r}=await C.custom({url:"",method:"get",meta:{operation:"schoolTimetableEducationLevel",variables:{id:{value:parseInt(T.id),type:"Int",required:!0}},fields:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},"created","updated","isActive","published","canEdit","canDelete","canManage"]}}).catch(o=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(o=>o);r&&f(r)},z=async()=>{const{data:r}=await C.custom({url:"",method:"get",meta:{operation:"schoolTimetable",variables:{id:{value:parseInt(T.tid),type:"Int",required:!0}},fields:["id","title","description",{school:["id"]},"forExamination","created","updated","isActive","isPublished","canEdit","canDelete","canManage"]}}).catch(o=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(o=>o);r&&j(r)},_=async(r,o)=>{const{data:S}=await C.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(r.toString()),type:"Int",required:!0},publish:{value:o,type:"Boolean",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});S.success?(s.success(S.message),f(S.schoolEducationLevelTimetable)):s.error(S.message)};return a.useEffect(()=>{document.title=Ie.system_name+": School Timetable Education Level Scheduler",z(),w()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(J.Item,{children:e.jsxs(be,{to:"/timetable/timetables",children:["Timetables - ",t==null?void 0:t.title]})}),e.jsxs(J.Item,{children:["Scheduler -"," ",i==null?void 0:i.schoolEducationLevel.educationLevel.name]}),(i==null?void 0:i.published)&&e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",style:{fontSize:16,padding:3},children:"To Continue Scheduling this Timetable, you first need to Unpublish"})})]})}),e.jsxs("div",{style:{float:"right"},children:[(i==null?void 0:i.published)&&e.jsx(te,{title:"Are you sure to Unpublish Timetable",placement:"left",onConfirm:()=>_(i==null?void 0:i.id,!1),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(F,{icon:e.jsx(bt,{style:{color:"red"}}),style:{float:"right"},children:"Unpublish"})}),!(i!=null&&i.published)&&e.jsx(e.Fragment,{children:e.jsx(te,{title:"Are you sure to Publish Timetable",placement:"left",onConfirm:()=>_(i==null?void 0:i.id,!0),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(F,{icon:e.jsx(at,{style:{color:"green"}}),style:{float:"right"},children:"Publish"})})}),e.jsx(O,{title:"Click to Switch to Other Related Timetables, so as to continue scheduling",color:"green",placement:"left",children:e.jsx(F,{icon:e.jsx(vt,{style:{color:"green"}}),style:{float:"right"},onClick:()=>p(!0),children:"Switch"})})]}),e.jsx("div",{style:{marginTop:45},children:e.jsx(ot,{advanced:!1,schoolTimetable:t,schoolTimetableEducationLevel:i})})]}),e.jsx(de,{title:"Timetable Switcher",width:"70vw",open:n,onClose:r=>p(r),children:e.jsx(dt,{schoolTimetable:t,randKey:Math.random()})})]})};G.extend(Tt);const Z="HH:mm",Lt=t=>{const[j,i]=a.useState(!1),[f]=c.useForm(),[n,p]=a.useState(),[T,w]=a.useState(!0),[z,_]=a.useState(!1),[r,o]=a.useState(!1),[S,I]=a.useState(!1),[D,q]=a.useState(!1),[E,v]=a.useState(!1),[b,A]=a.useState(!1),[m,N]=a.useState(!1),g=async d=>{i(!0);const{data:u}=await C.custom({url:"",method:"post",meta:{operation:"updateSchoolTimetablingSettings",variables:{perPeriodDuration:{value:d.per_period_duration,type:"Int",required:!0},periodsStartsAt:{value:d.periods_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"),type:"String",required:!1},periodsEndsAt:{value:d.periods_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"),type:"String",required:!1},breaktimeStartAt:{value:d.breaktime_start_at?d.breaktime_start_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},breaktimeEndAt:{value:d.breaktime_end_at?d.breaktime_end_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},allowSaturdayScheduling:{value:d.allow_saturday_scheduling??!1,type:"Boolean",required:!1},allowSundayScheduling:{value:d.allow_sunday_scheduling??!1,type:"Boolean",required:!1},morningSessionStartsAt:{value:d.morning_session_starts_at?d.morning_session_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},morningSessionEndsAt:{value:d.morning_session_ends_at?d.morning_session_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},eveningSessionStartsAt:{value:d.evening_session_starts_at?d.evening_session_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},eveningSessionEndsAt:{value:d.evening_session_ends_at?d.evening_session_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1}},fields:["success","message",{schoolTimetablingSettings:["id",{school:Be},"perPeriodDuration","periodsStartsAt","periodsEndsAt","breaktimeStartAt","breaktimeEndAt","morningSessionStartsAt","morningSessionEndsAt","eveningSessionStartsAt","eveningSessionEndsAt","allowSaturdayScheduling","allowSundayScheduling","created","updated","canEdit","canDelete","canManage"]}]}}).catch(x=>(console.error(x),s.error("Error occured while updating Timetabling Settings"),{data:null})).then(x=>x);u?u.success&&(s.success(u.message),u.periodsStartsAt=G(u.periodsStartsAt).utc(),u.periodsEndsAt=G(u.periodsEndsAt).utc(),u.breaktimeStartAt=G(u.breaktimeStartAt).utc(),u.breaktimeEndAt=G(u.breaktimeEndAt).utc(),p(u.schoolTimetablingSettings)):(s.remove(),s.error("Something Went Wrong ... please try again ...")),i(!1)},y=async()=>{i(!0);const{data:d}=await C.custom({url:"",method:"get",meta:{operation:"schoolTimetablingSetting",fields:["id",{school:Be},"perPeriodDuration","periodsStartsAt","periodsEndsAt","breaktimeStartAt","breaktimeEndAt","morningSessionStartsAt","morningSessionEndsAt","eveningSessionStartsAt","eveningSessionEndsAt","allowSaturdayScheduling","allowSundayScheduling","created","updated","canEdit","canDelete","canManage"]}}).catch(u=>(console.error(u),s.error("Error occured while getting Timetabling Settings"),{data:null})).then(u=>u);d&&p(d),i(!1)};return a.useEffect(()=>{y()},[]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:j,children:n&&e.jsx(ee,{style:{marginTop:10},children:e.jsx(B,{span:24,children:e.jsx(tt,{children:e.jsxs(c,{layout:"horizontal",form:f,onFinish:d=>{console.log(d),g(d)},requiredMark:!0,initialValues:{per_period_duration:(n==null?void 0:n.perPeriodDuration)??60,periods_starts_at:n!=null&&n.periodsEndsAt?G(n==null?void 0:n.periodsStartsAt,Z):void 0,periods_ends_at:n!=null&&n.periodsEndsAt?G(n==null?void 0:n.periodsEndsAt,Z):void 0,breaktime_start_at:n!=null&&n.breaktimeStartAt?G(n==null?void 0:n.breaktimeStartAt,Z):void 0,breaktime_end_at:n!=null&&n.breaktimeEndAt?G(n==null?void 0:n.breaktimeEndAt,Z):void 0,allow_saturday_scheduling:(n==null?void 0:n.allowSaturdayScheduling)??!1,allow_sunday_scheduling:(n==null?void 0:n.allowSundayScheduling)??!1,morning_session_starts_at:n!=null&&n.morningSessionStartsAt?G(n==null?void 0:n.morningSessionStartsAt,Z):void 0,morning_session_ends_at:n!=null&&n.morningSessionEndsAt?G(n==null?void 0:n.morningSessionEndsAt,Z):void 0,evening_session_starts_at:n!=null&&n.eveningSessionStartsAt?G(n==null?void 0:n.eveningSessionStartsAt,Z):void 0,evening_session_ends_at:n!=null&&n.eveningSessionEndsAt?G(n==null?void 0:n.eveningSessionEndsAt,Z):void 0},children:[e.jsx(c.Item,{label:"Per Period Duration in Minutes",name:"per_period_duration",rules:[{required:!0,message:"Please input Per Period Duration in Minutes!"}],style:{width:"50%"},children:e.jsx(U,{})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(se,{direction:"horizontal",children:[e.jsx(c.Item,{label:"Periods Start At(24 Hours Format)",name:"periods_starts_at",rules:[{required:T,message:"Please input Periods Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:G("12:00",Z),format:Z,minuteStep:15,hourStep:1,onChange:d=>{_(!!d)}})}),e.jsx(c.Item,{label:"Periods End At(24 Hours Format)",name:"periods_ends_at",rules:[{required:z,message:"Please input Periods End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Z,minuteStep:15,hourStep:1,onChange:d=>{w(!!d)},disabledHours:()=>f.getFieldValue("periods_starts_at")?Array.from({length:f.getFieldValue("periods_starts_at").hour()},(d,u)=>u):[],disabledMinutes:d=>f.getFieldValue("periods_starts_at")&&f.getFieldValue("periods_starts_at").hour()===d?Array.from({length:f.getFieldValue("periods_starts_at").minute()},(u,x)=>x):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(se,{direction:"horizontal",children:[e.jsx(c.Item,{label:"Morning Session Start At(24 Hours Format)",name:"morning_session_starts_at",rules:[{required:D,message:"Please input Morning Session Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:G("12:00",Z),format:Z,minuteStep:15,hourStep:1,onChange:d=>{v(!!d)}})}),e.jsx(c.Item,{label:"Morning Session End At(24 Hours Format)",name:"morning_session_ends_at",rules:[{required:E,message:"Please input Morning Session End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Z,minuteStep:15,hourStep:1,onChange:d=>{q(!!d)},disabledHours:()=>f.getFieldValue("morning_session_starts_at")?Array.from({length:f.getFieldValue("morning_session_starts_at").hour()},(d,u)=>u):[],disabledMinutes:d=>f.getFieldValue("morning_session_starts_at")&&f.getFieldValue("morning_session_starts_at").hour()===d?Array.from({length:f.getFieldValue("morning_session_starts_at").minute()},(u,x)=>x):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(se,{direction:"horizontal",children:[e.jsx(c.Item,{label:"Evening Session Start At(24 Hours Format)",name:"evening_session_starts_at",rules:[{required:b,message:"Please input Evening Session Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:G("12:00",Z),format:Z,minuteStep:15,hourStep:1,onChange:d=>{N(!!d)}})}),e.jsx(c.Item,{label:"Evening Session End At(24 Hours Format)",name:"evening_session_ends_at",rules:[{required:m,message:"Please input Evening Session End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Z,minuteStep:15,hourStep:1,onChange:d=>{A(!!d)},disabledHours:()=>f.getFieldValue("evening_session_starts_at")?Array.from({length:f.getFieldValue("evening_session_starts_at").hour()},(d,u)=>u):[],disabledMinutes:d=>f.getFieldValue("evening_session_starts_at")&&f.getFieldValue("evening_session_starts_at").hour()===d?Array.from({length:f.getFieldValue("evening_session_starts_at").minute()},(u,x)=>x):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(se,{direction:"horizontal",children:[e.jsx(c.Item,{label:"Break start At (24 Hours Format)",name:"breaktime_start_at",rules:[{required:r,message:"Please input Break Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Z,minuteStep:15,hourStep:1,onChange:d=>{I(!!d)}})}),e.jsx(c.Item,{label:"Break End At (24 Hours Format)",name:"breaktime_end_at",rules:[{required:S,message:"Please input Break End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Z,minuteStep:15,hourStep:1,onChange:d=>{o(!!d)},disabledHours:()=>f.getFieldValue("breaktime_start_at")?Array.from({length:f.getFieldValue("breaktime_start_at").hour()},(d,u)=>u):[],disabledMinutes:d=>f.getFieldValue("breaktime_start_at")&&f.getFieldValue("breaktime_start_at").hour()===d?Array.from({length:f.getFieldValue("breaktime_start_at").minute()},(u,x)=>x):[]})})]})}),e.jsx(c.Item,{label:"Allow Saturday Scheduling",name:"allow_saturday_scheduling",rules:[{required:!1,type:"boolean",message:"Allow Saturday Scheduling"}],style:{width:"50%"},valuePropName:"checked",children:e.jsx(_e,{defaultChecked:(n==null?void 0:n.allowSaturdayScheduling)??!1})}),e.jsx(c.Item,{label:"Allow Sunday Scheduling",name:"allow_sunday_scheduling",rules:[{type:"boolean",required:!1,message:"Allow Sunday Scheduling"}],style:{width:"50%"},valuePropName:"checked",children:e.jsx(_e,{})}),e.jsx(c.Item,{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(F,{type:"primary",htmlType:"submit",children:"Save"})})]})})})})})})},zt=()=>(a.useEffect(()=>(document.title=Ie.system_name+": Timetable Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{marginBottom:10},children:e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx("a",{href:"/",children:"Home"})}),e.jsx(J.Item,{children:e.jsx("a",{href:"/timetable",children:"Timetable"})}),e.jsx("span",{children:"Dashboard"})]})})}),e.jsx(Lt,{})]})),{TextArea:Vt}=U,{Option:Yt}=R,Ht=t=>{const[j,i]=a.useState(!1),[f,n]=a.useState([]),[p,T]=a.useState(),w=r=>{T(r)},z=async(r=1,o="")=>{i(!0);const{data:S}=await C.custom({url:"",method:"get",meta:{operation:"schoolVenueTypes",variables:{page:{value:r,type:"Int",required:!0},key:{value:o,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","isActive","created","updated","canEdit","canDelete","canManage"]}]}});n(S.results),i(!1)},_=async r=>{const{data:o}=await C.custom({url:"",method:"post",meta:{operation:"createSchoolVenue",variables:{name:{value:r.name,type:"String",required:!0},code:{value:r.code,type:"String",required:!0},schoolVenueTypeId:{value:parseInt(r.school_venue_type_id),type:"Int",required:!0},description:{value:r.description,type:"String",required:!1},capacity:{value:parseInt(r.capacity),type:"Int",required:!1},longitude:{value:r.longitude,type:"Float",required:!1},latitude:{value:r.latitude,type:"Float",required:!1}},fields:["success","message",{schoolVenue:["id","name","code","description",{schoolVenueType:["id","name"]},"capacity","latitude","longitude","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(S=>(s.error("Error occured while creating school venue"),{data:null})).then(S=>S);o&&(o.success?(s.success(o.message),t.onFinish(o.schoolVenue),t.form.resetFields()):s.error(o.message))};return a.useEffect(()=>{z()},[t.randKey]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:j,children:e.jsxs(c,{layout:"vertical",form:t.form,onFinish:r=>{r.school_venue_type_id=p,_(r)},children:[e.jsx(c.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Name ..."})}),e.jsx(c.Item,{name:"code",label:"Code",rules:[{required:!0,type:"string",message:"Please input Code"}],children:e.jsx(U,{size:"large",placeholder:"Enter Code ..."})}),e.jsx(c.Item,{name:"capacity",label:"Capacity",children:e.jsx(nt,{size:"large",min:0,defaultValue:45,style:{width:"100%"}})}),e.jsx(c.Item,{label:"School Type",rules:[{required:!0,type:"string",message:"Please choose School Type"}],children:e.jsx(R,{showSearch:!0,size:"large",placeholder:"Select a School Venue Type",optionFilterProp:"children",onChange:w,onSearch:r=>{},filterOption:(r,o)=>o.children.toLowerCase().includes(r.toLowerCase()),dropdownStyle:{zIndex:9999},children:f.map((r,o)=>e.jsx(Yt,{value:r.id,children:r.name}))})}),e.jsx(c.Item,{name:"latitude",label:"Latitude",rules:[{required:!1,type:"number",message:"Please input Latidue"}],children:e.jsx(U,{size:"large",placeholder:"Enter Latitude ..."})}),e.jsx(c.Item,{name:"longitude",label:"Longitude",rules:[{required:!1,type:"number",message:"Please input Longitude"}],children:e.jsx(U,{size:"large",placeholder:"Enter Longitude ..."})}),e.jsx(c.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(Vt,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(F,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})})},{TextArea:Wt}=U,{Option:Ot}=R,Bt=t=>{var r;const[j,i]=a.useState(!1),[f,n]=a.useState([]),[p,T]=a.useState(),w=o=>{T(o)},z=async(o=1,S="")=>{i(!0);const{data:I}=await C.custom({url:"",method:"get",meta:{operation:"schoolVenueTypes",variables:{page:{value:o,type:"Int",required:!0},key:{value:S,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","isActive","created","updated","canEdit","canDelete","canManage"]}]}});n(I.results),i(!1)},_=async o=>{const{data:S}=await C.custom({url:"",method:"post",meta:{operation:"updateSchoolVenue",variables:{schoolVenueId:{value:parseInt(o.school_venue_id),type:"Int",required:!0},name:{value:o.name,type:"String",required:!0},code:{value:o.code,type:"String",required:!0},schoolVenueTypeId:{value:parseInt(o.school_venue_type_id),type:"Int",required:!0},description:{value:o.description,type:"String",required:!1},capacity:{value:parseInt(o.capacity),type:"Int",required:!1},longitude:{value:o.longitude,type:"Float",required:!1},latitude:{value:o.latitude,type:"Float",required:!1}},fields:["success","message",{schoolVenue:["id","name","code","description",{schoolVenueType:["id","name"]},"capacity","latitude","longitude","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(I=>(s.error("Error occured while Updating school venue"),{data:null})).then(I=>I);S&&(S.success?(s.success(S.message),t.onFinish(S.schoolVenue),t.form.resetFields()):s.error(S.message))};return a.useEffect(()=>{var o,S,I,D,q,E,v,b;z(),t.form.setFieldsValue({name:(o=t.venue)==null?void 0:o.name,code:(S=t.venue)==null?void 0:S.code,capacity:(I=t.venue)==null?void 0:I.capacity,description:(D=t.venue)==null?void 0:D.description,school_venue_type_id:(q=t.venue)==null?void 0:q.schoolVenueType.id,longitude:(E=t.venue)==null?void 0:E.longitude,latitude:(v=t.venue)==null?void 0:v.latitude}),w((b=t.venue)==null?void 0:b.schoolVenueType.id)},[t.randKey]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:j,children:e.jsxs(c,{layout:"vertical",form:t.form,onFinish:o=>{var S;o.school_venue_type_id=p,o.school_venue_id=(S=t.venue)==null?void 0:S.id,_(o)},requiredMark:!1,children:[e.jsx(c.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Name ..."})}),e.jsx(c.Item,{name:"code",label:"Code",rules:[{required:!0,type:"string",message:"Please input Code"}],children:e.jsx(U,{size:"large",placeholder:"Enter Code ..."})}),e.jsx(c.Item,{name:"capacity",label:"Capacity",children:e.jsx(nt,{min:0,defaultValue:45,style:{width:"100%"}})}),e.jsx(c.Item,{label:"School Type",rules:[{required:!0,type:"string",message:"Please choose School Type"}],children:e.jsx(R,{showSearch:!0,placeholder:"Select a School Venue Type",optionFilterProp:"children",onChange:w,defaultValue:(r=t.venue)==null?void 0:r.schoolVenueType.id,onSearch:o=>{},filterOption:(o,S)=>S.children.toLowerCase().includes(o.toLowerCase()),dropdownStyle:{zIndex:9999},children:f.map((o,S)=>e.jsx(Ot,{value:o.id,children:o.name}))})}),e.jsx(c.Item,{name:"latitude",label:"Latitude",rules:[{required:!1,type:"number",message:"Please input Latidue"}],children:e.jsx(U,{size:"large",placeholder:"Enter Latitude ..."})}),e.jsx(c.Item,{name:"longitude",label:"Longitude",rules:[{required:!1,type:"number",message:"Please input Longitude"}],children:e.jsx(U,{size:"large",placeholder:"Enter Longitude ..."})}),e.jsx(c.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(Wt,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(F,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})})},Kt=t=>{const[j,i]=a.useState(),[f,n]=a.useState([]),[p,T]=a.useState(0),[w,z]=a.useState(!0),[_,r]=a.useState(20),[o,S]=a.useState(""),[I]=c.useForm(),[D]=c.useForm(),E=!ye.useBreakpoint().lg,[v,b]=a.useState(!1),[A,m]=a.useState(!1),N=x=>{i(x),m(!0)},g=async x=>{const{data:h}=await C.custom({url:"",method:"post",meta:{operation:"deleteSchoolVenue",variables:{schoolVenueId:{value:x,type:"Int",required:!0}},fields:["success","message"]}}).catch(P=>(s.error("Error occured while Deleting School Venue"),{data:null})).then(P=>P);h&&(h.success?(s.success(h.message),n(f.filter(P=>P.id.toString()!==x.toString()))):s.error(h.message))},y=async x=>{n([x,...f]),D.resetFields()},d=async x=>{const h=f.findIndex(P=>P.id===x.id);f[h]=x,n([...f]),D.resetFields(),i(void 0),m(!1)},u=async(x,h="",P=20)=>{z(!0);const{data:K}=await C.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:x,type:"Int",required:!0},key:{value:h,type:"String",required:!1},pageSize:{value:P,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","capacity","description","latitude","longitude",{school:["id"]},{schoolVenueType:["id","name"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(oe=>(s.error("Error occured while fetching roles"),{data:null})).then(oe=>oe);K&&(T(K.total),n([...K.results])),z(!1)};return a.useEffect(()=>{u(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:E?24:10,children:e.jsx(c,{layout:"vertical",form:I,onFinish:x=>{S(x.key),f.length=0,u(1,x.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:E?24:2,children:e.jsx(F,{icon:e.jsx(ce,{}),size:"large",onClick:()=>I.submit()})}),e.jsx(B,{span:E?24:12,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(O,{title:"Register a New Venue/Class",children:e.jsx(F,{icon:e.jsx(Te,{}),size:"large",onClick:()=>b(!0),children:"Add Venue"})})})})]}),e.jsx(ge,{loading:w,columns:[{title:"Name",dataIndex:"name",fixed:!0,render:(x,h,P)=>e.jsx("span",{children:e.jsx("a",{children:h.name})})},{title:"Code",dataIndex:"code",render:(x,h,P)=>e.jsx("span",{children:h.code})},{title:"Venue Type",dataIndex:"venue_type",render:(x,h,P)=>{var K;return e.jsx("span",{children:e.jsx(M,{color:"green",children:(K=h==null?void 0:h.schoolVenueType)==null?void 0:K.name})})}},{title:"Capacity",dataIndex:"capacity",render:(x,h,P)=>e.jsx("span",{children:h.capacity})},{title:"Date Created",dataIndex:"created",render:(x,h,P)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(h.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(x,h,P)=>e.jsx("span",{children:h!=null&&h.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(x,h,P)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(Je,{trigger:["click"],overlay:e.jsxs(he,{children:[e.jsx(he.Item,{icon:e.jsx(Ee,{}),disabled:!h.canDelete,children:e.jsx(te,{placement:"topLeft",title:`Are you sure you want to delete ${h.name} Venue?`,onConfirm:()=>g(parseInt(h.id)),okText:"Yes",cancelText:"No",children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(he.Item,{icon:e.jsx(it,{}),disabled:!h.canEdit,onClick:()=>N(h),children:e.jsx("a",{rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:K=>K.preventDefault(),children:e.jsx(lt,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}],dataSource:f,pagination:{onChange:(x,h)=>{r(h),u(x,o,h)},total:p,pageSize:_,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(80vh - 80px)"}}),e.jsx(de,{title:"Register New Venue/Class",width:"30vw",open:v,onClose:x=>b(x),children:e.jsx(Ht,{randKey:Math.random(),form:D,onFinish:y})}),e.jsx(de,{title:"Edditing Venue/Class",width:"30vw",open:A,onClose:x=>m(x),children:e.jsx(Bt,{randKey:Math.random(),form:D,onFinish:d,venue:j})})]})},Gt=()=>(a.useEffect(()=>(document.title=Ie.system_name+": School Venues",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(J.Item,{children:"Venues/Classes"})]})}),e.jsx(Kt,{})]})),{TextArea:Rt}=U,{Option:Ye}=R,ct=[];for(let t=2022;t<new Date().getFullYear()+3;t++)ct.push(e.jsx(Ye,{value:t,children:t.toString()},t.toString()));const Ut=t=>{const[j,i]=a.useState(!1),[f,n]=a.useState([]),[p,T]=a.useState([]),w=async()=>{const{data:r}=await C.custom({url:"",method:"get",meta:{operation:"schoolExaminations",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(o=>(s.error("Failed to get school Examinations"),{data:null})).then(o=>o);r&&n(r.results)},z=async()=>{const{data:r}=await C.custom({url:"",method:"get",meta:{operation:"schoolTypes",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(o=>(s.error("Error occured while fetching school types"),{data:null})).then(o=>o);r&&T(r.results)},_=async r=>{const{data:o}=await C.custom({url:"",method:"post",meta:{operation:"createSchoolTimetable",variables:{title:{value:r.title,type:"String",required:!0},description:{value:r.description,type:"String",required:!1},startAt:{value:r.start_at,type:"DateTime",required:!0},endAt:{value:r.end_at,type:"DateTime",required:!0},year:{value:r.year,type:"Int",required:!0},timetableType:{value:parseInt(r.timetable_type),type:"Int",required:!0},forExamination:{value:r.for_examination,type:"Boolean",required:!1},schoolExaminationId:{value:parseInt(r.school_examination_id),type:"Int",required:!1}},fields:["success","message",{schoolTimetable:["id","title","description","startAt","endAt","timetableType","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id","name"]},{schoolExamination:["id","name"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(S=>(s.error("Error occured while creating school timetable"),{data:null})).then(S=>S);o&&(o.success?(s.success(o.message),t.onFinish(o.schoolTimetable),t.form.resetFields()):s.error(o.message))};return a.useEffect(()=>{w(),z()},[t.randKey]),e.jsx(e.Fragment,{children:e.jsxs(c,{layout:"vertical",form:t.form,onFinish:r=>{r.for_examination=j,r.year?r.year=parseInt(r.year):r.year=new Date().getFullYear(),_(r)},children:[e.jsx(c.Item,{name:"timetable_type",label:"Timetable Type",rules:[{required:!0,type:"string",message:"Please select Timetable Type"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Timetable Type ...",dropdownStyle:{zIndex:9999},children:p.map(r=>e.jsx(Ye,{value:r.id,children:r.name},r.id))})}),e.jsx(c.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Title"}],children:e.jsx(U,{size:"large",placeholder:"Enter Title ..."})}),e.jsx(c.Item,{name:"year",label:"Academic Year",children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Select Year",defaultValue:new Date().getFullYear(),dropdownStyle:{zIndex:9999},children:ct})}),e.jsx(c.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(Rt,{rows:4})}),e.jsxs(ee,{children:[e.jsx(B,{span:12,children:e.jsx(c.Item,{name:"start_at",label:"Start At",rules:[{required:!0,type:"date",message:"Please input Start At Date"}],children:e.jsx(we,{style:{width:"100%"},disabledDate:r=>{const o=ne().format("YYYY-MM-DD");return r&&r<ne(o,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:12,children:e.jsx(c.Item,{name:"end_at",label:"End At",rules:[{required:!0,type:"date",message:"Please input End At Date"}],children:e.jsx(we,{style:{width:"100%"},disabledDate:r=>{const o=ne().format("YYYY-MM-DD");return r&&r<ne(o,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})})]}),e.jsx(c.Item,{name:"for_examination",valuePropName:"checked",children:e.jsx(_e,{onChange:r=>{r.target.checked?i(!0):i(!1)},children:"For Examination"})}),j&&e.jsx(c.Item,{name:"school_examination_id",label:"Examination",rules:[{required:j,type:"string",message:"Please select Examination"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Examination ...",dropdownStyle:{zIndex:9999},children:f==null?void 0:f.map(r=>e.jsx(Ye,{value:r.id.toString(),children:r.name},r.id))})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(F,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{Option:ut}=R,{TextArea:$t}=U,ht=[];for(let t=2022;t<new Date().getFullYear()+3;t++)ht.push(e.jsx(ut,{value:t,children:t.toString()},t.toString()));const Xt=t=>{const[j,i]=a.useState([]),f=async()=>{const{data:p}=await C.custom({url:"",method:"get",meta:{operation:"schoolTypes",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(T=>(s.error("Error occured while fetching school types"),{data:null})).then(T=>T);p&&i(p.results)},n=async p=>{const{data:T}=await C.custom({url:"",method:"post",meta:{operation:"updateSchoolTimetable",variables:{schoolTimetableId:{value:parseInt(p.school_timetable_id),type:"Int",required:!0},title:{value:p.title,type:"String",required:!0},description:{value:p.description,type:"String",required:!1},startAt:{value:p.start_at,type:"DateTime",required:!0},endAt:{value:p.end_at,type:"DateTime",required:!0},year:{value:p.year,type:"Int",required:!0},timetableType:{value:parseInt(p.timetable_type),type:"Int",required:!0},forExamination:{value:p.for_examination,type:"Boolean",required:!1}},fields:["success","message",{schoolTimetable:["id","title","description","startAt","endAt","timetableType","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id","name"]},{schoolExamination:["id","name"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(w=>(s.error("Error occured while creating school timetable"),{data:null})).then(w=>w);T&&(T.success?(s.success(T.message),t.onFinish(T.schoolTimetable),t.form.resetFields()):s.error(T.message))};return a.useEffect(()=>{var p,T,w,z,_,r,o,S;f(),t.form.setFieldsValue({title:(p=t==null?void 0:t.schoolTimetable)==null?void 0:p.title,description:(T=t==null?void 0:t.schoolTimetable)==null?void 0:T.description,start_at:G((w=t==null?void 0:t.schoolTimetable)==null?void 0:w.startAt),end_at:G((z=t==null?void 0:t.schoolTimetable)==null?void 0:z.endAt),timetable_type:(r=(_=t==null?void 0:t.schoolTimetable)==null?void 0:_.timetableSchoolType)==null?void 0:r.id,year:(o=t==null?void 0:t.schoolTimetable)==null?void 0:o.year,for_examination:(S=t==null?void 0:t.schoolTimetable)==null?void 0:S.forExamination})},[t.randKey]),e.jsx(e.Fragment,{children:e.jsxs(c,{layout:"vertical",form:t.form,onFinish:p=>{var T;p.school_timetable_id=(T=t.schoolTimetable)==null?void 0:T.id,n(p)},children:[e.jsx(c.Item,{name:"timetable_type",label:"Timetable Type",children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Timetable Type ...",disabled:!0,dropdownStyle:{zIndex:9999},children:j.map(p=>e.jsx(ut,{value:p.id,children:p.name},p.id))})}),e.jsx(c.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Title"}],children:e.jsx(U,{size:"large",placeholder:"Enter Title ..."})}),e.jsx(c.Item,{name:"year",label:"Academic Year",children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Select Year",defaultValue:new Date().getFullYear(),dropdownStyle:{zIndex:9999},children:ht})}),e.jsx(c.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx($t,{rows:4,maxLength:6})}),e.jsxs(ee,{children:[e.jsx(B,{span:12,children:e.jsx(c.Item,{name:"start_at",label:"Start At",rules:[{required:!0,type:"date",message:"Please input Start At Date"}],children:e.jsx(we,{style:{width:"100%"},disabledDate:p=>{var w;const T=ne((w=t.schoolTimetable)==null?void 0:w.startAt).format("YYYY-MM-DD");return p&&p<ne(T,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:12,children:e.jsx(c.Item,{name:"end_at",label:"End At",rules:[{required:!0,type:"date",message:"Please input End At Date"}],children:e.jsx(we,{style:{width:"100%"},disabledDate:p=>{var w;const T=ne((w=t.schoolTimetable)==null?void 0:w.startAt).format("YYYY-MM-DD");return p&&p<ne(T,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})})]}),e.jsx(c.Item,{name:"for_examination",valuePropName:"checked",children:e.jsx(_e,{disabled:!0,children:"For Examination"})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(F,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},Jt=t=>{const[j,i]=a.useState([]),[f,n]=a.useState(0),[p,T]=a.useState(20),[w,z]=a.useState(""),[_,r]=a.useState(!0),[o]=c.useForm(),I=!ye.useBreakpoint().lg,D=[{title:"Name",dataIndex:"name",fixed:!0,render:(v,b)=>e.jsx("span",{children:b.course.name})},{title:"Year",dataIndex:"year",fixed:!0,render:(v,b)=>e.jsx("span",{children:b.year})},{title:"Semester",dataIndex:"Semester",fixed:!0,render:(v,b)=>e.jsx("span",{children:b.semesterDisplay})},{title:"",dataIndex:"action",render:(v,b)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(te,{title:"Are you sure to delete this task?",onConfirm:()=>q(b.id),onCancel:()=>{},okText:"Yes",cancelText:"No",disabled:!b.canManage,overlayStyle:{zIndex:9999},children:e.jsx(F,{icon:e.jsx(Te,{}),children:"Add"})})})}],q=async v=>{var A;const{data:b}=await C.custom({url:"",method:"post",meta:{operation:"createTimetableStudyCourse",variables:{schoolTimetableId:{value:parseInt(((A=t.schoolTimetable)==null?void 0:A.id.toString())??"0"),type:"Int",required:!0},studyCourseId:{value:parseInt(v.toString()),type:"Int",required:!0}},fields:["success","message",{timetableStudyCourse:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(m=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(m=>m);b&&(b.success?(s.success(b.message),t.onAdd(b.timetableStudyCourse),i(j.filter(m=>m.id.toString()!==v.toString()))):s.error(b.message)),r(!1)},E=async(v,b="",A=20)=>{var N;const{data:m}=await C.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCoursesToAdd",variables:{schoolTimetableId:{value:parseInt(((N=t.schoolTimetable)==null?void 0:N.id.toString())??"0"),type:"Int",required:!0},page:{value:v,type:"Int",required:!0},key:{value:b,type:"String",required:!1},pageSize:{value:A,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{course:["id","name"]},"year","semester","semesterDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(g=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(g=>g);m&&(n(m.total),i([...m.results])),r(!1)};return a.useEffect(()=>{E(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ee,{style:{marginTop:10},children:e.jsx(B,{span:I?24:20,children:e.jsx(c,{layout:"vertical",form:o,onFinish:v=>{z(v.key),j.length=0,E(1,v.key,p)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:_,columns:D,dataSource:j,pagination:{onChange:(v,b)=>{T(b),E(v,w,b)},total:f,pageSize:p,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})]})},Qt=t=>{var y;const[j,i]=a.useState([]),[f,n]=a.useState(1),[p,T]=a.useState(0),[w,z]=a.useState(!1),[_,r]=a.useState(!0),{push:o}=Xe(),[S]=c.useForm();c.useForm(),ye.useBreakpoint().lg;const[D,q]=a.useState(!1),E=async d=>{i([d,...j])},v=async d=>{const{data:u}=await C.custom({url:"",method:"post",meta:{operation:"deleteTimetableStudyCourse",variables:{id:{value:parseInt(d.toString()),type:"Int",required:!0}},fields:["success","message"]}});u.success?(s.success(u.message),i(j.filter(x=>x.id!==d))):s.error(u.message)},b=async(d,u)=>{const{data:x}=await C.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolStudyCourseTimetable",variables:{schoolStudyCourseTimetableId:{value:parseInt(d.toString()),type:"Int",required:!0},published:{value:u,type:"Boolean",required:!0}},fields:["success","message",{schoolStudyCourseTimetable:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});x.success?(s.success(x.message),i(j.map(h=>h.id===x.schoolStudyCourseTimetable.id?x.schoolStudyCourseTimetable:h))):s.error(x.message)},A=()=>{s("Canceled")},m=[{title:"Name",dataIndex:"name",fixed:!0,render:(d,u,x)=>e.jsx("span",{children:e.jsx("a",{children:u.studyCourse.course.name})})},{title:"Year",dataIndex:"year",fixed:!0,render:(d,u,x)=>e.jsx("span",{children:u.studyCourse.year})},{title:"Semester",dataIndex:"Semester",fixed:!0,render:(d,u,x)=>e.jsx("span",{children:u.studyCourse.semesterDisplay})},{title:"Has Entries",dataIndex:"hasEntries",fixed:!0,render:(d,u,x)=>e.jsx("span",{children:u.hasEntries?e.jsx(e.Fragment,{children:e.jsx(M,{color:"green",children:"Yes"})}):e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",children:"No"})})})},{title:"Created",dataIndex:"created",render:(d,u,x)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(u.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(d,u,x)=>e.jsx("a",{children:u!=null&&u.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"Published",dataIndex:"published",render:(d,u,x)=>e.jsx("a",{children:u!=null&&u.published?e.jsx(te,{title:"Are you sure to Un-publish?",onConfirm:()=>b(u.id,!1),onCancel:()=>{},okText:"Unpublish",cancelText:"No",okButtonProps:{disabled:!u.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"green",children:"Published"})}):e.jsx(te,{title:"Are you sure to Publish?",onConfirm:()=>b(u.id,!0),onCancel:()=>{},okText:"Publish",cancelText:"No",okButtonProps:{disabled:!u.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"red",children:"Not Published"})})})},{title:"",dataIndex:"action",render:(d,u,x)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(O,{title:"Schedule",placement:"left",children:e.jsx(F,{icon:e.jsx(xe,{}),disabled:!u.canManage,onClick:()=>{var h;return o("/timetable/study/course/scheduler/"+((h=t==null?void 0:t.schoolTimetable)==null?void 0:h.id)+"/"+u.id)}})}),e.jsx(te,{title:"Are you sure to delete this Timetable Study Course?",onConfirm:()=>v(u==null?void 0:u.id),onCancel:()=>A,okText:"Yes",cancelText:"No",disabled:!(u!=null&&u.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(F,{icon:e.jsx(Ee,{}),disabled:!(u!=null&&u.canDelete)})})]})}],N=async(d,u="")=>{var h;const{data:x}=await C.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCourses",variables:{schoolTimetableId:{value:parseInt(((h=t.schoolTimetable)==null?void 0:h.id.toString())??"0"),type:"Int",required:!0},page:{value:d,type:"Int",required:!0},key:{value:u,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(P=>(s.error("Failed loading School Timetable Education Levels"),{data:null})).then(P=>P);x&&(n(x.page),T(x.total),z(x.hasNext),i([...x.results])),r(!1)},g=async d=>{var x;const{data:u}=await C.custom({url:"",method:"post",meta:{operation:"publishUnpublishAllSchoolStudyCourseTimetables",variables:{schoolTimetableId:{value:parseInt(((x=t.schoolTimetable)==null?void 0:x.id.toString())??"0"),type:"Int",required:!0},published:{value:d,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(h=>(s.error("Failed to publish/unpublish all study courses"),{data:null})).then(h=>h);u&&(u.success?(s.success(u.message),N(1)):s.error(u.message))};return a.useEffect(()=>{N(f)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:12,children:e.jsx(c,{layout:"vertical",form:S,onFinish:d=>{n(1),j.length=0,N(1,d.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(B,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(O,{title:"Click to Publish All Timetables",color:"green",children:e.jsx(F,{size:"large",icon:e.jsx(Qe,{style:{color:"green"}}),onClick:()=>g(!0),children:"Publish All"})}),e.jsx(O,{title:"Click to Unpublish All Timetables",color:"red",children:e.jsx(F,{size:"large",icon:e.jsx(Fe,{style:{color:"red"}}),onClick:()=>g(!1),children:"Unpublish All"})}),e.jsx(O,{title:"Auto Generate Timetable",color:"red",children:e.jsx(F,{size:"large",icon:e.jsx(rt,{style:{color:"red"}}),onClick:()=>t.autoGenerate(),children:"Auto Generate"})}),e.jsx(F,{size:"large",icon:e.jsx(st,{}),onClick:()=>q(!0),children:"Add"})]})]}),e.jsx(ge,{loading:_,columns:m,dataSource:j,pagination:!1,scroll:{y:"60vh"}}),e.jsx(ve,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Adding Study Courses to "}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:(y=t.schoolTimetable)==null?void 0:y.title})})]}),width:"45vw",anchor:"right",onClose:d=>q(d),open:D,noOverFlow:!0,children:e.jsx(Jt,{randKey:Math.random(),schoolTimetable:t.schoolTimetable,onAdd:E})})]})},Zt=t=>{const[j,i]=a.useState([]),[f,n]=a.useState({}),[p,T]=a.useState([]),w=async()=>{var o;const{data:r}=await C.custom({url:"",method:"post",meta:{operation:"uniTimetableAutoScheduler",variables:{schoolTimetableId:{value:parseInt(((o=t.schoolTimetable)==null?void 0:o.id.toString())??"0"),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(S=>S);r&&(r.success?s.success(r.message):s.error(r.message))},z=async()=>{var o;const{data:r}=await C.custom({url:"",method:"get",meta:{operation:"autoTimetableSchedulerValidityCheck",variables:{timetableId:{value:parseInt(((o=t.schoolTimetable)==null?void 0:o.id.toString())??"0"),type:"Int",required:!0}},fields:["data"]}}).catch(S=>(s.remove(),s.error("Something Went Wrong ..."),{data:null})).then(S=>S);r&&(n(r.data),i(r.data.validities.map(S=>({title:e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Course Name",children:S.name}),"- ",e.jsx(O,{title:"Maximum Number of Students",children:e.jsxs(M,{color:"green",children:[S.maxStudents," Max Students"]})}),!S.capacityFit&&e.jsxs(M,{color:"red",children:["No available Venue with capacity of ",S.maxStudents," Students for this course"]})]}),key:"sc-"+S.id,icon:e.jsx(Ve,{}),children:S.modules.length>0?S.modules.map(I=>({title:e.jsxs(e.Fragment,{children:[e.jsxs(O,{title:"Module Name",children:[I.name,e.jsx(M,{color:"green",children:I.code})]}),e.jsx(O,{title:"Number of Periods per Week",children:e.jsxs(M,{color:"green",children:[I.periodsPerWeek," Periods/Week"]})})]}),key:"sc-"+S.id+"-"+I.id,icon:e.jsx(Ve,{}),children:I.teachers.length>0?I.teachers.map(D=>({title:e.jsxs(e.Fragment,{children:[D.fullName," - ",e.jsx(M,{color:"green",children:D.phone})," ",e.jsx(M,{color:"blue",children:D.email})]}),key:"sc-"+S.id+"-"+I.id+"-"+D.id})):[{title:e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",children:"No available Teacher for this course"})}),key:"sc-"+S.id+"-"+I.id+"-0"}]})):[{title:"No Module Found",key:"sc-"+S.id+"-0",icon:e.jsx(Ve,{})}]}))),T(r.data.map(S=>"sc-"+S.id)))},_=[{key:"1",label:"Validity Check Summary",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[f.canGenerate&&e.jsx(Se,{message:"Timetable can be generated, no errors found",type:"success"}),!f.canGenerate&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{message:"Timetable can't be generated, please fix the errors highlited",type:"error"}),e.jsx(me,{bordered:!0,dataSource:f.issues,renderItem:r=>e.jsx(me.Item,{children:e.jsx(me.Item.Meta,{avatar:e.jsx(Ke,{style:{color:"red"}}),title:e.jsx(Ge.Text,{children:r})})})})]})]})},{key:"2",label:"Validity Check Details Tree",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[j.length>0&&e.jsx(gt,{showLine:!0,showIcon:!0,autoExpandParent:!0,expandedKeys:p,onExpand:r=>{T(r)},treeData:j}),j.length<=0&&e.jsx(Se,{message:"No Data Found",type:"error"})]})},{key:"3",label:"Venues",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[f.venues&&e.jsx(me,{bordered:!0,dataSource:f.venues,renderItem:r=>e.jsx(me.Item,{children:e.jsx(me.Item.Meta,{avatar:r.capacity>0?e.jsx(Ct,{style:{color:"green"}}):e.jsx(Ke,{style:{color:"red"}}),title:e.jsxs(Ge.Text,{children:[r.name,e.jsxs(M,{color:"green",style:{marginLeft:"10px"},children:[r.capacity," Max Students"]})]})})})}),!f.venues&&e.jsx(Se,{message:"No Venue Registered",type:"error"})]})}];return a.useEffect(()=>{z()},[t.randKey]),e.jsx("div",{style:{maxHeight:"80vh",minHeight:"80vh",overflowY:"auto",overflowX:"hidden"},children:e.jsx(It,{defaultActiveKey:"1",items:_,onChange:r=>{console.log(r)},tabBarExtraContent:e.jsxs(e.Fragment,{children:[f.canGenerate&&e.jsx(F,{type:"default",onClick:()=>w(),children:"Generate Timetable"}),!f.canGenerate&&e.jsx(Se,{message:"Timetable can't be generated, please fix the errors highlited",type:"error"})]})})})},ea=t=>{const[j,i]=a.useState(),[f,n]=a.useState([]),[p,T]=a.useState(0),[w,z]=a.useState(!0),[_,r]=a.useState(20),[o,S]=a.useState(""),[I]=c.useForm(),[D]=c.useForm(),[q]=c.useForm(),v=!ye.useBreakpoint().lg,[b,A]=a.useState(!1),[m,N]=a.useState(!1),[g,y]=a.useState(!1),[d,u]=a.useState(!1),[x,h]=a.useState(!1),[P,K]=a.useState(!1),oe=L=>{i(L),K(!0)},V=L=>{i(L),h(!0)},H=L=>{i(L),u(!0)},$=L=>{i(L),y(!0)},ae=L=>{i(L),N(!0)},Ae=async L=>{const{data:k}=await C.custom({url:"",method:"post",meta:{operation:"deleteSchoolTimetable",variables:{schoolTimetableId:{value:L,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(s.error("Error occured while Deleting School Venue"),{data:null})).then(Q=>Q);k&&(k.success?(s.success(k.message),n(f.filter(Q=>Q.id.toString()!==L.toString()))):s.error(k.message))},Le=async L=>{n([L,...f]),D.resetFields()},ze=async L=>{const k=f.findIndex(Q=>Q.id===L.id);f[k]=L,n([...f]),q.resetFields(),i(void 0),N(!1)},ke=async(L,k="",Q=20)=>{z(!0);const{data:ie}=await C.custom({url:"",method:"get",meta:{operation:"schoolTimetables",variables:{page:{value:L,type:"Int",required:!0},key:{value:k,type:"String",required:!1},pageSize:{value:Q,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","isPublished","startAt","endAt","timetableType","timetableTypeDisplay","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id"]},{author:["id","firstName","middleName","lastName","fullName"]},{schoolExamination:["id","name"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(s.error("Error occured while fetching roles"),{data:null})).then(fe=>fe);ie&&(T(ie.total),n([...ie.results])),z(!1)};return a.useEffect(()=>{ke(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:v?24:10,children:e.jsx(c,{layout:"vertical",form:I,onFinish:L=>{S(L.key),f.length=0,ke(1,L.key)},children:e.jsx(c.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:v?24:2,children:e.jsx(F,{icon:e.jsx(ce,{}),size:"large",onClick:()=>I.submit()})}),e.jsx(B,{span:v?24:12,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(O,{title:"Register a New Venue/Class",children:e.jsx(F,{icon:e.jsx(Te,{}),size:"large",onClick:()=>A(!0),children:"Add Timetable"})})})})]}),e.jsx(ge,{loading:w,columns:[{title:"Title",dataIndex:"title",fixed:!0,render:(L,k,Q)=>{var ie;return e.jsx("span",{children:e.jsxs("a",{children:[k.title,k.forExamination&&e.jsx(M,{color:"red",style:{marginLeft:10},children:(ie=k==null?void 0:k.schoolExamination)==null?void 0:ie.name})]})})}},{title:"Examination",dataIndex:"examination",fixed:!0,render:(L,k,Q)=>e.jsx("span",{children:e.jsx("a",{children:k.forExamination?e.jsx(M,{color:"green",children:"Yes"}):e.jsx(M,{color:"red",children:"No"})})})},{title:"Year",dataIndex:"year",fixed:!0,render:(L,k,Q)=>e.jsx("span",{children:e.jsx("a",{children:k.year})})},{title:"Timetable Type",dataIndex:"Timetable Type",fixed:!0,render:(L,k,Q)=>{var ie;return e.jsx("span",{children:e.jsx("a",{children:(ie=k==null?void 0:k.timetableSchoolType)==null?void 0:ie.name})})}},{title:"Start AT",dataIndex:"startAt",fixed:!0,render:(L,k,Q)=>e.jsx("span",{children:ne(new Date(k.startAt)).format("MMM Do Y")})},{title:"End At",dataIndex:"endAt",fixed:!0,render:(L,k,Q)=>e.jsx("span",{children:ne(new Date(k.endAt)).format("MMM Do Y")})},{title:"Date Created",dataIndex:"created",render:(L,k,Q)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(k.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(L,k,Q)=>e.jsx("a",{children:k!=null&&k.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(L,k,Q)=>{var ie,fe;return e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(Je,{trigger:["click"],overlay:e.jsxs(he,{children:[e.jsx(he.Item,{icon:e.jsx(Ee,{}),disabled:!k.canDelete,children:e.jsx(te,{placement:"topLeft",title:`Are you sure you want to delete ${k.name} Timetable?`,onConfirm:()=>Ae(parseInt(k.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(he.Item,{icon:e.jsx(it,{}),disabled:!k.canEdit,onClick:()=>ae(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Edit"})}),["pr","osc","asc","	tert"].includes((ie=k==null?void 0:k.timetableSchoolType)==null?void 0:ie.code)&&e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>$(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Scheduler"})}),["uni","poly","col","ous"].includes((fe=k==null?void 0:k.timetableSchoolType)==null?void 0:fe.code)&&e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>H(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Scheduler"})}),e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>oe(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Auto Generate"})}),e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>V(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Schedules Drafts"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:Me=>Me.preventDefault(),children:e.jsx(lt,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}}],dataSource:f,pagination:{onChange:(L,k)=>{r(k),ke(L,o,k)},total:p,pageSize:_,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(80vh - 80px)"}}),e.jsx(de,{title:"Creating New School Timetable",width:"30vw",open:b,onClose:L=>A(L),children:e.jsx(Ut,{randKey:Math.random(),form:D,onFinish:Le})}),e.jsx(de,{title:"Edditing School Timetable",width:"30vw",open:m,onClose:L=>N(L),children:e.jsx(Xt,{randKey:Math.random(),form:q,onFinish:ze,schoolTimetable:j})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"School Timetable Education Levels"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:j==null?void 0:j.title})})]}),width:"60vw",open:g,onClose:L=>y(L),children:e.jsx(dt,{schoolTimetable:j,randKey:Math.random()})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetable Study Courses"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:j==null?void 0:j.title})})]}),width:"80vw",open:d,onClose:L=>u(L),children:e.jsx(Qt,{schoolTimetable:j,randKey:Math.random(),autoGenerate:()=>{K(!0)}})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetables Schedules Drafts"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:j==null?void 0:j.title})})]}),width:"90vw",open:x,onClose:L=>h(L),children:e.jsx(e.Fragment,{children:"Drafts"})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetable Auto Generation"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:j==null?void 0:j.title})})]}),width:"60vw",open:P,onClose:L=>K(L),children:e.jsx(Zt,{schoolTimetable:j,randKey:Math.random()})})]})},ta=()=>(a.useEffect(()=>(document.title=Ie.system_name+": School Timetables",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(J.Item,{children:"Timetables"})]})}),e.jsx(ea,{})]})),Xa=t=>{const{page:j}=t;return j==="SchoolTimetablesPage"?e.jsx(ta,{}):j==="SchoolVenuesPage"?e.jsx(Gt,{}):j==="SchoolTimetableEducationLevelSchedulerPage"?e.jsx(Pt,{}):j==="SchoolTimetableStudyCourseSchedulerPage"?e.jsx(Dt,{}):j==="TimetableDashboardPage"?e.jsx(qt,{}):j==="SchoolTimetableSettingsPage"?e.jsx(zt,{}):e.jsx("div",{children:"Page not found ..."})};export{Xa as TimetablePages};
