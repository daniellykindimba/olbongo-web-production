import{r as t,l as E,c as d,j as e,R as T,d as q,I as R,e as z,L as v,f as O,A as _,h as U,g as F,_ as I,B as w,a as V,S as B,i as Y,M as D,O as G,D as H,k as W,m as X,n as J,o as Q,p as Z,C as $,T as L,P as ee}from"./index-0106a5d3.js";const te=a=>{const[g,u]=t.useState(!1),[b,c]=t.useState(1),[y,f]=t.useState(!1),[h,l]=t.useState(""),[r,x]=t.useState([]);E();const[C]=d.useForm(),p=async(i,N="",M=5)=>{u(!0);const{data:n}=await F.custom({url:"",method:"get",meta:{operation:"announcementViewers",variables:{page:{value:i,type:"Int",required:!0},key:{value:N,type:"String",required:!1},pageSize:{value:M,type:"Int",required:!1},announcementId:{value:parseInt(a.announcement.id),type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id",{user:["id","firstName","middleName","lastName","fullName","email","pic"]},"created","updated","isActive","canManage","canDelete","canEdit"]}]}}).catch(o=>(I.error("Error fetching announcement viewers"),{data:null})).then(o=>o);n&&(c(n.page+1),f(n.hasNext),x([...r,...n.results])),u(!1)},A=y&&!g?e.jsx("div",{style:{textAlign:"center",marginTop:12,height:32,lineHeight:"32px"},children:e.jsx(w,{onClick:()=>p(b,h,25),children:"loading more"})}):null;return t.useEffect(()=>{p(1,"",25)},[a.announcement]),e.jsxs(e.Fragment,{children:[e.jsx(T,{style:{marginTop:10},children:e.jsx(q,{span:24,children:e.jsx(d,{layout:"vertical",form:C,onFinish:i=>{l(i.key),x([]),r.length=0,p(1,i.key,25)},children:e.jsx(d.Item,{name:"key",children:e.jsx(R,{size:"large",placeholder:"Search ...",prefix:e.jsx(z,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(v,{className:"demo-loadmore-list",loading:g,itemLayout:"horizontal",loadMore:A,dataSource:r,renderItem:i=>e.jsx(v.Item,{actions:[],children:e.jsx(O,{avatar:!0,title:!1,loading:g,active:!0,children:e.jsx(v.Item.Meta,{avatar:e.jsx(_,{src:i.user.pic}),title:e.jsx("a",{children:i.user.fullName}),description:"Viewed on: "+U(i.created).format("lll")})})})})]})},P=a=>{const[g,u]=t.useState(!1),[b,c]=t.useState(1);t.useState(25),t.useState("");const[y,f]=t.useState(!1),[h,l]=t.useState([]),[r,x]=t.useState(),[C,p]=t.useState(!1),[A,i]=t.useState(!1);t.useState(a.reset),E();const[N]=d.useForm(),M=async s=>{const{data:m}=await F.custom({url:"",method:"post",meta:{operation:"markAnnouncementViewed",variables:{announcementId:{value:s,type:"Int",required:!0}},fields:["success","message",{darasaAnnouncement:["id","title","content",{user:["id","firstName","middleName","lastName","email","pic"]},{darasa:["id","name","code","description"]},{school:["id","name"]},"created","updated","isActive","isRead","canManage","canDelete","canEdit"]}]}}).catch(()=>(I.error("Error marking announcement as read"),{data:null})).then(S=>S);m&&m.success&&l(h.map(S=>S.id===m.darasaAnnouncement.id?m.darasaAnnouncement:S))},n=s=>{M(parseInt(s.id.toString())),x(s),p(!0)},o=(s,m)=>s.length>m?s.substring(0,m)+"...":s,j=async(s=1,m=25,S="")=>{const{data:k}=await F.custom({url:"",method:"get",meta:{operation:"announcements",variables:{page:{value:s,type:"Int",required:!0},pageSize:{value:m,type:"Int",required:!0},key:{value:S,type:"String",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","title","content",{user:["id","firstName","middleName","lastName","email","pic"]},{darasa:["id","name","code","description"]},{school:["id","name"]},"created","updated","isActive","isRead","canManage","canDelete","canEdit"]}]}}).catch(()=>(I.error("Error fetching announcements"),{data:null})).then(K=>K);k&&(c(k.page+1),f(k.hasNext),a.infinite?l([...h,...k.results]):l([...k.results]))};return t.useEffect(()=>{l([]),a.infinite?j(1,25,""):j(1,5,"")},[a.infinite,a.randKey,a.refresh,a.reset]),e.jsxs(e.Fragment,{children:[a.infinite&&e.jsx(T,{style:{marginTop:10},children:e.jsx(q,{span:24,children:e.jsx(d,{layout:"vertical",form:N,children:e.jsx(d.Item,{name:"key",children:e.jsx(R,{size:"large",placeholder:"Search ...",prefix:e.jsx(z,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(V,{spinning:g,children:e.jsx("div",{style:{overflowY:"auto",maxHeight:a.infinite?"80vh":"57vh",minHeight:a.infinite?"80vh":"57vh"},children:e.jsx(v,{itemLayout:"horizontal",dataSource:h,renderItem:s=>e.jsx("div",{style:{borderBottomColor:"green",marginBottom:3,paddingLeft:10,paddingRight:10,borderBottom:"1px solid #f0f0f0"},children:e.jsx(v.Item,{children:e.jsx(v.Item.Meta,{title:e.jsx(e.Fragment,{children:e.jsxs(B,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("a",{onClick:()=>n(s),children:[!s.isRead&&e.jsx(Y,{size:"default",dot:!0}),e.jsx("span",{style:{marginLeft:3},children:o(s.title,20)})]}),e.jsx(w,{onClick:()=>n(s),danger:!0,children:"Read"})]})}),description:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:o(s.content.replace(/<[^>]+>/g,""),250)}),e.jsxs("span",{style:{display:"block"},children:[e.jsx("b",{children:"Published"}),":"," ",new Date(s.created).toUTCString()]})]})})})})})})}),e.jsx(D,{title:r==null?void 0:r.title,width:"50vw",open:C,onClose:s=>p(s),children:e.jsxs(e.Fragment,{children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:(r==null?void 0:r.content)??""},style:{height:"70vh",overflowY:"auto",overflowX:"hidden"}}),e.jsx(w,{icon:e.jsx(G,{}),size:"large",disabled:!(r!=null&&r.canManage),onClick:()=>i(!0),style:{position:"absolute",bottom:10,right:10,zIndex:1e3},children:"Viewers"})]})}),e.jsx(H,{title:"Announcement Viewers",anchor:"right",width:"40vw",onClose:s=>i(s),open:A,children:e.jsx(te,{announcement:r})})]})},ne=a=>{const[g,u]=t.useState(!1),[b,c]=t.useState(!1),[y,f]=t.useState(!1),[h]=d.useForm(),[l,r]=t.useState("");t.useState("");const[x,C]=t.useState(""),[p,A]=t.useState(!1),[i,N]=t.useState(""),M=async n=>{f(!0);const{data:o}=await F.custom({url:"",method:"post",meta:{operation:"publishGlobalAnnouncement",variables:{title:{value:n.title,type:"String",required:!0},content:{value:n.content,type:"String",required:!0},smsNotify:{value:p,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(j=>({data:null})).then(j=>j);o&&(o.success?(u(!0),c(!1),a.onFinish()):(c(!0),u(!1),N(o.message),Z.error(o.message))),f(!1)};return e.jsx(e.Fragment,{children:e.jsxs(V,{spinning:y,children:[i.length>0&&e.jsx(W,{description:e.jsx(e.Fragment,{children:e.jsx("span",{style:{fontSize:22},children:i})}),type:"error"}),e.jsxs(d,{layout:"vertical",form:h,onFinish:n=>{n.content=x,M(n)},requiredMark:!0,children:[e.jsx(d.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Announcement Title"}],children:e.jsx(R,{onChange:n=>r(n.target.value),size:"large",placeholder:"Announcement Title"})}),e.jsx("div",{style:{marginBottom:10},children:e.jsx(X.CKEditor,{editor:J,data:x,onReady:n=>{n.editing.view.change(o=>{o.setStyle("min-height","200px",n.editing.view.document.getRoot())})},onChange:(n,o)=>{const j=o.getData();C(j)},config:{toolbar:{items:["bold","italic","strikethrough","underline","code","subscript","superscript","removeFormat","|","bulletedList","numberedList","todoList","|","outdent","indent","|","-","fontSize","fontFamily","fontColor","fontBackgroundColor","highlight","|","alignment","|","EmojiPanel"],shouldNotGroupWhenFull:!0},fontFamily:{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0}}})}),e.jsx(d.Item,{name:"sms_notify",valuePropName:"checked",children:e.jsx(Q,{onChange:n=>{A(n.target.checked)},children:"SMS Notify"})}),e.jsx(d.Item,{children:e.jsx(w,{type:"primary",htmlType:"submit",size:"large",style:{float:"right"},disabled:!l||!x||i.length>0,children:"Publish"})})]})]})})},ae=a=>{const[g,u]=t.useState(!1),[b,c]=t.useState(!1),[y,f]=t.useState(Math.random()),h=()=>{f(Math.random()),c(!1)};return t.useEffect(()=>{},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx($,{bodyStyle:{padding:0},title:e.jsx(e.Fragment,{children:e.jsxs(B,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Notice Board"}),e.jsxs("div",{children:[e.jsx(L,{title:"Publish Global Announcement",placement:"left",color:"red",children:e.jsx(w,{style:{marginRight:10},icon:e.jsx(ee,{}),onClick:()=>{c(!0)},danger:!0})}),e.jsx(L,{title:"View All Announcements",placement:"left",color:"red",children:e.jsx(w,{icon:e.jsx(G,{}),onClick:()=>u(!0),danger:!0})})]})]})}),children:e.jsx(P,{infinite:!1,randKey:Math.random(),reset:!0})}),e.jsx(H,{title:"Announcements",anchor:"right",width:"40vw",onClose:l=>u(l),open:g,children:e.jsx(t.Suspense,{fallback:e.jsx(e.Fragment,{}),children:e.jsx(P,{infinite:!0,randKey:Math.random(),refresh:y,reset:!0})})}),e.jsx(D,{title:"Global Announcement Publishing",width:"40vw",open:b,onClose:l=>c(l),children:e.jsx(ne,{randKey:Math.random(),onFinish:h})})]})};export{ae as DashboardAnnouncementsComponent};
