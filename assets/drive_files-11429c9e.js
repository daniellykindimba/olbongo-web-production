import{r as a,F as f,q as X,b6 as Z,bw as ee,j as e,y as h,z as d,s as se,bE as k,C as te,B as p,au as U,bU as ae,I as ne,S as re,aO as oe,ec as ie,u as le,ed as ce,D as de,H as B,ee as ue,ef as he,J as y,aV as pe,K as u,a$ as me}from"./index-96b6a8d9.js";import{D as xe}from"./drive_info-6d738c29.js";import{B as m}from"./Breadcrumb-249d9435.js";const je=M=>{const[x,z]=a.useState(!1),[s,q]=a.useState(),[j,v]=a.useState([]),[C,A]=a.useState(!0),[i,P]=a.useState(1),[fe,E]=a.useState(0),[g,K]=a.useState(20),[O,H]=a.useState(0),[ye,N]=a.useState(!0),[S,R]=a.useState(""),[L]=f.useForm(),{push:T}=X(),[V,Y]=a.useState(Math.random()),[J,F]=a.useState(!1),r=Z();a.useState(!1),a.useState();const[G,w]=a.useState(!1),b=!ee.useBreakpoint().lg,Q=()=>{Y(Math.random()),F(!0)},I=async t=>{const{data:n}=await y.custom({url:"",method:"get",meta:{operation:"drive",variables:{id:{value:t,type:"Int",required:!0}},fields:pe}}).catch(()=>(u.error("Error occured while fetching drive data"),{data:null})).then(c=>c);n&&(q(n),z(!0))},D=t=>{v([...t,...j])},l=async(t,n="",c=20)=>{const{data:o}=await y.custom({url:"",method:"get",meta:{operation:"driveFiles",variables:{id:{value:parseInt(r.drive.toString()),type:"Int",required:!0},page:{value:t,type:"Int",required:!0},key:{value:n,type:"String",required:!1},pageSize:{value:c,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:me}]}}).catch(()=>(u.error("Error occured while fetching files"),{data:null})).then(W=>W);o&&(H(o.total),P(o.page),E(o.pages),N(o.hasNext),v(o.results)),A(!1)},_=(t,n)=>{K(n),l(i,S,n)},$=async t=>{const{data:n}=await y.custom({url:"",method:"post",meta:{operation:"connectDrive",variables:{id:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(u.error("Drive connection failed"),{data:null})).then(c=>c);n&&(n.success?(u(n.message),I(parseInt(r.drive.toString())),l(i,"",20)):u.error(n.message))};return a.useEffect(()=>{I(parseInt(r.drive.toString())),l(i,"",20)},[r.drive]),x?s!=null&&s.isBlocked?e.jsx("div",{children:e.jsx(k,{message:"You can not Access this Drive, you are blocked",type:"error",showIcon:!0})}):s!=null&&s.isConnected?e.jsxs(e.Fragment,{children:[s&&e.jsxs(e.Fragment,{children:[e.jsx(h,{children:e.jsxs(d,{span:24,style:{display:"flex",justifyContent:"space-between",marginBottom:10},children:[e.jsxs(m,{children:[e.jsx(m.Item,{children:e.jsx(U,{to:"/odrive",children:"Home"})}),e.jsx(m.Item,{children:e.jsx(U,{to:"/odrive/drives",children:"Drives"})}),e.jsxs(m.Item,{children:[s==null?void 0:s.name," - Files"]})]}),e.jsx("div",{children:e.jsx(p,{size:"large",icon:e.jsx(ae,{}),disabled:!(s!=null&&s.canManage)||(s==null?void 0:s.isArchived),onClick:()=>T("/odrive/drive/"+r.drive+"/"+r.code+"/members"),children:"Members"})})]})}),e.jsxs(h,{children:[e.jsx(d,{span:12,children:e.jsx(f,{layout:"vertical",form:L,onFinish:t=>{R(t.key),l(1,t.key,g)},children:e.jsx(f.Item,{name:"key",children:e.jsx(ne,{size:"large",placeholder:"Search file(s)...",prefix:e.jsx(re,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(d,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(p,{size:"large",icon:e.jsx(oe,{}),onClick:()=>Q(),loading:!x,disabled:!(s!=null&&s.isAuthor)||(s==null?void 0:s.isArchived),children:"Upload File(s)"}),e.jsx(p,{size:"large",icon:e.jsx(ie,{}),onClick:()=>w(!0),loading:!x,disabled:!(s!=null&&s.isAuthor)||(s==null?void 0:s.isArchived),children:"Upload Folder"})]})]}),e.jsx(le,{sx:{maxHeight:"calc(100vh - 270px)",overflowY:"auto"},children:e.jsx(ce,{loading:C,data:j,min:M.min??!1})})]}),!C&&j.length>0&&e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:10,marginTop:15},children:e.jsx(de,{showSizeChanger:!0,showQuickJumper:!0,defaultCurrent:i,current:i,total:O,pageSize:g,onShowSizeChange:_,onChange:t=>l(t,S,g)})}),e.jsx(B,{title:"Uploading Files",open:J,onClose:t=>F(t),width:b?"100vw":"50vw",children:e.jsx(ue,{onFinish:D,random:V,mode:"drive"})}),e.jsx(B,{title:"Uploading Folder",open:G,onClose:t=>w(t),width:b?"100vw":"50vw",children:e.jsx(he,{onFinish:t=>D(t),mode:"drive",drive:s})})]}):e.jsx(h,{style:{display:"flex",justifyContent:"center"},children:e.jsx(d,{span:12,children:e.jsxs(te,{children:[e.jsx(k,{message:"You can not Access this Drive, you are not connected, Please Click Connect button Below",type:"error",showIcon:!0,style:{marginBottom:30}}),e.jsx(xe,{id:s==null?void 0:s.id}),e.jsx(p,{type:"primary",size:"large",style:{float:"right"},onClick:()=>$(s==null?void 0:s.id),children:"Connect"})]})})}):e.jsx(h,{children:e.jsx(d,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(se,{})})})},ge=()=>e.jsx("div",{style:{marginTop:10},children:e.jsx(je,{})}),we=()=>e.jsx(ge,{});export{we as DriveFilesPage};
