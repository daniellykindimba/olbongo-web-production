import{r as t,c as te,aT as m,j as e,aW as H,aP as f,a1 as O,av as q,aS as me,cW as Le,aZ as Y,aX as ae,cn as le,g as I,_ as c,aY as Ce,af as ce,u as ne,a8 as pe,S as be,F as Fe,aR as de,aU as U,cm as $,cv as _e,co as ee,cM as se,aN as y,cA as M,cf as xe,P as Ke,ce as Be}from"./index-05772eb7.js";import{L as ye}from"./index-7c727271.js";import{C as _}from"./index-7b68fa8b.js";import{A as ke}from"./index-26ba155a.js";import{S as J}from"./SearchOutlined-0e97f4a9.js";import{U as Ve}from"./UserOutlined-930ca4ae.js";import{S as W}from"./index-cc1e3f08.js";import{A as G}from"./ArrowUpOutlined-76a15ab1.js";import{A as oe}from"./index-951488b4.js";import{S as Ee}from"./Skeleton-4d93f06a.js";import{C as Ue}from"./CheckCircleFilled-c4b3f0d6.js";import{C as Oe}from"./CloseCircleOutlined-d90bcde8.js";import{L as Re,A as Ie}from"./LineChartOutlined-8090ddf6.js";import{M as ge}from"./index-013e811c.js";import{P as He}from"./PlusCircleFilled-14ac1555.js";import{D as he}from"./DeleteOutlined-9fe75e98.js";import{S as Pe}from"./SendOutlined-e41c4555.js";import{M as ue}from"./MoreOutlined-acda24b1.js";import{E as fe}from"./ExclamationCircleOutlined-0a20a855.js";import{l as Se}from"./index-2dc20dbd.js";import{G as Ye}from"./index-ab185c8e.js";import{E as je}from"./EditOutlined-2e749454.js";import{A as We}from"./AppstoreOutlined-b4d1c40e.js";import{P as ve}from"./index-1461aa9c.js";import{U as $e}from"./index-a29a8baa.js";import{D as Je}from"./DownloadOutlined-581febce.js";import{I as Qe}from"./InboxOutlined-1c2ad304.js";import{U as Me}from"./UploadOutlined-e863922c.js";import"./index-88e92a4a.js";import"./index-54251132.js";import"./InfoCircleFilled-219488c9.js";import"./InfoCircleFilled-baaa675e.js";import"./DotChartOutlined-f39c986e.js";import"./ActionButton-e20fca38.js";import"./DialogWrap-c515d700.js";import"./index-fe2fbeda.js";import"./fade-6bc080d2.js";import"./DeleteOutlined-25685737.js";import"./defineProperty-4d9f4f1d.js";import"./useNotification-fddf6c6b.js";import"./index-cedb4c3d.js";import"./localeData-ea0dd020.js";import"./SinglePicker-9fafe884.js";import"./useMutateObserver-3cfc8689.js";import"./index-fa9d428a.js";import"./InputNumber-677354a2.js";import"./Image-256411dd.js";import"./Upload-890ff9ff.js";import"./Rate-fbbf0fc9.js";import"./index-849a35e1.js";import"./index-ad8bef66.js";import"./EditOutlined-401a1613.js";import"./DownloadOutlined-6cd35f11.js";const Ge=()=>{const[a,i]=t.useState([]),[r,s]=t.useState(!1),[h,n]=t.useState(!1),[d,l]=t.useState(20),[u,p]=t.useState(0),[F,P]=t.useState(1);t.useState(""),te();const[A]=m.useForm(),z=async(N,k,b=20)=>{s(!0);const{data:C}=await I.custom({url:"",method:"get",meta:{operation:"messagesDispatches",variables:{page:{value:N,type:"Int",required:!0},key:{value:k,type:"String",required:!1},pageSize:{value:b,type:"Int",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","receipientPhoneNumber","carrier",{channelMessage:["id","message",{channel:["id","name","code"]}]},{receipient:["id","firstName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(D=>(c.error("Error fetching Recently Messages Dispatched"),{data:null})).then(D=>D);C&&(p(C.total),P(C.page+1),i([...a,...C.results])),s(!1),n(!1)},K=N=>{N.currentTarget.scrollHeight-N.currentTarget.scrollTop===window.innerHeight/1.4&&z(F,"",20)};return t.useEffect(()=>{z(F,"",20)},[]),e.jsx(e.Fragment,{children:e.jsxs(H,{children:[e.jsx(f,{children:e.jsx("span",{style:{fontSize:16,fontWeight:"bolder"},children:"Recently Dispatched Messages"})}),e.jsx(f,{span:20,style:{height:45},children:e.jsx(m,{layout:"vertical",form:A,onFinish:N=>{n(!0),z(F,N.key,d)},children:e.jsx(m.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:h,placeholder:"Search Phone Number(s)...",prefix:e.jsx(J,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-start",height:45},children:e.jsx(q,{size:"large",icon:e.jsx(J,{}),onClick:()=>{A.submit()},loading:h||r,disabled:h||r})}),e.jsxs(f,{span:24,children:[a.length===0&&e.jsx(me,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No recently dispatched message ..."})}),e.jsx(ye,{style:{paddingRight:10},children:e.jsx(Le,{data:a,height:window.innerHeight/1.4,itemHeight:47,itemKey:"phoneNumber",onScroll:K,children:N=>{var k,b;return e.jsx(_,{children:e.jsx(ye.Item,{children:e.jsx(ye.Item.Meta,{avatar:e.jsx(ke,{icon:e.jsx(Ve,{})}),title:e.jsxs("a",{children:[N.receipientPhoneNumber,e.jsxs("span",{style:{marginLeft:5},children:[e.jsx(Y,{color:"green",children:(b=(k=N==null?void 0:N.channelMessage)==null?void 0:k.channel)==null?void 0:b.name}),N.carrier&&e.jsx(Y,{color:"red",children:N.carrier})]})]}),description:e.jsx(e.Fragment,{children:e.jsxs(ae,{direction:"vertical",children:[e.jsx("span",{children:N.channelMessage.message.length>100?N.channelMessage.message.substring(0,100)+"...":N.channelMessage.message}),e.jsxs("span",{children:[e.jsx("b",{children:"Dispatched"}),":"," ",le(N.created).format("lll")]})]})})})},N.receipientPhoneNumber)})}})})]})]})})},Ze=a=>{const[i,r]=t.useState([]);t.useState();const[s,h]=t.useState(!1),[n,d]=t.useState(!1),[l,u]=t.useState(20),[p,F]=t.useState(0),[P,A]=t.useState("");te();const[z]=m.useForm(),K=async(k,b,C=20)=>{h(!0);const{data:D}=await I.custom({url:"",method:"get",meta:{operation:"channelMessageDispatches",variables:{page:{value:k,type:"Int",required:!0},key:{value:b,type:"String",required:!1},pageSize:{value:C,type:"Int",required:!1},filterType:{value:a.filterType,type:"String",required:!0},messageId:{value:a.messageId,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","receipientPhoneNumber","status","statusColor","carrier","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(S=>(c.error("Error fetching Dispatches"),{data:null})).then(S=>S);D&&(F(D.total),r(D.results)),h(!1),d(!1)},N=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(k,b,C)=>e.jsx("a",{onClick:()=>{},children:b.receipientPhoneNumber})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(k,b,C)=>e.jsx(Y,{color:"green",children:b.carrier})},{title:"Created",dataIndex:"created",key:"created",render:(k,b,C)=>e.jsx(ce,{title:le(b.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:le(b.created).format("Y-mm-d hh:mm:ss")})})},{title:"Status",dataIndex:"status",key:"status",render:(k,b,C)=>e.jsx(Y,{color:b.statusColor,children:b.status})},{title:"",dataIndex:"Action",key:"action",render:(k,b,C)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"}})}];return t.useEffect(()=>{K(1,"",20)},[a.randKey,a.filterType]),e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsx(f,{span:24,children:e.jsx(m,{layout:"vertical",form:z,onFinish:k=>{d(!0),K(0,k.key,l)},children:e.jsx(m.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:n,placeholder:"Search Phone Number(s)...",prefix:e.jsx(J,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(Ce,{loading:s,columns:N,dataSource:i,pagination:{onChange:(k,b)=>{u(b),K(k,P,b)},total:p,pageSize:l,position:["bottomCenter"],showQuickJumper:!0},scroll:{x:!0,y:"40vh"}})]})},Xe=["receipients","delivered","notdelivered","failed"],es=["All Receipients","All Delivered","All Not Delivered","All Failed"],De=a=>{var u;ne(),te();const[i,r]=t.useState(!1),[s,h]=t.useState(),[n,d]=t.useState("receipients"),l=async()=>{var F;r(!0);const{data:p}=await I.custom({url:"",method:"get",meta:{operation:"channelMessageDispatchAnalytics",variables:{messageId:{value:(F=a.channelMessage)==null?void 0:F.id,type:"Int",required:!0}},fields:["analytics"]}}).catch(P=>(c.error("Error fetching Message Dispatch analytics"),{data:null})).then(P=>P);p&&h(p.analytics),r(!1)};return t.useEffect(()=>{l()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(pe,{spinning:i,children:[e.jsxs(H,{style:{display:"flex",justifyContent:"center",marginTop:2},children:[e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>d("receipients"),children:e.jsx(_,{children:e.jsx(W,{title:"Total Receipients",value:s==null?void 0:s.total_receipients,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>d("delivered"),children:e.jsx(_,{children:e.jsx(W,{title:"Delivered",value:s==null?void 0:s.total_delivered,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>d("notdelivered"),children:e.jsx(_,{children:e.jsx(W,{title:"Not Delievered",value:s==null?void 0:s.total_not_delivered,precision:0,valueStyle:{color:"#5E0321"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>d("failed"),children:e.jsx(_,{children:e.jsx(W,{title:"Failed",value:s==null?void 0:s.total_failed,precision:0,valueStyle:{color:"#700107"},prefix:e.jsx(G,{})})})})})]}),e.jsxs("div",{style:{marginTop:2},children:[e.jsx("h3",{children:es[Xe.indexOf(n)]}),e.jsx(Ze,{randKey:Math.random(),filterType:n,messageId:(u=a.channelMessage)==null?void 0:u.id})]})]})})},{TextArea:ss}=O,ts=a=>{const[i,r]=t.useState([]),[s,h]=t.useState([]),n=async(p=1,F=25,P="")=>{const{data:A}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:p,type:"Int",required:!0},pageSize:{value:F,type:"Int",required:!0},key:{value:P,type:"String",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code"]}]}}).catch(()=>(c.remove(),c.error("Error fetching Channels"),{data:null})).then(z=>z);A&&r(A.results)},d=async p=>{console.error(p);const{data:F}=await I.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelMessage",variables:{channels:{value:p.channels,type:"[Int]",required:!0},message:{value:p.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessages:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","dispatched","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(P=>(console.error(P),c.remove(),c.error("Error creating channel message"),{data:null})).then(P=>P);console.log(F),F&&(F.success?(c.success(F.message),a.onFinish(F.njiwaChannelMessages)):c.error(F.message))},l=p=>{h(p)},u=p=>{};return t.useEffect(()=>{n()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:p=>{console.log("values",p),p.channels=s,d(p)},requiredMark:!0,children:[e.jsx(m.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(ss,{rows:4})}),e.jsx(m.Item,{name:"channels",label:"Channels",rules:[{required:!0,type:"array",message:"Please Choose Channels ..."}],children:e.jsx(be,{size:"large",showSearch:!0,allowClear:!0,mode:"multiple",placeholder:"Select a Channel ...",optionFilterProp:"children",onChange:l,onSearch:u,filterOption:(p,F)=>((F==null?void 0:F.label)??"").toLowerCase().includes(p.toLowerCase()),options:i.map(p=>({value:p.id,label:p.name+" --> "+p.code})),dropdownStyle:{zIndex:9999}})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},ns=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),[n,d]=t.useState(""),[l,u]=t.useState(""),[p,F]=t.useState(!1),[P,A]=t.useState(""),[z,K]=t.useState(""),N=async b=>{r(!0);const{data:C}=await I.custom({url:"",method:"post",meta:{operation:"messagePreDispatchSummary",variables:{messageId:{value:b,type:"Int",required:!0}},fields:["success","message",{data:["data"]}]}}).catch(D=>(console.error(D),c.remove(),c.error(D.message),{data:null})).then(D=>D);C&&(h(C.data.data),C.success?d(C.message):u(C.message)),r(!1)},k=async b=>{r(!0);const{data:C}=await I.custom({url:"",method:"post",meta:{operation:"dispatchChannelMessage",variables:{channelMessageId:{value:b,type:"Int",required:!0}},fields:["success","message",{channelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","dispatched","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(D=>(c.remove(),c.error(D.message),{data:null})).then(D=>D);c.remove(),C&&(F(!0),C.success?(K(C.message),a.onDispatch(C.channelMessage)):A(C.message))};return t.useEffect(()=>{N(a.channelMessage.id)},[a.channelMessage.id]),p?e.jsxs(e.Fragment,{children:[z.length>0&&e.jsx(oe,{message:z,type:"success",showIcon:!0}),P.length>0&&e.jsx(oe,{message:P,type:"error",showIcon:!0})]}):e.jsxs(Ee,{loading:i,active:!0,children:[n.length>0&&e.jsx(oe,{message:n,type:"success",showIcon:!0}),l.length>0&&e.jsx(oe,{message:l,type:"error",showIcon:!0}),e.jsxs("div",{children:[e.jsxs("p",{children:["Message Count: ",s==null?void 0:s.totalMessages]}),e.jsxs("p",{children:["Message Units: ",s==null?void 0:s.messageUnits]}),e.jsxs("p",{children:["Total Contacts: ",s==null?void 0:s.totalContacts]})]}),e.jsx(Fe,{gap:10,style:{marginTop:20},justify:"flex-end",children:e.jsx(q,{disabled:!(s!=null&&s.dispatchable),type:"primary",onClick:()=>k(a.channelMessage.id),children:"Dispatch"})})]})},qe=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,d]=t.useState(!1),[l,u]=t.useState(!1),[p,F]=t.useState(20);t.useState(""),te(),m.useForm();const[P]=m.useForm(),[A,z]=t.useState(!1),[K,N]=t.useState(!1),[k,b]=t.useState(!1),C=async j=>{h(j),z(!0)},D=j=>{h(j),b(!0)},S=async j=>{const{data:R}=await I.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannelMessage",variables:{id:{value:j,type:"Int",required:!0}},fields:["success","message"]}});c.remove(),R.success?(c.success(R.message),r(i.filter(Z=>Z.id.toString()!==j.toString()))):c.error(R.message)},E=async j=>{r(i.map(R=>R.id===j.id?j:R))},v=j=>{ge.confirm({title:"Deleting Njiwa Channel Message",icon:e.jsx(fe,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>S(parseInt(j.toString()))})},L=async(j,R,Z=20)=>{d(!0);const{data:re}=await I.custom({url:"",method:"get",meta:{operation:"njiwaChannelsMessages",variables:{page:{value:j,type:"Int",required:!0},key:{value:R,type:"String",required:!1},pageSize:{value:Z,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"dispatched","messageCount","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>({data:null})).then(ie=>ie);re&&r(re.results),d(!1),u(!1)},Q=async j=>{r([...j,...i]),N(!1)};return t.useEffect(()=>{L(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(m,{layout:"vertical",form:P,onFinish:j=>{u(!0),L(0,j.key,p)},children:e.jsx(m.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Channel Message(s)...",prefix:e.jsx(J,{}),autoComplete:"off",autoFocus:!0,allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(q,{size:"large",icon:e.jsx(J,{}),onClick:()=>{P.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ce,{title:"Click to Create Message",placement:"top",color:"green",children:e.jsx(q,{size:"large",icon:e.jsx(He,{}),onClick:()=>{N(!0)},loading:l||n,disabled:l||n,style:{marginRight:30}})})})]}),e.jsx(pe,{spinning:n,children:e.jsx("div",{style:{maxHeight:a.dash?"69vh":"",overflowY:"auto"},children:e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(me,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Message Found ..."})})}),i.map(j=>{var R;return e.jsx(f,{span:24,children:e.jsxs(_,{hoverable:j.isActive,style:{marginRight:10,marginBottom:3},children:[e.jsxs(ae,{style:{right:0,position:"absolute"},children:[j.dispatched?e.jsx(e.Fragment,{children:e.jsx(ce,{title:"Dispatched",placement:"top",color:"green",children:e.jsx(Ue,{style:{color:"green"}})})}):e.jsx(e.Fragment,{children:e.jsx(ce,{title:"Not Dispatched",placement:"top",color:"red",children:e.jsx(Oe,{style:{color:"red"}})})}),e.jsx(de,{trigger:["click"],overlay:e.jsxs(U,{children:[e.jsx(U.Item,{icon:e.jsx(he,{}),onClick:()=>{v(j.id)},disabled:!(j!=null&&j.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}),!j.dispatched&&e.jsx(U.Item,{icon:e.jsx(Pe,{}),disabled:!(j!=null&&j.canDelete),onClick:()=>{D(j)},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch"})}),e.jsx(U.Item,{icon:e.jsx(Re,{}),disabled:!(j!=null&&j.canDelete),onClick:()=>C(j),children:e.jsx("a",{rel:"noopener noreferrer",children:"Dispatch Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:Z=>Z.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})]}),e.jsxs(ae,{direction:"vertical",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created By:"}),e.jsx("span",{style:{marginLeft:5},children:(R=j==null?void 0:j.creator)==null?void 0:R.fullName})]}),e.jsx("span",{children:j.message}),e.jsxs(ae,{direction:"horizontal",children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created On:"}),e.jsx("span",{style:{marginLeft:5},children:le(j.created).format("YYYY/MM/DD HH:MM")})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Channel:"}),e.jsxs("span",{style:{marginLeft:5},children:[j==null?void 0:j.channel.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:j==null?void 0:j.channel.code})})]})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Message Count:"}),e.jsx("span",{style:{marginLeft:5},children:e.jsx(Y,{color:"green",children:j==null?void 0:j.messageCount})})]})]})]})]})})})]})})}),e.jsx($,{title:"Dispatch Report",width:"80vw",open:A,onClose:j=>z(j),children:e.jsx(De,{randKey:Math.random(),channelMessage:s})}),e.jsx($,{title:"Creating Message",open:K,width:"40vw",onClose:j=>N(j),children:e.jsx(ts,{onFinish:Q})}),e.jsx($,{title:"Dispatching Message",open:k,width:"40vw",onClose:j=>b(j),children:e.jsx(ns,{channelMessage:s,onDispatch:j=>E(j)})})]})},as=a=>{const[i,r]=t.useState(),[s,h]=t.useState(!1),[n]=m.useForm(),[d,l]=t.useState(1),[u,p]=t.useState(),[F,P]=t.useState(""),[A,z]=t.useState(!1);t.useState(!0);const[K,N]=t.useState("Congratulations! Your payment has been received successfully");_e(S=>S.socketMessage);const k=async()=>{h(!0);const{data:S}=await I.custom({url:"",method:"get",meta:{operation:"systemSettings",fields:["smsCostPerUnit"]}}).catch(()=>(c.remove(),c.error("Error fetching system settings"),{data:null})).then(E=>E);S&&p(S),h(!1)},b=async S=>{const{data:E}=await I.custom({url:"",method:"get",meta:{operation:"schoolNjiwaAccountBilling",variables:{id:{value:S,type:"Int",required:!0}},fields:["id","isPaid","billNumber","amount","phone","paymentDate","receiptNumber","created","updated","isActive"]}}).catch(()=>(c.remove(),c.error("Error fetching billing details"),{data:null})).then(v=>v);E&&r(E)},C=async S=>{console.log(S);const{data:E}=await I.custom({url:"",method:"post",meta:{operation:"purchaseSmsOrder",variables:{messages:{value:S.messages,type:"Int",required:!0},phone:{value:S.phone,type:"String",required:!0}},fields:["success","message",{bill:["id","isPaid","billNumber","amount","phone","paymentDate","receiptNumber","created","updated","isActive"]}]}}).catch(v=>(c.remove(),console.error(v),c.error("Error creating order"),{data:null})).then(v=>v);E&&(E.success?(r(E.bill),c.success(E.message),l(3)):(P(E.message),z(!0)))},D=S=>S.toLocaleString("en-US",{style:"currency",currency:"TZS"});return t.useEffect(()=>{k();const S=setInterval(()=>{i&&!i.isPaid&&b(i.id)},5e3);return()=>clearInterval(S)},[a.randKey]),i&&i.isPaid?e.jsx(e.Fragment,{children:e.jsx(oe,{message:K,type:"success",showIcon:!0})}):e.jsxs(Ee,{loading:s,active:!0,children:[A&&d===2&&e.jsx(oe,{message:F,type:"error",showIcon:!0}),d===1&&e.jsxs(m,{layout:"vertical",form:n,onFinish:()=>{P(""),z(!1),l(2)},requiredMark:!0,children:[e.jsx(oe,{message:"Please note that the minimum number of messages is 100",type:"info",showIcon:!0}),e.jsx(Fe,{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",marginBottom:"10px"},children:e.jsx("div",{children:e.jsxs("h3",{children:["Cost per message: ",u==null?void 0:u.smsCostPerUnit," Tsh"]})})}),e.jsx(m.Item,{name:"messages",label:"Total Messages (5 Tsh per message)",rules:[{type:"number",min:100,message:"Minimum number of messages is 100"}],children:e.jsx(Se.InputNumber,{min:100,style:{width:"100%"}})}),e.jsx(m.Item,{name:"phone",label:"Phone Number (will be used for payment)",rules:[{required:!0,message:"Please Enter Phone Number ..."}],children:e.jsx(O,{placeholder:"Enter Phone Number"})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Purchase"})})]}),d===2&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["Total Messages: ",n.getFieldValue("messages")," "]}),e.jsxs("h3",{children:["Total Amount:"," ",D(parseInt(n.getFieldValue("messages"))*parseFloat((u==null?void 0:u.smsCostPerUnit.toString())??"0.0"))," "]}),e.jsxs("h3",{children:["Phone Number: ",n.getFieldValue("phone")," "]})]}),e.jsxs("div",{children:[e.jsx(q,{type:"primary",size:"large",style:{float:"left"},onClick:()=>l(1),children:"Back"}),e.jsx(q,{type:"primary",size:"large",style:{float:"right"},onClick:()=>{C({messages:n.getFieldValue("messages"),phone:n.getFieldValue("phone")})},children:"Pay"})]})]}),d===3&&e.jsxs("div",{children:[e.jsxs("h3",{children:["Payment request sent to ",n.getFieldValue("phone"),", please check your phone and confirm the payment"]}),e.jsxs("div",{children:[e.jsx(q,{type:"primary",size:"large",style:{float:"left"},onClick:()=>l(2),children:"Back"}),e.jsx(q,{type:"primary",size:"large",style:{float:"right"},onClick:()=>a.onFinish(),children:"Finish"})]})]})]})},rs=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),{push:n}=te(),[d,l]=t.useState(!1),p=!Ye.useBreakpoint().lg,F=async()=>{r(!0);const{data:P}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolAnalytic",fields:["analytics"]}}).catch(()=>(c.remove(),c.error("Error fetching analytics"),{data:null})).then(A=>A);P&&h(P.analytics),r(!1)};return t.useEffect(()=>{F()},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(Se.Skeleton,{loading:i,children:[e.jsxs(H,{style:{display:"flex",justifyContent:"center"},children:[e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>l(!0),children:e.jsx(_,{children:e.jsx(W,{title:"Balances (Units)",value:s==null?void 0:s.balances,precision:0,valueStyle:{color:"#3f8600"}})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/channels"),children:e.jsx(_,{children:e.jsx(W,{title:"Channels",value:s==null?void 0:s.channels,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/contacts/phonenumbers"),children:e.jsx(_,{children:e.jsx(W,{title:"Phone Numbers",value:s==null?void 0:s.phone_numbers,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/contacts/emails"),children:e.jsx(_,{children:e.jsx(W,{title:"Emails",value:s==null?void 0:s.emails,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages"),children:e.jsx(_,{children:e.jsx(W,{title:"Messages",value:s==null?void 0:s.messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/sent"),children:e.jsx(_,{children:e.jsx(W,{title:"Pending Messages",value:s==null?void 0:s.sent_messages,precision:0,valueStyle:{color:"#770622"},prefix:e.jsx(Ie,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/sent"),children:e.jsx(_,{children:e.jsx(W,{title:"Sent Messages",value:s==null?void 0:s.sent_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/failed"),children:e.jsx(_,{children:e.jsx(W,{title:"Failed Messages",value:s==null?void 0:s.failed_messages,precision:0,valueStyle:{color:"#861400"},prefix:e.jsx(Ie,{})})})})})]}),e.jsxs(H,{children:[e.jsx(f,{span:12,children:e.jsxs("div",{style:{marginTop:20},children:[e.jsx("span",{style:{fontSize:16,fontWeight:"bolder"},children:"Messages"}),e.jsx(qe,{dash:!0})]})}),e.jsx(f,{span:12,children:e.jsx("div",{style:{marginTop:20},children:e.jsx(Ge,{})})})]})]}),e.jsx($,{title:"Purchase Messages",open:d,onClose:P=>{F(),l(P)},width:p?"100vw":"30vw",children:e.jsx(as,{onFinish:()=>l(!1)})})]})},is=()=>(t.useEffect(()=>{document.title=ee.system_name+": Njiwa"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx("span",{children:"Channels"})]})})}),e.jsx(rs,{})]})),{TextArea:ls}=O,we=a=>{const i=async r=>{const{data:s}=await I.custom({url:"",method:"post",meta:{operation:"createNjiwaChannel",variables:{name:{value:r.name,type:"String",required:!0},description:{value:r.description,type:"String",required:!1}},fields:["success","message",{njiwaChannel:["id","name","description","code","icon","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(h=>(c.error("Error creating channel"),{data:null})).then(h=>h);s&&(s.success?(c.success(s.message),a.onFinish(s.njiwaChannel)):c.error(s.message))};return t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,children:[e.jsx(m.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Channel Name ..."}],children:e.jsx(O,{size:"large",placeholder:"Enter Channel Name ..."})}),e.jsx(m.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(ls,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{TextArea:os}=O,cs=a=>{const i=async r=>{var h;const{data:s}=await I.custom({url:"",method:"post",meta:{operation:"updateNjiwaChannel",variables:{channelId:{value:(h=a.channel)==null?void 0:h.id,type:"Int",required:!0},name:{value:r.name,type:"String",required:!0},description:{value:r.description,type:"String",required:!1}},fields:["success","message",{njiwaChannel:["id","name","description","code","icon","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(n=>(c.error("Error Updating channel"),{data:null})).then(n=>n);s&&(s.success?(c.success(s.message),a.onFinish(s.njiwaChannel)):c.error(s.message))};return t.useEffect(()=>{var r,s;a.form.setFieldsValue({name:(r=a.channel)==null?void 0:r.name,description:(s=a.channel)==null?void 0:s.description})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,autoComplete:"off",children:[e.jsx(m.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Channel Name"}],children:e.jsx(O,{size:"large",placeholder:"Enter Channel Name ..."})}),e.jsx(m.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(os,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},ds=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,d]=t.useState(!1),[l,u]=t.useState(!1),[p,F]=t.useState(0),[P,A]=t.useState(1),[z,K]=t.useState(30),[N,k]=t.useState(""),{push:b}=te(),[C,D]=t.useState(!1),[S,E]=t.useState(!1),[v]=m.useForm(),[L]=m.useForm(),[Q]=m.useForm(),j=o=>{A(o),B(o,N,z)},R=o=>{h(o),E(!0)},Z=()=>{D(!0)},re=async o=>{r([o,...i]),v.resetFields(),D(!1)},ie=async o=>{const x=i.findIndex(w=>w.id===o.id);i[x]=o,r([...i]),L.resetFields(),E(!1)},g=async o=>{const{data:x}=await I.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{channelId:{value:o,type:"Int",required:!0}},fields:["success","message"]}}).catch(w=>(c.error(w.message),{data:null})).then(w=>w);x&&(x.success?(c.success(x.message),r(i.filter(w=>w.id.toString()!==o.toString()))):c.error(x.message))},T=o=>{ge.confirm({title:e.jsxs(e.Fragment,{children:["Deleting ",o.name," Channel"]}),icon:e.jsx(fe,{}),content:"Are you sure ...",okText:"Yes",cancelText:"Cancel",onOk:()=>g(parseInt(o.id.toString()))})},B=async(o,x,w=20)=>{d(!0);const{data:V}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:o,type:"Int",required:!0},key:{value:x,type:"String",required:!1},pageSize:{value:w,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(X=>(c.error("Error fetching channels"),{data:null})).then(X=>X);V&&(F(V.total),r(V.results)),d(!1),u(!1)};return t.useEffect(()=>{B(1,N,z)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(m,{layout:"vertical",form:Q,onFinish:o=>{k(o.key),u(!0),B(0,o.key,z)},children:e.jsx(m.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Channel(s)...",prefix:e.jsx(J,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(q,{size:"large",icon:e.jsx(J,{}),onClick:()=>{Q.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(q,{size:"large",disabled:n||l,onClick:()=>{v.resetFields(),Z()},children:[e.jsx(xe,{}),"Create Channel"]})})]}),e.jsxs(pe,{spinning:n,size:"large",children:[e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(me,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(q,{type:"primary",onClick:()=>{v.resetFields(),Z()},children:"Create Channel Now"})})}),i.map(o=>e.jsx(f,{span:4,children:e.jsxs(_,{hoverable:o.isActive,style:{marginRight:10},children:[e.jsx(ae,{style:{right:0,position:"absolute"},children:e.jsx(de,{trigger:["click"],overlay:e.jsxs(U,{children:[e.jsx(U.Item,{icon:e.jsx(je,{}),onClick:()=>{R(o)},disabled:!(o!=null&&o.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(U.Item,{icon:e.jsx(he,{}),onClick:()=>{T(o)},disabled:!(o!=null&&o.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:x=>x.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsx("a",{onClick:()=>b("/njiwa/channel/"+o.id+"/"+o.name),children:e.jsxs(ae,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsx(ke,{size:{xs:24,sm:32,md:40,lg:40,xl:40,xxl:80},icon:e.jsx(We,{}),src:o.icon}),e.jsx(ce,{title:o.name,children:o.name.length>10?o.name.substring(0,10)+"...":o.name}),e.jsx("span",{children:e.jsx(Y,{color:"green",children:o.code})})]})})]})}))]}),i.length>0&&e.jsx(H,{style:{display:"flex",justifyContent:"center"},children:e.jsx("span",{style:{marginTop:20},children:e.jsx(Ke,{showQuickJumper:!0,showTotal:(o,x)=>`Total ${o} Channels`,defaultCurrent:P,total:p,pageSize:z,onChange:j,showSizeChanger:!0,onShowSizeChange:(o,x)=>{K(x),B(o,N,x)},disabled:n||l})})})]}),e.jsx($,{title:"Create Njiwa Channel",width:"40vw",open:C,onClose:o=>D(o),children:e.jsx(we,{form:v,randKey:Math.random(),onFinish:re})}),e.jsx($,{title:"Edit "+(s==null?void 0:s.name)+" Channel",width:"40vw",open:S,onClose:o=>E(o),children:e.jsx(cs,{form:L,randKey:Math.random(),onFinish:ie,channel:s})})]})},hs=()=>(t.useEffect(()=>{document.title=ee.system_name+": Channels"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:5,marginBottom:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx("span",{children:"Channels"})]})})}),e.jsx(ds,{randKey:Math.random()})]})),us=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Emails"})})),ms=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=ne(),d=async()=>{r(!0);const{data:l}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(u=>(c.error("Error fetching channel"),{data:null})).then(u=>u);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel Emails",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:5,marginBottom:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(y.Item,{children:e.jsxs(M,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Emails"})]})})}),e.jsx(us,{randKey:Math.random(),channel:s})]})},xs=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Failed Messages"})})),js=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=ne(),d=async()=>{r(!0);const{data:l}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(u=>(c.error("Error fetching channel"),{data:null})).then(u=>u);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Failed Messages",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(y.Item,{children:e.jsxs(M,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx(y.Item,{children:"Messages"}),e.jsx("span",{children:"Failed"})]})})}),e.jsx(xs,{randKey:Math.random(),channel:s})]})},{TextArea:ps}=O,gs=a=>{const i=ne(),r=async s=>{const{data:h}=await I.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelMessage",variables:{channelId:{value:parseInt(i.channelId),type:"Int",required:!0},message:{value:s.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(n=>(c.error("Error creating channel message"),{data:null})).then(n=>n);h&&(h.success?(c.success(h.message),a.onFinish(h.njiwaChannelMessage)):c.error(h.message))};return t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:s=>{r(s)},requiredMark:!0,children:[e.jsx(m.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(ps,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{TextArea:fs}=O,ys=a=>{ne();const i=async r=>{const{data:s}=await I.custom({url:"",method:"post",meta:{operation:"updateNjiwaChannelMessage",variables:{channelMessageId:{value:r.channel_message_id,type:"Int",required:!0},message:{value:r.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(h=>(c.error("Error creating channel message"),{data:null})).then(h=>h);s&&(s.success?(c.success(s.message),a.onFinish(s.njiwaChannelMessage)):c.error(s.message))};return t.useEffect(()=>{var r;a.form.setFieldsValue({message:(r=a==null?void 0:a.channelMessage)==null?void 0:r.message})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:r=>{var s;r.channel_message_id=(s=a.channelMessage)==null?void 0:s.id,i(r)},requiredMark:!0,children:[e.jsx(m.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(fs,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},Cs=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,d]=t.useState(!1),[l,u]=t.useState(!1),[p,F]=t.useState(20);t.useState(""),te();const[P,A]=t.useState(!1),[z,K]=t.useState(!1),[N,k]=t.useState(!1),[b]=m.useForm(),[C]=m.useForm(),[D]=m.useForm(),S=ne(),E=g=>{h(g),k(!0)},v=g=>{h(g),K(!0)},L=()=>{A(!0)},Q=async g=>{r([g,...i]),b.resetFields(),A(!1)},j=async g=>{r(i.map(T=>T.id.toString()===g.id.toString()?g:T)),C.resetFields(),K(!1)},R=async g=>{const{data:T}=await I.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannelMessage",variables:{channelMessageId:{value:g,type:"Int",required:!0}},fields:["success","message"]}});T.success?(c.success(T.message),r(i.filter(B=>B.id.toString()!==g.toString()))):c.error(T.message)},Z=async g=>{c("dispatching");const{data:T}=await I.custom({url:"",method:"post",meta:{operation:"dispatchChannelMessage",variables:{channelMessageId:{value:g,type:"Int",required:!0}},fields:["success","message"]}}).catch(B=>(c.error(B.message),{data:null})).then(B=>B);T&&(T.success?c.success(T.message):c.error(T.message))},re=g=>{ge.confirm({title:"Deleting Njiwa Channel Message",icon:e.jsx(fe,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>R(parseInt(g.toString()))})},ie=async(g,T,B=20)=>{const{data:o}=await I.custom({url:"",method:"get",meta:{operation:"njiwaChannelMessages",variables:{page:{value:g,type:"Int",required:!0},key:{value:T,type:"String",required:!1},pageSize:{value:B,type:"Int",required:!1},channelId:{value:parseInt(S.channelId),type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(x=>(c.error("Failed to fetch Channel Messages"),{data:null})).then(x=>x);o&&r(o.results),d(!1),u(!1)};return t.useEffect(()=>{ie(1,"",20)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(m,{layout:"vertical",form:D,onFinish:g=>{u(!0),ie(0,g.key,p)},children:e.jsx(m.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Channel Message(s)...",prefix:e.jsx(J,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(q,{size:"large",icon:e.jsx(J,{}),onClick:()=>{D.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(q,{size:"large",disabled:n||l,onClick:()=>{b.resetFields(),L()},children:[e.jsx(xe,{}),"Create Message"]})})]}),e.jsx(pe,{spinning:n,children:e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(me,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(q,{type:"primary",onClick:()=>{b.resetFields(),L()},children:"Create Message"})})}),i.map(g=>{var T;return e.jsx(f,{span:24,children:e.jsxs(_,{hoverable:g.isActive,style:{marginRight:10},children:[e.jsx(ae,{style:{right:0,position:"absolute"},children:e.jsx(de,{trigger:["click"],overlay:e.jsxs(U,{children:[e.jsx(U.Item,{icon:e.jsx(je,{}),onClick:()=>{v(g)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(U.Item,{icon:e.jsx(he,{}),onClick:()=>{re(g.id)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}),e.jsx(U.Item,{icon:e.jsx(Pe,{}),disabled:!(g!=null&&g.canDelete),children:e.jsx(ve,{title:"Are you sure to Start Sending/Dispatching SMS?",onConfirm:()=>Z(g.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch"})})}),e.jsx(U.Item,{icon:e.jsx(Be,{}),onClick:()=>{E(g)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:B=>B.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsxs(ae,{direction:"vertical",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsx("span",{children:g.message}),e.jsxs(ae,{direction:"horizontal",children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created On:"}),e.jsx("span",{style:{marginLeft:5},children:le(g.created).format("YYYY/MM/DD HH:MM")})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created By:"}),e.jsx("span",{style:{marginLeft:5},children:(T=g==null?void 0:g.creator)==null?void 0:T.fullName})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Channel:"}),e.jsx("span",{style:{marginLeft:5},children:g==null?void 0:g.channel.name})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Message Count:"}),e.jsx("span",{style:{marginLeft:5},children:e.jsx(Y,{color:"green",children:g==null?void 0:g.messageCount})})]})]})]})]})})})]})}),e.jsx($,{title:"Create Njiwa Channel Message",width:"40vw",open:P,onClose:g=>A(g),children:e.jsx(gs,{form:b,randKey:Math.random(),onFinish:Q})}),e.jsx($,{title:"Edit Njiwa Channel Message",width:"40vw",open:z,onClose:g=>K(g),children:e.jsx(ys,{form:C,randKey:Math.random(),onFinish:j,channelMessage:s})}),e.jsx($,{title:"Dispatch Report",width:"50vw",open:N,onClose:g=>k(g),children:e.jsx(De,{randKey:Math.random(),channelMessage:s})})]})},bs=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=ne(),d=async()=>{r(!0);const{data:l}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(u=>(c.error("Error fetching channel"),{data:null})).then(u=>u);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel Messages",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(y.Item,{children:e.jsxs(M,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Messages"})]})})}),e.jsx(Cs,{randKey:Math.random(),channel:s})]})},Ss=a=>{const i=ne(),{push:r}=te(),[s,h]=t.useState(!1),[n,d]=t.useState(),l=async()=>{h(!0);const{data:u}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannelAnalytic",variables:{channelId:{value:parseInt(i.channelId),type:"Int",required:!0}},fields:["analytics"]}}).catch(p=>(c.error("Error fetching analytics"),{data:null})).then(p=>p);u&&d(u.analytics),h(!1)};return t.useEffect(()=>{l()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(H,{style:{display:"flex",justifyContent:"center",marginTop:10},children:[e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{var u,p;return r("/njiwa/channel/"+((u=a.channel)==null?void 0:u.id)+"/"+((p=a.channel)==null?void 0:p.name)+"/phonenumbers")},children:e.jsx(_,{children:e.jsx(W,{title:"Phone Numbers",value:n==null?void 0:n.phone_numbers,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Emails",value:n==null?void 0:n.emails_addresses,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{var u,p;return r("/njiwa/channel/"+((u=a.channel)==null?void 0:u.id)+"/"+((p=a.channel)==null?void 0:p.name)+"/messages")},children:e.jsx(_,{children:e.jsx(W,{title:"Messages",value:n==null?void 0:n.messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Pending Messages",value:n==null?void 0:n.pending_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Sent Messages",value:n==null?void 0:n.sent_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Failed Messages",value:n==null?void 0:n.failed_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(G,{})})})})})]})})},vs=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=ne(),d=async()=>{r(!0);const{data:l}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(u=>(c.error("Error fetching channel"),{data:null})).then(u=>u);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa/channels",children:"Channels"})}),e.jsxs("span",{children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})]})})}),e.jsx(Ss,{randKey:Math.random(),channel:s})]})},ze=a=>{const[i,r]=t.useState([]),s=async n=>{const{data:d}=await I.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelsPhoneNumber",variables:{phoneNumber:{value:n.phoneNumber,type:"String",required:!0},name:{value:n.name,type:"String",required:!1},channels:{value:n.channels,type:"[Int]",required:!0}},fields:["success","message"]}}).catch(l=>(c.error("Error creating channels phone number"),{data:null})).then(l=>l);d&&(d.success?(c.success(d.message),a.onFinish(d.njiwaChannel)):c.error(d.message))},h=async(n,d,l=20)=>{const{data:u}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:n,type:"Int",required:!0},key:{value:d,type:"String",required:!1},pageSize:{value:l,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(p=>(c.error("Error fetching channels"),{data:null})).then(p=>p);u&&r(u.results)};return t.useEffect(()=>{h(1,"",50)},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:n=>{n.channels=a.channel?[a.channel.id]:[],s(n)},requiredMark:!0,autoComplete:"off",children:[e.jsx(m.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,type:"string",message:"Please input Phone Number"}],children:e.jsx(O,{size:"large",placeholder:"Enter Phone Number ..."})}),e.jsx(m.Item,{name:"name",label:"Full Name",rules:[{required:!1,type:"string",message:"Please input Full Name"}],children:e.jsx(O,{size:"large",placeholder:"Enter Full Name ..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},Ae=a=>{const i=async r=>{var h;const{data:s}=await I.custom({url:"",method:"post",meta:{operation:"updateNjiwaPhoneNumber",variables:{phoneNumberId:{value:(h=a.phoneNumber)==null?void 0:h.id,type:"Int",required:!0},phoneNumber:{value:r.phoneNumber,type:"String",required:!0},name:{value:r.name,type:"String",required:!1}},fields:["success","message",{phoneNumber:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(n=>(c.error("Error Updating Phone number"),{data:null})).then(n=>n);s&&(s.success?(c.success(s.message),a.onFinish(s.phoneNumber)):c.error(s.message))};return t.useEffect(()=>{var r,s;a.form.setFieldsValue({phoneNumber:(r=a.phoneNumber)==null?void 0:r.phoneNumber,name:(s=a.phoneNumber)==null?void 0:s.name})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,autoComplete:"off",children:[e.jsx(m.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,type:"string",message:"Please input Phone Number"}],children:e.jsx(O,{size:"large",placeholder:"Enter Phone Number ..."})}),e.jsx(m.Item,{name:"name",label:"Full Name",rules:[{required:!1,type:"string",message:"Please input Full Name"}],children:e.jsx(O,{size:"large",placeholder:"Enter Full Name ..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Update"})})]})})},{Option:ws}=be,Ns=a=>Array.isArray(a)?a:a==null?void 0:a.fileList,Te=a=>{const[i,r]=t.useState([]),s=async n=>{const{data:d}=await I.custom({url:"",method:"post",meta:{operation:"uploadNjiwaChannelsPhoneNumbers",variables:{channels:{value:n.channels,type:"[Int]",required:!0},file:{value:n.file,type:"Upload",required:!0}},fields:["success","message"]}}).catch(l=>(c.error("Error creating channels phone number"),{data:null})).then(l=>l);d&&(d.success?(c.success(d.message),a.onFinish(d.njiwaChannel)):c.error(d.message))},h=async(n,d,l=20)=>{const{data:u}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:n,type:"Int",required:!0},key:{value:d,type:"String",required:!1},pageSize:{value:l,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(p=>(c.error("Error fetching channels"),{data:null})).then(p=>p);u&&r(u.results)};return t.useEffect(()=>{h(1,"",50)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsxs("a",{target:"_blank",href:ee.base_url+"/static/templates/njiwa_channels_phone_numbers_template.xlsx",rel:"noreferrer",children:["Download Excel Template ",e.jsx(Je,{})]})}),e.jsxs(m,{layout:"vertical",form:a.form,onFinish:n=>{n.channels=n.channels.map(d=>parseInt(d)),s(n)},requiredMark:!0,autoComplete:"off",children:[e.jsx(m.Item,{label:"Contacts File(Excel)",children:e.jsx(m.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:Ns,noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload students excel file"}],children:e.jsxs($e.Dragger,{name:"file",accept:".xls, .xlsx",multiple:!1,beforeUpload:()=>!1,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(Qe,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload."})]})})}),e.jsx(m.Item,{name:"channels",label:"Channels",rules:[{required:!0,type:"array",message:"Please select Channel(s)..."}],children:e.jsx(be,{size:"large",mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"Please select",defaultValue:[],dropdownStyle:{zIndex:9999},children:i.map(n=>e.jsxs(ws,{value:n.id,children:[n.name,e.jsx("span",{style:{marginLeft:5},children:e.jsx(Y,{color:"green",children:n.code})})]},n.id))})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})]})},Is=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,d]=t.useState(!1),[l,u]=t.useState(!1),[p,F]=t.useState(20),[P,A]=t.useState(0),[z,K]=t.useState("");te();const[N,k]=t.useState(!1),[b,C]=t.useState(!1),[D,S]=t.useState(!1),[E]=m.useForm(),[v]=m.useForm(),[L]=m.useForm(),[Q]=m.useForm(),j=ne(),R=x=>{h(x),C(!0)},Z=()=>{k(!0)},re=async()=>{B(1,"",20),k(!1),E.resetFields()},ie=async x=>{r(i.map(w=>w.id.toString()===x.id.toString()?x:w)),v.resetFields(),C(!1)},g=async()=>{B(1,"",20),L.resetFields(),S(!1)},T=async x=>{const{data:w}=await I.custom({url:"",method:"post",meta:{operation:"deleteChannelPhoneNumber",variables:{id:{value:x,type:"Int",required:!0}},fields:["success","message"]}});w.success?(c.success(w.message),r(i.filter(V=>V.id.toString()!==x.toString()))):c.error(w.message)},B=async(x,w,V=20)=>{d(!0);const{data:X}=await I.custom({url:"",method:"get",meta:{operation:"njiwaChannelPhoneNumbers",variables:{page:{value:x,type:"Int",required:!0},key:{value:w,type:"String",required:!1},pageSize:{value:V,type:"Int",required:!1},channelId:{value:parseInt(j.channelId),type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id",{phoneContact:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]}]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(Ne=>(c.error("Error fetching phone numbers"),{data:null})).then(Ne=>Ne);X&&(A(X.total),r(X.results)),d(!1),u(!1)},o=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(x,w,V)=>e.jsx("a",{onClick:()=>{},children:w.phoneContact.phoneNumber})},{title:"Full Name",dataIndex:"fullName",key:"name",render:(x,w,V)=>e.jsx("span",{children:w.phoneContact.name})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(x,w,V)=>{var X;return e.jsx(Y,{color:"green",children:(X=w.phoneContact.carrier)==null?void 0:X.name})}},{title:"Created",dataIndex:"created",key:"created",render:(x,w,V)=>e.jsx(ce,{title:le(w.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:le(w.created).format("Y-mm-d hh:mm:ss")})})},{title:"",dataIndex:"Action",key:"action",render:(x,w,V)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(de,{trigger:["click"],overlay:e.jsxs(U,{children:[e.jsx(U.Item,{disabled:!w.canDelete,icon:e.jsx(he,{}),onClick:()=>{},children:e.jsx(ve,{placement:"topLeft",title:"Deleting Phone Number",onConfirm:()=>T(parseInt(w.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(U.Item,{disabled:!w.canEdit,icon:e.jsx(je,{}),onClick:()=>R(w),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:X=>X.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}];return t.useEffect(()=>{B(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:8,children:e.jsx(m,{layout:"vertical",form:Q,onFinish:x=>{u(!0),B(0,x.key,p)},children:e.jsx(m.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Phone Number(s)...",prefix:e.jsx(J,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(q,{size:"large",icon:e.jsx(J,{}),onClick:()=>{Q.submit()},loading:l||n,disabled:l||n})}),e.jsxs(f,{span:10,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(q,{size:"large",disabled:n||l,onClick:()=>{E.resetFields(),Z()},icon:e.jsx(xe,{}),children:"Add Phone Number"}),e.jsx(q,{size:"large",disabled:n||l,onClick:()=>S(!0),icon:e.jsx(Me,{}),children:"Upload Phone Numbers"})]})]}),e.jsx(Ce,{loading:n,columns:o,dataSource:i,pagination:{onChange:(x,w)=>{F(w),B(x,z,w)},total:P,pageSize:p,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}}),e.jsx($,{title:"Adding Phone Number",width:"40vw",open:N,onClose:x=>k(x),children:e.jsx(ze,{form:E,onFinish:re,randKey:Math.random(),channel:a.channel})}),e.jsx($,{title:"Editting Phone Number",width:"40vw",open:b,onClose:x=>C(x),children:e.jsx(Ae,{form:v,onFinish:ie,randKey:Math.random()})}),e.jsx($,{title:"Uploading Phone Numbers",width:"40vw",open:D,onClose:x=>S(x),children:e.jsx(Te,{form:L,onFinish:g,randKey:Math.random()})})]})},Fs=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=ne(),d=async()=>{r(!0);const{data:l}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(u=>(c.error("Error fetching channel"),{data:null})).then(u=>u);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Phone Numbers",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(y.Item,{children:e.jsxs(M,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Phone Numbers"})]})})}),e.jsx(Is,{randKey:Math.random(),channel:s})]})},ks=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Sent Messages"})})),Es=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=ne(),d=async()=>{r(!0);const{data:l}=await I.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(u=>(c.error("Error fetching channel"),{data:null})).then(u=>u);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Sent Messages",d()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(y.Item,{children:e.jsxs(M,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx(y.Item,{children:"Messages"}),e.jsx("span",{children:"Sent"})]})})}),e.jsx(ks,{randKey:Math.random(),channel:s})]})},Ps="/assets/nodata-fff54bfe.png",Ms=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,d]=t.useState(!1),[l,u]=t.useState(!1),[p,F]=t.useState(20);t.useState(""),te();const[P,A]=t.useState(!1),[z,K]=t.useState(!1),[N]=m.useForm();m.useForm();const[k]=m.useForm(),b=v=>{h(v),K(!0)},C=()=>{A(!0)},D=async v=>{const{data:L}=await I.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{id:{value:v,type:"Int",required:!0}},fields:["success","message"]}});L.success?(c.success(L.message),r(i.filter(Q=>Q.id.toString()!==v.toString()))):c.error(L.message)},S=v=>{ge.confirm({title:"Deleting Njiwa Email Address",icon:e.jsx(fe,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>D(parseInt(v.toString()))})},E=async(v,L,Q=20)=>{const{data:j}=await I.custom({url:"",method:"get",meta:{operation:"njiwaChannels",variables:{control:{value:!0,type:"Boolean",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","icon","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}});r(j.results),d(!1),u(!1)};return t.useEffect(()=>{E(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(m,{layout:"vertical",form:k,onFinish:v=>{u(!0),E(0,v.key,p)},children:e.jsx(m.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Channel(s)...",prefix:e.jsx(J,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(q,{size:"large",icon:e.jsx(J,{}),onClick:()=>{k.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(q,{size:"large",disabled:n||l,onClick:()=>{},children:[e.jsx(xe,{}),"Add Email Address"]})})]}),e.jsxs(H,{align:"top",children:[i.length===0&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(me,{image:Ps,imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(q,{type:"primary",onClick:()=>{N.resetFields(),C()},children:"Create Email Address Now"})})}),i.map(v=>e.jsx(f,{span:4,children:e.jsxs(_,{hoverable:v.isActive,style:{marginRight:10},children:[e.jsx(ae,{style:{right:0,position:"absolute"},children:e.jsx(de,{trigger:["click"],overlay:e.jsxs(U,{children:[e.jsx(U.Item,{icon:e.jsx(je,{}),onClick:()=>{b(v)},disabled:!(v!=null&&v.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(U.Item,{icon:e.jsx(he,{}),onClick:()=>{S(v.id)},disabled:!(v!=null&&v.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:L=>L.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsx(ae,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:v.emailAddress})]})}))]}),e.jsx($,{title:"Create Njiwa Email Address",width:"40vw",open:P,onClose:v=>A(v),children:e.jsx(we,{})})]})},Ds=()=>(t.useEffect(()=>{document.title=ee.system_name+": Emails"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx("span",{children:"Emails Addresses"})]})})}),e.jsx(Ms,{})]})),qs=()=>(t.useEffect(()=>{document.title=ee.system_name+": Messages"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx("span",{children:"Messages"})]})})}),e.jsx(qe,{})]})),zs=a=>(t.useEffect(()=>{},[]),e.jsx(e.Fragment,{children:e.jsx("span",{children:"Settings"})})),As=()=>(t.useEffect(()=>{document.title=ee.system_name+": Settings"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx("span",{children:"Settings"})]})})}),e.jsx(zs,{})]})),Ts=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,d]=t.useState(!1),[l,u]=t.useState(!1),[p,F]=t.useState(20),[P,A]=t.useState(0),[z,K]=t.useState("");te();const[N,k]=t.useState(!1),[b,C]=t.useState(!1),[D,S]=t.useState(!1),[E]=m.useForm(),[v]=m.useForm(),[L]=m.useForm(),[Q]=m.useForm(),j=o=>{h(o),C(!0)},R=()=>{k(!0)},Z=async()=>{T(1,"",20),k(!1),E.resetFields()},re=async o=>{r(i.map(x=>x.id.toString()===o.id.toString()?o:x)),v.resetFields(),C(!1)},ie=async()=>{T(1,"",20),L.resetFields(),S(!1)},g=async o=>{const{data:x}=await I.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{id:{value:o,type:"Int",required:!0}},fields:["success","message"]}});x.success?(c.success(x.message),r(i.filter(w=>w.id.toString()!==o.toString()))):c.error(x.message)},T=async(o,x,w=20)=>{d(!0);const{data:V}=await I.custom({url:"",method:"get",meta:{operation:"njiwaChannelsPhoneContacts",variables:{page:{value:o,type:"Int",required:!0},key:{value:x,type:"String",required:!1},pageSize:{value:w,type:"Int",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(X=>(c.error("Error fetching phone numbers"),{data:null})).then(X=>X);V&&(A(V.total),r(V.results)),d(!1),u(!1)},B=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(o,x,w)=>e.jsx("a",{onClick:()=>{},children:x.phoneNumber})},{title:"Full Name",dataIndex:"fullName",key:"name",render:(o,x,w)=>e.jsx("span",{children:x.name})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(o,x,w)=>{var V;return e.jsx(Y,{color:"green",children:(V=x.carrier)==null?void 0:V.name})}},{title:"Created",dataIndex:"created",key:"created",render:(o,x,w)=>e.jsx(ce,{title:le(x.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:le(x.created).format("Y-mm-d hh:mm:ss")})})},{title:"",dataIndex:"Action",key:"action",render:(o,x,w)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(de,{trigger:["click"],overlay:e.jsxs(U,{children:[e.jsx(U.Item,{disabled:!x.canDelete,icon:e.jsx(he,{}),onClick:()=>{},children:e.jsx(ve,{placement:"topLeft",title:"Deleting Phone Number",onConfirm:()=>g(parseInt(x.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(U.Item,{disabled:!x.canEdit,icon:e.jsx(je,{}),onClick:()=>j(x),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:V=>V.preventDefault(),children:e.jsx(ue,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}];return t.useEffect(()=>{T(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:8,children:e.jsx(m,{layout:"vertical",form:Q,onFinish:o=>{u(!0),T(0,o.key,p)},children:e.jsx(m.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Phone Number(s)...",prefix:e.jsx(J,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(q,{size:"large",icon:e.jsx(J,{}),onClick:()=>{Q.submit()},loading:l||n,disabled:l||n})}),e.jsxs(f,{span:10,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(q,{size:"large",disabled:n||l,onClick:()=>{E.resetFields(),R()},icon:e.jsx(xe,{}),children:"Add Phone Number"}),e.jsx(q,{size:"large",disabled:n||l,onClick:()=>S(!0),icon:e.jsx(Me,{}),children:"Upload Phone Numbers"})]})]}),e.jsx(Ce,{loading:n,columns:B,dataSource:i,pagination:{onChange:(o,x)=>{F(x),T(o,z,x)},total:P,pageSize:p,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}}),e.jsx($,{title:"Adding Phone Number",width:"40vw",open:N,onClose:o=>k(o),children:e.jsx(ze,{form:E,onFinish:Z,randKey:Math.random()})}),e.jsx($,{title:"Editting Phone Number",width:"40vw",open:b,onClose:o=>C(o),children:e.jsx(Ae,{phoneNumber:s,form:v,onFinish:re,randKey:Math.random()})}),e.jsx($,{title:"Uploading Phone Numbers",width:"40vw",open:D,onClose:o=>S(o),children:e.jsx(Te,{form:L,onFinish:ie,randKey:Math.random()})})]})},Ls=()=>(t.useEffect(()=>{document.title=ee.system_name+": Phone Numbers"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx("span",{children:"Phone Numbers"})]})})}),e.jsx(Ts,{})]})),_s=a=>{const[i,r]=t.useState([]);t.useState();const[s,h]=t.useState(!1),[n,d]=t.useState(!1),[l,u]=t.useState(20),[p,F]=t.useState(0),[P,A]=t.useState(1),[z,K]=t.useState("");te();const[N,k]=t.useState(!1);t.useState(!1),m.useForm(),m.useForm();const[b]=m.useForm(),C=async(S,E,v=20)=>{const{data:L}=await I.custom({url:"",method:"get",meta:{operation:"schoolNjiwaAccountBillings",variables:{control:{value:!0,type:"Boolean",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","created","updated","canEdit","canDelete","canManage"]}]}});r(L.results),F(L.total),A(L.page),h(!1),d(!1)},D=[{title:"Bill #",dataIndex:"billNumber",key:"billNumber"},{title:"Amount",dataIndex:"amount",key:"amount",render:(S,E)=>E.amount.toFixed(2)},{title:"Units",dataIndex:"units",key:"units"},{title:"Status",dataIndex:"status",key:"status",render:(S,E)=>E.isPaid?e.jsx(Y,{color:"green",children:"Paid"}):e.jsx(Y,{color:"red",children:"Unpaid"})}];return t.useEffect(()=>{C(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(m,{layout:"vertical",form:b,onFinish:S=>{d(!0),C(0,S.key,l)},children:e.jsx(m.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:n,placeholder:"Search Bill(s)...",prefix:e.jsx(J,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(q,{size:"large",icon:e.jsx(J,{}),onClick:()=>{b.submit()},loading:n||s,disabled:n||s})})]}),e.jsx(H,{children:e.jsx(f,{span:24,children:e.jsx(Se.Table,{dataSource:i,columns:D,pagination:{position:["bottomCenter"],pageSize:l,showSizeChanger:!0,showQuickJumper:!0,total:p,current:P,onChange:(S,E)=>{C(S,z,E)},onShowSizeChange:(S,E)=>{u(E),C(S,z,E)}}})})}),e.jsx($,{title:"Create Njiwa Email Address",width:"40vw",open:N,onClose:S=>k(S),children:e.jsx(we,{})})]})},Ks=()=>(t.useEffect(()=>{document.title=ee.system_name+": Emails"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsx(se,{children:e.jsxs(y,{children:[e.jsx(y.Item,{children:e.jsx(M,{to:"/",children:"Home"})}),e.jsx(y.Item,{children:e.jsx(M,{to:"/njiwa",children:"Njiwa"})}),e.jsx("span",{children:"Payments"})]})})}),e.jsx(_s,{})]})),Kt=a=>{const{page:i}=a;return i==="PhoneNumbersPage"?e.jsx(Ls,{}):i==="NjiwaSettingsPage"?e.jsx(As,{}):i==="MessagesPage"?e.jsx(qs,{}):i==="EmailsPage"?e.jsx(Ds,{}):i==="ChannelSentMessagesPage"?e.jsx(Es,{}):i==="ChannelPhoneNumbersPage"?e.jsx(Fs,{}):i==="ChannelPage"?e.jsx(vs,{}):i==="ChannelMessagesPage"?e.jsx(bs,{}):i==="ChannelFailedMessagesPage"?e.jsx(js,{}):i==="ChannelEmailsPage"?e.jsx(ms,{}):i==="ChannelsPage"?e.jsx(hs,{}):i==="NjiwaDashboardPage"?e.jsx(is,{}):i==="NjiwaPaymentsPage"?e.jsx(Ks,{}):e.jsx("div",{children:"Page not found ..."})};export{Kt as NjiwaPages};
