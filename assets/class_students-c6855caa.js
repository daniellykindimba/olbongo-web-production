import{r as a,aV as f,c as B,j as e,aZ as U,aR as N,a0 as E,cT as O,aw as S,c_ as re,d1 as Z,g as k,dn as ae,_ as d,d8 as $,j_ as ne,d2 as P,a_ as H,aT as oe,aW as y,cV as V,cv as le,dl as ie,cK as de,a7 as ce,b$ as W,cW as Y}from"./index-ccfcd4da.js";import{k as F}from"./data_objects-dd20071d.js";import{S as R}from"./Skeleton-a2d4f426.js";import{L as q}from"./index-885f566c.js";import{P as G}from"./index-27f5ca3f.js";import{A as z}from"./index-3bfb9ed3.js";import{T as J}from"./index-b8a04bf2.js";import{C as ue}from"./index-e733c2fd.js";import{A as he}from"./Alert-a74bd568.js";import{M as K}from"./index-65dd5ac4.js";import"./data_objects-ce8f5e44.js";import"./index-afc6ce50.js";import"./ActionButton-3b8e0c74.js";import"./transButton-719ccb9d.js";import"./index-a75cd6c4.js";import"./index-5c2e1e93.js";import"./InfoCircleFilled-f916d949.js";import"./DialogWrap-1d0538d4.js";import"./index-7da8bd4f.js";import"./fade-dd39912a.js";const me=n=>{const[u,h]=a.useState([]),[x,b]=a.useState(!0),[j,p]=a.useState(1),[_,C]=a.useState(0),[I,w]=a.useState(!0),[v]=f.useForm();B();const g=async(s,o="",l=!1)=>{const{data:r}=await k.custom({url:"",method:"get",meta:{operation:"darasaStudentsToAdd",variables:{page:{value:s,type:"Int",required:!0},key:{value:o,type:"String",required:!1},id:{value:parseInt(n.id===void 0?"0":n.id.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:ae}]}}).catch(()=>(d.error("Error fetching students"),{data:null})).then(T=>T);r&&(C(r.total),p(r.page),w(r.hasNext),h(r.results)),b(!1)},A=async s=>{const{data:o}=await k.custom({url:"",method:"post",meta:{operation:"createDarasaStudent",variables:{darasa:{value:parseInt(n.id===void 0?"0":n.id.toString()),type:"Int",required:!0},student:{value:parseInt(s===void 0?"0":s.toString()),type:"Int",required:!0}},fields:["success","message",{student:F}]}}).catch(()=>(d.error("Error adding student"),{data:null})).then(l=>l);o&&(o.success?(d.success(o.message),h(u.filter(l=>l.id!==s)),n.handleAddingStudent(o.student)):d.error(o.message))};return a.useEffect(()=>{g(j)},[n.random]),x?e.jsx(e.Fragment,{children:e.jsx(R,{loading:x,active:!0})}):e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsx(N,{span:24,children:e.jsx(f,{layout:"vertical",form:v,onFinish:s=>{p(0),g(0,s.key,!0)},children:e.jsx(f.Item,{name:"key",children:e.jsx(E,{size:"large",placeholder:"Search User(s)/Student(s) to Add ...",prefix:e.jsx(O,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsxs("div",{id:"scrollableDrivesToAdd",style:{height:"65vh",overflow:"auto"},children:[e.jsx(q,{dataSource:u,renderItem:s=>e.jsxs(q.Item,{actions:[e.jsx(G,{title:"Are you sure to Add  -"+s.fullName+" ?",onConfirm:()=>A(s.id),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(S,{icon:e.jsx(re,{}),children:"Add"})})],children:[e.jsx(z,{src:s.pic,style:{marginRight:10}}),s.fullName,e.jsx(Z,{}),e.jsx(J.Text,{mark:!0,children:s.email})]})}),I&&e.jsx(S,{onClick:()=>{g(j+1)},type:"primary",style:{margin:"auto",display:"block"},children:"Load More"})]})]})},xe=n=>{const[u,h]=a.useState([]),[x,b]=a.useState(!0),[j,p]=a.useState(1),[_,C]=a.useState(0),[I,w]=a.useState(!0),[v]=f.useForm();B();const g=async(s,o="",l=!1)=>{const{data:r}=await k.custom({url:"",method:"get",meta:{operation:"blockedDarasaStudents",variables:{page:{value:s,type:"Int",required:!0},key:{value:o,type:"String",required:!1},id:{value:parseInt(n.id===void 0?"0":n.id.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:F}]}}).catch(()=>(d.error("Error fetching students"),{data:null})).then(T=>T);r&&(C(r.total),p(r.page),w(r.hasNext),h(r.results)),b(!1)},A=async(s,o)=>{const{data:l}=await k.custom({url:"",method:"post",meta:{operation:"blockUnblockDarasaStudent",variables:{id:{value:parseInt(s.toString()),type:"Int",required:!0},blocked:{value:o,type:"Boolean",required:!0}},fields:["success","message",{darasaStudent:F}]}}).catch(()=>(d.error("Error Unblocking student"),{data:null})).then(r=>r);l&&(l.success?(d.success(l.message),h(u.filter(r=>r.id!==s)),n.handleUnblockingStudent(l.darasaStudent)):d.error(l.message))};return a.useEffect(()=>{g(j)},[n.random]),x?e.jsx(e.Fragment,{children:e.jsx(R,{loading:x,active:!0})}):e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsx(N,{span:24,children:e.jsx(f,{layout:"vertical",form:v,onFinish:s=>{p(0),g(0,s.key,!0)},children:e.jsx(f.Item,{name:"key",children:e.jsx(E,{size:"large",placeholder:"Search Blocked Students ...",prefix:e.jsx(O,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsxs("div",{id:"scrollableDrivesToAdd",style:{height:"65vh",overflow:"auto"},children:[e.jsx(q,{dataSource:u,renderItem:s=>{var o,l,r;return e.jsxs(q.Item,{actions:[e.jsx(G,{title:"Are you sure to Unblock  -"+s.user.fullName+" ?",onConfirm:()=>A(s.id,!1),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(S,{icon:e.jsx($,{}),children:"Unblock"})})],children:[e.jsx(z,{src:(o=s==null?void 0:s.user)==null?void 0:o.pic,style:{marginRight:10}}),(l=s==null?void 0:s.user)==null?void 0:l.fullName,e.jsx(Z,{}),e.jsx(J.Text,{mark:!0,children:(r=s==null?void 0:s.user)==null?void 0:r.email})]})}}),I&&e.jsx("div",{style:{textAlign:"center",marginTop:12,height:32,lineHeight:"32px"},children:e.jsx(S,{onClick:()=>g(j+1),disabled:!I,children:"Load More"})})]})]})},Be=n=>{const[u,h]=a.useState([]),[x,b]=a.useState(!0),[j,p]=a.useState(1),[_,C]=a.useState(0),[I,w]=a.useState(0),[v,g]=a.useState(!0),[A]=f.useForm();B();const[s,o]=a.useState(!1),[l,r]=a.useState(!1),T=()=>{o(!0)},D=async(t,i="",c=!1)=>{const{data:m}=await k.custom({url:"",method:"get",meta:{operation:"darasaStudents",variables:{page:{value:t,type:"Int",required:!0},key:{value:i,type:"String",required:!1},id:{value:parseInt(n.id===void 0?"0":n.id.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:F}]}}).catch(()=>(d.error("Error fetching students"),{data:null})).then(M=>M);m&&(w(m.total),C(m.pages),p(m.page),g(m.hasNext),h(m.results)),b(!1)},Q=async t=>{h([t,...u])},X=async t=>{const{data:i}=await k.custom({url:"",method:"post",meta:{operation:"deleteDarasaStudent",variables:{id:{value:parseInt(t.toString()),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(d.error("Error removing student"),{data:null})).then(c=>c);i&&(i.success?(d.success(i.message),h(u.filter(c=>c.id!==t))):d.error(i.message))},ee=async(t,i)=>{const{data:c}=await k.custom({url:"",method:"post",meta:{operation:"blockUnblockDarasaStudent",variables:{id:{value:parseInt(t.toString()),type:"Int",required:!0},blocked:{value:i,type:"Boolean",required:!0}},fields:["success","message",{darasaStudent:F}]}}).catch(()=>(d.error("Error blocking/unblocking student"),{data:null})).then(m=>m);if(c)if(c.success){d.success(c.message);const m=u.map(M=>M.id===t?c.darasaStudent:M);h(m)}else d.error(c.message)},te=t=>{const i=u.map(c=>c.id===t.id?t:c);h(i)},se=t=>{K.confirm({title:"Removing Student",icon:e.jsx(Y,{}),content:"Are you sure ...",okText:"Remove",cancelText:"Cancel",onOk:()=>X(t)})},L=(t,i)=>{K.confirm({title:i?"Blocking Student":"Unblocking Student",icon:e.jsx(Y,{}),content:"Are you sure ...",okText:i?"Block":"Unblock",cancelText:"Cancel",onOk:()=>ee(t,i)})};return a.useEffect(()=>{D(j)},[]),x?e.jsx(e.Fragment,{children:e.jsx(R,{loading:x,active:!0})}):e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx(N,{span:12,children:e.jsx(f,{layout:"vertical",form:A,onFinish:t=>{p(0),D(0,t.key,!0)},children:e.jsx(f.Item,{name:"key",children:e.jsx(E,{size:"large",placeholder:"Search Student(s)...",prefix:e.jsx(O,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(N,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(S,{size:"large",icon:e.jsx(ne,{}),onClick:T,disabled:!n.canManage,children:"Add Student"}),e.jsx(S,{size:"large",icon:e.jsx(P,{}),onClick:()=>r(!0),disabled:!n.canManage,children:"Blocked Students"})]})]}),e.jsxs("div",{id:"scrollableDiv",style:{height:"74vh",overflow:"auto"},children:[u.length>0?e.jsx(U,{align:"top",children:u.map(t=>e.jsx(N,{span:6,children:e.jsxs(ue,{hoverable:t.isActive,style:{marginRight:10,borderColor:t.blocked?"red":"#f0f0f0"},children:[e.jsx(H,{style:{right:0,position:"absolute"},children:e.jsx(oe,{trigger:["click"],overlay:e.jsxs(y,{children:[e.jsx(y.Item,{icon:e.jsx(V,{}),disabled:!t.isActive,children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"View"})}),e.jsx(y.Item,{icon:e.jsx(le,{}),onClick:()=>d("Under construction"),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Report"})}),e.jsx(y.Item,{icon:e.jsx(P,{}),onClick:()=>se(t.id),disabled:!t.canDelete,children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Remove"})}),t.blocked?e.jsx(y.Item,{icon:e.jsx($,{}),onClick:()=>L(t.id,!1),disabled:!t.canManage,children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Unblock"})}):e.jsx(y.Item,{icon:e.jsx(ie,{}),onClick:()=>L(t.id,!0),disabled:!t.canManage,children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Block"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:i=>i.preventDefault(),children:e.jsx(de,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsx("a",{children:e.jsxs(H,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center"},children:[e.jsx(z,{size:{xs:24,sm:32,md:40,lg:40,xl:40,xxl:80},icon:e.jsx(V,{}),src:t.user.pic}),e.jsx("span",{style:{fontSize:20},children:t.user.fullName})]})})]})}))}):e.jsx(he,{severity:"info",children:"No Student found for this class. Please add some students"}),v&&e.jsx("div",{style:{textAlign:"center",marginTop:12,height:32,lineHeight:"32px"},children:e.jsx(S,{onClick:()=>{D(j+1)},disabled:!v,children:x?e.jsx(ce,{}):e.jsx(e.Fragment,{children:e.jsx("span",{children:"Load More"})})})})]}),e.jsx(W,{title:"Adding Students",open:s,onClose:t=>o(t),width:"50vw",children:e.jsx(me,{id:n.id,random:Math.random(),handleAddingStudent:Q})}),e.jsx(W,{title:"Blocked Students",open:l,onClose:t=>r(t),width:"50vw",children:e.jsx(xe,{id:n.id,random:Math.random(),handleUnblockingStudent:te})})]})};export{Be as ClassStudents};
