import{r as u,aT as m,j as e,a1 as F,cm as v,av as T,g as C,_ as l,c as je,aW as S,aP as y,af as ye,aZ as I,aX as ve,aR as V,aU as x,cd as be,cl as P,a_ as Se,aS as Te}from"./index-3f04361d.js";import{d as J,C as Q}from"./ckeditor-21ed7852.js";import{o as w}from"./data_objects-c5a24b89.js";import{D as $}from"./index-70413df2.js";import{I as ee}from"./index-5c7d8a8d.js";import{G as Ce}from"./iconBase-aff00a5a.js";import{G as Ie}from"./index-5989b58d.js";import{C as k}from"./index-2ac5d61b.js";import{C as B,V as De}from"./VideoCameraOutlined-8e6a3881.js";import{C as te}from"./Collapse-62fa6c0a.js";import{M as H}from"./index-0f874ea4.js";import{S as Me}from"./SearchOutlined-ca526dda.js";import{F as ke}from"./FolderAddOutlined-ec272f13.js";import{B as Fe}from"./BookOutlined-f8a9c287.js";import{I as K}from"./InfoCircleOutlined-95ab394c.js";import{C as W}from"./CloseOutlined-7510ccf7.js";import{M as U}from"./MoreOutlined-d3af1bd1.js";import{P as we}from"./PlusCircleFilled-72045ac9.js";import{E as X}from"./ExclamationCircleOutlined-dc1ce38f.js";import"./data_objects-54e2a4fd.js";import"./index-c576a427.js";import"./index-a52eff82.js";import"./localeData-ee81be6c.js";import"./SwapRightOutlined-c4e52b1e.js";import"./SinglePicker-8226d477.js";import"./UpOutlined-7082c42f.js";import"./InputNumber-baf1c013.js";import"./Skeleton-4286ac29.js";import"./DotChartOutlined-f39c986e.js";import"./index-983365c0.js";import"./index-ee5ddf71.js";import"./InfoCircleFilled-cf97344e.js";import"./InfoCircleFilled-baaa675e.js";import"./ActionButton-1fdd8a6f.js";import"./DialogWrap-baa689d5.js";import"./index-0a6ac51b.js";import"./fade-4604162d.js";const ze=d=>{const[o,h]=u.useState(""),[c]=m.useForm(),p=async s=>{const{data:n}=await C.custom({url:"",method:"post",meta:{operation:"createDarasaTopic",variables:{darasaId:{value:parseInt(d.darasa),type:"Int",required:!0},title:{value:s.title,type:"String",required:!0},description:{value:s.description,type:"String",required:!0},startDate:{value:v(s.start_date).format("YYYY-MM-DD"),type:"String",required:!1},minutes:{value:s.minutes,type:"Int",required:!1}},fields:["success","message",{topic:w}]}}).catch(()=>(l.error("Error creating topic"),{data:null})).then(g=>g);n&&(n.success?(l.success(n.message),d.onFinish(n.topic),c.resetFields()):l.error(n.message))};return e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:c,onFinish:s=>{s.description=o,p(s)},onReset:()=>{h("")},requiredMark:!1,children:[e.jsx(m.Item,{name:"title",label:"Topic Title",rules:[{required:!0,type:"string",message:"Enter Topic Title ..."}],children:e.jsx(F,{size:"large",placeholder:"Enter Topic Title ..."})}),e.jsxs("div",{children:[e.jsx("h3",{children:"Description"}),e.jsx("div",{style:{marginBottom:10},children:e.jsx(J.CKEditor,{editor:Q,data:o,onReady:s=>{s.editing.view.change(n=>{n.setStyle("min-height","150px",s.editing.view.document.getRoot())})},onChange:(s,n)=>{const g=n.getData();h(g)},config:{toolbar:{items:["bold","italic","strikethrough","underline","code","subscript","superscript","removeFormat","|","bulletedList","numberedList","todoList","|","outdent","indent","|","-","fontSize","fontFamily","fontColor","fontBackgroundColor","highlight","|","alignment","|"],shouldNotGroupWhenFull:!0},fontFamily:{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0}}})})]}),e.jsx(m.Item,{label:"Start Date",name:"start_date",rules:[{required:!!c.getFieldValue("minutes"),type:"object",message:"Please select Start Date"}],children:e.jsx($,{size:"large",style:{width:"50%"},disabledDate:s=>s.add(1,"day")<v().endOf("day"),popupStyle:{zIndex:9999}})}),e.jsx(m.Item,{label:"Total Duration (Minutes)",name:"minutes",rules:[{required:!1,type:"number",message:"Please enter total duration in minutes"}],children:e.jsx(ee,{style:{width:"35%"},size:"large"})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(T,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},Ae=d=>{const[o,h]=u.useState(""),[c]=m.useForm(),p=async s=>{const{data:n}=await C.custom({url:"",method:"post",meta:{operation:"createDarasaSubtopic",variables:{topicId:{value:parseInt(d.topic.id),type:"Int",required:!0},title:{value:s.title,type:"String",required:!0},description:{value:s.description,type:"String",required:!0},startDate:{value:v(s.start_date).format("YYYY-MM-DD"),type:"String",required:!1},minutes:{value:s.minutes,type:"Int",required:!1}},fields:["success","message",{topic:w}]}}).catch(()=>(l.error("Error creating topic"),{data:null})).then(g=>g);n&&(n.success?(l.success(n.message),d.onFinish(n.topic),c.resetFields()):l.error(n.message))};return e.jsx(e.Fragment,{children:e.jsxs(m,{layout:"vertical",form:c,onFinish:s=>{s.description=o,p(s)},requiredMark:!1,children:[e.jsx(m.Item,{name:"title",label:"Topic Title",rules:[{required:!0,type:"string"}],children:e.jsx(F,{size:"large",placeholder:"Enter Topic Title ..."})}),e.jsxs("div",{children:[e.jsx("h3",{children:"Description"}),e.jsx("div",{style:{marginBottom:10},children:e.jsx(J.CKEditor,{editor:Q,data:o,onReady:s=>{s.editing.view.change(n=>{n.setStyle("min-height","150px",s.editing.view.document.getRoot())})},onChange:(s,n)=>{const g=n.getData();h(g)},config:{toolbar:{items:["bold","italic","strikethrough","underline","code","subscript","superscript","removeFormat","|","bulletedList","numberedList","todoList","|","outdent","indent","|","-","fontSize","fontFamily","fontColor","fontBackgroundColor","highlight","|","alignment","|"],shouldNotGroupWhenFull:!0},fontFamily:{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0}}})})]}),e.jsx(m.Item,{label:"Start Date",name:"start_date",rules:[{required:!1,type:"object",message:"Please select Start Date"}],children:e.jsx($,{size:"large",style:{width:"50%"},disabledDate:s=>s.add(1,"day")<v().endOf("day"),popupStyle:{zIndex:9999}})}),e.jsx(m.Item,{label:"Total Duration (Minutes)",name:"minutes",rules:[{required:!1,type:"number",message:"Enter Total Duration (Minutes)"}],children:e.jsx(ee,{style:{width:"50%"},size:"large"})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(T,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})};function qe(d){return Ce({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z"}},{tag:"path",attr:{d:"M8 4.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5zM8 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0 3a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-3.5 1.5a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"}}]})(d)}const{TreeNode:Z,DirectoryTree:Ee}=Se,{Panel:Re}=te,Tt=d=>{const[o,h]=u.useState([]),[c,p]=u.useState([]),[s,n]=u.useState(),[g,se]=u.useState(!0),[z,A]=u.useState(1),[Le,re]=u.useState(0),[Ne,ie]=u.useState(0),[q,ne]=u.useState(!0),[ae]=m.useForm(),[Ye,E]=u.useState(void 0);je();const R=!Ie.useBreakpoint().lg,[oe,L]=u.useState(!1),[le,N]=u.useState(!1),de=()=>{L(!0)},D=async(t,r="",i=!1)=>{const{data:a}=await C.custom({url:"",method:"get",meta:{operation:"darasaTopics",variables:{page:{value:t,type:"Int",required:!0},key:{value:r,type:"String",required:!1},id:{value:parseInt(d.id===void 0?"0":d.id.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:w}]}}).catch(f=>(console.log(f),l.error("Error fetching Topics"),{data:null})).then(f=>f);a&&(ie(a.total),re(a.pages),A(a.page),ne(a.hasNext),h(a.results),p(a.results)),se(!1)},ce=async t=>{const{data:r}=await C.custom({url:"",method:"post",meta:{operation:"deleteDarasaTopic",variables:{id:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(l.error("Error removing class Topic"),{data:null})).then(i=>i);r&&(r.success?(l.success(r.message),h(o.filter(i=>i.id!==t)),p(c.filter(i=>i.id!==t))):l.error(r.message))},ue=async(t,r)=>{const{data:i}=await C.custom({url:"",method:"post",meta:{operation:"deleteDarasaTopic",variables:{id:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(l.error("Error removing class Topic"),{data:null})).then(a=>a);if(i)if(i.success){l.success(i.message);const a=[...o],f=a.findIndex(j=>j.id===r),O=a[f].subtopics.findIndex(j=>j.id===t);O!==-1&&a[f].subtopics.splice(O,1),h(a);const G=[...c],M=a.findIndex(j=>j.id===r);if(M!==-1){const j=a[M].subtopics.findIndex(fe=>fe.id===t);j!==-1&&G[M].subtopics.splice(j,1),p(G)}}else l.error(i.message)},me=t=>{H.confirm({title:"Deleting Topic",icon:e.jsx(X,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>ce(t)})},pe=(t,r)=>{H.confirm({title:"Deleting Subtopic",icon:e.jsx(X,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>ue(t,r)})},b=t=>{n(t),N(!0)},he=async t=>{h([t,...o]),c.length===o.length&&p([t,...c])},xe=async t=>{h(o.map(r=>r.id===t.id?t:r)),p(c.map(r=>r.id===t.id?t:r))},Y=t=>{const r=o.filter(i=>parseInt(i.id.toString())===parseInt(t));p(r)},_=()=>e.jsx(Te,{description:"No topic Registered ..."}),ge=t=>t.subtopics.map(r=>e.jsx(Re,{extra:[e.jsx("div",{style:{right:0,zIndex:99999},children:e.jsx(V,{trigger:["click"],overlay:e.jsxs(x,{children:[e.jsx(x.Item,{icon:e.jsx(K,{}),onClick:()=>l("Under construction"),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Report"})}),e.jsx(x.Item,{icon:e.jsx(W,{}),onClick:()=>pe(r.id,t.id),disabled:!d.canManage,children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Remove"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:i=>i.preventDefault(),children:e.jsx(U,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})],header:e.jsx("div",{children:e.jsxs("span",{children:[r.title,r.minutes>0&&e.jsxs(I,{color:"green",children:[r.minutes," ",r.minutes>1?"Mins":"Min"]})]})}),children:e.jsx("div",{dangerouslySetInnerHTML:{__html:r.description}})},r.id));return u.useEffect(()=>{D(z)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsx(y,{span:6,children:e.jsxs(k,{style:{marginRight:5},children:[o.length===0&&e.jsx(e.Fragment,{children:_()}),e.jsx(Ee,{multiple:!0,defaultExpandedKeys:[],onExpand:(t,r)=>{const i=r.node.key;if(i&&i.toString().includes("topic")){E(i);const a=i.toString().split("-")[1];Y(a)}else if(!(i&&i.toString().includes("sub")))p(o);else{const a=i.toString().split(":")[0];E(a);const f=a.toString().split("-")[1];Y(f)}},children:o.map((t,r)=>e.jsx(Z,{icon:e.jsx(B,{}),title:t.title,children:t.subtopics.map(i=>e.jsx(Z,{icon:e.jsx(B,{}),title:i.title},"topic-"+t.id+":sub-"+i.id))},"topic-"+t.id))})]})}),e.jsxs(y,{span:18,children:[e.jsxs(S,{children:[e.jsx(y,{span:12,children:e.jsx(m,{layout:"vertical",form:ae,onFinish:t=>{A(0),D(0,t.key,!0)},children:e.jsx(m.Item,{name:"key",children:e.jsx(F,{size:"large",placeholder:"Search Topics(s)...",prefix:e.jsx(Me,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(y,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(T,{icon:e.jsx(ke,{}),size:"large",onClick:de,disabled:!d.canManage,children:"Add Topic"})})]}),e.jsxs("div",{id:"scrollableDiv",style:{height:"74vh",overflow:"auto"},children:[c.length>0?e.jsx(S,{align:"top",children:c.map((t,r)=>e.jsx(y,{span:24,style:{marginTop:r===0?0:10},children:e.jsxs(k,{hoverable:t.isActive,style:{marginRight:10},title:e.jsxs("div",{children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontSize:22},children:t.title}),t.minutes>0&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(ye,{color:"green",title:e.jsxs(e.Fragment,{children:[e.jsxs(I,{children:["Starts:"," ",v(t.startDate).format("DD/MM/YYYY hh:mm a")]}),e.jsxs(I,{children:["Ends:"," ",v(t.endDate).format("DD/MM/YYYY hh:mm a")]})]}),children:e.jsxs(I,{color:"green",children:[t.minutes," ",t.minutes>1?"Mins":"Min"]})})})]}),e.jsx(ve,{style:{right:0,position:"absolute"},children:e.jsx(V,{trigger:["click"],overlay:e.jsxs(x,{children:[e.jsx(x.Item,{icon:e.jsx(be,{}),disabled:!t.canManage,children:e.jsx("a",{onClick:()=>b(t),children:"Add Subtopics"})}),e.jsx(x.Item,{icon:e.jsx(Fe,{}),disabled:!0,children:e.jsx("a",{onClick:()=>b(t),children:"Add Documents"})}),e.jsx(x.Item,{icon:e.jsx(De,{}),disabled:!0,children:e.jsx("a",{onClick:()=>b(t),children:"Add Videos"})}),e.jsx(x.Item,{icon:e.jsx(qe,{}),disabled:!0,children:e.jsx("a",{onClick:()=>b(t),children:"Add Audios"})}),e.jsx(x.Item,{icon:e.jsx(K,{}),onClick:()=>l("Under construction"),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Report"})}),e.jsx(x.Item,{icon:e.jsx(W,{}),onClick:()=>me(t.id),disabled:!d.canManage,children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Remove"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:i=>i.preventDefault(),children:e.jsx(U,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})]}),children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:t.description}}),t.subtopics.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsxs(y,{span:24,style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{fontSize:20,fontWeight:"bolder"},children:"Subtopics"}),t.canManage&&e.jsx(T,{disabled:!t.canManage,icon:e.jsx(we,{}),onClick:()=>b(t),children:"Add Subtopic"})]})}),e.jsx(te,{defaultActiveKey:["1"],accordion:!0,children:ge(t)})]})]})}))}):e.jsx(k,{children:e.jsx(S,{justify:"center",children:e.jsx(y,{children:_()})})}),q&&e.jsx("div",{style:{textAlign:"center",marginTop:12,height:32,lineHeight:"32px"},children:e.jsx(T,{onClick:()=>D(z+1),disabled:!q,children:"Load More"})})]})]})]}),e.jsx(P,{title:"Adding Topics",open:oe,onClose:t=>L(t),width:R?"100vw":"50vw",children:e.jsx(ze,{darasa:d.id,onFinish:he})}),e.jsx(P,{title:"Add Subtopics to "+(s==null?void 0:s.title),open:le,onClose:t=>N(t),width:R?"100vw":"50vw",children:e.jsx(Ae,{topic:s,onFinish:xe})})]})};export{Tt as ClassTopics};
