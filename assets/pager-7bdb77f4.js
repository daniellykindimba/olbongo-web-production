import{r as s,c as L,j as e,G as F,a8 as oe,aS as ee,av as w,ce as te,aZ as $,B as K,aX as J,af as G,aW as q,aP as N,P as se,cl as re,a1 as H,g as M,_ as j,cn as U,cL as W,aN as g,aT as I,aY as de,cd as fe,aR as be,aU as _,aV as ye,aO as ke,cB as Q,cM as ne,F as me,cN as Ae,cO as we}from"./index-7ac8fc92.js";import{B as ue}from"./book_payment_form-28f6e23f.js";import{C as Z}from"./index-0a7ff63a.js";import{M as ve,S as De,a as Fe}from"./StarOutlined-b0fb3bb5.js";import{A as ie}from"./index-76c73f07.js";import{A as ae}from"./index-a283429b.js";import{D as le}from"./index-1974f517.js";import{P as ze}from"./pdf_document_viewer-ec055d52.js";import{D as Oe}from"./DownloadOutlined-7fe85224.js";import{M as Se}from"./MoreOutlined-4666e32c.js";import{R as pe}from"./ReadOutlined-fd67fd82.js";import{I as Ee}from"./InfoCircleOutlined-4fbda646.js";import{L as ce}from"./index-537ec24f.js";import{P as X}from"./index-c1edda26.js";import{S as Me}from"./Skeleton-a1e70c5e.js";import{I as qe}from"./InfoOutlined-3f71cb3a.js";import{D as V}from"./index-191c0328.js";import{D as he}from"./DeleteOutlined-044ab42c.js";import{P as Le}from"./PrinterOutlined-b78fb790.js";import{d as Pe,C as Be}from"./ckeditor-dc340c5c.js";import{U as Ce}from"./index-3b39667f.js";import{I as Ie}from"./InboxOutlined-c2b4e4a6.js";import{I as Ne}from"./index-5ca754e2.js";import{G as Re}from"./index-3cb2cad1.js";import{F as Ve}from"./FolderOpenFilled-5140edf8.js";import"./index-3e999fd0.js";import"./InfoCircleFilled-72907a72.js";import"./InfoCircleFilled-baaa675e.js";import"./index-0e10b20d.js";import"./StarFilled-ce1748cd.js";import"./index-03a70552.js";import"./DownloadOutlined-6cd35f11.js";import"./ActionButton-c3339e52.js";import"./DotChartOutlined-f39c986e.js";import"./DeleteOutlined-25685737.js";import"./Upload-8fd33b7d.js";import"./fade-4eb0cb8a.js";import"./UpOutlined-7082c42f.js";import"./InputNumber-d54b24aa.js";const{Search:He}=H,Te=r=>{const[f,k]=s.useState(!1),[z,B]=s.useState(0),[T,D]=s.useState(0),[A,O]=s.useState(1),[y,C]=s.useState([]),[v,E]=s.useState(),[P,S]=s.useState(!1);L();const i=o=>{E(o),S(!0)},b=async o=>{const{data:x}=await M.custom({url:"",method:"post",meta:{operation:"addBookToReadings",variables:{bookId:{value:o,type:"Int",required:!0}},fields:["success","message",{book:["id","title","description","file","cover","price","downloadable","publisherCanAddToReadings","created","updated","isActive","isPublic","canEdit","canDelete","canManage","inLibrary",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}}).catch(()=>(j.error("Error deleting book"),{data:null})).then(c=>c);x&&(x.success?(j.success(x.message),C(y.map(c=>c.id===o?x.book:c))):j.error(x.message))},u=async(o,x="")=>{k(!0);const{data:c}=await M.custom({url:"",method:"get",meta:{operation:"marketplaceBooks",variables:{page:{value:o,type:"Int",required:!0},key:{value:x,type:"String",required:!1},public:{value:r.public,type:"Boolean",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","orderPaid","canEdit","canDelete","canManage","inLibrary",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}}).catch(()=>(j.error("Error getting Books"),{data:null})).then(m=>m);c&&(B(c.total),D(c.pages),O(c.page),C(c.results)),k(!1)};return s.useEffect(()=>{u(A,"")},[r.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(F,{container:!0,spacing:0,sx:{display:"flex",justifyContent:"flex-start"},children:e.jsx(F,{item:!0,xs:12,sm:12,md:4,lg:4,xl:4,children:e.jsx(He,{size:"large",placeholder:"Search Book(s) ...",onSearch:o=>u(1,o),style:{width:"100%"}})})}),e.jsxs("div",{style:{maxHeight:"calc(100vh - 150px)",overflowY:"auto"},children:[e.jsx(oe,{spinning:f,children:e.jsxs(F,{container:!0,spacing:0,children:[y.length===0&&f&&e.jsx(e.Fragment,{children:e.jsx(F,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:e.jsx(ee,{description:"Loading Books"})})}),y.length===0&&!f&&e.jsx(e.Fragment,{children:e.jsx(F,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:e.jsx(ee,{description:"No Book Published"})})}),y.map(o=>e.jsx(F,{item:!0,xs:12,sm:12,md:6,lg:6,xl:6,children:e.jsx(Z,{hoverable:!0,bordered:!0,style:{margin:"2px"},type:"inner",actions:[e.jsxs("span",{style:{fontSize:"18px",display:o.price>0?"block":"none"},children:[o.price," Tsh"]}),e.jsx("span",{style:{float:"right",marginRight:"10px",display:"flex"},children:o.isPublic?e.jsx(w,{disabled:o.inLibrary,size:"large",icon:e.jsx(te,{}),onClick:()=>b(o.id),children:"Add to Readings"}):e.jsxs(e.Fragment,{children:[o.orderPaid&&e.jsx(e.Fragment,{children:e.jsx($,{color:"green",children:"Already Purchased"})}),!o.orderPaid&&e.jsx(w,{size:"large",icon:e.jsx(ve,{}),onClick:()=>i(o),children:"Buy"})]})})],children:e.jsxs(F,{container:!0,spacing:0,children:[e.jsx(F,{item:!0,xs:12,sm:12,md:4,sx:{backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+o.cover+")"},children:e.jsx(K,{sx:{display:{xs:"block",md:"none"},height:100,width:"100%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+o.cover+")"}})}),e.jsx(F,{item:!0,xs:12,sm:12,md:8,children:e.jsx(K,{style:{padding:"10px"},children:e.jsxs(J,{direction:"vertical",children:[e.jsx("a",{children:e.jsx("h3",{children:o.title.length>50?o.title.substring(0,50)+"...":o.title})}),e.jsx("p",{children:o.description.replace(/(<([^>]+)>)/gi,"").length>100?o.description.replace(/(<([^>]+)>)/gi,"").substring(0,100)+"...":o.description.replace(/(<([^>]+)>)/gi,"")}),e.jsx("div",{children:e.jsx(J,{children:e.jsx(G,{title:"Click to View Author Profile",children:e.jsxs("a",{children:[e.jsx(ie,{size:"small",src:o.author.pic}),e.jsx("span",{style:{marginLeft:"10px"},children:o.author.fullName})]})})})})]})})})]})})}))]})}),y.length>0&&e.jsx(q,{children:e.jsx(N,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(se,{defaultCurrent:A,total:z})})})]}),e.jsx(re,{title:"Purchase Book",open:P,onClose:o=>S(o),width:"40vw",children:e.jsx(ue,{book:v,randKey:Math.random(),onFinish:()=>{S(!1),u(1,"")}})})]})},Ke=()=>{const{push:r}=L();return s.useEffect(()=>{document.title=U.system_name+": Books MarketPlace"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(W,{children:e.jsxs(g,{children:[e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/"),children:"Home"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib"),children:"Olib"})}),e.jsx(g.Item,{children:"Books MarketPlace"})]})})}),e.jsx(Te,{public:!1,randKey:Math.random()})]})},_e=()=>{const{push:r}=L();return s.useEffect(()=>(document.title=U.system_name+": Public Books",document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(W,{children:e.jsxs(g,{children:[e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/"),children:"Home"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib"),children:"Olib"})}),e.jsx(g.Item,{children:"Public Books"})]})})}),e.jsx(Te,{public:!0,randKey:Math.random()})]})},{Search:Ge}=H,Ue=r=>{const[f,k]=s.useState(!1),[z,B]=s.useState(0),[T,D]=s.useState(0),[A,O]=s.useState(1),[y,C]=s.useState(25),[v,E]=s.useState(""),[P,S]=s.useState([]);s.useState(),I.useForm(),s.useState(!1);const[i,b]=s.useState(!1);L();const u=async(x,c="",m=25)=>{k(!0);const{data:h}=await M.custom({url:"",method:"get",meta:{operation:"authorBooksPurchases",variables:{page:{value:x,type:"Int",required:!0},key:{value:c,type:"String",required:!1},pageSize:{value:m,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","price","paymentDate","receiptNumber","isPaid",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]},{user:["id","firstName","middleName","lastName"]},{bill:["id","billNumber"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(l=>(j.error("Error getting Bills"),{data:null})).then(l=>l);h&&(B(h.total),D(h.pages),O(h.page),S(h.results)),k(!1)},o=[{title:"Bill#",dataIndex:"billNumber",fixed:!0,render:(x,c,m)=>{var h;return e.jsx("span",{children:e.jsx("a",{children:(h=c==null?void 0:c.bill)==null?void 0:h.billNumber})})}},{title:"Book Title",dataIndex:"bookTitle",fixed:!0,render:(x,c,m)=>{var h;return e.jsx("span",{children:e.jsx("a",{children:(h=c==null?void 0:c.book)==null?void 0:h.title})})}},{title:"Amount",dataIndex:"billAmount",fixed:!0,render:(x,c,m)=>e.jsxs("span",{children:[c.price," Tsh"]})}];return s.useEffect(()=>{u(A,"",25)},[r.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{offsetTop:75,children:e.jsxs(q,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:[e.jsx(N,{span:10,children:e.jsx(Ge,{size:"large",placeholder:"Search Disbursement(s) ...",onSearch:x=>u(1,x,25),style:{width:"100%"}})}),e.jsx(N,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{icon:e.jsx(te,{}),size:"large",onClick:()=>b(!0),children:"Create Disbursement"})})]})}),e.jsx(q,{children:e.jsx(N,{span:24,children:e.jsx(de,{loading:f,columns:o,dataSource:P,pagination:{onChange:(x,c)=>{C(c),u(x,v,c)},total:z,pageSize:y,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})})}),e.jsx(re,{title:"Creating Dibursement",width:"35vw",open:i,onClose:x=>b(x),children:e.jsx("p",{children:"Creating Dibursement"})})]})},We=()=>{const{push:r}=L();return s.useEffect(()=>{document.title=U.system_name+": Books Purchases Disbursement"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(W,{children:e.jsxs(g,{children:[e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/"),children:"Home"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib"),children:"Olib"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib/publish/books"),children:"Published Books"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib/books/purchases"),children:"Books Purchases"})}),e.jsx(g.Item,{children:"Books Purchases Disbursement"})]})})}),e.jsx(Ue,{})]})},{Search:Ye}=H,$e=r=>{const[f,k]=s.useState(!1),[z,B]=s.useState(0),[T,D]=s.useState(0),[A,O]=s.useState(1),[y,C]=s.useState(25),[v,E]=s.useState(""),[P,S]=s.useState([]),[i,b]=s.useState();I.useForm();const[u,o]=s.useState(!1),{push:x}=L(),c=async(h,l="",n=25)=>{k(!0);const{data:t}=await M.custom({url:"",method:"get",meta:{operation:"authorBooksPurchases",variables:{page:{value:h,type:"Int",required:!0},key:{value:l,type:"String",required:!1},pageSize:{value:n,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","price","paymentDate","receiptNumber","isPaid",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]},{user:["id","firstName","middleName","lastName"]},{bill:["id","billNumber"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(d=>(j.error("Error getting Bills"),{data:null})).then(d=>d);t&&(B(t.total),D(t.pages),O(t.page),S(t.results)),k(!1)},m=[{title:"Bill#",dataIndex:"billNumber",fixed:!0,render:(h,l,n)=>{var t;return e.jsx("span",{children:e.jsx("a",{children:(t=l==null?void 0:l.bill)==null?void 0:t.billNumber})})}},{title:"Book Title",dataIndex:"bookTitle",fixed:!0,render:(h,l,n)=>{var t;return e.jsx("span",{children:e.jsx("a",{children:(t=l==null?void 0:l.book)==null?void 0:t.title})})}},{title:"Amount",dataIndex:"billAmount",fixed:!0,render:(h,l,n)=>e.jsxs("span",{children:[l.price," Tsh"]})}];return s.useEffect(()=>{c(A,"",25)},[r.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{offsetTop:75,children:e.jsxs(q,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:[e.jsx(N,{span:10,children:e.jsx(Ye,{size:"large",placeholder:"Search Purchase(s) ...",onSearch:h=>c(1,h,25),style:{width:"100%"}})}),e.jsx(N,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{icon:e.jsx(fe,{}),size:"large",onClick:()=>x("/olib/books/purchases/disbursements"),children:"Disbursement"})})]})}),e.jsx(q,{children:e.jsx(N,{span:24,children:e.jsx(de,{loading:f,columns:m,dataSource:P,pagination:{onChange:(h,l)=>{C(l),c(h,v,l)},total:z,pageSize:y,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})})}),e.jsx(re,{title:"Order Details & Payment",open:u,width:"50vw",onClose:h=>o(h),children:e.jsx(ue,{book:i==null?void 0:i.book})})]})},Ze=()=>{const{push:r}=L();return s.useEffect(()=>{document.title=U.system_name+": Books Purchases"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(W,{children:e.jsxs(g,{children:[e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/"),children:"Home"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib"),children:"Olib"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib/publish/books"),children:"Published Books"})}),e.jsx(g.Item,{children:"Books Purchases"})]})})}),e.jsx($e,{})]})},{Search:Xe}=H,Je=r=>{const[f,k]=s.useState(!1),[z,B]=s.useState(!1),[T,D]=s.useState(),[A,O]=s.useState(0),[y,C]=s.useState(0),[v,E]=s.useState(1),[P,S]=s.useState([]),[i,b]=s.useState(),[u,o]=s.useState(!1);I.useForm();const{push:x}=L(),c=t=>{b(t),o(!0)},m=async(t,d="")=>{k(!0);const{data:p}=await M.custom({url:"",method:"get",meta:{operation:"userBooks",variables:{page:{value:t,type:"Int",required:!0},key:{value:d,type:"String",required:!1},pageSize:{value:20,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","averageRating","downloadable","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}]}}).catch(()=>(j.error("Error getting Books"),{data:null})).then(a=>a);p&&(O(p.total),C(p.pages),E(p.page),S(p.results)),k(!1)},h=async()=>{B(!0);const{data:t}=await M.custom({url:"",method:"get",meta:{operation:"olibDashboardAnalytics",fields:["analytics"]}}).catch(()=>(j.error("Error fetching analytics"),{data:null})).then(d=>d);t&&D(t.analytics),B(!1)},l=async(t,d)=>{const{data:p}=await M.custom({url:"",method:"post",meta:{operation:"createBookRating",variables:{bookId:{value:d,type:"Int",required:!0},rating:{value:t,type:"Int",required:!0}},fields:["success","message",{userBook:["id",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","averageRating","downloadable","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}]}}).catch(a=>(console.log(a),{data:null})).then(a=>a);if(p){const a=P.map(R=>R.id===p.userBook.id?p.userBook:R);S(a)}},n=(t,d)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Rated: "}),e.jsxs("span",{children:[[1,2,3,4,5].map(p=>e.jsx("span",{style:{marginRight:5},children:p<=t?e.jsx(G,{title:p,children:e.jsx("a",{onClick:()=>{l(p,d)},style:{display:"inline"},children:e.jsx(De,{style:{color:"orange"}})})}):e.jsx(G,{title:p,children:e.jsx("a",{onClick:()=>{l(p,d)},style:{display:"inline"},children:e.jsx(Fe,{})})})})),e.jsx($,{color:"green",children:t})]})]});return s.useEffect(()=>{h(),m(v,"")},[r.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(K,{children:e.jsxs(F,{container:!0,spacing:0,children:[e.jsx(F,{item:!0,xs:6,sm:6,md:2,children:e.jsx("a",{onClick:()=>x("/olib"),children:e.jsxs(Z,{children:[e.jsx($,{children:T==null?void 0:T.my_books})," Books To Read"]})})}),e.jsx(F,{item:!0,xs:6,sm:6,md:2,children:e.jsx("a",{onClick:()=>x("/olib/books/public"),children:e.jsxs(Z,{style:{cursor:"pointer"},children:[e.jsx($,{children:T==null?void 0:T.public_books})," Public Books"]})})})]})}),e.jsx(ae,{offsetTop:75,children:e.jsx(K,{sx:{display:"flex",justifyContent:"center",mt:1,mb:1},children:e.jsx(F,{container:!0,spacing:0,sx:{display:"flex",justifyContent:"flex-start"},children:e.jsx(F,{item:!0,xs:12,sm:4,md:6,children:e.jsx(Xe,{size:"large",placeholder:"Enter Book Title, Description to search ...",onSearch:t=>m(1,t),style:{width:"100%"}})})})})}),e.jsx("div",{style:{maxHeight:"calc(100vh - 240px)",overflowY:"auto"},children:e.jsxs(oe,{spinning:f,children:[e.jsxs(F,{container:!0,spacing:0,children:[P.length===0&&!f&&e.jsx(e.Fragment,{children:e.jsx(F,{item:!0,xs:12,sm:12,md:12,children:e.jsx(ee,{description:"No Book Published"})})}),P.map(t=>e.jsx(F,{item:!0,xs:12,sm:12,md:6,children:e.jsx(Z,{hoverable:!0,bordered:!0,style:{margin:"2px"},type:"inner",actions:[e.jsx("span",{children:n(t.book.averageRating,t.book.id)}),e.jsxs("span",{style:{float:"right",marginRight:"10px",display:"flex"},children:[t.book.downloadable&&e.jsx(w,{icon:e.jsx(Oe,{}),children:e.jsx("a",{href:t.book.file,target:"_blank",download:!0,children:"Download"})}),e.jsx(w,{style:{marginRight:"10px"},icon:e.jsx(pe,{}),onClick:()=>c(t),children:"Read"}),e.jsx(be,{trigger:["click"],overlay:e.jsxs(_,{children:[e.jsx(_.Item,{icon:e.jsx(pe,{}),onClick:()=>c(t),children:e.jsx("a",{rel:"noopener noreferrer",children:"Read"})}),e.jsx(_.Item,{icon:e.jsx(Ee,{}),onClick:()=>j("Under construction"),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:d=>d.preventDefault(),children:e.jsx(Se,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})]})],children:e.jsxs(F,{container:!0,spacing:0,children:[e.jsx(F,{item:!0,xs:12,sm:12,md:4,sx:{backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+t.book.cover+")"},children:e.jsx(K,{sx:{display:{xs:"block",md:"none"},height:100,width:"100%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+t.book.cover+")"}})}),e.jsx(F,{item:!0,xs:12,sm:12,md:8,children:e.jsx(K,{style:{padding:"10px"},children:e.jsxs(J,{direction:"vertical",children:[e.jsx("a",{children:e.jsx("h3",{children:t.book.title.length>50?t.book.title.substring(0,50)+"...":t.book.title})}),e.jsx("p",{children:t.book.description.replace(/(<([^>]+)>)/gi,"").length>100?t.book.description.replace(/(<([^>]+)>)/gi,"").substring(0,100)+"...":t.book.description.replace(/(<([^>]+)>)/gi,"")}),e.jsx("div",{children:e.jsx(J,{children:e.jsx(G,{title:"Click to View Author Profile",children:e.jsxs("a",{children:[e.jsx(ie,{size:"small",src:t.book.author.pic}),e.jsx("span",{style:{marginLeft:"10px"},children:t.book.author.fullName})]})})})})]})})})]})})}))]}),e.jsx(q,{children:e.jsx(N,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(se,{defaultCurrent:v,total:A,defaultPageSize:20,onChange:t=>{E(t),m(t,"")}})})})]})}),e.jsx(le,{title:i==null?void 0:i.book.title,anchor:"right",width:"80vw",onClose:t=>o(t),open:u,noOverFlow:!0,children:e.jsx(ze,{url:i==null?void 0:i.book.file,onFullWidth:()=>{alert("fullWidth")}})})]})},Qe=()=>{const{push:r}=L();return s.useEffect(()=>(document.title=U.system_name+": Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(W,{children:e.jsxs(g,{children:[e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/"),children:"Home"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib"),children:"Olib"})}),e.jsx(g.Item,{children:"Dashboard"})]})})}),e.jsx(Je,{})]})},{Search:et}=H,tt=r=>{const[f,k]=s.useState(!0),[z,B]=s.useState(!1),[T,D]=s.useState(0),[A,O]=s.useState(0),[y,C]=s.useState(1),[v,E]=s.useState(25),[P,S]=s.useState(""),[i,b]=s.useState(!1),[u,o]=s.useState([]);L();const x=async(m,h="",l=25)=>{B(!0);const{data:n}=await M.custom({url:"",method:"get",meta:{operation:"booksAuthorsToAdd",variables:{page:{value:m,type:"Int",required:!0},key:{value:h,type:"String",required:!1},pageSize:{value:l,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","firstName","middleName","lastName","fullName","email","pic","isActive","created","updated","canDelete","canManage"]}]}}).catch(()=>(j.error("Error getting authors"),{data:null})).then(t=>t);n&&(D(n.total),O(n.pages),C(n.page),b(n.hasNext),o([...n.results])),B(!1)},c=async m=>{const{data:h}=await M.custom({url:"",method:"post",meta:{operation:"addBooksAuthor",variables:{authorId:{value:m,type:"Int",required:!0}},fields:["success","message",{bookAuthor:["id",{user:["id","firstName","middleName","lastName","fullName","email","pic","isActive","created","updated","canDelete","canManage"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(()=>(j.error("Error Adding Author"),{data:null})).then(l=>l);h&&(h.success?(j.success(h.message),o(u.filter(l=>parseInt(l.id.toString())!==m)),r.onAdd(h.bookAuthor)):j.error(h.message)),B(!1)};return s.useEffect(()=>{x(y,P,v),k(!1)},[r.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{offsetTop:90,children:e.jsx(q,{style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(N,{span:10,children:e.jsx(et,{size:"large",placeholder:"Search Purchase(s) ...",onSearch:m=>{S(m),x(1,m,v)},style:{width:"100%"}})})})}),e.jsx("div",{style:{maxHeight:"80vh",minHeight:"80vh",overflowY:"auto",overflowX:"hidden",marginTop:"10px"},children:e.jsx(ce,{itemLayout:"horizontal",dataSource:u,renderItem:m=>e.jsx(ce.Item,{actions:[e.jsx(X,{title:"Adding Books Author??",onConfirm:()=>c(parseInt(m.id.toString())),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(w,{icon:e.jsx(te,{}),size:"large"})})],children:e.jsx(Me,{avatar:!0,title:!1,loading:z,active:!0,children:e.jsx(ce.Item.Meta,{avatar:e.jsx(ie,{src:m.pic}),title:e.jsx("a",{children:m.fullName}),description:e.jsx(e.Fragment,{children:e.jsx($,{color:"green",children:m.email})})})})})})}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(se,{defaultCurrent:y,total:T,pageSize:25,onChange:(m,h)=>{E(h),C(m),x(m,P,h)}})})]})},{Search:st}=H,rt=r=>{const[f,k]=s.useState(!1),[z,B]=s.useState(0),[T,D]=s.useState(0),[A,O]=s.useState(1),[y,C]=s.useState([]);s.useState(),s.useState(!1);const[v,E]=s.useState(!1),[P,S]=s.useState(!1);I.useForm(),L();const i=async(u,o="")=>{k(!0);const{data:x}=await M.custom({url:"",method:"get",meta:{operation:"vertedBooksPublishers",variables:{page:{value:u,type:"Int",required:!0},key:{value:o,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{user:["id","firstName","lastName","middleName","fullName","email","pic"]},"canEdit","canDelete","canManage"]}]}}).catch(c=>(j.error("Error getting Books"),{data:null})).then(c=>c);x&&(B(x.total),D(x.pages),O(x.page),C(x.results)),k(!1)},b=async u=>{C([u,...y])};return s.useEffect(()=>{i(A,"")},[r.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(q,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:[e.jsx(N,{span:10,children:e.jsx(st,{size:"large",placeholder:"Search Purchase(s) ...",onSearch:u=>i(1,u),style:{width:"100%"}})}),e.jsx(N,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{icon:e.jsx(te,{}),size:"large",onClick:()=>E(!0),children:"Add Authors"})})]}),e.jsx(oe,{spinning:f,children:e.jsxs(q,{children:[y.length===0&&e.jsx(e.Fragment,{children:e.jsx(N,{span:24,children:e.jsx(ee,{description:"No Book Published"})})}),y.map(u=>e.jsx(N,{span:6,children:e.jsx(Z,{hoverable:!0,bordered:!0,style:{margin:"2px"},bodyStyle:{minHeight:100,maxHeight:100},actions:[e.jsx(w,{disabled:!0,size:"large",children:"100 Books"}),e.jsx(G,{title:"View Authors Details",color:"green",children:e.jsx(w,{icon:e.jsx(qe,{}),size:"large",onClick:()=>S(!0)})}),e.jsx("span",{style:{background:"red"},children:u.canDelete&&e.jsx(X,{title:"Delete the Author",okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(w,{size:"large",icon:e.jsx(he,{})})})})],children:e.jsx(q,{children:e.jsx(N,{span:24,style:{padding:"10px"},children:e.jsx(J,{direction:"horizontal",children:e.jsxs("a",{children:[e.jsx(ie,{src:u.user.pic,size:"large"}),e.jsx("span",{style:{marginLeft:10},children:u.user.fullName})]})})})})})},u.id))]})}),e.jsx(q,{children:e.jsx(N,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(se,{defaultCurrent:A,total:z})})}),e.jsx(le,{title:"Adding Authors",anchor:"right",width:"50vw",onClose:u=>E(u),open:v,noOverFlow:!0,children:e.jsx(tt,{randKey:Math.random(),onAdd:b})}),e.jsx(le,{title:"Author Details",width:"50vw",anchor:"right",onClose:u=>S(u),open:P,children:e.jsxs(e.Fragment,{children:[e.jsxs(V,{title:"Author Info",children:[e.jsx(V.Item,{label:"UserName",children:"Zhou Maomao"}),e.jsx(V.Item,{label:"Telephone",children:"1810000000"}),e.jsx(V.Item,{label:"Live",children:"Hangzhou, Zhejiang"}),e.jsx(V.Item,{label:"Remark",children:"empty"}),e.jsx(V.Item,{label:"Address",children:"No. 18, Wantang Road, Xihu District, Hangzhou, Zhejiang, China"})]}),e.jsxs(V,{title:"Author Company Info",children:[e.jsx(V.Item,{label:"UserName",children:"Zhou Maomao"}),e.jsx(V.Item,{label:"Telephone",children:"1810000000"}),e.jsx(V.Item,{label:"Live",children:"Hangzhou, Zhejiang"}),e.jsx(V.Item,{label:"Remark",children:"empty"}),e.jsx(V.Item,{label:"Address",children:"No. 18, Wantang Road, Xihu District, Hangzhou, Zhejiang, China"})]})]})})]})},it=()=>{const{push:r}=L();return s.useEffect(()=>{document.title=U.system_name+": Books Authors"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(W,{children:e.jsxs(g,{children:[e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/"),children:"Home"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib"),children:"Olib"})}),e.jsx(g.Item,{children:"Books Authors"})]})})}),e.jsx(rt,{randKey:Math.random()})]})},{Search:at}=H,nt=r=>{const[f,k]=s.useState(!1),[z,B]=s.useState(0),[T,D]=s.useState(0),[A,O]=s.useState(1),[y,C]=s.useState(25),[v,E]=s.useState(""),[P,S]=s.useState([]),[i,b]=s.useState();I.useForm();const[u,o]=s.useState(!1);L();const x=async l=>{b(l),o(!0)},c=async(l,n="",t=25)=>{k(!0);const{data:d}=await M.custom({url:"",method:"get",meta:{operation:"myBooksOrders",variables:{page:{value:l,type:"Int",required:!0},key:{value:n,type:"String",required:!1},pageSize:{value:t,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","price","paymentDate","receiptNumber","isPaid",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]},{user:["id","firstName","middleName","lastName"]},{bill:["id","billNumber"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(p=>(j.error("Error getting Bills"),{data:null})).then(p=>p);d&&(B(d.total),D(d.pages),O(d.page),S(d.results)),k(!1)},m=async l=>{const{data:n}=await M.custom({url:"",method:"post",meta:{operation:"deleteBookOrder",variables:{id:{value:l,type:"Int",required:!0}},fields:["success","message"]}}).catch(t=>(j.error("Error deleting Order"),{data:null})).then(t=>t);n&&S(P.filter(t=>t.id!==l))},h=[{title:"Bill#",dataIndex:"billNumber",fixed:!0,render:(l,n,t)=>{var d;return e.jsx("span",{children:e.jsx("a",{children:(d=n==null?void 0:n.bill)==null?void 0:d.billNumber})})}},{title:"Book Title",dataIndex:"bookTitle",fixed:!0,render:(l,n,t)=>{var d;return e.jsx("span",{children:e.jsx("a",{children:(d=n==null?void 0:n.book)==null?void 0:d.title})})}},{title:"Bill Amount",dataIndex:"billAmount",fixed:!0,render:(l,n,t)=>e.jsxs("span",{children:[n.price," Tsh"]})},{title:"Paid",dataIndex:"isPaid",fixed:!0,render:(l,n,t)=>e.jsx("span",{children:n.isPaid?e.jsx($,{color:"green",children:"Yes"}):e.jsx($,{color:"red",children:"No"})})},{title:"Created",dataIndex:"created",render:(l,n,t)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(n.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(l,n,t)=>e.jsx("a",{children:n!=null&&n.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(l,n,t)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[!n.isPaid&&e.jsx(X,{title:"Are you sure to delete this Order?",onConfirm:()=>m(n.id),okText:"Yes",cancelText:"No",disabled:!(n!=null&&n.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(w,{icon:e.jsx(he,{}),disabled:!(n!=null&&n.canDelete),size:"large"})}),n.isPaid&&e.jsx(G,{title:"Print Receipt",children:e.jsx(w,{icon:e.jsx(Le,{}),size:"large"})}),!n.isPaid&&e.jsx(G,{title:"View Order Details",placement:"topLeft",children:e.jsx(w,{icon:e.jsx(fe,{}),size:"large",onClick:()=>x(n)})})]})}];return s.useEffect(()=>{c(A,"",25)},[r.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{offsetTop:75,children:e.jsx(q,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:e.jsx(N,{span:10,children:e.jsx(at,{size:"large",placeholder:"Search Bill(s) ...",onSearch:l=>c(1,l,25),style:{width:"100%"}})})})}),e.jsx(q,{children:e.jsx(N,{span:24,children:e.jsx(de,{loading:f,columns:h,dataSource:P,pagination:{onChange:(l,n)=>{C(n),c(l,v,n)},total:z,pageSize:y,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})})}),e.jsx(re,{title:"Order Details & Payment",open:u,width:"50vw",onClose:l=>o(l),children:e.jsx(ue,{book:i==null?void 0:i.book})})]})},lt=()=>{const{push:r}=L();return s.useEffect(()=>{document.title=U.system_name+": Books Orders"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(W,{children:e.jsxs(g,{children:[e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/"),children:"Home"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib"),children:"Olib"})}),e.jsx(g.Item,{children:"Books Orders"})]})})}),e.jsx(nt,{})]})},ge=[".pdf"],ot=r=>Array.isArray(r)?r:r==null?void 0:r.fileList,ct=r=>{const[f,k]=s.useState(""),[z,B]=s.useState(!1),[T,D]=s.useState(!1),[A,O]=s.useState(!1),[y,C]=s.useState(""),[v]=I.useForm(),E=[{label:"Public (Free)",value:!0},{label:"Private (Payable or Rentable)",value:!1}],P=async i=>{B(!0);const{data:b}=await M.custom({url:"",method:"post",meta:{operation:"publishBook",variables:{file:{value:i.file,type:"Upload",required:!0},title:{value:i.title,type:"String",required:!0},description:{value:i.description,type:"String",required:!0},price:{value:i.price,type:"Float",required:!1},isPublic:{value:i.is_public,type:"Boolean",required:!0},downloadable:{value:i.downloadable,type:"Boolean",required:!1}},fields:["success","message"]}}).catch(()=>(j.error("Error creating publishing book"),{data:null})).then(u=>u);b&&(b.success?(j.success(b.message),r.onFinish()):j.error(b.message)),B(!1)},S=i=>(i=i.replace(/[-_]/g," "),i=i.replace(/.pdf/g,""),i=i.replace(/[.]/g," "),i=i.replace(/\s+/g," "),i=i.trim(),i);return e.jsx(e.Fragment,{children:e.jsx(oe,{spinning:z,children:e.jsxs(I,{layout:"vertical",form:v,onFinish:i=>{i.price=i.price??0,i.downloadable=A,i.description=y,P(i)},requiredMark:!0,children:[e.jsx(I.Item,{label:"Pick a Book ("+ge.join()+")",children:e.jsx(I.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:i=>{var u,o;k((u=i==null?void 0:i.file)==null?void 0:u.name);const b=(o=i==null?void 0:i.file)==null?void 0:o.name.split(".");return b.pop(),v.setFieldsValue({title:S(b.join("."))}),ot(i)},noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload Book file"}],children:e.jsxs(Ce.Dragger,{name:"file",accept:ge.join(),multiple:!1,maxCount:1,beforeUpload:()=>!1,onRemove:()=>{k(""),v.setFieldsValue({title:""})},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(Ie,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})})}),e.jsx(I.Item,{name:"title",label:"Book Title",initialValue:f,rules:[{required:!0,type:"string"}],children:e.jsx(H,{size:"large",placeholder:"Enter Book Title ..."})}),e.jsx(I.Item,{name:"is_public",label:"Availability",initialValue:!0,children:e.jsx(ye.Group,{options:E,onChange:i=>{D(!i.target.value)},value:!0})}),T&&e.jsx(I.Item,{label:"Book Cost (Tsh)",name:"price",rules:[{required:T,type:"number",min:100,message:"Price must be greater than 100"}],children:e.jsx(Ne,{style:{width:"50%"},size:"large"})}),e.jsx(I.Item,{name:"downloadable",valuePropName:"checked",children:e.jsx(ke,{onChange:i=>{O(i.target.checked)},children:"Downloadable"})}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h3",{children:"Description"}),e.jsx(Pe.CKEditor,{disabled:z,editor:Be,data:y,onReady:i=>{i.editing.view.change(b=>{b.setStyle("min-height","100px",i.editing.view.document.getRoot())})},onChange:(i,b)=>{const u=b.getData();C(u)},config:{toolbar:{items:["bold","italic","strikethrough","underline","code","subscript","superscript","removeFormat","|","bulletedList","numberedList","todoList","|","outdent","indent","|","-","fontSize","fontFamily","fontColor","fontBackgroundColor","highlight","|","alignment","|","EmojiPanel"],shouldNotGroupWhenFull:!0},fontFamily:{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0}}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{type:"primary",size:"large",htmlType:"submit",loading:z,children:"Publish"})})]})})})},je=[".pdf"],dt=r=>Array.isArray(r)?r:r==null?void 0:r.fileList,ut=r=>{var o,x,c,m,h,l,n,t,d,p;const[f,k]=s.useState(0),[z,B]=s.useState(""),[T,D]=s.useState(!1),[A,O]=s.useState(!1),[y,C]=s.useState(!1),[v,E]=s.useState(""),[P]=I.useForm(),[S]=I.useForm(),i=[{label:"Public (Free)",value:!0},{label:"Private (Payable or Rentable)",value:!1}],b=async a=>{D(!0);const{data:R}=await M.custom({url:"",method:"post",meta:{operation:"publishBook",variables:{file:{value:a.file,type:"Upload",required:!0},title:{value:a.title,type:"String",required:!0},description:{value:a.description,type:"String",required:!0},price:{value:a.price,type:"Float",required:!1},isPublic:{value:a.is_public,type:"Boolean",required:!0},downloadable:{value:a.downloadable,type:"Boolean",required:!1}},fields:["success","message"]}}).catch(Y=>(j.error("Error creating publishing book"),{data:null})).then(Y=>Y);R&&(R.success?(j.success(R.message),r.onFinish()):j.error(R.message)),D(!1)},u=a=>(a=a.replace(/[-_]/g," "),a=a.replace(/.pdf/g,""),a=a.replace(/[.]/g," "),a=a.replace(/\s+/g," "),a=a.trim(),a);return e.jsxs(e.Fragment,{children:[e.jsxs(K,{sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(w,{onClick:()=>k(0),children:"Book Info"}),e.jsx(w,{onClick:()=>k(1),children:"Edit Book Basic Info"}),e.jsx(w,{onClick:()=>k(2),children:"Edit Book Cover Image"})]}),f===0&&e.jsx(e.Fragment,{children:e.jsxs(K,{sx:{width:"100%"},children:[e.jsxs(Q,{variant:"h4",gutterBottom:!0,children:[e.jsx("b",{children:"Title"}),": ",(o=r.book)==null?void 0:o.title,e.jsx(ne,{})]}),e.jsxs(Q,{variant:"h5",gutterBottom:!0,children:[e.jsx("b",{children:"Availability"}),": ",(x=r.book)!=null&&x.isPublic?"Public":"Private",e.jsx(ne,{})]}),e.jsxs(Q,{variant:"h5",gutterBottom:!0,children:[e.jsx("b",{children:"Downloadable"}),": ",(c=r.book)!=null&&c.downloadable?"Yes":"No",e.jsx(ne,{})]}),e.jsxs(Q,{variant:"h5",gutterBottom:!0,children:[e.jsx("b",{children:"Price"}),": ",(m=r.book)==null?void 0:m.price," Tsh",e.jsx(ne,{})]}),e.jsxs(Q,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Description"}),": ",(h=r.book)==null?void 0:h.description]})]})}),f===1&&e.jsxs(I,{layout:"vertical",form:S,onFinish:a=>{a.price=a.price??0,a.downloadable=y,a.description=v,b(a)},requiredMark:!0,initialValues:{title:(l=r.book)==null?void 0:l.title,is_public:(n=r.book)==null?void 0:n.isPublic,price:(t=r.book)==null?void 0:t.price,downloadable:(d=r.book)==null?void 0:d.downloadable},children:[e.jsx(I.Item,{name:"title",label:"Book Title",initialValue:z,rules:[{required:!0,type:"string"}],children:e.jsx(H,{size:"large",placeholder:"Enter Book Title ..."})}),e.jsx(I.Item,{name:"is_public",label:"Availability",initialValue:!0,children:e.jsx(ye.Group,{options:i,onChange:a=>{O(!a.target.value)},value:!0})}),!((p=r.book)!=null&&p.isPublic)&&e.jsx(I.Item,{label:"Book Cost (Tsh)",name:"price",rules:[{required:A,type:"number",min:0}],children:e.jsx(Ne,{style:{width:"50%"},size:"large"})}),e.jsx(I.Item,{name:"downloadable",valuePropName:"checked",children:e.jsx(ke,{onChange:a=>{C(a.target.checked)},children:"Downloadable"})}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h3",{children:"Description"}),e.jsx(Pe.CKEditor,{disabled:T,editor:Be,data:v,onReady:a=>{a.editing.view.change(R=>{R.setStyle("min-height","100px",a.editing.view.document.getRoot())})},onChange:(a,R)=>{const Y=R.getData();E(Y)},config:{toolbar:{items:["bold","italic","strikethrough","underline","code","subscript","superscript","removeFormat","|","bulletedList","numberedList","todoList","|","outdent","indent","|","-","fontSize","fontFamily","fontColor","fontBackgroundColor","highlight","|","alignment","|","EmojiPanel"],shouldNotGroupWhenFull:!0},fontFamily:{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0}}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{type:"primary",size:"large",htmlType:"submit",loading:T,children:"Publish"})})]}),f===2&&e.jsx(I,{layout:"vertical",form:P,onFinish:a=>{a.price=a.price??0,a.downloadable=y,a.description=v,b(a)},requiredMark:!0,children:e.jsx(I.Item,{label:"Pick a Book ("+je.join()+")",children:e.jsx(I.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:a=>{var Y,xe;B((Y=a==null?void 0:a.file)==null?void 0:Y.name);const R=(xe=a==null?void 0:a.file)==null?void 0:xe.name.split(".");return R.pop(),P.setFieldsValue({title:u(R.join("."))}),dt(a)},noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload Book file"}],children:e.jsxs(Ce.Dragger,{name:"file",accept:je.join(),multiple:!1,maxCount:1,beforeUpload:()=>!1,onRemove:()=>{B(""),P.setFieldsValue({title:""})},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(Ie,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})})})})]})},{Search:ht}=H,xt=r=>{const[f,k]=s.useState(!1);s.useState(!1);const[z,B]=s.useState(0),[T,D]=s.useState(0),[A,O]=s.useState(1),[y,C]=s.useState([]),[v,E]=s.useState();I.useForm();const[P,S]=s.useState(!1),[i,b]=s.useState(!1),{push:u}=L();Re.useBreakpoint().lg;const x=async t=>{E(t),b(!0)},c=async()=>{l(1,""),S(!1)},m=async(t,d)=>{const{data:p}=await M.custom({url:"",method:"post",meta:{operation:"publishUnpublishBook",variables:{bookId:{value:t,type:"Int",required:!0},published:{value:d,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(()=>(j.remove(),d?j.error("Error publishing book"):j.error("Error unpublishing book"),{data:null})).then(a=>a);p&&(p.success?(j.success(p.message),C(y.map(a=>(a.id===t&&(a.published=d),a)))):j.error(p.message))},h=async t=>{const{data:d}=await M.custom({url:"",method:"post",meta:{operation:"deleteBook",variables:{bookId:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(j.error("Error deleting book"),{data:null})).then(p=>p);d&&(d.success?(j.success(d.message),C(y.filter(p=>p.id!==t))):j.error(d.message))},l=async(t,d="")=>{k(!0);const{data:p}=await M.custom({url:"",method:"get",meta:{operation:"publisherBooks",variables:{page:{value:t,type:"Int",required:!0},key:{value:d,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","file","cover","price","downloadable","publisherCanAddToReadings","published","created","updated","isActive","isPublic","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}}).catch(()=>(j.error("Error getting Books"),{data:null})).then(a=>a);p&&(B(p.total),D(p.pages),O(p.page),C(p.results)),k(!1)},n=async()=>{const{data:t}=await M.custom({url:"",method:"get",meta:{operation:"checkIfVertedBookPublisher",variables:{},fields:["data"]}}).catch(()=>(j.error("Error getting Books"),{data:null})).then(d=>d);t&&console.log(t)};return s.useEffect(()=>{n(),l(A,"")},[]),e.jsxs(e.Fragment,{children:[e.jsxs(me,{children:[e.jsx(ht,{size:"large",placeholder:"Enter Book Title, Description to search ...",onSearch:t=>l(1,t),style:{width:"100%"}}),e.jsxs(me,{children:[e.jsx(w,{size:"large",style:{float:"right"},icon:e.jsx(ve,{}),onClick:()=>u("/olib/books/purchases"),children:"Purchases"}),e.jsx(w,{size:"large",style:{float:"right"},icon:e.jsx(te,{}),onClick:()=>S(!0),children:"Publish"})]})]}),e.jsxs(q,{children:[y.length===0&&e.jsx(N,{span:24,children:e.jsx(ee,{description:"No Book Published"})}),y.map(t=>e.jsx(N,{span:12,xs:24,xl:12,xxl:12,children:e.jsx(Z,{hoverable:!0,bordered:!0,style:{margin:"2px"},bodyStyle:{minHeight:190,maxHeight:190},type:"inner",actions:[e.jsx("span",{style:{fontSize:"18px"},children:t.price>0&&e.jsxs(e.Fragment,{children:[t.price," Tsh"]})})],children:e.jsxs(q,{children:[e.jsx(N,{xs:12,sm:12,md:4,xl:2,lg:2,style:{backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+t.cover+")"},children:e.jsx("div",{style:{height:"100%",width:"100%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+t.cover+")"}})}),e.jsx(N,{xs:12,sm:12,md:8,style:{padding:"0px"},children:e.jsxs(K,{style:{padding:"0px"},children:[e.jsxs("div",{children:[e.jsx("a",{children:e.jsx("h3",{children:t.title.length>50?t.title.substring(0,50)+"...":t.title})}),e.jsx("span",{style:{float:"right",display:"flex",position:"absolute",right:0,top:0},children:e.jsx(be,{trigger:["click"],overlay:e.jsxs(_,{children:[e.jsx(_.Item,{icon:e.jsx(Ve,{}),onClick:()=>x(t),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"View"})}),t.published?e.jsx(_.Item,{icon:e.jsx(Ae,{}),children:e.jsx(X,{title:"Are you sure to Unpublish this Book?",description:t.isPublic?e.jsx(e.Fragment,{children:"This will remove the book from the public books and no one can view or read it"}):e.jsx(e.Fragment,{children:"This will remove the book from the market place and no one can purchase it"}),onConfirm:()=>m(t.id,!1),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Unpublish"})})}):e.jsx(_.Item,{icon:e.jsx(we,{}),children:e.jsx(X,{title:"Are you sure to Publish this Book?",description:t.isPublic?e.jsx(e.Fragment,{children:"This will make the book listed in the public books and everyone can view and read it"}):e.jsx(e.Fragment,{children:"This will make the book listed in the market place and anyone can purchase it"}),onConfirm:()=>m(t.id,!0),okText:"Publish",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Publish"})})}),e.jsx(_.Item,{icon:e.jsx(he,{}),children:e.jsx(X,{title:"Are you sure to delete this Book?",onConfirm:()=>h(t.id),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:d=>d.preventDefault(),children:e.jsx(Se,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})]}),e.jsx("p",{children:t.description.replace(/(<([^>]+)>)/gi,"").length>100?t.description.replace(/(<([^>]+)>)/gi,"").substring(0,100)+"...":t.description.replace(/(<([^>]+)>)/gi,"")}),e.jsx("div",{children:e.jsx(J,{children:e.jsx(G,{title:"Click to View Author Profile",children:e.jsxs("a",{children:[e.jsx(ie,{size:"small",src:t.author.pic}),e.jsx("span",{style:{marginLeft:"10px"},children:t.author.fullName})]})})})})]})})]})})}))]}),e.jsx(q,{children:e.jsx(N,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(se,{defaultCurrent:A,total:T})})}),e.jsx(re,{title:"Publishing Book",open:P,width:"60vw",onClose:t=>S(t),children:e.jsx(ct,{randKey:Math.random(),onFinish:c})}),e.jsx(le,{title:v==null?void 0:v.title,width:"80vw",anchor:"right",onClose:t=>b(t),open:i,noOverFlow:!0,children:e.jsx(ut,{book:v})})]})},mt=()=>{const{push:r}=L();return s.useEffect(()=>{document.title=U.system_name+": Publish Books"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(W,{children:e.jsxs(g,{children:[e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/"),children:"Home"})}),e.jsx(g.Item,{children:e.jsx("a",{onClick:()=>r("/olib"),children:"Olib"})}),e.jsx(g.Item,{children:"Publish Books"})]})})}),e.jsx(xt,{})]})},es=r=>{const{page:f}=r;return f==="PublishBooksPage"?e.jsx(mt,{}):f==="OlibOrdersPage"?e.jsx(lt,{}):f==="OlibBooksAuthorsPage"?e.jsx(it,{}):f==="OlibDashboardPage"?e.jsx(Qe,{}):f==="BooksPurchasesPage"?e.jsx(Ze,{}):f==="BooksPurchasesDisbursementsPage"?e.jsx(We,{}):f==="BooksPublicPage"?e.jsx(_e,{}):f==="BooksMarketPlacePage"?e.jsx(Ke,{}):e.jsx("div",{children:"Page not found ..."})};export{es as OlibPages};
