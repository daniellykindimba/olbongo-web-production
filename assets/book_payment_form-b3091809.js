import{r as a,aC as h,aM as e,aH as w,ae as x,ac as b,aJ as N,M as B,bJ as m,bK as p}from"./index-2fc17c3b.js";import{A as j}from"./index-389401b2.js";import{D as f}from"./index-d62905de.js";const A=n=>{const[o,g]=a.useState(!1),[S,i]=a.useState(!1),[E,P]=a.useState(""),[v,k]=a.useState([]),[y,l]=a.useState(""),[C,c]=a.useState(!1),[F,u]=a.useState(!1),[M]=h.useForm(),q=async()=>{const{data:s}=await m.custom({url:"",method:"get",meta:{operation:"paymentSupportedTelecomCarriers",variables:{},fields:[{results:["id","name"]}]}}).catch(r=>({data:null})).then(r=>r);if(s){const r=s.results,t=[];r.forEach(d=>{t.push(d.name)}),k(t)}},z=async s=>{c(!0),u(!1);const{data:r}=await m.custom({url:"",method:"post",meta:{operation:"createBookPurchaseOrder",variables:{bookId:{value:s.book_id,type:"Int",required:!0},phone:{value:s.phone,type:"String",required:!0}},fields:["success","message"]}}).catch(t=>({data:null})).then(t=>t);r&&(r.success?(u(!0),p.success(r.message),n.onFinish()):p.error(r.message)),c(!1)},I=async s=>{g(!0);const{data:r}=await m.custom({url:"",method:"post",meta:{operation:"validateMobilePhoneNumber",variables:{phone:{value:s,type:"String",required:!0}},fields:["success","message","carrier","formattedPhone"]}}).catch(t=>(p.error("Error Validating Mobile Phone Number"),{data:null})).then(t=>t);return r&&(i(r.success),r.success||(P(r.message),l(r.carrier))),g(!1),r};return a.useEffect(()=>{q()},[n.randKey]),F?e.jsx(e.Fragment,{children:e.jsx(j,{type:"success",showIcon:!0,description:e.jsx(e.Fragment,{children:e.jsxs(w,{direction:"vertical",children:[e.jsxs("span",{style:{fontSize:22},children:["Please your phone, we have pushed payment request, you will be requested to Enter ",e.jsx("b",{children:"PIN"})," to authorize this payment."]}),e.jsx(x,{size:"large",onClick:()=>{u(!1),c(!1)},children:"Push Payment Again"})]})})})}):e.jsx(e.Fragment,{children:e.jsxs(b,{spinning:C,children:[e.jsx(j,{description:e.jsxs(e.Fragment,{children:["Payment is supported through"," ",e.jsx("span",{style:{fontSize:20},children:e.jsx("b",{children:v.join(",")})})]}),type:"info",showIcon:!0,style:{fontSize:22,marginBottom:10}}),e.jsxs(f,{title:"Payment For",column:1,labelStyle:{fontSize:22,fontWeight:"bold"},contentStyle:{fontSize:22},children:[e.jsx(f.Item,{label:"Book Name",children:n.book.title}),e.jsxs(f.Item,{label:"Cost",children:[n.book.price," Tsh"]})]}),e.jsxs(h,{layout:"vertical",form:M,onFinish:s=>{s.book_id=n.book.id,z(s)},requiredMark:!0,autoComplete:"off",children:[e.jsx(h.Item,{name:"phone",label:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Mobile Phone Number"}),y.length>0&&e.jsx(N,{color:"green",style:{marginLeft:10},children:y}),o&&e.jsx(b,{spinning:o})]}),rules:[{required:!0,type:"string",message:"Required"},{validator:async(s,r)=>{if(r.length>=10){if(!o){const t=await I(r).then(d=>d);if(t!=null&&t.success)l(t.carrier),i(!0);else return l(""),Promise.reject(t==null?void 0:t.message)}}else i(!1)}}],children:e.jsx(B,{size:"large",placeholder:"Mobile Phone Number ..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(x,{type:"primary",size:"large",htmlType:"submit",disabled:!S,children:"Pay"})})]})]})})};export{A as B};
