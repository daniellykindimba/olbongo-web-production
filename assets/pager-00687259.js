import{r as t,m as Y,j as e,G as N,S as Ke,af as Be,k as Pe,a as _,ag as Ie,ah as ge,ai as Pt,B as ne,aj as me,e as le,ak as Ne,R as X,n as U,al as Oe,M as Fe,I as se,g as J,_ as z,d as de,am as M,F as I,an as dt,a5 as kt,O as V,ao as F,ap as s,aq as We,ar as rn,as as sn,at as an,au as ft,av as Et,aw as ke,f as on,ax as Ct,ay as ln,az as cn,aA as Qe,aB as Je,aC as dn,aD as un,aE as ut,aF as te,aG as hn,aH as nt,aI as rt,aJ as st,aK as at,T as Le,aL as Ge,aM as pt}from"./index-d9f4923f.js";import{B as ht}from"./book_payment_form-4e862204.js";import{A as Me}from"./index-67320175.js";import{i as Ee,p as ae,a as gt,d as mt,b as fn,c as pn,e as gn,l as mn,f as ce,w as re,g as xn,m as He,h as Tt,j as pe}from"./index-21b7c2a7.js";import{D as Ue}from"./index-de414737.js";import{R as yn}from"./ReactTimeAgo-cfa8a546.js";import{d as ot,C as it}from"./ckeditor-2d6c4104.js";import{I as lt}from"./index-1e413543.js";import"./memoize-one.esm-297ddbcb.js";import"./InputNumber-218fc870.js";const{Search:jn}=se,Rt=n=>{const[r,a]=t.useState(!1),[i,o]=t.useState(0),[l,m]=t.useState(0),[R,f]=t.useState(1),[y,T]=t.useState([]),[k,w]=t.useState(),[S,A]=t.useState(!1);Y();const c=x=>{w(x),A(!0)},C=async x=>{const{data:P}=await J.custom({url:"",method:"post",meta:{operation:"addBookToReadings",variables:{bookId:{value:x,type:"Int",required:!0}},fields:["success","message",{book:["id","title","description","file","cover","price","downloadable","publisherCanAddToReadings","created","updated","isActive","isPublic","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}}).catch(()=>(z.error("Error deleting book"),{data:null})).then(b=>b);P&&(P.success?(z.success(P.message),T(y.map(b=>b.id===x?P.book:b))):z.error(P.message))},v=async(x,P="")=>{a(!0);const{data:b}=await J.custom({url:"",method:"get",meta:{operation:"marketplaceBooks",variables:{page:{value:x,type:"Int",required:!0},key:{value:P,type:"String",required:!1},public:{value:n.public,type:"Boolean",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","orderPaid","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}}).catch(()=>(z.error("Error getting Books"),{data:null})).then(j=>j);b&&(o(b.total),m(b.pages),f(b.page),T(b.results)),a(!1)};return t.useEffect(()=>{v(R,"")},[n.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(N,{container:!0,spacing:0,sx:{display:"flex",justifyContent:"flex-start"},children:e.jsx(N,{item:!0,xs:12,sm:12,md:4,lg:4,xl:4,children:e.jsx(jn,{size:"large",placeholder:"Search Book(s) ...",onSearch:x=>v(1,x),style:{width:"100%"}})})}),e.jsxs("div",{style:{maxHeight:"calc(100vh - 150px)",overflowY:"auto"},children:[e.jsx(Ke,{spinning:r,children:e.jsxs(N,{container:!0,spacing:0,children:[y.length===0&&r&&e.jsx(e.Fragment,{children:e.jsx(N,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:e.jsx(Be,{description:"Loading Books"})})}),y.length===0&&!r&&e.jsx(e.Fragment,{children:e.jsx(N,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:e.jsx(Be,{description:"No Book Published"})})}),y.map(x=>e.jsx(N,{item:!0,xs:12,sm:12,md:6,lg:6,xl:6,children:e.jsx(Pe,{hoverable:!0,bordered:!0,style:{margin:"2px"},type:"inner",actions:[e.jsxs("span",{style:{fontSize:"18px",display:x.price>0?"block":"none"},children:[x.price," Tsh"]}),e.jsx("span",{style:{float:"right",marginRight:"10px",display:"flex"},children:x.isPublic?e.jsx(_,{size:"large",icon:e.jsx(Ie,{}),onClick:()=>C(x.id),children:"Add to Readings"}):e.jsxs(e.Fragment,{children:[x.orderPaid&&e.jsx(e.Fragment,{children:e.jsx(ge,{color:"green",children:"Already Purchased"})}),!x.orderPaid&&e.jsx(_,{size:"large",icon:e.jsx(Pt,{}),onClick:()=>c(x),children:"Buy"})]})})],children:e.jsxs(N,{container:!0,spacing:0,children:[e.jsx(N,{item:!0,xs:12,sm:12,md:4,sx:{backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+x.cover+")"},children:e.jsx(ne,{sx:{display:{xs:"block",md:"none"},height:100,width:"100%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+x.cover+")"}})}),e.jsx(N,{item:!0,xs:12,sm:12,md:8,children:e.jsx(ne,{style:{padding:"10px"},children:e.jsxs(me,{direction:"vertical",children:[e.jsx("a",{children:e.jsx("h3",{children:x.title.length>50?x.title.substring(0,50)+"...":x.title})}),e.jsx("p",{children:x.description.replace(/(<([^>]+)>)/gi,"").length>100?x.description.replace(/(<([^>]+)>)/gi,"").substring(0,100)+"...":x.description.replace(/(<([^>]+)>)/gi,"")}),e.jsx("div",{children:e.jsx(me,{children:e.jsx(le,{title:"Click to View Author Profile",children:e.jsxs("a",{children:[e.jsx(Ne,{size:"small",src:x.author.pic}),e.jsx("span",{style:{marginLeft:"10px"},children:x.author.fullName})]})})})})]})})})]})})}))]})}),y.length>0&&e.jsx(X,{children:e.jsx(U,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(Oe,{defaultCurrent:R,total:i})})})]}),e.jsx(Fe,{title:"Purchase Book",open:S,onClose:x=>A(x),width:"40vw",children:e.jsx(ht,{book:k,randKey:Math.random()})})]})},bn=()=>{const{push:n}=Y();return t.useEffect(()=>{document.title=de.system_name+": Books MarketPlace"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(M,{children:[e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib"),children:"Home"})}),e.jsx(M.Item,{children:"Books MarketPlace"})]})}),e.jsx(Rt,{public:!1,randKey:Math.random()})]})},vn=()=>{const{push:n}=Y();return t.useEffect(()=>(document.title=de.system_name+": Public Books",document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(M,{children:[e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib"),children:"Home"})}),e.jsx(M.Item,{children:"Public Books"})]})}),e.jsx(Rt,{public:!0,randKey:Math.random()})]})},{Search:Sn}=se,Pn=n=>{const[r,a]=t.useState(!1),[i,o]=t.useState(0),[l,m]=t.useState(0),[R,f]=t.useState(1),[y,T]=t.useState(25),[k,w]=t.useState(""),[S,A]=t.useState([]);t.useState(),I.useForm(),t.useState(!1);const[c,C]=t.useState(!1);Y();const v=async(P,b="",j=25)=>{a(!0);const{data:u}=await J.custom({url:"",method:"get",meta:{operation:"authorBooksPurchases",variables:{page:{value:P,type:"Int",required:!0},key:{value:b,type:"String",required:!1},pageSize:{value:j,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","price","paymentDate","receiptNumber","isPaid",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]},{user:["id","firstName","middleName","lastName"]},{bill:["id","billNumber"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(g=>(z.error("Error getting Bills"),{data:null})).then(g=>g);u&&(o(u.total),m(u.pages),f(u.page),A(u.results)),a(!1)},x=[{title:"Bill#",dataIndex:"billNumber",fixed:!0,render:(P,b,j)=>{var u;return e.jsx("span",{children:e.jsx("a",{children:(u=b==null?void 0:b.bill)==null?void 0:u.billNumber})})}},{title:"Book Title",dataIndex:"bookTitle",fixed:!0,render:(P,b,j)=>{var u;return e.jsx("span",{children:e.jsx("a",{children:(u=b==null?void 0:b.book)==null?void 0:u.title})})}},{title:"Amount",dataIndex:"billAmount",fixed:!0,render:(P,b,j)=>e.jsxs("span",{children:[b.price," Tsh"]})}];return t.useEffect(()=>{v(R,"",25)},[n.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(Me,{offsetTop:75,children:e.jsxs(X,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:[e.jsx(U,{span:10,children:e.jsx(Sn,{size:"large",placeholder:"Search Disbursement(s) ...",onSearch:P=>v(1,P,25),style:{width:"100%"}})}),e.jsx(U,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(_,{icon:e.jsx(Ie,{}),size:"large",onClick:()=>C(!0),children:"Create Disbursement"})})]})}),e.jsx(X,{children:e.jsx(U,{span:24,children:e.jsx(dt,{loading:r,columns:x,dataSource:S,pagination:{onChange:(P,b)=>{T(b),v(P,k,b)},total:i,pageSize:y,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})})}),e.jsx(Fe,{title:"Creating Dibursement",width:"35vw",open:c,onClose:P=>C(P),children:e.jsx("p",{children:"Creating Dibursement"})})]})},kn=()=>{const{push:n}=Y();return t.useEffect(()=>{document.title=de.system_name+": Books Purchases Disbursement"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(M,{children:[e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib"),children:"Home"})}),e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib/publish/books"),children:"Published Books"})}),e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib/books/purchases"),children:"Books Purchases"})}),e.jsx(M.Item,{children:"Books Purchases Disbursement"})]})}),e.jsx(Pn,{})]})},{Search:En}=se,Cn=n=>{const[r,a]=t.useState(!1),[i,o]=t.useState(0),[l,m]=t.useState(0),[R,f]=t.useState(1),[y,T]=t.useState(25),[k,w]=t.useState(""),[S,A]=t.useState([]),[c,C]=t.useState();I.useForm();const[v,x]=t.useState(!1),{push:P}=Y(),b=async(u,g="",p=25)=>{a(!0);const{data:h}=await J.custom({url:"",method:"get",meta:{operation:"authorBooksPurchases",variables:{page:{value:u,type:"Int",required:!0},key:{value:g,type:"String",required:!1},pageSize:{value:p,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","price","paymentDate","receiptNumber","isPaid",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]},{user:["id","firstName","middleName","lastName"]},{bill:["id","billNumber"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(D=>(z.error("Error getting Bills"),{data:null})).then(D=>D);h&&(o(h.total),m(h.pages),f(h.page),A(h.results)),a(!1)},j=[{title:"Bill#",dataIndex:"billNumber",fixed:!0,render:(u,g,p)=>{var h;return e.jsx("span",{children:e.jsx("a",{children:(h=g==null?void 0:g.bill)==null?void 0:h.billNumber})})}},{title:"Book Title",dataIndex:"bookTitle",fixed:!0,render:(u,g,p)=>{var h;return e.jsx("span",{children:e.jsx("a",{children:(h=g==null?void 0:g.book)==null?void 0:h.title})})}},{title:"Amount",dataIndex:"billAmount",fixed:!0,render:(u,g,p)=>e.jsxs("span",{children:[g.price," Tsh"]})}];return t.useEffect(()=>{b(R,"",25)},[n.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(Me,{offsetTop:75,children:e.jsxs(X,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:[e.jsx(U,{span:10,children:e.jsx(En,{size:"large",placeholder:"Search Purchase(s) ...",onSearch:u=>b(1,u,25),style:{width:"100%"}})}),e.jsx(U,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(_,{icon:e.jsx(kt,{}),size:"large",onClick:()=>P("/olib/books/purchases/disbursements"),children:"Disbursement"})})]})}),e.jsx(X,{children:e.jsx(U,{span:24,children:e.jsx(dt,{loading:r,columns:j,dataSource:S,pagination:{onChange:(u,g)=>{T(g),b(u,k,g)},total:i,pageSize:y,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})})}),e.jsx(Fe,{title:"Order Details & Payment",open:v,width:"50vw",onClose:u=>x(u),children:e.jsx(ht,{book:c==null?void 0:c.book})})]})},Tn=()=>{const{push:n}=Y();return t.useEffect(()=>{document.title=de.system_name+": Books Purchases"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(M,{children:[e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib"),children:"Home"})}),e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib/publish/books"),children:"Published Books"})}),e.jsx(M.Item,{children:"Books Purchases"})]})}),e.jsx(Cn,{})]})};var H=globalThis&&globalThis.__spreadArray||function(n,r,a){if(a||arguments.length===2)for(var i=0,o=r.length,l;i<o;i++)(l||!(i in r))&&(l||(l=Array.prototype.slice.call(r,0,i)),l[i]=r[i]);return n.concat(l||Array.prototype.slice.call(r))},Rn=["onCopy","onCut","onPaste"],wn=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],An=["onFocus","onBlur"],Dn=["onInput","onInvalid","onReset","onSubmit"],Ln=["onLoad","onError"],Bn=["onKeyDown","onKeyPress","onKeyUp"],In=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],Nn=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],On=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],Fn=["onSelect"],Mn=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],_n=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],zn=["onScroll"],Vn=["onWheel"],qn=["onAnimationStart","onAnimationEnd","onAnimationIteration"],Gn=["onTransitionEnd"],$n=["onToggle"],Hn=["onChange"],wt=H(H(H(H(H(H(H(H(H(H(H(H(H(H(H(H(H(H([],Rn,!0),wn,!0),An,!0),Dn,!0),Ln,!0),Bn,!0),In,!0),Nn,!0),On,!0),Fn,!0),Mn,!0),_n,!0),zn,!0),Vn,!0),qn,!0),Gn,!0),Hn,!0),$n,!0);function At(n,r){var a={};return wt.forEach(function(i){var o=n[i];o&&(r?a[i]=function(l){return o(l,r(i))}:a[i]=o)}),a}function Te(n){var r=!1,a=new Promise(function(i,o){n.then(function(l){return!r&&i(l)}).catch(function(l){return!r&&o(l)})});return{promise:a,cancel:function(){r=!0}}}const Dt=t.createContext(null);function Ce({children:n,type:r}){return V.createElement("div",{className:`react-pdf__message react-pdf__message--${r}`},n)}const Un="noopener noreferrer nofollow";class Lt{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(r){this.pdfDocument=r}setViewer(r){this.pdfViewer=r}setExternalLinkRel(r){this.externalLinkRel=r}setExternalLinkTarget(r){this.externalLinkTarget=r}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return F(this.pdfViewer,"PDF viewer is not initialized."),this.pdfViewer.currentPageNumber||0}set page(r){F(this.pdfViewer,"PDF viewer is not initialized."),this.pdfViewer.currentPageNumber=r}get rotation(){return 0}set rotation(r){}goToDestination(r){return new Promise(a=>{F(this.pdfDocument,"PDF document not loaded."),F(r,"Destination is not specified."),typeof r=="string"?this.pdfDocument.getDestination(r).then(a):Array.isArray(r)?a(r):r.then(a)}).then(a=>{F(Array.isArray(a),`"${a}" is not a valid destination array.`);const i=a[0];new Promise(o=>{F(this.pdfDocument,"PDF document not loaded."),i instanceof Object?this.pdfDocument.getPageIndex(i).then(l=>{o(l)}).catch(()=>{F(!1,`"${i}" is not a valid page reference.`)}):typeof i=="number"?o(i):F(!1,`"${i}" is not a valid destination reference.`)}).then(o=>{const l=o+1;F(this.pdfViewer,"PDF viewer is not initialized."),F(l>=1&&l<=this.pagesCount,`"${l}" is not a valid page number.`),this.pdfViewer.scrollPageIntoView({dest:a,pageIndex:o,pageNumber:l})})})}navigateTo(r){this.goToDestination(r)}goToPage(r){const a=r-1;F(this.pdfViewer,"PDF viewer is not initialized."),F(r>=1&&r<=this.pagesCount,`"${r}" is not a valid page number.`),this.pdfViewer.scrollPageIntoView({pageIndex:a,pageNumber:r})}addLinkAttributes(r,a,i){r.href=a,r.rel=this.externalLinkRel||Un,r.target=i?"_blank":this.externalLinkTarget||""}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}setHash(){}executeNamedAction(){}cachePageRef(){}isPageVisible(){return!0}isPageCached(){return!0}executeSetOCGState(){}}const Kn={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},xt=Kn;function Wn(n,r){switch(r.type){case"RESOLVE":return{value:r.value,error:void 0};case"REJECT":return{value:!1,error:r.error};case"RESET":return{value:void 0,error:void 0};default:return n}}function xe(){return t.useReducer(Wn,{value:void 0,error:void 0})}const{PDFDataRangeTransport:Jn}=ae,Bt=(()=>{const n={};return wt.forEach(r=>{n[r]=s.func}),n})(),Yn=s.oneOfType([s.instanceOf(Int8Array),s.instanceOf(Uint8Array),s.instanceOf(Uint8ClampedArray),s.instanceOf(Int16Array),s.instanceOf(Uint16Array),s.instanceOf(Int32Array),s.instanceOf(Uint32Array),s.instanceOf(Float32Array),s.instanceOf(Float64Array)]),It=[s.string,s.instanceOf(ArrayBuffer),s.shape({data:s.oneOfType([s.string,s.instanceOf(ArrayBuffer),s.arrayOf(s.number.isRequired),Yn]).isRequired}),s.shape({range:s.instanceOf(Jn).isRequired}),s.shape({url:s.string.isRequired})];typeof Blob<"u"&&It.push(s.instanceOf(Blob));const Nt=s.oneOfType([s.string,s.arrayOf(s.string)]),Zn=s.oneOfType(It);s.instanceOf(Lt);s.oneOf(["_self","_blank","_parent","_top"]);s.shape({commonObjs:s.shape({}).isRequired,getAnnotations:s.func.isRequired,getTextContent:s.func.isRequired,getViewport:s.func.isRequired,render:s.func.isRequired});const Xn=function(r,a,i){const{[a]:o,pageNumber:l,pdf:m}=r;if(!Ee(m))return null;if(Ee(o)){if(typeof o!="number")return new Error(`\`${a}\` of type \`${typeof o}\` supplied to \`${i}\`, expected \`number\`.`);if(o<0)return new Error(`Expected \`${a}\` to be greater or equal to 0.`);const{numPages:R}=m;if(o+1>R)return new Error(`Expected \`${a}\` to be less or equal to ${R-1}.`)}else if(!Ee(l))return new Error(`\`${a}\` not supplied. Either pageIndex or pageNumber must be supplied to \`${i}\`.`);return null},Qn=function(r,a,i){const{[a]:o,pageIndex:l,pdf:m}=r;if(!Ee(m))return null;if(Ee(o)){if(typeof o!="number")return new Error(`\`${a}\` of type \`${typeof o}\` supplied to \`${i}\`, expected \`number\`.`);if(o<1)return new Error(`Expected \`${a}\` to be greater or equal to 1.`);const{numPages:R}=m;if(o>R)return new Error(`Expected \`${a}\` to be less or equal to ${R}.`)}else if(!Ee(l))return new Error(`\`${a}\` not supplied. Either pageIndex or pageNumber must be supplied to \`${i}\`.`);return null},er=s.oneOfType([s.any,s.oneOf([!1])]),ct=s.oneOfType([s.func,s.exact({current:s.any})]),tr=s.oneOf(["canvas","custom","none","svg"]),nr=s.oneOf([0,90,180,270]);var rr=globalThis&&globalThis.__awaiter||function(n,r,a,i){function o(l){return l instanceof a?l:new a(function(m){m(l)})}return new(a||(a=Promise))(function(l,m){function R(T){try{y(i.next(T))}catch(k){m(k)}}function f(T){try{y(i.throw(T))}catch(k){m(k)}}function y(T){T.done?l(T.value):o(T.value).then(R,f)}y((i=i.apply(n,r||[])).next())})},yt=globalThis&&globalThis.__rest||function(n,r){var a={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&r.indexOf(i)<0&&(a[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(n);o<i.length;o++)r.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(n,i[o])&&(a[i[o]]=n[i[o]]);return a};const{PDFDataRangeTransport:sr}=ae,ar=(n,r)=>{switch(r){case xt.NEED_PASSWORD:{const a=prompt("Enter the password to open this PDF file.");n(a);break}case xt.INCORRECT_PASSWORD:{const a=prompt("Invalid password. Please try again.");n(a);break}}},Ot=t.forwardRef(function(r,a){var{children:i,className:o,error:l="Failed to load PDF file.",externalLinkRel:m,externalLinkTarget:R,file:f,inputRef:y,imageResourcesPath:T,loading:k="Loading PDF…",noData:w="No PDF file specified.",onItemClick:S,onLoadError:A,onLoadProgress:c,onLoadSuccess:C,onPassword:v=ar,onSourceError:x,onSourceSuccess:P,options:b,renderMode:j,rotate:u}=r,g=yt(r,["children","className","error","externalLinkRel","externalLinkTarget","file","inputRef","imageResourcesPath","loading","noData","onItemClick","onLoadError","onLoadProgress","onLoadSuccess","onPassword","onSourceError","onSourceSuccess","options","renderMode","rotate"]);const[p,h]=xe(),{value:D,error:E}=p,[d,L]=xe(),{value:B,error:Z}=d,K=t.useRef(new Lt),ee=t.useRef([]),Q=t.useRef({scrollPageIntoView:O=>{const{dest:G,pageNumber:W,pageIndex:$=W-1}=O;if(S){S({dest:G,pageIndex:$,pageNumber:W});return}const Ve=ee.current[$];if(Ve){Ve.scrollIntoView();return}}});t.useImperativeHandle(a,()=>({linkService:K,pages:ee,viewer:Q}),[]);function oe(){P&&P()}function ie(){E&&(re(!1,E.toString()),x&&x(E))}function ye(){h({type:"RESET"})}t.useEffect(ye,[f,h]);const ue=t.useCallback(()=>rr(this,void 0,void 0,function*(){if(!f)return null;if(typeof f=="string")return gt(f)?{data:mt(f)}:{url:f};if(f instanceof sr)return{range:f};if(fn(f))return{data:f};if(pn&&gn(f))return{data:yield mn(f)};if(F(typeof f=="object","Invalid parameter in file, need either Uint8Array, string or a parameter object"),F("data"in f||"range"in f||"url"in f,"Invalid parameter object: need either .data, .range or .url"),"url"in f&&typeof f.url=="string"&&gt(f.url)){const{url:O}=f,G=yt(f,["url"]),W=mt(O);return Object.assign({data:W},G)}return f}),[f]);t.useEffect(()=>{const O=Te(ue());return O.promise.then(G=>{h({type:"RESOLVE",value:G})}).catch(G=>{h({type:"REJECT",error:G})}),()=>{ce(O)}},[ue,h]),t.useEffect(()=>{if(!(typeof D>"u")){if(D===!1){ie();return}oe()}},[D]);function he(){B&&(C&&C(B),ee.current=new Array(B.numPages),K.current.setDocument(B))}function Re(){Z&&(re(!1,Z.toString()),A&&A(Z))}function je(){L({type:"RESET"})}t.useEffect(je,[L,D]);function we(){if(!D)return;const O=b?Object.assign(Object.assign({},D),b):D,G=ae.getDocument(O);c&&(G.onProgress=c),v&&(G.onPassword=v);const W=G;return W.promise.then($=>{L({type:"RESOLVE",value:$})}).catch($=>{W.destroyed||L({type:"REJECT",error:$})}),()=>{W.destroy()}}t.useEffect(we,[b,L,D]),t.useEffect(()=>{if(!(typeof B>"u")){if(B===!1){Re();return}he()}},[B]);function be(){K.current.setViewer(Q.current),K.current.setExternalLinkRel(m),K.current.setExternalLinkTarget(R)}t.useEffect(be,[m,R]);function ze(O,G){ee.current[O]=G}function Ze(O){delete ee.current[O]}const fe=t.useMemo(()=>({imageResourcesPath:T,linkService:K.current,onItemClick:S,pdf:B,registerPage:ze,renderMode:j,rotate:u,unregisterPage:Ze}),[T,S,B,j,u]),q=t.useMemo(()=>At(g,()=>B),[g,B]);function Ae(){return V.createElement(Dt.Provider,{value:fe},i)}function De(){return f?B==null?V.createElement(Ce,{type:"loading"},typeof k=="function"?k():k):B===!1?V.createElement(Ce,{type:"error"},typeof l=="function"?l():l):Ae():V.createElement(Ce,{type:"no-data"},typeof w=="function"?w():w)}return V.createElement("div",Object.assign({className:We("react-pdf__Document",o),ref:y,style:{"--scale-factor":"1"}},q),De())}),et=s.oneOfType([s.func,s.node]);Ot.propTypes=Object.assign(Object.assign({},Bt),{children:s.node,className:Nt,error:et,externalLinkRel:s.string,externalLinkTarget:s.oneOf(["_self","_blank","_parent","_top"]),file:Zn,imageResourcesPath:s.string,inputRef:ct,loading:et,noData:et,onItemClick:s.func,onLoadError:s.func,onLoadProgress:s.func,onLoadSuccess:s.func,onPassword:s.func,onSourceError:s.func,onSourceSuccess:s.func,options:s.shape({canvasFactory:s.any,canvasMaxAreaInBytes:s.number,cMapPacked:s.bool,CMapReaderFactory:s.any,cMapUrl:s.string,disableAutoFetch:s.bool,disableFontFace:s.bool,disableRange:s.bool,disableStream:s.bool,docBaseUrl:s.string,enableXfa:s.bool,filterFactory:s.any,fontExtraProperties:s.bool,httpHeaders:s.object,isEvalSupported:s.bool,isOffscreenCanvasSupported:s.bool,length:s.number,maxImageSize:s.number,ownerDocument:s.any,password:s.string,pdfBug:s.bool,rangeChunkSize:s.number,StandardFontDataFactory:s.any,standardFontDataUrl:s.string,stopAtErrors:s.bool,useSystemFonts:s.bool,useWorkerFetch:s.bool,verbosity:s.number,withCredentials:s.bool,worker:s.any}),rotate:s.number});const or=Ot;function Ft(){return t.useContext(Dt)}function Mt(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var a=n.filter(Boolean);if(a.length<=1){var i=a[0];return i||null}return function(l){a.forEach(function(m){typeof m=="function"?m(l):m&&(m.current=l)})}}const _t=t.createContext(null),zt={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},ir=/^H(\d+)$/;function lr(n){return n in zt}function Ye(n){return"children"in n}function Vt(n){return Ye(n)?n.children.length===1&&0 in n.children&&"id"in n.children[0]:!1}function cr(n){const r={};if(Ye(n)){const{role:a}=n,i=a.match(ir);if(i)r.role="heading",r["aria-level"]=Number(i[1]);else if(lr(a)){const o=zt[a];o&&(r.role=o)}}return r}function qt(n){const r={};if(Ye(n)){if(n.alt!==void 0&&(r["aria-label"]=n.alt),n.lang!==void 0&&(r.lang=n.lang),Vt(n)){const[a]=n.children;if(a){const i=qt(a);return Object.assign(Object.assign({},r),i)}}}else"id"in n&&(r["aria-owns"]=n.id);return r}function dr(n){return n?Object.assign(Object.assign({},cr(n)),qt(n)):null}function Gt({className:n,node:r}){const a=t.useMemo(()=>dr(r),[r]),i=t.useMemo(()=>!Ye(r)||Vt(r)?null:r.children.map((o,l)=>V.createElement(Gt,{key:l,node:o})),[r]);return V.createElement("span",Object.assign({className:n},a),i)}function _e(){return t.useContext(_t)}function ur(){const n=_e();F(n,"Unable to find Page context.");const{onGetStructTreeError:r,onGetStructTreeSuccess:a}=n,[i,o]=xe(),{value:l,error:m}=i,{customTextRenderer:R,page:f}=n;function y(){l&&a&&a(l)}function T(){m&&(re(!1,m.toString()),r&&r(m))}function k(){o({type:"RESET"})}t.useEffect(k,[o,f]);function w(){if(R||!f)return;const S=Te(f.getStructTree()),A=S;return S.promise.then(c=>{o({type:"RESOLVE",value:c})}).catch(c=>{o({type:"REJECT",error:c})}),()=>ce(A)}return t.useEffect(w,[R,f,o]),t.useEffect(()=>{if(l!==void 0){if(l===!1){T();return}y()}},[l]),l?V.createElement(Gt,{className:"react-pdf__Page__structTree structTree",node:l}):null}const jt=ae.AnnotationMode;function hr(n){const r=_e();F(r,"Unable to find Page context.");const a=Object.assign(Object.assign({},r),n),{_className:i,canvasBackground:o,devicePixelRatio:l=xn(),onRenderError:m,onRenderSuccess:R,page:f,renderForms:y,renderTextLayer:T,rotate:k,scale:w}=a,{canvasRef:S}=n;F(f,"Attempted to render page canvas, but no page was specified.");const A=t.useRef(null);function c(){f&&R&&R(He(f,w))}function C(j){Tt(j)||(re(!1,j.toString()),m&&m(j))}const v=t.useMemo(()=>f.getViewport({scale:w*l,rotation:k}),[l,f,k,w]),x=t.useMemo(()=>f.getViewport({scale:w,rotation:k}),[f,k,w]);function P(){if(!f)return;f.cleanup();const{current:j}=A;if(!j)return;j.width=v.width,j.height=v.height,j.style.width=`${Math.floor(x.width)}px`,j.style.height=`${Math.floor(x.height)}px`,j.style.visibility="hidden";const u={annotationMode:y?jt.ENABLE_FORMS:jt.ENABLE,canvasContext:j.getContext("2d",{alpha:!1}),viewport:v};o&&(u.background=o);const g=f.render(u),p=g;return g.promise.then(()=>{j.style.visibility="",c()}).catch(C),()=>ce(p)}t.useEffect(P,[o,A,l,f,y,v,x]);const b=t.useCallback(()=>{const{current:j}=A;j&&(j.width=0,j.height=0)},[A]);return t.useEffect(()=>b,[b]),V.createElement("canvas",{className:`${i}__canvas`,dir:"ltr",ref:Mt(S,A),style:{display:"block",userSelect:"none"}},T?V.createElement(ur,null):null)}function fr(){const n=_e();F(n,"Unable to find Page context.");const{_className:r,onRenderSuccess:a,onRenderError:i,page:o,rotate:l,scale:m}=n;F(o,"Attempted to render page SVG, but no page was specified.");const[R,f]=xe(),{value:y,error:T}=R;function k(){o&&a&&a(He(o,m))}function w(){T&&(Tt(T)||(re(!1,T.toString()),i&&i(T)))}const S=t.useMemo(()=>o.getViewport({scale:m,rotation:l}),[o,l,m]);function A(){f({type:"RESET"})}t.useEffect(A,[o,f,S]);function c(){if(!o)return;const P=Te(o.getOperatorList());return P.promise.then(b=>{new ae.SVGGraphics(o.commonObjs,o.objs).getSVG(b,S).then(u=>{f({type:"RESOLVE",value:u})}).catch(u=>{f({type:"REJECT",error:u})})}).catch(b=>{f({type:"REJECT",error:b})}),()=>ce(P)}t.useEffect(c,[o,f,S]),t.useEffect(()=>{if(y!==void 0){if(y===!1){w();return}k()}},[y]);function C(P){if(!P||!y)return;P.firstElementChild||P.appendChild(y);const{width:b,height:j}=S;y.setAttribute("width",`${b}`),y.setAttribute("height",`${j}`)}const{width:v,height:x}=S;return V.createElement("div",{className:`${r}__svg`,ref:P=>C(P),style:{display:"block",backgroundColor:"white",overflow:"hidden",width:v,height:x,userSelect:"none"}})}function pr(n){return"str"in n}function gr(){const n=_e();F(n,"Unable to find Page context.");const{customTextRenderer:r,onGetTextError:a,onGetTextSuccess:i,onRenderTextLayerError:o,onRenderTextLayerSuccess:l,page:m,pageIndex:R,pageNumber:f,rotate:y,scale:T}=n;F(m,"Attempted to load page text content, but no page was specified.");const[k,w]=xe(),{value:S,error:A}=k,c=t.useRef(null),C=t.useRef();re(parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1);function v(){S&&i&&i(S)}function x(){A&&(re(!1,A.toString()),a&&a(A))}function P(){w({type:"RESET"})}t.useEffect(P,[m,w]);function b(){if(!m)return;const E=Te(m.getTextContent()),d=E;return E.promise.then(L=>{w({type:"RESOLVE",value:L})}).catch(L=>{w({type:"REJECT",error:L})}),()=>ce(d)}t.useEffect(b,[m,w]),t.useEffect(()=>{if(S!==void 0){if(S===!1){x();return}v()}},[S]);const j=t.useCallback(()=>{l&&l()},[l]),u=t.useCallback(E=>{re(!1,E.toString()),o&&o(E)},[o]);function g(){const E=C.current;E&&E.classList.add("active")}function p(){const E=C.current;E&&E.classList.remove("active")}const h=t.useMemo(()=>m.getViewport({scale:T,rotation:y}),[m,y,T]);function D(){if(!m||!S)return;const{current:E}=c;if(!E)return;E.innerHTML="";const d=m.streamTextContent({includeMarkedContent:!0}),L={container:E,textContentSource:d,viewport:h},B=ae.renderTextLayer(L),Z=B;return B.promise.then(()=>{const K=document.createElement("div");K.className="endOfContent",E.append(K),C.current=K;const Q=!!E.querySelector(".markedContent")?E.querySelectorAll(".markedContent > *:not(.markedContent"):E.children;if(r){let oe=0;S.items.forEach((ie,ye)=>{if(!pr(ie))return;const ue=Q[oe];if(!ue)return;const he=r(Object.assign({pageIndex:R,pageNumber:f,itemIndex:ye},ie));ue.innerHTML=he,oe+=ie.str&&ie.hasEOL?2:1})}j()}).catch(u),()=>ce(Z)}return t.useLayoutEffect(D,[r,u,j,m,R,f,S,h]),V.createElement("div",{className:We("react-pdf__Page__textContent","textLayer"),onMouseUp:p,onMouseDown:g,ref:c})}function mr(){const n=Ft();F(n,"Unable to find Document context. Did you wrap <Page /> in <Document />?");const r=_e();F(r,"Unable to find Page context.");const a=Object.assign(Object.assign({},n),r),{imageResourcesPath:i,linkService:o,onGetAnnotationsError:l,onGetAnnotationsSuccess:m,onRenderAnnotationLayerError:R,onRenderAnnotationLayerSuccess:f,page:y,pdf:T,renderForms:k,rotate:w,scale:S=1}=a;F(y,"Attempted to load page annotations, but no page was specified.");const[A,c]=xe(),{value:C,error:v}=A,x=t.useRef(null);re(parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1);function P(){C&&m&&m(C)}function b(){v&&(re(!1,v.toString()),l&&l(v))}function j(){c({type:"RESET"})}t.useEffect(j,[c,y]);function u(){if(!y)return;const E=Te(y.getAnnotations()),d=E;return E.promise.then(L=>{c({type:"RESOLVE",value:L})}).catch(L=>{c({type:"REJECT",error:L})}),()=>{ce(d)}}t.useEffect(u,[c,y,k]),t.useEffect(()=>{if(C!==void 0){if(C===!1){b();return}P()}},[C]);function g(){f&&f()}function p(E){R&&R(E)}const h=t.useMemo(()=>y.getViewport({scale:S,rotation:w}),[y,w,S]);function D(){if(!T||!y||!C)return;const{current:E}=x;if(!E)return;const d=h.clone({dontFlip:!0}),L={annotations:C,annotationStorage:T.annotationStorage,div:E,downloadManager:null,imageResourcesPath:i,linkService:o,page:y,renderForms:k,viewport:d};E.innerHTML="";try{ae.AnnotationLayer.render(L),g()}catch(B){p(B)}return()=>{}}return t.useEffect(D,[C,i,o,y,k,h]),V.createElement("div",{className:We("react-pdf__Page__annotations","annotationLayer"),ref:x})}var xr=globalThis&&globalThis.__rest||function(n,r){var a={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&r.indexOf(i)<0&&(a[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(n);o<i.length;o++)r.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(n,i[o])&&(a[i[o]]=n[i[o]]);return a};const bt=1,$t=function(r){const a=Ft();F(a,"Unable to find Document context. Did you wrap <Page /> in <Document />?");const i=Object.assign(Object.assign({},a),r),{_className:o="react-pdf__Page",_enableRegisterUnregisterPage:l=!0,canvasBackground:m,canvasRef:R,children:f,className:y,customRenderer:T,customTextRenderer:k,devicePixelRatio:w,error:S="Failed to load the page.",height:A,inputRef:c,loading:C="Loading page…",noData:v="No page specified.",onGetAnnotationsError:x,onGetAnnotationsSuccess:P,onGetStructTreeError:b,onGetStructTreeSuccess:j,onGetTextError:u,onGetTextSuccess:g,onLoadError:p,onLoadSuccess:h,onRenderAnnotationLayerError:D,onRenderAnnotationLayerSuccess:E,onRenderError:d,onRenderSuccess:L,onRenderTextLayerError:B,onRenderTextLayerSuccess:Z,pageIndex:K,pageNumber:ee,pdf:Q,registerPage:oe,renderAnnotationLayer:ie=!0,renderForms:ye=!1,renderMode:ue="canvas",renderTextLayer:he=!0,rotate:Re,scale:je=bt,unregisterPage:we,width:be}=i,ze=xr(i,["_className","_enableRegisterUnregisterPage","canvasBackground","canvasRef","children","className","customRenderer","customTextRenderer","devicePixelRatio","error","height","inputRef","loading","noData","onGetAnnotationsError","onGetAnnotationsSuccess","onGetStructTreeError","onGetStructTreeSuccess","onGetTextError","onGetTextSuccess","onLoadError","onLoadSuccess","onRenderAnnotationLayerError","onRenderAnnotationLayerSuccess","onRenderError","onRenderSuccess","onRenderTextLayerError","onRenderTextLayerSuccess","pageIndex","pageNumber","pdf","registerPage","renderAnnotationLayer","renderForms","renderMode","renderTextLayer","rotate","scale","unregisterPage","width"]),[Ze,fe]=xe(),{value:q,error:Ae}=Ze,De=t.useRef(null);F(Q,"Attempted to load a page, but no document was specified.");const O=pe(ee)?ee-1:K??null,G=ee??(pe(K)?K+1:null),W=Re??(q?q.rotate:null),$=t.useMemo(()=>{if(!q)return null;let ve=1;const Xe=je??bt;if(be||A){const Se=q.getViewport({scale:1,rotation:W});be?ve=be/Se.width:A&&(ve=A/Se.height)}return Xe*ve},[A,q,W,je,be]);function Ve(){return()=>{pe(O)&&l&&we&&we(O)}}t.useEffect(Ve,[l,Q,O,we]);function Ht(){if(h){if(!q||!$)return;h(He(q,$))}if(l&&oe){if(!pe(O)||!De.current)return;oe(O,De.current)}}function Ut(){Ae&&(re(!1,Ae.toString()),p&&p(Ae))}function Kt(){fe({type:"RESET"})}t.useEffect(Kt,[fe,Q,O]);function Wt(){if(!Q||!G)return;const ve=Te(Q.getPage(G)),Xe=ve;return ve.promise.then(Se=>{fe({type:"RESOLVE",value:Se})}).catch(Se=>{fe({type:"REJECT",error:Se})}),()=>ce(Xe)}t.useEffect(Wt,[fe,Q,O,G,oe]),t.useEffect(()=>{if(q!==void 0){if(q===!1){Ut();return}Ht()}},[q,$]);const Jt=t.useMemo(()=>q&&pe(O)&&G&&pe(W)&&pe($)?{_className:o,canvasBackground:m,customTextRenderer:k,devicePixelRatio:w,onGetAnnotationsError:x,onGetAnnotationsSuccess:P,onGetStructTreeError:b,onGetStructTreeSuccess:j,onGetTextError:u,onGetTextSuccess:g,onRenderAnnotationLayerError:D,onRenderAnnotationLayerSuccess:E,onRenderError:d,onRenderSuccess:L,onRenderTextLayerError:B,onRenderTextLayerSuccess:Z,page:q,pageIndex:O,pageNumber:G,renderForms:ye,renderTextLayer:he,rotate:W,scale:$}:null,[o,m,k,w,x,P,b,j,u,g,D,E,d,L,B,Z,q,O,G,ye,he,W,$]),Yt=t.useMemo(()=>At(ze,()=>q&&($?He(q,$):void 0)),[ze,q,$]),qe=`${O}@${$}/${W}`,Zt=`${O}/${W}`;function Xt(){switch(ue){case"custom":return F(T,'renderMode was set to "custom", but no customRenderer was passed.'),V.createElement(T,{key:`${qe}_custom`});case"none":return null;case"svg":return V.createElement(fr,{key:`${Zt}_svg`});case"canvas":default:return V.createElement(hr,{key:`${qe}_canvas`,canvasRef:R})}}function Qt(){return he?V.createElement(gr,{key:`${qe}_text`}):null}function en(){return ie?V.createElement(mr,{key:`${qe}_annotations`}):null}function tn(){return V.createElement(_t.Provider,{value:Jt},Xt(),Qt(),en(),f)}function nn(){return G?Q===null||q===void 0||q===null?V.createElement(Ce,{type:"loading"},typeof C=="function"?C():C):Q===!1||q===!1?V.createElement(Ce,{type:"error"},typeof S=="function"?S():S):tn():V.createElement(Ce,{type:"no-data"},typeof v=="function"?v():v)}return V.createElement("div",Object.assign({className:We(o,y),"data-page-number":G,ref:Mt(c,De),style:{"--scale-factor":`${$}`,backgroundColor:m||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"}},Yt),nn())},tt=s.oneOfType([s.func,s.node]);$t.propTypes=Object.assign(Object.assign({},Bt),{canvasBackground:s.string,canvasRef:ct,children:s.node,className:Nt,customRenderer:s.func,customTextRenderer:s.func,devicePixelRatio:s.number,error:tt,height:s.number,imageResourcesPath:s.string,inputRef:ct,loading:tt,noData:tt,onGetTextError:s.func,onGetTextSuccess:s.func,onLoadError:s.func,onLoadSuccess:s.func,onRenderError:s.func,onRenderSuccess:s.func,onRenderTextLayerError:s.func,onRenderTextLayerSuccess:s.func,pageIndex:Xn,pageNumber:Qn,pdf:er,renderAnnotationLayer:s.bool,renderForms:s.bool,renderMode:tr,renderTextLayer:s.bool,rotate:nr,scale:s.number,width:s.number});const yr=$t;ae.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${ae.version}/pdf.worker.js`;const jr=n=>{const[r,a]=t.useState(900),[i,o]=t.useState(),[l,m]=t.useState(1),[R,f]=t.useState(!1),y=w=>{m(S=>S+w)},T=()=>{y(-1)},k=()=>{y(1)};return t.useEffect(()=>{a(window.innerWidth)},[n.randKey]),e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("div",{style:{maxHeight:"85vh",minHeight:"85vh",overflowY:"auto",overflowX:"hidden"},onContextMenu:w=>{},children:e.jsx(or,{file:n.book.file,onLoadSuccess:({numPages:w})=>{o(w),f(!0)},children:e.jsx(yr,{pageNumber:l,width:r/1.3})})}),R&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",paddingTop:"10px"},children:[e.jsxs(_,{disabled:l<=1,onClick:T,children:[e.jsx(rn,{}),"Previous Page (",l," of ",i,")"]}),"  ",e.jsxs(_,{disabled:l===i,onClick:k,children:["Next Page (",l," of ",i,")",e.jsx(sn,{})]})]})]})})},{Search:br}=se,vr=n=>{const[r,a]=t.useState(!1),[i,o]=t.useState(!1),[l,m]=t.useState(),[R,f]=t.useState(0),[y,T]=t.useState(0),[k,w]=t.useState(1),[S,A]=t.useState([]),[c,C]=t.useState(),[v,x]=t.useState(!1);I.useForm();const{push:P}=Y(),b=h=>{C(h),x(!0)},j=async(h,D="")=>{a(!0);const{data:E}=await J.custom({url:"",method:"get",meta:{operation:"userBooks",variables:{page:{value:h,type:"Int",required:!0},key:{value:D,type:"String",required:!1},pageSize:{value:20,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","averageRating","downloadable","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}]}}).catch(d=>(z.error("Error getting Books"),{data:null})).then(d=>d);E&&(f(E.total),T(E.pages),w(E.page),A(E.results)),a(!1)},u=async()=>{o(!0);const{data:h}=await J.custom({url:"",method:"get",meta:{operation:"olibDashboardAnalytics",fields:["analytics"]}}).catch(D=>(z.error("Error fetching analytics"),{data:null})).then(D=>D);h&&m(h.analytics),o(!1)},g=async(h,D)=>{const{data:E}=await J.custom({url:"",method:"post",meta:{operation:"createBookRating",variables:{bookId:{value:D,type:"Int",required:!0},rating:{value:h,type:"Int",required:!0}},fields:["success","message",{userBook:["id",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","averageRating","downloadable","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}]}}).catch(d=>(console.log(d),{data:null})).then(d=>d);if(E){const d=S.map(L=>L.id===E.userBook.id?E.userBook:L);A(d)}},p=(h,D)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Rated: "}),e.jsxs("span",{children:[[1,2,3,4,5].map(E=>e.jsx("span",{style:{marginRight:5},children:E<=h?e.jsx(le,{title:E,children:e.jsx("a",{onClick:()=>{g(E,D)},style:{display:"inline"},children:e.jsx(ln,{style:{color:"orange"}})})}):e.jsx(le,{title:E,children:e.jsx("a",{onClick:()=>{g(E,D)},style:{display:"inline"},children:e.jsx(cn,{})})})})),e.jsx(ge,{color:"green",children:h})]})]});return t.useEffect(()=>{u(),j(k,"")},[n.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsxs(N,{container:!0,spacing:0,children:[e.jsx(N,{item:!0,xs:6,sm:6,md:2,children:e.jsx("a",{onClick:()=>P("/olib"),children:e.jsxs(Pe,{children:[e.jsx(ge,{children:l==null?void 0:l.my_books})," Books To Read"]})})}),e.jsx(N,{item:!0,xs:6,sm:6,md:2,children:e.jsx("a",{onClick:()=>P("/olib/books/public"),children:e.jsxs(Pe,{style:{cursor:"pointer"},children:[e.jsx(ge,{children:l==null?void 0:l.public_books})," Public Books"]})})})]})}),e.jsx(Me,{offsetTop:75,children:e.jsx(ne,{sx:{display:"flex",justifyContent:"center",mt:1,mb:1},children:e.jsx(N,{container:!0,spacing:0,sx:{display:"flex",justifyContent:"flex-start"},children:e.jsx(N,{item:!0,xs:12,sm:4,md:6,children:e.jsx(br,{size:"large",placeholder:"Enter Book Title, Description to search ...",onSearch:h=>j(1,h),style:{width:"100%"}})})})})}),e.jsx("div",{style:{maxHeight:"calc(100vh - 240px)",overflowY:"auto"},children:e.jsxs(Ke,{spinning:r,children:[e.jsxs(N,{container:!0,spacing:0,children:[S.length===0&&!r&&e.jsx(e.Fragment,{children:e.jsx(N,{item:!0,xs:12,sm:12,md:12,children:e.jsx(Be,{description:"No Book Published"})})}),S.map(h=>e.jsx(N,{item:!0,xs:12,sm:12,md:6,children:e.jsx(Pe,{hoverable:!0,bordered:!0,style:{margin:"2px"},type:"inner",actions:[e.jsx("span",{children:p(h.book.averageRating,h.book.id)}),e.jsxs("span",{style:{float:"right",marginRight:"10px",display:"flex"},children:[h.book.downloadable&&e.jsx(_,{icon:e.jsx(an,{}),children:e.jsx("a",{href:h.book.file,target:"_blank",download:!0,children:"Download"})}),e.jsx(_,{style:{marginRight:"10px"},icon:e.jsx(ft,{}),onClick:()=>b(h),children:"Read"}),e.jsx(Et,{trigger:["click"],overlay:e.jsxs(ke,{children:[e.jsx(ke.Item,{icon:e.jsx(ft,{}),onClick:()=>b(h),children:e.jsx("a",{rel:"noopener noreferrer",children:"Read"})}),e.jsx(ke.Item,{icon:e.jsx(on,{}),onClick:()=>z("Under construction"),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:D=>D.preventDefault(),children:e.jsx(Ct,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})]})],children:e.jsxs(N,{container:!0,spacing:0,children:[e.jsx(N,{item:!0,xs:12,sm:12,md:4,sx:{backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+h.book.cover+")"},children:e.jsx(ne,{sx:{display:{xs:"block",md:"none"},height:100,width:"100%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+h.book.cover+")"}})}),e.jsx(N,{item:!0,xs:12,sm:12,md:8,children:e.jsx(ne,{style:{padding:"10px"},children:e.jsxs(me,{direction:"vertical",children:[e.jsx("a",{children:e.jsx("h3",{children:h.book.title.length>50?h.book.title.substring(0,50)+"...":h.book.title})}),e.jsx("p",{children:h.book.description.replace(/(<([^>]+)>)/gi,"").length>100?h.book.description.replace(/(<([^>]+)>)/gi,"").substring(0,100)+"...":h.book.description.replace(/(<([^>]+)>)/gi,"")}),e.jsx("div",{children:e.jsx(me,{children:e.jsx(le,{title:"Click to View Author Profile",children:e.jsxs("a",{children:[e.jsx(Ne,{size:"small",src:h.book.author.pic}),e.jsx("span",{style:{marginLeft:"10px"},children:h.book.author.fullName})]})})})})]})})})]})})}))]}),e.jsx(X,{children:e.jsx(U,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(Oe,{defaultCurrent:k,total:R,defaultPageSize:20,onChange:h=>{w(h),j(h,"")}})})})]})}),e.jsx(Ue,{title:c==null?void 0:c.book.title,anchor:"right",width:"80vw",onClose:h=>x(h),open:v,children:e.jsx(jr,{book:c==null?void 0:c.book,randKey:Math.random()})})]})},Sr=()=>{const{push:n}=Y();return t.useEffect(()=>(document.title=de.system_name+": Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(M,{children:[e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib"),children:"Home"})}),e.jsx(M.Item,{children:"Dashboard"})]})}),e.jsx(vr,{})]})},{Search:Pr}=se,kr=n=>{const[r,a]=t.useState(!0),[i,o]=t.useState(!1),[l,m]=t.useState(0),[R,f]=t.useState(0),[y,T]=t.useState(1),[k,w]=t.useState(25),[S,A]=t.useState(""),[c,C]=t.useState(!1),[v,x]=t.useState([]);Y();const P=async(j,u="",g=25)=>{o(!0);const{data:p}=await J.custom({url:"",method:"get",meta:{operation:"booksAuthorsToAdd",variables:{page:{value:j,type:"Int",required:!0},key:{value:u,type:"String",required:!1},pageSize:{value:g,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","firstName","middleName","lastName","fullName","email","pic","isActive","created","updated","canDelete","canManage"]}]}}).catch(()=>(z.error("Error getting authors"),{data:null})).then(h=>h);p&&(m(p.total),f(p.pages),T(p.page),C(p.hasNext),x([...p.results])),o(!1)},b=async j=>{const{data:u}=await J.custom({url:"",method:"post",meta:{operation:"addBooksAuthor",variables:{authorId:{value:j,type:"Int",required:!0}},fields:["success","message",{bookAuthor:["id",{user:["id","firstName","middleName","lastName","fullName","email","pic","isActive","created","updated","canDelete","canManage"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(()=>(z.error("Error Adding Author"),{data:null})).then(g=>g);u&&(u.success?(z.success(u.message),x(v.filter(g=>parseInt(g.id.toString())!==j)),n.onAdd(u.bookAuthor)):z.error(u.message)),o(!1)};return t.useEffect(()=>{P(y,S,k),a(!1)},[n.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(Me,{offsetTop:90,children:e.jsx(X,{style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(U,{span:10,children:e.jsx(Pr,{size:"large",placeholder:"Search Purchase(s) ...",onSearch:j=>{A(j),P(1,j,k)},style:{width:"100%"}})})})}),e.jsx("div",{style:{maxHeight:"80vh",minHeight:"80vh",overflowY:"auto",overflowX:"hidden",marginTop:"10px"},children:e.jsx(Qe,{itemLayout:"horizontal",dataSource:v,renderItem:j=>e.jsx(Qe.Item,{actions:[e.jsx(Je,{title:"Adding Books Author??",onConfirm:()=>b(parseInt(j.id.toString())),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(_,{icon:e.jsx(Ie,{}),size:"large"})})],children:e.jsx(dn,{avatar:!0,title:!1,loading:i,active:!0,children:e.jsx(Qe.Item.Meta,{avatar:e.jsx(Ne,{src:j.pic}),title:e.jsx("a",{children:j.fullName}),description:e.jsx(e.Fragment,{children:e.jsx(ge,{color:"green",children:j.email})})})})})})}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(Oe,{defaultCurrent:y,total:l,pageSize:25,onChange:(j,u)=>{w(u),T(j),P(j,S,u)}})})]})},{Search:Er}=se,Cr=n=>{const[r,a]=t.useState(!1),[i,o]=t.useState(0),[l,m]=t.useState(0),[R,f]=t.useState(1),[y,T]=t.useState([]);t.useState(),t.useState(!1);const[k,w]=t.useState(!1),[S,A]=t.useState(!1);I.useForm(),Y();const c=async(v,x="")=>{a(!0);const{data:P}=await J.custom({url:"",method:"get",meta:{operation:"vertedBooksPublishers",variables:{page:{value:v,type:"Int",required:!0},key:{value:x,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{user:["id","firstName","lastName","middleName","fullName","email","pic"]},"canEdit","canDelete","canManage"]}]}}).catch(b=>(z.error("Error getting Books"),{data:null})).then(b=>b);P&&(o(P.total),m(P.pages),f(P.page),T(P.results)),a(!1)},C=async v=>{T([v,...y])};return t.useEffect(()=>{c(R,"")},[n.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(X,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:[e.jsx(U,{span:10,children:e.jsx(Er,{size:"large",placeholder:"Search Purchase(s) ...",onSearch:v=>c(1,v),style:{width:"100%"}})}),e.jsx(U,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(_,{icon:e.jsx(Ie,{}),size:"large",onClick:()=>w(!0),children:"Add Authors"})})]}),e.jsx(Ke,{spinning:r,children:e.jsxs(X,{children:[y.length===0&&e.jsx(e.Fragment,{children:e.jsx(U,{span:24,children:e.jsx(Be,{description:"No Book Published"})})}),y.map(v=>e.jsx(U,{span:6,children:e.jsx(Pe,{hoverable:!0,bordered:!0,style:{margin:"2px"},bodyStyle:{minHeight:100,maxHeight:100},actions:[e.jsx(_,{disabled:!0,size:"large",children:"100 Books"}),e.jsx(le,{title:"View Authors Details",color:"green",children:e.jsx(_,{icon:e.jsx(un,{}),size:"large",onClick:()=>A(!0)})}),e.jsx("span",{style:{background:"red"},children:v.canDelete&&e.jsx(Je,{title:"Delete the Author",okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(_,{size:"large",icon:e.jsx(ut,{})})})})],children:e.jsx(X,{children:e.jsx(U,{span:24,style:{padding:"10px"},children:e.jsx(me,{direction:"horizontal",children:e.jsxs("a",{children:[e.jsx(Ne,{src:v.user.pic,size:"large"}),e.jsx("span",{style:{marginLeft:10},children:v.user.fullName})]})})})})})},v.id))]})}),e.jsx(X,{children:e.jsx(U,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(Oe,{defaultCurrent:R,total:i})})}),e.jsx(Ue,{title:"Adding Authors",anchor:"right",width:"50vw",onClose:v=>w(v),open:k,children:e.jsx(kr,{randKey:Math.random(),onAdd:C})}),e.jsx(Ue,{title:"Author Details",width:"50vw",anchor:"right",onClose:v=>A(v),open:S,children:e.jsxs(e.Fragment,{children:[e.jsxs(te,{title:"Author Info",children:[e.jsx(te.Item,{label:"UserName",children:"Zhou Maomao"}),e.jsx(te.Item,{label:"Telephone",children:"1810000000"}),e.jsx(te.Item,{label:"Live",children:"Hangzhou, Zhejiang"}),e.jsx(te.Item,{label:"Remark",children:"empty"}),e.jsx(te.Item,{label:"Address",children:"No. 18, Wantang Road, Xihu District, Hangzhou, Zhejiang, China"})]}),e.jsxs(te,{title:"Author Company Info",children:[e.jsx(te.Item,{label:"UserName",children:"Zhou Maomao"}),e.jsx(te.Item,{label:"Telephone",children:"1810000000"}),e.jsx(te.Item,{label:"Live",children:"Hangzhou, Zhejiang"}),e.jsx(te.Item,{label:"Remark",children:"empty"}),e.jsx(te.Item,{label:"Address",children:"No. 18, Wantang Road, Xihu District, Hangzhou, Zhejiang, China"})]})]})})]})},Tr=()=>{const{push:n}=Y();return t.useEffect(()=>{document.title=de.system_name+": Books Authors"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(M,{children:[e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib"),children:"Home"})}),e.jsx(M.Item,{children:"Books Authors"})]})}),e.jsx(Cr,{randKey:Math.random()})]})},{Search:Rr}=se,wr=n=>{const[r,a]=t.useState(!1),[i,o]=t.useState(0),[l,m]=t.useState(0),[R,f]=t.useState(1),[y,T]=t.useState(25),[k,w]=t.useState(""),[S,A]=t.useState([]),[c,C]=t.useState();I.useForm();const[v,x]=t.useState(!1);Y();const P=async g=>{C(g),x(!0)},b=async(g,p="",h=25)=>{a(!0);const{data:D}=await J.custom({url:"",method:"get",meta:{operation:"myBooksOrders",variables:{page:{value:g,type:"Int",required:!0},key:{value:p,type:"String",required:!1},pageSize:{value:h,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","price","paymentDate","receiptNumber","isPaid",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]},{user:["id","firstName","middleName","lastName"]},{bill:["id","billNumber"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(E=>(z.error("Error getting Bills"),{data:null})).then(E=>E);D&&(o(D.total),m(D.pages),f(D.page),A(D.results)),a(!1)},j=async g=>{const{data:p}=await J.custom({url:"",method:"post",meta:{operation:"deleteBookOrder",variables:{id:{value:g,type:"Int",required:!0}},fields:["success","message"]}}).catch(h=>(z.error("Error deleting Order"),{data:null})).then(h=>h);p&&A(S.filter(h=>h.id!==g))},u=[{title:"Bill#",dataIndex:"billNumber",fixed:!0,render:(g,p,h)=>{var D;return e.jsx("span",{children:e.jsx("a",{children:(D=p==null?void 0:p.bill)==null?void 0:D.billNumber})})}},{title:"Book Title",dataIndex:"bookTitle",fixed:!0,render:(g,p,h)=>{var D;return e.jsx("span",{children:e.jsx("a",{children:(D=p==null?void 0:p.book)==null?void 0:D.title})})}},{title:"Bill Amount",dataIndex:"billAmount",fixed:!0,render:(g,p,h)=>e.jsxs("span",{children:[p.price," Tsh"]})},{title:"Paid",dataIndex:"isPaid",fixed:!0,render:(g,p,h)=>e.jsx("span",{children:p.isPaid?e.jsx(ge,{color:"green",children:"Yes"}):e.jsx(ge,{color:"red",children:"No"})})},{title:"Created",dataIndex:"created",render:(g,p,h)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:e.jsx(yn,{date:new Date(p.created)})})})},{title:"Status",dataIndex:"isActive",render:(g,p,h)=>e.jsx("a",{children:p!=null&&p.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(g,p,h)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[!p.isPaid&&e.jsx(Je,{title:"Are you sure to delete this Order?",onConfirm:()=>j(p.id),okText:"Yes",cancelText:"No",disabled:!(p!=null&&p.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(_,{icon:e.jsx(ut,{}),disabled:!(p!=null&&p.canDelete),size:"large"})}),p.isPaid&&e.jsx(le,{title:"Print Receipt",children:e.jsx(_,{icon:e.jsx(hn,{}),size:"large"})}),!p.isPaid&&e.jsx(le,{title:"View Order Details",placement:"topLeft",children:e.jsx(_,{icon:e.jsx(kt,{}),size:"large",onClick:()=>P(p)})})]})}];return t.useEffect(()=>{b(R,"",25)},[n.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(Me,{offsetTop:75,children:e.jsx(X,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:e.jsx(U,{span:10,children:e.jsx(Rr,{size:"large",placeholder:"Search Bill(s) ...",onSearch:g=>b(1,g,25),style:{width:"100%"}})})})}),e.jsx(X,{children:e.jsx(U,{span:24,children:e.jsx(dt,{loading:r,columns:u,dataSource:S,pagination:{onChange:(g,p)=>{T(p),b(g,k,p)},total:i,pageSize:y,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})})}),e.jsx(Fe,{title:"Order Details & Payment",open:v,width:"50vw",onClose:g=>x(g),children:e.jsx(ht,{book:c==null?void 0:c.book})})]})},Ar=()=>{const{push:n}=Y();return t.useEffect(()=>{document.title=de.system_name+": Books Orders"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(M,{children:[e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib"),children:"Home"})}),e.jsx(M.Item,{children:"Books Orders"})]})}),e.jsx(wr,{})]})},vt=[".pdf"],Dr=n=>Array.isArray(n)?n:n==null?void 0:n.fileList,Lr=n=>{const[r,a]=t.useState(""),[i,o]=t.useState(!1),[l,m]=t.useState(!1),[R,f]=t.useState(!1),[y,T]=t.useState(""),[k]=I.useForm(),w=[{label:"Public (Free)",value:!0},{label:"Private (Payable or Rentable)",value:!1}],S=async c=>{o(!0);const{data:C}=await J.custom({url:"",method:"post",meta:{operation:"publishBook",variables:{file:{value:c.file,type:"Upload",required:!0},title:{value:c.title,type:"String",required:!0},description:{value:c.description,type:"String",required:!0},price:{value:c.price,type:"Float",required:!1},isPublic:{value:c.is_public,type:"Boolean",required:!0},downloadable:{value:c.downloadable,type:"Boolean",required:!1}},fields:["success","message"]}}).catch(v=>(z.error("Error creating publishing book"),{data:null})).then(v=>v);C&&(C.success?(z.success(C.message),n.onFinish()):z.error(C.message)),o(!1)},A=c=>(c=c.replace(/[-_]/g," "),c=c.replace(/.pdf/g,""),c=c.replace(/[.]/g," "),c=c.replace(/\s+/g," "),c=c.trim(),c);return e.jsx(e.Fragment,{children:e.jsx(Ke,{spinning:i,children:e.jsxs(I,{layout:"vertical",form:k,onFinish:c=>{c.price=c.price??0,c.downloadable=R,c.description=y,S(c)},requiredMark:!0,children:[e.jsx(I.Item,{label:"Pick a Book ("+vt.join()+")",children:e.jsx(I.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:c=>{var v,x;a((v=c==null?void 0:c.file)==null?void 0:v.name);const C=(x=c==null?void 0:c.file)==null?void 0:x.name.split(".");return C.pop(),k.setFieldsValue({title:A(C.join("."))}),Dr(c)},noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload Book file"}],children:e.jsxs(nt.Dragger,{name:"file",accept:vt.join(),multiple:!1,maxCount:1,beforeUpload:()=>!1,onRemove:()=>{a(""),k.setFieldsValue({title:""})},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(rt,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})})}),e.jsx(I.Item,{name:"title",label:"Book Title",initialValue:r,rules:[{required:!0,type:"string"}],children:e.jsx(se,{size:"large",placeholder:"Enter Book Title ..."})}),e.jsx(I.Item,{name:"is_public",label:"Availability",initialValue:!0,children:e.jsx(st.Group,{options:w,onChange:c=>{m(!c.target.value)},value:!0})}),l&&e.jsx(I.Item,{label:"Book Cost (Tsh)",name:"price",rules:[{required:l,type:"number",min:1e3,message:"Price must be greater than 1000"}],children:e.jsx(lt,{style:{width:"50%"},size:"large"})}),e.jsx(I.Item,{name:"downloadable",valuePropName:"checked",children:e.jsx(at,{onChange:c=>{f(c.target.checked)},children:"Downloadable"})}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h3",{children:"Description"}),e.jsx(ot.CKEditor,{disabled:i,editor:it,data:y,onReady:c=>{c.editing.view.change(C=>{C.setStyle("min-height","100px",c.editing.view.document.getRoot())})},onChange:(c,C)=>{const v=C.getData();T(v)},config:{toolbar:{items:["bold","italic","strikethrough","underline","code","subscript","superscript","removeFormat","|","bulletedList","numberedList","todoList","|","outdent","indent","|","-","fontSize","fontFamily","fontColor","fontBackgroundColor","highlight","|","alignment","|","EmojiPanel"],shouldNotGroupWhenFull:!0},fontFamily:{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0}}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(_,{type:"primary",size:"large",htmlType:"submit",loading:i,children:"Publish"})})]})})})},$e=[".pdf"],St=n=>Array.isArray(n)?n:n==null?void 0:n.fileList,Br=n=>{var x,P,b,j,u,g,p,h,D,E;const[r,a]=t.useState(0),[i,o]=t.useState(""),[l,m]=t.useState(!1),[R,f]=t.useState(!1),[y,T]=t.useState(!1),[k,w]=t.useState(""),[S]=I.useForm(),[A]=I.useForm(),c=[{label:"Public (Free)",value:!0},{label:"Private (Payable or Rentable)",value:!1}],C=async d=>{m(!0);const{data:L}=await J.custom({url:"",method:"post",meta:{operation:"publishBook",variables:{file:{value:d.file,type:"Upload",required:!0},title:{value:d.title,type:"String",required:!0},description:{value:d.description,type:"String",required:!0},price:{value:d.price,type:"Float",required:!1},isPublic:{value:d.is_public,type:"Boolean",required:!0},downloadable:{value:d.downloadable,type:"Boolean",required:!1}},fields:["success","message"]}}).catch(B=>(z.error("Error creating publishing book"),{data:null})).then(B=>B);L&&(L.success?(z.success(L.message),n.onFinish()):z.error(L.message)),m(!1)},v=d=>(d=d.replace(/[-_]/g," "),d=d.replace(/.pdf/g,""),d=d.replace(/[.]/g," "),d=d.replace(/\s+/g," "),d=d.trim(),d);return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(_,{onClick:()=>a(0),children:"Book Info"}),e.jsx(_,{onClick:()=>a(1),children:"Edit Book Basic Info"}),e.jsx(_,{onClick:()=>a(2),children:"Edit Book Cover Image"}),e.jsx(_,{onClick:()=>a(3),children:"Edit Book Descriptions"})]}),r===0&&e.jsx(e.Fragment,{children:e.jsxs(ne,{sx:{width:"100%"},children:[e.jsxs(Le,{variant:"h4",gutterBottom:!0,children:[e.jsx("b",{children:"Title"}),": ",(x=n.book)==null?void 0:x.title,e.jsx(Ge,{})]}),e.jsxs(Le,{variant:"h5",gutterBottom:!0,children:[e.jsx("b",{children:"Availability"}),": ",(P=n.book)!=null&&P.isPublic?"Public":"Private",e.jsx(Ge,{})]}),e.jsxs(Le,{variant:"h5",gutterBottom:!0,children:[e.jsx("b",{children:"Downloadable"}),": ",(b=n.book)!=null&&b.downloadable?"Yes":"No",e.jsx(Ge,{})]}),e.jsxs(Le,{variant:"h5",gutterBottom:!0,children:[e.jsx("b",{children:"Price"}),": ",(j=n.book)==null?void 0:j.price," Tsh",e.jsx(Ge,{})]}),e.jsxs(Le,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Description"}),": ",(u=n.book)==null?void 0:u.description]})]})}),r===1&&e.jsxs(I,{layout:"vertical",form:A,onFinish:d=>{d.price=d.price??0,d.downloadable=y,d.description=k,C(d)},requiredMark:!0,initialValues:{title:(g=n.book)==null?void 0:g.title,is_public:(p=n.book)==null?void 0:p.isPublic,price:(h=n.book)==null?void 0:h.price,downloadable:(D=n.book)==null?void 0:D.downloadable},children:[e.jsx(I.Item,{name:"title",label:"Book Title",initialValue:i,rules:[{required:!0,type:"string"}],children:e.jsx(se,{size:"large",placeholder:"Enter Book Title ..."})}),e.jsx(I.Item,{name:"is_public",label:"Availability",initialValue:!0,children:e.jsx(st.Group,{options:c,onChange:d=>{f(!d.target.value)},value:!0})}),!((E=n.book)!=null&&E.isPublic)&&e.jsx(I.Item,{label:"Book Cost (Tsh)",name:"price",rules:[{required:R,type:"number",min:0}],children:e.jsx(lt,{style:{width:"50%"},size:"large"})}),e.jsx(I.Item,{name:"downloadable",valuePropName:"checked",children:e.jsx(at,{onChange:d=>{T(d.target.checked)},children:"Downloadable"})}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h3",{children:"Description"}),e.jsx(ot.CKEditor,{disabled:l,editor:it,data:k,onReady:d=>{d.editing.view.change(L=>{L.setStyle("min-height","100px",d.editing.view.document.getRoot())})},onChange:(d,L)=>{const B=L.getData();w(B)},config:{toolbar:{items:["bold","italic","strikethrough","underline","code","subscript","superscript","removeFormat","|","bulletedList","numberedList","todoList","|","outdent","indent","|","-","fontSize","fontFamily","fontColor","fontBackgroundColor","highlight","|","alignment","|","EmojiPanel"],shouldNotGroupWhenFull:!0},fontFamily:{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0}}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(_,{type:"primary",size:"large",htmlType:"submit",loading:l,children:"Publish"})})]}),r===2&&e.jsx(I,{layout:"vertical",form:S,onFinish:d=>{d.price=d.price??0,d.downloadable=y,d.description=k,C(d)},requiredMark:!0,children:e.jsx(I.Item,{label:"Pick a Book ("+$e.join()+")",children:e.jsx(I.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:d=>{var B,Z;o((B=d==null?void 0:d.file)==null?void 0:B.name);const L=(Z=d==null?void 0:d.file)==null?void 0:Z.name.split(".");return L.pop(),S.setFieldsValue({title:v(L.join("."))}),St(d)},noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload Book file"}],children:e.jsxs(nt.Dragger,{name:"file",accept:$e.join(),multiple:!1,maxCount:1,beforeUpload:()=>!1,onRemove:()=>{o(""),S.setFieldsValue({title:""})},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(rt,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})})})}),r===3&&e.jsxs(I,{layout:"vertical",form:S,onFinish:d=>{d.price=d.price??0,d.downloadable=y,d.description=k,C(d)},requiredMark:!0,children:[e.jsx(I.Item,{label:"Pick a Book ("+$e.join()+")",children:e.jsx(I.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:d=>{var B,Z;o((B=d==null?void 0:d.file)==null?void 0:B.name);const L=(Z=d==null?void 0:d.file)==null?void 0:Z.name.split(".");return L.pop(),S.setFieldsValue({title:v(L.join("."))}),St(d)},noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload Book file"}],children:e.jsxs(nt.Dragger,{name:"file",accept:$e.join(),multiple:!1,maxCount:1,beforeUpload:()=>!1,onRemove:()=>{o(""),S.setFieldsValue({title:""})},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(rt,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})})}),e.jsx(I.Item,{name:"title",label:"Book Title",initialValue:i,rules:[{required:!0,type:"string"}],children:e.jsx(se,{size:"large",placeholder:"Enter Book Title ..."})}),e.jsx(I.Item,{name:"is_public",label:"Availability",initialValue:!0,children:e.jsx(st.Group,{options:c,onChange:d=>{f(!d.target.value)},value:!0})}),R&&e.jsx(I.Item,{label:"Book Cost (Tsh)",name:"price",rules:[{required:R,type:"number",min:0}],children:e.jsx(lt,{style:{width:"50%"},size:"large"})}),e.jsx(I.Item,{name:"downloadable",valuePropName:"checked",children:e.jsx(at,{onChange:d=>{T(d.target.checked)},children:"Downloadable"})}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h3",{children:"Description"}),e.jsx(ot.CKEditor,{disabled:l,editor:it,data:k,onReady:d=>{d.editing.view.change(L=>{L.setStyle("min-height","100px",d.editing.view.document.getRoot())})},onChange:(d,L)=>{const B=L.getData();w(B)},config:{toolbar:{items:["bold","italic","strikethrough","underline","code","subscript","superscript","removeFormat","|","bulletedList","numberedList","todoList","|","outdent","indent","|","-","fontSize","fontFamily","fontColor","fontBackgroundColor","highlight","|","alignment","|","EmojiPanel"],shouldNotGroupWhenFull:!0},fontFamily:{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0}}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(_,{type:"primary",size:"large",htmlType:"submit",loading:l,children:"Publish"})})]})]})},{Search:Ir}=se,Nr=n=>{const[r,a]=t.useState(!1),[i,o]=t.useState(0),[l,m]=t.useState(0),[R,f]=t.useState(1),[y,T]=t.useState([]),[k,w]=t.useState();I.useForm();const[S,A]=t.useState(!1),[c,C]=t.useState(!1),{push:v}=Y(),x=async u=>{w(u),C(!0)},P=async()=>{j(1,""),A(!1)},b=async u=>{const{data:g}=await J.custom({url:"",method:"post",meta:{operation:"deleteBook",variables:{bookId:{value:u,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(z.error("Error deleting book"),{data:null})).then(p=>p);g&&(g.success?(z.success(g.message),T(y.filter(p=>p.id!==u))):z.error(g.message))},j=async(u,g="")=>{a(!0);const{data:p}=await J.custom({url:"",method:"get",meta:{operation:"publisherBooks",variables:{page:{value:u,type:"Int",required:!0},key:{value:g,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","file","cover","price","downloadable","publisherCanAddToReadings","created","updated","isActive","isPublic","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}}).catch(()=>(z.error("Error getting Books"),{data:null})).then(h=>h);p&&(o(p.total),m(p.pages),f(p.page),T(p.results)),a(!1)};return t.useEffect(()=>{j(R,"")},[]),e.jsxs(e.Fragment,{children:[e.jsxs(ne,{children:[e.jsx(_,{size:"large",style:{float:"right"},icon:e.jsx(Pt,{}),onClick:()=>v("/olib/books/purchases"),children:"Purchases"}),e.jsx(_,{size:"large",style:{float:"right"},icon:e.jsx(Ie,{}),onClick:()=>A(!0),children:"Publish"})]}),e.jsx(N,{container:!0,spacing:0,sx:{display:"flex",justifyContent:"flex-start"},children:e.jsx(N,{item:!0,xs:12,sm:12,md:4,lg:4,xl:4,children:e.jsx(Ir,{size:"large",placeholder:"Enter Book Title, Description to search ...",onSearch:u=>j(1,u),style:{width:"100%"}})})}),e.jsxs(N,{container:!0,spacing:0,children:[y.length===0&&e.jsx(e.Fragment,{children:e.jsx(N,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:e.jsx(Be,{description:"No Book Published"})})}),y.map(u=>e.jsx(N,{item:!0,xs:12,sm:12,md:6,lg:6,xl:6,children:e.jsx(Pe,{hoverable:!0,bordered:!0,style:{margin:"2px"},bodyStyle:{minHeight:190,maxHeight:190},type:"inner",actions:[e.jsxs("span",{style:{fontSize:"18px"},children:[u.price," Tsh"]}),e.jsxs("span",{style:{float:"right",marginRight:"10px",display:"flex"},children:[e.jsx(_,{style:{marginRight:"10px"},icon:e.jsx(pt,{}),onClick:()=>x(u),children:"View"}),e.jsx(Et,{trigger:["click"],overlay:e.jsxs(ke,{children:[e.jsx(ke.Item,{icon:e.jsx(pt,{}),onClick:()=>x(u),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"View"})}),e.jsx(ke.Item,{icon:e.jsx(ut,{}),children:e.jsx(Je,{title:"Are you sure to delete this Book?",onConfirm:()=>b(u.id),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:g=>g.preventDefault(),children:e.jsx(Ct,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})]})],children:e.jsxs(N,{container:!0,spacing:0,children:[e.jsx(N,{item:!0,xs:12,sm:12,md:4,sx:{backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+u.cover+")"},children:e.jsx(ne,{sx:{display:{xs:"block",md:"none"},height:100,width:"100%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+u.cover+")"}})}),e.jsx(N,{item:!0,xs:12,sm:12,md:8,children:e.jsx(ne,{style:{padding:"10px"},children:e.jsxs(me,{direction:"vertical",children:[e.jsx("a",{children:e.jsx("h3",{children:u.title.length>50?u.title.substring(0,50)+"...":u.title})}),e.jsx("p",{children:u.description.replace(/(<([^>]+)>)/gi,"").length>100?u.description.replace(/(<([^>]+)>)/gi,"").substring(0,100)+"...":u.description.replace(/(<([^>]+)>)/gi,"")}),e.jsx("div",{children:e.jsx(me,{children:e.jsx(le,{title:"Click to View Author Profile",children:e.jsxs("a",{children:[e.jsx(Ne,{size:"small",src:u.author.pic}),e.jsx("span",{style:{marginLeft:"10px"},children:u.author.fullName})]})})})})]})})})]})})}))]}),e.jsx(X,{children:e.jsx(U,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(Oe,{defaultCurrent:R,total:l})})}),e.jsx(Fe,{title:"Publishing Book",open:S,width:"60vw",onClose:u=>A(u),children:e.jsx(Lr,{randKey:Math.random(),onFinish:P})}),e.jsx(Ue,{title:k==null?void 0:k.title,width:"80vw",anchor:"right",onClose:u=>C(u),open:c,children:e.jsx(Br,{book:k})})]})},Or=()=>{const{push:n}=Y();return t.useEffect(()=>{document.title=de.system_name+": Publish Books"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(M,{children:[e.jsx(M.Item,{children:e.jsx("a",{onClick:()=>n("/olib"),children:"Home"})}),e.jsx(M.Item,{children:"Publish Books"})]})}),e.jsx(Nr,{})]})},Kr=n=>{const{page:r}=n;return r==="PublishBooksPage"?e.jsx(Or,{}):r==="OlibOrdersPage"?e.jsx(Ar,{}):r==="OlibBooksAuthorsPage"?e.jsx(Tr,{}):r==="OlibDashboardPage"?e.jsx(Sr,{}):r==="BooksPurchasesPage"?e.jsx(Tn,{}):r==="BooksPurchasesDisbursementsPage"?e.jsx(kn,{}):r==="BooksPublicPage"?e.jsx(vn,{}):r==="BooksMarketPlacePage"?e.jsx(bn,{}):e.jsx("div",{children:"Page not found ..."})};export{Kr as OlibPages};
