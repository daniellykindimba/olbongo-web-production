import{aA as L,i as oe,d as re,R as o,a as ie,b as B,q as se,fI as M}from"./index-62ca8c71.js";function F(t){let r;const s=l=>()=>{r=null,t.apply(void 0,oe(l))},u=function(){if(r==null){for(var l=arguments.length,c=new Array(l),d=0;d<l;d++)c[d]=arguments[d];r=L(s(c))}};return u.cancel=()=>{L.cancel(r),r=null},u}const ae=t=>{const{componentCls:r}=t;return{[r]:{position:"fixed",zIndex:t.zIndexPopup}}},le=t=>({zIndexPopup:t.zIndexBase+10}),ce=re("Affix",ae,le);function C(t){return t!==window?t.getBoundingClientRect():{top:0,bottom:window.innerHeight}}function H(t,r,s){if(s!==void 0&&Math.round(r.top)>Math.round(t.top)-s)return s+r.top}function O(t,r,s){if(s!==void 0&&Math.round(r.bottom)<Math.round(t.bottom)+s){const u=window.innerHeight-r.bottom;return s+u}}const V=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"];function fe(){return typeof window<"u"?window:null}var h;(function(t){t[t.None=0]="None",t[t.Prepare=1]="Prepare"})(h||(h={}));const ue=o.forwardRef((t,r)=>{var s;const{style:u,offsetTop:l,offsetBottom:c,prefixCls:d,className:q,rootClassName:G,children:j,target:p,onChange:S}=t,{getPrefixCls:D,getTargetContainer:U}=o.useContext(ie),A=D("affix",d),[_,$]=o.useState(!1),[f,J]=o.useState(),[K,Q]=o.useState(),E=o.useRef(h.None),T=o.useRef(null),g=o.useRef(),m=o.useRef(null),N=o.useRef(null),R=o.useRef(null),a=(s=p??U)!==null&&s!==void 0?s:fe,P=c===void 0&&l===void 0?0:l,W=()=>{if(E.current!==h.Prepare||!N.current||!m.current||!a)return;const i=a();if(i){const n={status:h.None},e=C(m.current);if(e.top===0&&e.left===0&&e.width===0&&e.height===0)return;const v=C(i),w=H(e,v,P),I=O(e,v,c);w!==void 0?(n.affixStyle={position:"fixed",top:w,width:e.width,height:e.height},n.placeholderStyle={width:e.width,height:e.height}):I!==void 0&&(n.affixStyle={position:"fixed",bottom:I,width:e.width,height:e.height},n.placeholderStyle={width:e.width,height:e.height}),n.lastAffix=!!n.affixStyle,_!==n.lastAffix&&(S==null||S(n.lastAffix)),E.current=n.status,J(n.affixStyle),Q(n.placeholderStyle),$(n.lastAffix)}},b=()=>{E.current=h.Prepare,W()},x=F(()=>{b()}),y=F(()=>{if(a&&f){const i=a();if(i&&m.current){const n=C(i),e=C(m.current),v=H(e,n,P),w=O(e,n,c);if(v!==void 0&&f.top===v||w!==void 0&&f.bottom===w)return}}b()}),z=()=>{const i=a==null?void 0:a();i&&(V.forEach(n=>{var e;g.current&&((e=T.current)===null||e===void 0||e.removeEventListener(n,g.current)),i==null||i.addEventListener(n,y)}),T.current=i,g.current=y)},X=()=>{R.current&&(clearTimeout(R.current),R.current=null);const i=a==null?void 0:a();V.forEach(n=>{var e;i==null||i.removeEventListener(n,y),g.current&&((e=T.current)===null||e===void 0||e.removeEventListener(n,g.current))}),x.cancel(),y.cancel()};o.useImperativeHandle(r,()=>({updatePosition:x})),o.useEffect(()=>(R.current=setTimeout(z),()=>X()),[]),o.useEffect(()=>{z()},[p,f]),o.useEffect(()=>{x()},[p,l,c]);const[Y,Z,k]=ce(A),ee=B(G,Z,A,k),te=B({[ee]:f});let ne=se(t,["prefixCls","offsetTop","offsetBottom","target","onChange","rootClassName"]);return Y(o.createElement(M,{onResize:x},o.createElement("div",Object.assign({style:u,className:q,ref:m},ne),f&&o.createElement("div",{style:K,"aria-hidden":"true"}),o.createElement("div",{className:te,ref:N,style:f},o.createElement(M,{onResize:x},j)))))}),he=ue;export{he as A,F as t};
