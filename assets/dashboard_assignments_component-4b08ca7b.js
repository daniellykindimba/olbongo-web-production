import{r as i,F as h,m as te,j as e,R as k,n as v,I as se,aN as ne,S as V,aA as A,av as ie,aw as g,e2 as R,aX as ae,aE as re,ax as oe,c6 as le,ah as u,e as S,bg as de,a as ce,M as x,g as y,e8 as m,aR as me,b2 as q}from"./index-d9f4923f.js";import{E as ue,A as he,a as ge,b as xe}from"./edit_assignment-c92dcffd.js";import{R as O}from"./ReactTimeAgo-cfa8a546.js";import{M as pe}from"./index-c3f2bf11.js";import"./data_objects-446cebf4.js";import"./data_objects-f63e1ada.js";import"./ckeditor-7cc783e5.js";import"./ckeditor-2d6c4104.js";import"./index-ab184d43.js";import"./index-0d548680.js";import"./PickerPanel-adf5703b.js";import"./localeData-7e1ac95b.js";import"./RangePicker-ba6ee425.js";import"./memoize-one.esm-297ddbcb.js";import"./DialogWrap-994988aa.js";import"./index-6f06488e.js";const W=r=>{const[l,o]=i.useState([]),[s,c]=i.useState(),[p,N]=i.useState(!0),[M,_]=i.useState(1);i.useState(25);const[z]=h.useForm(),[je,L]=i.useState(0),[be,B]=i.useState(0),[P,U]=i.useState(!0);te(),i.useState(!1);const[H,C]=i.useState(!1),[Y,j]=i.useState(!1),[K,b]=i.useState(!1),[X,w]=i.useState(!1);h.useForm();const[F]=h.useForm(),Z=t=>{c(t),w(!0)},G=t=>{o(l.map(n=>n.id===t.id?t:n))},D=t=>{c(t),b(!0)},I=t=>{c(t),C(!0)},J=t=>{c(t),j(!0)},f=async(t,n="",a=!1)=>{const{data:d}=await y.custom({url:"",method:"get",meta:{operation:"myAssignments",variables:{page:{value:t,type:"Int",required:!0},key:{value:n,type:"String",required:!1},overdue:{value:r.overdue?r.overdue:!1,type:"Boolean",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","totalAttachments","deadline","onlineSubmission","submitted","canSubmit","created","updated","isActive","canDelete","canEdit","canManage","canUploadAttachment","attachmentZippedFolderPath",{user:["id","firstName","middleName","lastName","fullName","pic"]},{darasa:["id"]}]}]}}).catch(E=>(m.error("Failed to fetch assignments"),{data:null})).then(E=>E);d&&(B(d.total),L(d.pages),_(d.page),U(d.hasNext),o(l.concat(d.results)),o(t===1?[...d.results]:[...l,...d.results])),N(!1)},Q=async t=>{const{data:n}=await y.custom({url:"",method:"post",meta:{operation:"deleteDarasaAssignment",variables:{id:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(a=>(m.error("Failed to delete assignment"),{data:null})).then(a=>a);n&&(n.success?(m.success(n.message),o(l.filter(a=>a.id!==t))):m.error(n.message))},$=async t=>{const{data:n}=await y.custom({url:"",method:"post",meta:{operation:"updateDarasaAssignment",variables:{id:{value:s===void 0?0:s.id,type:"Int",required:!0},title:{value:t.title,type:"String",required:!0},description:{value:t.description,type:"String",required:!0},deadline:{value:t.deadline,type:"DateTime",required:!0},online:{value:t.online,type:"Boolean",required:!0}},fields:["success","message",{assignment:["id","title","description","deadline","onlineSubmission","submitted","canSubmit",{user:["id"]},{darasa:["id"]},"created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(a=>(m.error("Failed to update assignment"),{data:null})).then(a=>a);n&&(n.success?(m(n.message),o(l.map(a=>a.id===n.assignment.id?n.assignment:a)),F.resetFields(),j(!1)):m.error(n.message))},ee=t=>{pe.confirm({title:"Deleting Assignment",icon:e.jsx(me,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>Q(t)})};return i.useEffect(()=>{f(M)},[]),e.jsxs(e.Fragment,{children:[e.jsx(k,{children:e.jsx(v,{span:16,children:e.jsx(h,{layout:"vertical",form:z,onFinish:t=>f(0,t.key,!0),children:e.jsx(h.Item,{name:"key",children:e.jsx(se,{size:"large",placeholder:"Search Assignments...",prefix:e.jsx(ne,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx("div",{id:"scrollableDiv",style:{height:"62vh",overflow:"auto"},children:e.jsxs(V,{spinning:p,children:[e.jsx(A,{itemLayout:"horizontal",dataSource:l,renderItem:t=>e.jsx("div",{style:{background:"white",marginBottom:5,paddingLeft:10,paddingTop:10},children:e.jsx(A.Item,{style:{margin:0,padding:0},actions:[e.jsx(ie,{trigger:["click"],overlay:e.jsxs(g,{children:[e.jsx(g.Item,{icon:e.jsx(R,{}),children:e.jsx("a",{target:"_blank",onClick:()=>D(t),children:"Submissions"})}),e.jsx(g.Item,{icon:e.jsx(R,{}),children:e.jsx("a",{target:"_blank",onClick:()=>I(t),children:"Attachements"})}),e.jsx(g.Item,{icon:e.jsx(ae,{}),disabled:!t.canDelete,onClick:()=>J(t),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(g.Item,{icon:e.jsx(re,{}),disabled:!t.canDelete,onClick:()=>ee(t.id),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:n=>n.preventDefault(),children:e.jsx(oe,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})],children:e.jsx(A.Item.Meta,{style:{borderBottom:"1px solid #e8e8e8",paddingBottom:10},avatar:e.jsx(le,{}),title:e.jsxs("a",{target:"_blank",rel:"noreferrer",children:[t.title,t.onlineSubmission&&e.jsx("span",{style:{marginLeft:20},children:e.jsx(u,{color:"red",children:"Online Submission"})})]}),description:e.jsxs(e.Fragment,{children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:t.description}}),e.jsxs("p",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("span",{children:[e.jsxs(u,{color:"cyan",children:[e.jsx("span",{style:{marginRight:5},children:"Created:"}),e.jsx(O,{date:new Date(t.created),locale:"en-US"})]}),e.jsxs(u,{color:"green",children:[e.jsx("span",{style:{marginRight:5},children:"Deadline:"}),e.jsx(O,{date:new Date(t.deadline),locale:"en-US"})]}),e.jsx(S,{title:"Click to View Attachments",children:e.jsx("a",{onClick:()=>I(t),children:e.jsxs(u,{color:"orange",children:[e.jsx("span",{style:{marginRight:5},children:"Attachments:"}),t.totalAttachments]})})})]}),e.jsxs("span",{children:[t.canSubmit&&!t.canManage&&e.jsx(S,{title:t.submitted?"Click to Re-submitt Your Assignment Work":"Click to Submitt Your Assignment Work",color:t.submitted?"green":"red",children:e.jsx("a",{onClick:()=>Z(t),children:e.jsx(u,{color:t.submitted?"green":"red",icon:e.jsx(de,{}),children:e.jsxs("span",{style:{marginRight:5},children:[t.submitted?"Re-submitt":"Submitt"," ","Assignment Work:"]})})})}),t.canManage&&e.jsx(S,{title:"Click to View Students Submissions",color:"green",children:e.jsx("a",{onClick:()=>D(t),children:e.jsx(u,{color:"green",children:e.jsx("span",{style:{marginRight:5},children:"Submissions"})})})})]})]})]})})},"class-assignment-link-"+t.id)},"class-resource-link-item-container-"+t.id)}),P&&e.jsx("div",{style:{textAlign:"center",marginTop:12,height:32,lineHeight:"32px"},children:e.jsx(ce,{type:"primary",onClick:()=>{f(M+1)},children:"Load More"})})]})}),e.jsx(x,{title:"Edit Assignment",open:Y,onClose:t=>j(t),width:"50vw",children:e.jsx(ue,{assignment:s,form:F,onFinish:$})}),e.jsx(x,{title:"Assignment Attachements",visible:H,onClose:t=>C(t),width:"50vw",children:e.jsx(he,{assignment:s,canManage:(s==null?void 0:s.canManage)??!1})}),e.jsx(x,{title:"Assignment Submissions",open:K,onOk:()=>b(!1),onClose:t=>b(t),width:"50vw",children:e.jsx(ge,{assignment:s,canManage:(s==null?void 0:s.canManage)??!1})}),e.jsx(x,{title:"Assignment Work Submission",open:X,onClose:t=>w(t),width:"50vw",children:e.jsx(xe,{assignment:s,canManage:(s==null?void 0:s.canManage)??!1,submitted:s==null?void 0:s.submitted,onFinish:G})})]})},{TabPane:T}=q,Te=r=>{var s,c;const[l,o]=i.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(V,{spinning:r.loading,children:e.jsx("a",{onClick:()=>o(!0),style:{padding:"0px !important",cursor:"pointer"},children:e.jsxs("span",{onClick:()=>o(!0),style:{padding:"0px !important",cursor:"pointer"},children:[e.jsx(k,{children:e.jsxs(v,{children:[e.jsx("span",{style:{marginRight:10,fontSize:20,color:"green",fontWeight:"bolder"},children:(s=r==null?void 0:r.data)==null?void 0:s.total_assignments}),e.jsx("span",{style:{fontSize:18},children:"Assignments"})]})}),e.jsx(k,{children:e.jsxs(v,{children:[e.jsx("span",{style:{marginRight:10,fontSize:20,color:"red",fontWeight:"bolder"},children:(c=r==null?void 0:r.data)==null?void 0:c.overdue_assignments}),e.jsx("span",{style:{fontSize:18},children:"Assignments Overdue"})]})})]})})}),e.jsx(x,{title:"Assignments",width:"60vw",open:l,onClose:p=>o(p),children:e.jsxs(q,{defaultActiveKey:"1",children:[e.jsx(T,{tab:"Assignments",children:e.jsx(W,{infinite:!0,overdue:!1})},"1"),e.jsx(T,{tab:"Overdue Assignments",children:e.jsx(W,{infinite:!0,overdue:!0})},"2")]})})]})};export{Te as DashboardAssignmentsComponent};
