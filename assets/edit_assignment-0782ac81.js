import{r as a,aV as S,c as H,j as e,aZ as J,aR as M,a0 as Z,cT as X,af as V,aw as C,cI as Y,iP as he,c5 as pe,c4 as ee,dq as xe,aT as te,aW as z,c9 as se,cK as ne,_ as r,g as D,cW as ae,a7 as fe,cZ as N,aQ as je,c3 as ye}from"./index-ccfcd4da.js";import{e as $,f as Se,g as ve}from"./data_objects-dd20071d.js";import{L as F}from"./index-885f566c.js";import{A as re}from"./index-3bfb9ed3.js";import{A as be}from"./index-8ddfcaf4.js";import{U as T}from"./index-200f56a0.js";import{M as R}from"./index-65dd5ac4.js";import{C as Ae}from"./ckeditor-625b9636.js";import{D as Ie}from"./index-12434ef6.js";const{Dragger:ke}=T,Q=window.innerHeight*.6,Oe=s=>{var K,G;const[o,m]=a.useState(!1),[g,p]=a.useState([]),[i,l]=a.useState(!1),[d,u]=a.useState(!0),[q,v]=a.useState(1),[j,O]=a.useState(10),[E,b]=a.useState(""),[W]=S.useForm(),[B,_]=a.useState(0),[n,c]=a.useState(0),[x,y]=a.useState(!0);H();const L=t=>{const h=["pdf","xls","xlsx","xlx","docx","doc","odt","ods","ppt","pptx","txt"],A=t.name.split(".").pop();return h.indexOf(A)===-1?(r.error("File type not supported"),T.LIST_IGNORE):t.size/1024/1024>50?(r.error("File size too large"),T.LIST_IGNORE):!0},P=async t=>{l(!0);const{onSuccess:h,onError:A,file:f,onProgress:U}=t,{data:w}=await D.custom({url:"",method:"post",meta:{operation:"uploadDarasaAssignmentAttachment",variables:{file:{value:f,type:"Upload",required:!0},title:{value:f.name,type:"String",required:!1},size:{value:f.size,type:"Decimal",required:!1},id:{value:parseInt(s.assignment===void 0?"0":s.assignment.id.toString()),type:"Int",required:!0}},onUploadProgress:I=>{const{loaded:ue,total:me}=I,ge=Math.floor(ue*100/me);U(ge)},onError:I=>{A(I),r.error(I.message)},fields:["success","message",{attachment:$}]}}).catch(()=>(r.error("Error uploading file"),{data:null})).then(I=>I);w&&(w.success?(le(),h("ok"),r("File(s) uploaded successfully")):r.error(w.message)),l(!1)},k=async(t,h="",A=!1)=>{var U,w;u(!0);const{data:f}=await D.custom({url:"",method:"get",meta:{operation:"assignmentDocuments",variables:{page:{value:parseInt(t.toString()),type:"Int",required:!1},pageSize:{value:parseInt(j.toString()),type:"Int",required:!1},key:{value:h,type:"String",required:!1},id:{value:parseInt(((U=s.assignment)==null?void 0:U.id)===void 0?"0":(w=s.assignment)==null?void 0:w.id.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:$}]}}).catch(()=>(r.error("Error fetching attachments"),{data:null})).then(I=>I);f&&(c(f.total),_(f.pages),v(f.page+1),y(f.hasNext),p([...g,...f.results])),u(!1)},ie=async t=>{const{data:h}=await D.custom({url:"",method:"post",meta:{operation:"deleteDarasaAssignmentAttachment",variables:{id:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(r.error("Error deleting attachment"),{data:null})).then(A=>A);h&&(h.success?(r.success(h.message),p(g.filter(A=>A.id.toString()!==t.toString()))):r.error(h.message)),R.destroyAll()},oe=t=>{R.confirm({title:"Confirm",icon:e.jsx(ae,{}),content:"Are you sure you want to delete this attachment?",okText:"Yes",cancelText:"Cancel",onOk:()=>ie(t)})},le=async()=>{k(1)},de=t=>{x&&!d&&t.currentTarget.scrollHeight-t.currentTarget.scrollTop===Q&&k(q,E)},ce=async()=>{b(""),g.length=0,p([]),k(1)};return a.useEffect(()=>{p([]),k(1)},[s.assignment]),e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[!o&&e.jsxs(e.Fragment,{children:[e.jsx(M,{span:10,children:e.jsx(S,{layout:"vertical",form:W,onFinish:t=>{g.length=0,p([]),v(1),b(t.key),k(0,t.key,!0)},children:e.jsx(S.Item,{name:"key",children:e.jsx(Z,{size:"large",placeholder:"Search Attachment(s)...",prefix:e.jsx(X,{}),autoComplete:"off",allowClear:!0,onChange:t=>{t.target.value===""&&ce()}})})})}),e.jsxs(M,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:[((K=s.assignment)==null?void 0:K.attachmentZippedFolderPath)&&e.jsx(V,{title:"Click To Download All Files Zipped",placement:"bottomRight",children:e.jsx(C,{size:"large",icon:e.jsx(Y,{}),onClick:()=>{var t;window.open((t=s.assignment)==null?void 0:t.attachmentZippedFolderPath,"_blank")},danger:!0,children:"Download All"})}),((G=s.assignment)==null?void 0:G.canUploadAttachment)&&e.jsx(V,{title:"Add more Assignment Attachments",placement:"bottomRight",children:e.jsx(C,{size:"large",icon:e.jsx(he,{}),disabled:!s.canManage,onClick:()=>{m(!o)},danger:!0,children:"Add Attachement"})})]})]}),o&&e.jsx(e.Fragment,{children:e.jsx(M,{span:24,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(C,{size:"large",icon:e.jsx(pe,{}),onClick:()=>{m(!o)},children:"Attachments"})})})]}),o&&e.jsx("div",{style:{marginTop:30},children:e.jsxs(ke,{customRequest:P,beforeUpload:L,multiple:!0,accept:".pdf, .xls, .xlsx, .xlx, .docx, .doc, .odt, .ods, .ppt,.pptx,.txt",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ee,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload"})]})}),!o&&e.jsxs("div",{children:[e.jsx(F,{split:!1,loading:d,size:"small",children:e.jsx(xe,{data:g,height:Q,itemHeight:100,itemKey:t=>t.id.toString(),onScroll:de,children:t=>e.jsx(F.Item,{style:{margin:0,padding:0},actions:[e.jsx(te,{trigger:["click"],placement:"topRight",overlay:e.jsxs(z,{children:[e.jsx(z.Item,{icon:e.jsx(Y,{}),children:e.jsx("a",{target:"_blank",href:t.file,rel:"noopener noreferrer",download:!0,children:"Download"})}),e.jsx(z.Item,{icon:e.jsx(se,{}),disabled:!t.canDelete,children:e.jsx("a",{rel:"noopener noreferrer",onClick:()=>oe(t.id),children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:h=>h.preventDefault(),children:e.jsx(ne,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})],children:e.jsx(F.Item.Meta,{style:{paddingBottom:0,borderBottom:"1px solid #e8e8e8"},avatar:e.jsx(re,{src:t.icon}),title:e.jsx("a",{children:t.title}),description:e.jsxs(e.Fragment,{children:[e.jsx("p",{}),e.jsxs("p",{children:[e.jsx("span",{style:{color:"orange"},children:t.size})," |",new Date(t.created).toLocaleString()]})]})})},"file-"+t.id)})}),g.length>0&&!x&&e.jsx("div",{style:{textAlign:"center",marginTop:20},children:e.jsx(be,{message:"No more attachments",type:"info"})})]})]})},Le=s=>{const[o,m]=a.useState([]),[g,p]=a.useState(!0),[i,l]=a.useState(1);a.useState(25);const[d]=S.useForm(),[u,q]=a.useState(0),[v,j]=a.useState(0),[O,E]=a.useState(!0);H();const b=async(n,c="",x=!1)=>{var L,P;const{data:y}=await D.custom({url:"",method:"get",meta:{operation:"assignmentSubmissions",variables:{page:{value:parseInt(n.toString()),type:"Int",required:!0},key:{value:c,type:"String",required:!1},id:{value:parseInt(((L=s.assignment)==null?void 0:L.id)===void 0?"0":(P=s.assignment)==null?void 0:P.id.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:Se}]}}).catch(()=>(r.error("Error fetching submissions"),{data:null})).then(k=>k);y&&(j(y.total),q(y.pages),l(y.page),E(y.hasNext),(c.length>0||c.length===0&&x)&&m(y.results),y.results.length>0&&!x&&m(o.concat(y.results))),p(!1)},W=async n=>{const{data:c}=await D.custom({url:"",method:"post",meta:{operation:"deleteAssignmentSubmission",variables:{id:{value:n,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(r.error("Error deleting submission"),{data:null})).then(x=>x);c&&(c.success?(r.success(c.message),m(o.filter(x=>x.id.toString()!==n.toString()))):r.error(c.message)),R.destroyAll()},B=async()=>{var c;const{data:n}=await D.custom({url:"",method:"post",meta:{operation:"downloadAssignmentSubmissionWorksZipped",variables:{assignmentId:{value:parseInt(((c=s.assignment)==null?void 0:c.id.toString())??"0"),type:"Int",required:!0}},fields:["success","message","zipFile"]}}).catch(()=>(r.error("Error downloading submissions"),{data:null})).then(x=>x);n&&(n.success?(r.success(n.message),window.open(n.zipFile,"_blank")):r.error(n.message))},_=n=>{R.confirm({title:"Confirm",icon:e.jsx(ae,{}),content:"Are you sure you want to delete this Submission?",okText:"Yes",cancelText:"Cancel",onOk:()=>W(n)})};return a.useEffect(()=>{m([]),b(1)},[s.assignment]),e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsx(M,{span:14,children:e.jsx(S,{layout:"vertical",form:d,onFinish:n=>b(0,n.key,!0),children:e.jsx(S.Item,{name:"key",children:e.jsx(Z,{size:"large",placeholder:"Search Assignment(s) Work ...",prefix:e.jsx(X,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(M,{span:10,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(C,{icon:e.jsx(Y,{}),size:"large",onClick:B,disabled:o.length===0||s.canManage===!1,children:"Download All Zipped"})})]}),e.jsxs("div",{id:"scrollableDiv",style:{height:"60vh",overflow:"auto"},children:[e.jsx(fe,{spinning:g,children:e.jsx(F,{itemLayout:"horizontal",dataSource:o,renderItem:n=>e.jsx("div",{style:{background:"white",marginBottom:5,paddingLeft:10,paddingTop:10},children:e.jsx(F.Item,{style:{margin:0,padding:0},actions:[e.jsx(te,{trigger:["click"],overlay:e.jsxs(z,{children:[e.jsx(z.Item,{icon:e.jsx(Y,{}),children:e.jsx("a",{target:"_blank",href:n.file,rel:"noopener noreferrer",download:!0,children:"Download"})}),e.jsx(z.Item,{icon:e.jsx(se,{}),disabled:!n.canDelete,children:e.jsx("a",{rel:"noopener noreferrer",onClick:()=>_(n.id),children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:c=>c.preventDefault(),children:e.jsx(ne,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})],children:e.jsx(F.Item.Meta,{style:{paddingBottom:0,borderBottom:"1px solid #e8e8e8"},avatar:e.jsx(re,{src:n.icon}),title:e.jsx("a",{children:n.student.user.firstName+" "+n.student.user.middleName+" "+n.student.user.lastName}),description:e.jsxs(e.Fragment,{children:[e.jsx("p",{}),e.jsxs("p",{children:[e.jsx("span",{style:{color:"orange"},children:n.size})," |",new Date(n.created).toLocaleString()]})]})})},"file-"+n.id)})})}),O&&e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:10},children:e.jsx(C,{type:"primary",onClick:()=>{b(i+1)},children:"Load More"})})]})]})},{Dragger:De}=T,Pe=s=>{const[o,m]=a.useState(!1);H();const g=i=>{const l=["pdf","xls","xlsx","xlx","docx","doc","odt","ods","ppt","pptx","txt"],d=i.name.split(".").pop();return l.indexOf(d)===-1?(r.error("File type not supported"),T.LIST_IGNORE):i.size/1024/1024>50?(r.error("File size too large"),T.LIST_IGNORE):!0},p=async i=>{m(!0);const{onSuccess:l,onError:d,file:u,onProgress:q}=i,{data:v}=await D.custom({url:"",method:"post",meta:{operation:"submittAssignmentWork",variables:{work:{value:u,type:"Upload",required:!0},extension:{value:u.name.split(".").pop(),type:"String",required:!1},size:{value:u.size,type:"Decimal",required:!1},id:{value:parseInt(s.assignment===void 0?"0":s.assignment.id.toString()),type:"Int",required:!0}},onUploadProgress:j=>{const{loaded:O,total:E}=j,b=Math.floor(O*100/E);q(b)},onError:j=>{d(j),r.error(j.message)},fields:["success","message",{assignment:ve}]}}).catch(()=>(r.error("Error uploading file"),{data:null})).then(j=>j);v&&(v.success?(l("ok"),r("Assignment uploaded successfully"),s.onFinish(v.assignment)):(d(v.message),r.error(v.message))),m(!1)};return a.useEffect(()=>{},[s.assignment]),e.jsx(e.Fragment,{children:e.jsx("div",{style:{marginTop:30},children:e.jsxs(De,{customRequest:p,beforeUpload:g,multiple:!0,accept:".pdf, .xls, .xlsx, .xlx, .docx, .doc, .odt, .ods, .ppt,.pptx,.txt",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ee,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload"})]})})})},Ue=s=>{const[o,m]=a.useState(!0),[g,p]=a.useState("");return a.useEffect(()=>{var i,l,d,u;s.form.setFieldsValue({title:(i=s.assignment)==null?void 0:i.title,description:(l=s.assignment)==null?void 0:l.description,deadline:N((d=s.assignment)==null?void 0:d.deadline),online:(u=s.assignment)==null?void 0:u.onlineSubmission})},[s.assignment,s.form]),e.jsx(e.Fragment,{children:e.jsxs(S,{layout:"vertical",form:s.form,onFinish:i=>{i.online=o,i.description=g,s.onFinish(i)},requiredMark:!1,children:[e.jsx(S.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Title"}],children:e.jsx(Z,{size:"large",placeholder:"Enter Title ..."})}),e.jsx(S.Item,{name:"online",children:e.jsx(je,{checked:o,onChange:()=>m(!o),children:"Online Submit Assignment Work"})}),e.jsx(S.Item,{name:"deadline",label:"Deadline",rules:[{required:!0,type:"date",message:"Please select Deadline"}],children:e.jsx(Ie,{showTime:{format:"HH:mm"},onChange:()=>{console.log("change")},disabledDate:i=>{var d,u;let l;return N().isAfter(N((d=s.assignment)==null?void 0:d.deadline))?l=N((u=s.assignment)==null?void 0:u.deadline).format("YYYY-MM-DD"):l=N().format("YYYY-MM-DD"),i&&i<ye(l,"YYYY-MM-DD")},style:{width:"100%"},popupStyle:{zIndex:9999}})}),e.jsx("h3",{children:"Assignment Description"}),e.jsx(Ae,{onChange:i=>{p(i)}}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(C,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})};export{Oe as A,Ue as E,Le as a,Pe as b};
