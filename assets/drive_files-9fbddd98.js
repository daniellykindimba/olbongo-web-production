import{r as s,aT as C,c as ee,u as q,j as e,aW as F,aP as x,a8 as te,av as g,a1 as re,B as se,P as oe,cl as A,g as j,_ as u,cn as ie,cL as ae,aN as h,cz as w}from"./index-c2aacc94.js";import{U as ne,a as le}from"./upload_folder-8fc94688.js";import{D as ce}from"./drive_info-af443581.js";import{d as E,f as me}from"./data_objects-8117e4a9.js";import{F as de}from"./files_component-2c2c8389.js";import{G as pe}from"./index-1c6a345e.js";import{A as P}from"./index-e5a89580.js";import{C as ue}from"./index-792862f2.js";import{S as he}from"./SearchOutlined-0a7c7395.js";import{U as fe}from"./UploadOutlined-be53cc88.js";import{F as xe}from"./FolderOutlined-31f85b56.js";import{U as ge}from"./UserOutlined-8ee96294.js";import"./index-369d7591.js";import"./Upload-5babab10.js";import"./fade-83a387f8.js";import"./DeleteOutlined-25685737.js";import"./DownloadOutlined-6cd35f11.js";import"./InboxOutlined-da957fdf.js";import"./index-a30bfaab.js";import"./defineProperty-549f2390.js";import"./useNotification-eb255a2d.js";import"./DialogWrap-bd4b8c41.js";import"./index-b72f7a69.js";import"./localeData-f54d63c2.js";import"./SinglePicker-36921b7a.js";import"./index-0a439b65.js";import"./useMutateObserver-953a6ea5.js";import"./index-22b60e6b.js";import"./InputNumber-e5a9ac80.js";import"./Image-0cfd8829.js";import"./Rate-8659abbe.js";import"./index-6df0ce0b.js";import"./index-ebc226c3.js";import"./index-d1b8c76e.js";import"./EditOutlined-401a1613.js";import"./transButton-558586a5.js";import"./file_item_component-3794bacd.js";import"./index-170d2a9e.js";import"./index-30af6731.js";import"./pdf_document_viewer-ccc763c3.js";import"./SecurityScanOutlined-b845c44a.js";import"./index-c8b7207b.js";import"./index-7cd118b8.js";import"./ActionButton-af3929dc.js";import"./index.esm-da3a81a9.js";import"./index-5a878f72.js";import"./index-39dba383.js";import"./index-a4ef8b74.js";import"./ZoomOutOutlined-4d40b3b9.js";import"./index-c314d154.js";import"./DeleteOutlined-d1e219b7.js";import"./DownloadOutlined-5b7a48d4.js";import"./InfoCircleOutlined-90b30a3a.js";import"./MoreOutlined-012dadc2.js";import"./SaveOutlined-eb6339bd.js";import"./index-4f75291d.js";import"./InfoCircleFilled-137bb87b.js";import"./InfoCircleFilled-baaa675e.js";import"./SmileOutlined-e0ec5bcf.js";import"./ExclamationCircleOutlined-5ebd3c48.js";import"./Skeleton-7afb965a.js";import"./DotChartOutlined-f39c986e.js";const je=c=>{const[m,y]=s.useState(!1),[t,v]=s.useState(),[i,f]=s.useState([]),[I,D]=s.useState(!0),[d,N]=s.useState(1),[ye,O]=s.useState(0),[S,R]=s.useState(20),[T,K]=s.useState(0),[ve,L]=s.useState(!0),[b,H]=s.useState(""),[Y]=C.useForm(),{push:_}=ee(),[G,V]=s.useState(Math.random()),[W,k]=s.useState(!1),a=q(),[J,U]=s.useState(!1),M=!pe.useBreakpoint().lg,Q=()=>{V(Math.random()),k(!0)},B=async r=>{const{data:o}=await j.custom({url:"",method:"get",meta:{operation:"drive",variables:{id:{value:r,type:"Int",required:!0}},fields:E}}).catch(()=>(u.error("Error occured while fetching drive data"),{data:null})).then(p=>p);o&&(v(o),y(!0))},z=r=>{f([...r,...i])},n=async(r,o="",p=20)=>{D(!0);const{data:l}=await j.custom({url:"",method:"get",meta:{operation:"driveFiles",variables:{id:{value:parseInt(a.drive.toString()),type:"Int",required:!0},page:{value:r,type:"Int",required:!0},key:{value:o,type:"String",required:!1},pageSize:{value:p,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:me}]}}).catch(()=>(u.error("Error occured while fetching files"),{data:null})).then($=>$);l&&(K(l.total),N(l.page),O(l.pages),L(l.hasNext),f(l.results)),D(!1)},X=(r,o)=>{R(o),n(d,b,o)},Z=async r=>{const{data:o}=await j.custom({url:"",method:"post",meta:{operation:"connectDrive",variables:{id:{value:r,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(u.error("Drive connection failed"),{data:null})).then(p=>p);o&&(o.success?(u(o.message),B(parseInt(a.drive.toString())),n(d,"",20)):u.error(o.message))};return s.useEffect(()=>{B(parseInt(a.drive.toString())),n(d,"",20)},[a.drive]),m?t!=null&&t.isBlocked?e.jsx("div",{children:e.jsx(P,{message:"You can not Access this Drive, you are blocked",type:"error",showIcon:!0})}):t!=null&&t.isConnected?e.jsxs(e.Fragment,{children:[t&&e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(F,{children:[e.jsx(x,{span:12,children:e.jsx(C,{layout:"vertical",form:Y,onFinish:r=>{H(r.key),n(1,r.key,S)},children:e.jsx(C.Item,{name:"key",children:e.jsx(re,{size:"large",placeholder:"Search file(s)...",prefix:e.jsx(he,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(x,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(g,{size:"large",icon:e.jsx(fe,{}),onClick:()=>Q(),loading:!m,disabled:!(t!=null&&t.isAuthor)||(t==null?void 0:t.isArchived),children:"Upload File(s)"}),e.jsx(g,{size:"large",icon:e.jsx(xe,{}),onClick:()=>U(!0),loading:!m,disabled:!(t!=null&&t.isAuthor)||(t==null?void 0:t.isArchived),children:"Upload Folder"}),e.jsx(g,{size:"large",icon:e.jsx(ge,{}),disabled:!(t!=null&&t.canManage)||(t==null?void 0:t.isArchived),onClick:()=>_("/odrive/drive/"+a.drive+"/"+a.code+"/members"),children:"Members"})]})]}),e.jsx(se,{sx:{maxHeight:"calc(100vh - 270px)",overflowY:"auto"},children:e.jsx(de,{showDrive:!1,loading:I,data:i,min:c.min??!1,onRefresh:()=>{alert("refresh2"),n(1,"",20)}})})]}),!I&&i.length>0&&e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:10,marginTop:15},children:e.jsx(oe,{showSizeChanger:!0,showQuickJumper:!0,defaultCurrent:d,current:d,total:T,pageSize:S,onShowSizeChange:X,onChange:r=>n(r,b,S)})}),e.jsx(A,{title:"Uploading Files",open:W,onClose:r=>k(r),width:M?"100vw":"50vw",children:e.jsx(ne,{onFinish:z,random:G,mode:"drive"})}),e.jsx(A,{title:"Uploading Folder",open:J,onClose:r=>U(r),width:M?"100vw":"50vw",children:e.jsx(le,{onFinish:r=>z(r),mode:"drive",drive:t})})]}):e.jsx(F,{style:{display:"flex",justifyContent:"center"},children:e.jsx(x,{span:12,children:e.jsxs(ue,{children:[e.jsx(P,{message:"You can not Access this Drive, you are not connected, Please Click Connect button Below",type:"error",showIcon:!0,style:{marginBottom:30}}),e.jsx(ce,{id:t==null?void 0:t.id}),e.jsx(g,{type:"primary",size:"large",style:{float:"right"},onClick:()=>Z(t==null?void 0:t.id),children:"Connect"})]})})}):e.jsx(F,{children:e.jsx(x,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(te,{})})})},Mt=()=>{const[c,m]=s.useState(),y=q(),t=async v=>{const{data:i}=await j.custom({url:"",method:"get",meta:{operation:"drive",variables:{id:{value:v,type:"Int",required:!0}},fields:E}}).catch(()=>({data:null})).then(f=>f);i&&m(i)};return s.useEffect(()=>{document.title=ie.system_name+": Drive Files",t(parseInt(y.drive.toString()))},[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(ae,{children:e.jsxs(h,{children:[e.jsx(h.Item,{children:e.jsx(w,{to:"/",children:"Home"})}),e.jsx(h.Item,{children:e.jsx(w,{to:"/odrive",children:"Odrive"})}),e.jsx(h.Item,{children:e.jsx(w,{to:"/odrive/drives",children:"Drives"})}),e.jsxs(h.Item,{children:[c==null?void 0:c.name," - Files"]})]})}),e.jsx(je,{})]})};export{Mt as DriveFilesPage};
