import{r as n,F as g,m as se,j as e,R as D,n as I,I as ne,aP as ie,S as B,aC as w,ax as ae,ay as p,e2 as q,aZ as re,aG as oe,az as le,c6 as de,aj as u,e as F,bg as ce,a as me,M as x,g as b,e8 as c,aT as ue,U as _}from"./index-cdd95245.js";import{E as he,A as ge,a as pe,b as xe}from"./edit_assignment-c2600e44.js";import{R as z}from"./ReactTimeAgo-d90e120d.js";import{M as je}from"./index-d04ae3d3.js";import"./data_objects-49bfabb0.js";import"./data_objects-b1ad9e08.js";import"./ckeditor-e5396dd7.js";import"./ckeditor-f0755184.js";import"./index-c2046d3a.js";import"./index-875e851c.js";import"./PickerPanel-c8c9357d.js";import"./localeData-ee9c919c.js";import"./RangePicker-1f5cbaa1.js";import"./memoize-one.esm-297ddbcb.js";import"./DialogWrap-870f1462.js";import"./index-a087753e.js";const L=j=>{const[l,o]=n.useState([]),[s,m]=n.useState(),[f,S]=n.useState(!0),[A,h]=n.useState(1);n.useState(25);const[y]=g.useForm(),[r,v]=n.useState(0),[Ae,P]=n.useState(0),[U,H]=n.useState(!0);se(),n.useState(!1);const[K,E]=n.useState(!1),[Y,k]=n.useState(!1),[Z,M]=n.useState(!1),[G,O]=n.useState(!1);g.useForm();const[T]=g.useForm(),J=t=>{m(t),O(!0)},Q=t=>{o(l.map(i=>i.id===t.id?t:i))},R=t=>{m(t),M(!0)},W=t=>{m(t),E(!0)},X=t=>{m(t),k(!0)},C=async(t,i="",a=!1)=>{const{data:d}=await b.custom({url:"",method:"get",meta:{operation:"myAssignments",variables:{page:{value:t,type:"Int",required:!0},key:{value:i,type:"String",required:!1},overdue:{value:j.overdue?j.overdue:!1,type:"Boolean",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","totalAttachments","deadline","onlineSubmission","submitted","canSubmit","created","updated","isActive","canDelete","canEdit","canManage","canUploadAttachment","attachmentZippedFolderPath",{user:["id","firstName","middleName","lastName","fullName","pic"]},{darasa:["id"]}]}]}}).catch(V=>(c.error("Failed to fetch assignments"),{data:null})).then(V=>V);d&&(P(d.total),v(d.pages),h(d.page),H(d.hasNext),o(l.concat(d.results)),o(t===1?[...d.results]:[...l,...d.results])),S(!1)},$=async t=>{const{data:i}=await b.custom({url:"",method:"post",meta:{operation:"deleteDarasaAssignment",variables:{id:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(a=>(c.error("Failed to delete assignment"),{data:null})).then(a=>a);i&&(i.success?(c.success(i.message),o(l.filter(a=>a.id!==t))):c.error(i.message))},ee=async t=>{const{data:i}=await b.custom({url:"",method:"post",meta:{operation:"updateDarasaAssignment",variables:{id:{value:s===void 0?0:s.id,type:"Int",required:!0},title:{value:t.title,type:"String",required:!0},description:{value:t.description,type:"String",required:!0},deadline:{value:t.deadline,type:"DateTime",required:!0},online:{value:t.online,type:"Boolean",required:!0}},fields:["success","message",{assignment:["id","title","description","deadline","onlineSubmission","submitted","canSubmit",{user:["id"]},{darasa:["id"]},"created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(a=>(c.error("Failed to update assignment"),{data:null})).then(a=>a);i&&(i.success?(c(i.message),o(l.map(a=>a.id===i.assignment.id?i.assignment:a)),T.resetFields(),k(!1)):c.error(i.message))},te=t=>{je.confirm({title:"Deleting Assignment",icon:e.jsx(ue,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>$(t)})};return n.useEffect(()=>{C(A)},[]),e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsx(I,{span:16,children:e.jsx(g,{layout:"vertical",form:y,onFinish:t=>C(0,t.key,!0),children:e.jsx(g.Item,{name:"key",children:e.jsx(ne,{size:"large",placeholder:"Search Assignments...",prefix:e.jsx(ie,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx("div",{id:"scrollableDiv",style:{height:"62vh",overflow:"auto"},children:e.jsxs(B,{spinning:f,children:[e.jsx(w,{itemLayout:"horizontal",dataSource:l,renderItem:t=>e.jsx("div",{style:{background:"white",marginBottom:5,paddingLeft:10,paddingTop:10},children:e.jsx(w.Item,{style:{margin:0,padding:0},actions:[e.jsx(ae,{trigger:["click"],overlay:e.jsxs(p,{children:[e.jsx(p.Item,{icon:e.jsx(q,{}),children:e.jsx("a",{target:"_blank",onClick:()=>R(t),children:"Submissions"})}),e.jsx(p.Item,{icon:e.jsx(q,{}),children:e.jsx("a",{target:"_blank",onClick:()=>W(t),children:"Attachements"})}),e.jsx(p.Item,{icon:e.jsx(re,{}),disabled:!t.canDelete,onClick:()=>X(t),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(p.Item,{icon:e.jsx(oe,{}),disabled:!t.canDelete,onClick:()=>te(t.id),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:i=>i.preventDefault(),children:e.jsx(le,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})],children:e.jsx(w.Item.Meta,{style:{borderBottom:"1px solid #e8e8e8",paddingBottom:10},avatar:e.jsx(de,{}),title:e.jsxs("a",{target:"_blank",rel:"noreferrer",children:[t.title,t.onlineSubmission&&e.jsx("span",{style:{marginLeft:20},children:e.jsx(u,{color:"red",children:"Online Submission"})})]}),description:e.jsxs(e.Fragment,{children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:t.description}}),e.jsxs("p",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("span",{children:[e.jsxs(u,{color:"cyan",children:[e.jsx("span",{style:{marginRight:5},children:"Created:"}),e.jsx(z,{date:new Date(t.created),locale:"en-US"})]}),e.jsxs(u,{color:"green",children:[e.jsx("span",{style:{marginRight:5},children:"Deadline:"}),e.jsx(z,{date:new Date(t.deadline),locale:"en-US"})]}),e.jsx(F,{title:"Click to View Attachments",children:e.jsx("a",{onClick:()=>W(t),children:e.jsxs(u,{color:"orange",children:[e.jsx("span",{style:{marginRight:5},children:"Attachments:"}),t.totalAttachments]})})})]}),e.jsxs("span",{children:[t.canSubmit&&!t.canManage&&e.jsx(F,{title:t.submitted?"Click to Re-submitt Your Assignment Work":"Click to Submitt Your Assignment Work",color:t.submitted?"green":"red",children:e.jsx("a",{onClick:()=>J(t),children:e.jsx(u,{color:t.submitted?"green":"red",icon:e.jsx(ce,{}),children:e.jsxs("span",{style:{marginRight:5},children:[t.submitted?"Re-submitt":"Submitt"," ","Assignment Work:"]})})})}),t.canManage&&e.jsx(F,{title:"Click to View Students Submissions",color:"green",children:e.jsx("a",{onClick:()=>R(t),children:e.jsx(u,{color:"green",children:e.jsx("span",{style:{marginRight:5},children:"Submissions"})})})})]})]})]})})},"class-assignment-link-"+t.id)},"class-resource-link-item-container-"+t.id)}),U&&e.jsx("div",{style:{textAlign:"center",marginTop:12,height:32,lineHeight:"32px"},children:e.jsx(me,{type:"primary",onClick:()=>{C(A+1)},children:"Load More"})})]})}),e.jsx(x,{title:"Edit Assignment",open:Y,onClose:t=>k(t),width:"50vw",children:e.jsx(he,{assignment:s,form:T,onFinish:ee})}),e.jsx(x,{title:"Assignment Attachements",visible:K,onClose:t=>E(t),width:"50vw",children:e.jsx(ge,{assignment:s,canManage:(s==null?void 0:s.canManage)??!1})}),e.jsx(x,{title:"Assignment Submissions",open:Z,onOk:()=>M(!1),onClose:t=>M(t),width:"50vw",children:e.jsx(pe,{assignment:s,canManage:(s==null?void 0:s.canManage)??!1})}),e.jsx(x,{title:"Assignment Work Submission",open:G,onClose:t=>O(t),width:"50vw",children:e.jsx(xe,{assignment:s,canManage:(s==null?void 0:s.canManage)??!1,submitted:s==null?void 0:s.submitted,onFinish:Q})})]})},{TabPane:N}=_,We=j=>{const[l,o]=n.useState(!1),[s,m]=n.useState(0),[f,S]=n.useState(0),[A,h]=n.useState(!1),y=async()=>{o(!0);const{data:r}=await b.custom({url:"",method:"get",meta:{operation:"dashboardAssignmentsAnalytics",variables:{},fields:["totalAssignments","overdueAssignments"]}}).catch(()=>({data:null})).then(v=>v);r&&(m(r==null?void 0:r.totalAssignments),S(r==null?void 0:r.overdueAssignments)),o(!1)};return n.useEffect(()=>{y()},[j.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(B,{spinning:l,children:e.jsx("a",{onClick:()=>h(!0),style:{padding:"0px !important",cursor:"pointer"},children:e.jsxs("span",{onClick:()=>h(!0),style:{padding:"0px !important",cursor:"pointer"},children:[e.jsx(D,{children:e.jsxs(I,{children:[e.jsx("span",{style:{marginRight:10,fontSize:20,color:"green",fontWeight:"bolder"},children:s}),e.jsx("span",{style:{fontSize:18},children:"Assignments"})]})}),e.jsx(D,{children:e.jsxs(I,{children:[e.jsx("span",{style:{marginRight:10,fontSize:20,color:"red",fontWeight:"bolder"},children:f}),e.jsx("span",{style:{fontSize:18},children:"Assignments Overdue"})]})})]})})}),e.jsx(x,{title:"Assignments",width:"60vw",open:A,onClose:r=>h(r),children:e.jsxs(_,{defaultActiveKey:"1",children:[e.jsx(N,{tab:"Assignments",children:e.jsx(L,{infinite:!0,overdue:!1})},"1"),e.jsx(N,{tab:"Overdue Assignments",children:e.jsx(L,{infinite:!0,overdue:!0})},"2")]})})]})};export{We as DashboardAssignmentsComponent};
