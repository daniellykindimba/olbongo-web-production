import{r,F as f,m as N,j as e,aE as k,R as H,n as R,I as U,aP as W,B as G,aC as C,k as K,ax as X,ay as u,av as Z,aG as Q,aZ as $,aD as V,b5 as ee,e9 as te,az as ae,am as se,_ as n,aj as v,aX as I,a as re,M as T,g as m,aT as ne,S as ie,al as le}from"./index-cdd95245.js";import{E as oe}from"./edit_class_virtual_form-172de955.js";import{M as ce}from"./index-d04ae3d3.js";import"./ckeditor-e5396dd7.js";import"./ckeditor-f0755184.js";import"./index-c2046d3a.js";import"./index-875e851c.js";import"./PickerPanel-c8c9357d.js";import"./localeData-ee9c919c.js";import"./RangePicker-1f5cbaa1.js";import"./index-8e8c07f8.js";import"./InputNumber-d6d7b041.js";import"./DialogWrap-870f1462.js";import"./index-a087753e.js";const de=S=>{const[D,p]=r.useState(!1),[l,o]=r.useState([]),[c,x]=r.useState();r.useState();const[g,d]=r.useState(!0),[h,M]=r.useState(1),[ue,F]=r.useState(0),[w,q]=r.useState(!0),[A]=f.useForm();r.useState(!1);const{push:E}=N(),[Y]=f.useForm();r.useState(!1);const[z,j]=r.useState(!1),L=t=>{x(t),j(!0)},b=async(t,a)=>{const{data:s}=await m.custom({url:"",method:"post",meta:{operation:"endVirtualClass",variables:{id:{value:t,type:"Int",required:!0},stop:{value:a,type:"Boolean",required:!0}},fields:["success","message",{virtualClass:["id","name","description","startDate","endDate","duration","durationType","token","canJoin",{darasa:["id","name","code","description"]},{author:["id","firstName","lastName","middleName","fullName","email","pic"]},"created","canEdit","canDelete","canManage","updated","isActive","ended"]}]}}).catch(i=>(n.error("Error in Ending Virtual Class"),{data:null})).then(i=>i);s&&(s.success?(n(s.message),o(l.map(i=>i.id===t?s.virtualClass:i))):n.error(s.message))},O=async t=>{const{data:a}=await m.custom({url:"",method:"post",meta:{operation:"editVirtualClass",variables:{id:{value:t.id,type:"Int",required:!0},name:{value:t.name,type:"String",required:!0},description:{value:t.description,type:"String",required:!0},duration:{value:t.duration,type:"Int",required:!0},durationType:{value:t.durationType.toUpperCase(),type:"String",required:!0},startDate:{value:t.startDate,type:"DateTime",required:!0},isPublic:{value:!0,type:"Boolean",required:!0}},fields:["success","message",{virtual:["id","name","description","startDate","endDate","duration","durationType","token","canJoin",{darasa:["id","name","code","description"]},{author:["id","firstName","lastName","middleName","fullName","email","pic"]},"created","canEdit","canDelete","canManage","updated","isActive"]}]}}).catch(s=>(n.error("Error editing class"),{data:null})).then(s=>s);a&&(a.success?(n.success(a.message),o(l.map(s=>s.id===a.virtual.id?a.virtual:s)),j(!1)):n.error(a.message))},J=async t=>{const{data:a}=await m.custom({url:"",method:"post",meta:{operation:"deleteVirtualClass",variables:{id:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(s=>(n.error("Error deleting class"),{data:null})).then(s=>s);a&&(a.success?(n.success(a.message),o(l.filter(s=>s.id!==t))):n.error(a.message))},P=t=>{ce.confirm({title:"Deleting Virtual Class",icon:e.jsx(ne,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>J(t)})},y=async(t,a="",s=!1)=>{const{data:i}=await m.custom({url:"",method:"get",meta:{operation:"myVirtualClasses",variables:{page:{value:t,type:"Int",required:!0},key:{value:a,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","startDate","endDate","duration","durationType","token","canJoin","ended",{darasa:["id","name","code","description"]},{author:["id","firstName","lastName","middleName","fullName","email","pic"]},"created","canEdit","canDelete","canManage","updated","isActive"]}]}}).catch(()=>(n.error("Error fetching classes"),{data:null})).then(B=>B);i&&(F(i.total),M(i.page),q(i.hasNext),o(i.results)),d(!1)},_=async()=>{const{data:t}=await m.custom({url:"",method:"get",meta:{operation:"darasaAuth",variables:{},fields:["auth"]}}).catch(a=>(n.error("Error getting darasa auth"),{data:null})).then(a=>a);t&&p(t.auth.create_virtual_classes)};return r.useEffect(()=>{_(),y(h)},[]),g?e.jsx(e.Fragment,{children:e.jsx(k,{loading:g,active:!0})}):e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsx(R,{span:14,children:e.jsx(f,{layout:"vertical",form:A,onFinish:t=>{M(0),y(0,t.key,!0)},children:e.jsx(f.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search Public Virtual Classes...",prefix:e.jsx(W,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsxs(G,{sx:{height:"68vh"},children:[e.jsx(C,{loading:!1,itemLayout:"horizontal",loadMore:!1,dataSource:l,renderItem:t=>e.jsx(K,{children:e.jsx(C.Item,{actions:[e.jsx(X,{trigger:["click"],overlay:e.jsxs(u,{children:[e.jsx(u.Item,{icon:e.jsx(Z,{}),disabled:!t.canJoin,onClick:()=>E("/oclass/virtual/class/session/"+t.id+"/"+t.token),children:e.jsx("a",{children:"Join"})}),t.canDelete?e.jsx(u.Item,{disabled:!t.canDelete,icon:e.jsx(Q,{}),onClick:()=>P(t.id),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}):e.jsx(e.Fragment,{}),t.canManage&&e.jsx(u.Item,{icon:e.jsx($,{}),disabled:!t.canManage,onClick:()=>L(t),children:e.jsx("a",{children:"Edit"})}),t.ended?e.jsx(V,{title:"Un-Stoping Virtual Class",onConfirm:()=>b(t.id,!1),okText:"Yes",cancelText:"No",disabled:!t.canManage,overlayStyle:{zIndex:9999},children:e.jsx(u.Item,{icon:e.jsx(ee,{}),disabled:!t.canManage,children:e.jsx("a",{children:"Un-Stop"})})}):e.jsx(V,{title:"Ending/Stoping Virtual Class",onConfirm:()=>b(t.id,!0),okText:"Yes",cancelText:"No",disabled:!t.canManage,overlayStyle:{zIndex:9999},children:e.jsx(u.Item,{icon:e.jsx(te,{}),disabled:!t.canManage,children:e.jsx("a",{children:"End/Stop"})})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:a=>a.preventDefault(),children:e.jsx(ae,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})],children:e.jsx(k,{avatar:!0,title:!1,loading:!1,active:!0,children:e.jsx(C.Item.Meta,{avatar:e.jsx(se,{}),title:e.jsx("a",{onClick:()=>t.canJoin?E("/oclass/virtual/class/session/"+t.id+"/"+t.token):n("You can't join this class"),children:t.name}),description:e.jsxs(e.Fragment,{children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:t.description}}),e.jsxs("p",{children:[e.jsxs(v,{color:"green",children:["Start At:"," ",e.jsx("span",{style:{marginLeft:10},children:I(t.startDate).format("MMMM do, YYYY H:mma")})]}),e.jsxs(v,{color:"green",children:["End In:",e.jsx("span",{style:{marginLeft:10},children:I(t.endDate).format("MMMM do, YYYY H:mma")})]}),t.canJoin?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsx(v,{color:"red",children:"Not Joinable"})})]})]})})})})})}),w&&e.jsx("div",{style:{textAlign:"center",marginTop:12,height:32,lineHeight:"32px"},children:e.jsx(re,{type:"primary",onClick:()=>{y(h+1)},children:"Load More"})})]}),e.jsx(T,{title:"Editting "+(c==null?void 0:c.name),width:"40vw",open:z,onClose:t=>j(t),children:e.jsx(oe,{form:Y,darasa:c,onFinish:O})})]})},be=S=>{const[D,p]=r.useState(!1),[l,o]=r.useState(),[c,x]=r.useState(!1);N();const g=async()=>{p(!0);const{data:d}=await m.custom({url:"",method:"get",meta:{operation:"dashboardVirtualClassesAnalytics",variables:{},fields:["totalVirtualClasses"]}}).catch(h=>(n.error("Error Virtual Classes Analytics"),{data:null})).then(h=>h);d&&o(d),p(!1)};return r.useEffect(()=>{g()},[S.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ie,{spinning:D,children:e.jsx("a",{onClick:()=>x(!0),children:e.jsx("span",{children:e.jsxs(le,{children:[e.jsx("span",{style:{marginRight:10,fontSize:24,color:"green",fontWeight:"bolder"},children:l==null?void 0:l.totalVirtualClasses}),e.jsx("span",{style:{fontSize:18},children:"Virtual Classess"})]})})})}),e.jsx(T,{title:"Virtual Classes",width:"60vw",open:c,onClose:d=>x(d),footer:[],children:e.jsx(de,{})})]})};export{be as DashboardVirtualClassesComponent};
