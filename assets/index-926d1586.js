var Qt=Object.defineProperty;var er=(e,n,r)=>n in e?Qt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r;var I=(e,n,r)=>(er(e,typeof n!="symbol"?n+"":n,r),r);import{r as s,bE as It,bF as Pt,bA as tt,bG as tr,bH as rr,k as ne,bI as bt,bJ as ze,bK as xt,bL as yt,bz as nr,a$ as Ot,bM as jt,bN as sr,bO as or,aY as t,bP as Ve,bQ as Tt,bR as K,bS as Ct,bT as ir,bU as ar,bV as Oe,bW as Te,bX as lr,bY as Me,aO as _e,Q as cr,ao as ye,bZ as Z,b_ as E,b$ as rt,aK as ur,ak as De,aT as Ie,c0 as Et,aS as dr,a6 as Pe,c1 as pr,c2 as hr,c3 as mr,c4 as fr,c5 as gr,c6 as vr,c7 as de,c8 as br,c9 as xr,ca as yr,cb as jr,cc as Rt,aP as ce,cd as Cr,ce as wr,cf as kr,aM as wt,a5 as Sr,cg as Mr,ch as Ze,ci as Ir,cj as Pr,ck as kt,cl as Or,cm as ve,cn as Tr,co as Er,cp as we,cq as Be,cr as Rr,cs as St}from"./index-60f2319e.js";import{C as Lr}from"./change_password_form-e3ad29d0.js";import{D as ue}from"./index-2b95bb77.js";import{T as Qe}from"./index-9ee2500e.js";import{A as Ar}from"./index-52cf496e.js";import{C as $r,T as Lt}from"./index-372942ca.js";import{A as pe}from"./index-d67d24cb.js";import{G as nt}from"./index-0eeea9dd.js";import{D as At}from"./index-1a927b6e.js";import{L as Ke}from"./index-d14c7ff5.js";import{S as Nr}from"./school_switcher_component-5a22cb87.js";import{U as et}from"./index-edf48d1e.js";import{M as zr}from"./index-62c85f30.js";import"./transButton-7f29754e.js";import"./index-1bde99c1.js";import"./InfoCircleFilled-6d0588ac.js";import"./Skeleton-6d5c2967.js";import"./index-5d31df90.js";import"./index-fec28892.js";import"./ActionButton-3aa18717.js";import"./Upload-473b3c62.js";import"./fade-5fa5b38f.js";import"./DialogWrap-d3722b37.js";import"./index-1081035e.js";const _r=e=>{const n=s.useRef({});return s.useEffect(()=>{n.current=e}),n.current},$t=_r;function Br(e){const{badgeContent:n,invisible:r=!1,max:i=99,showZero:o=!1}=e,u=$t({badgeContent:n,max:i});let c=r;r===!1&&n===0&&!o&&(c=!0);const{badgeContent:l,max:d=i}=c?u:e,f=l&&Number(l)>d?`${d}+`:l;return{badgeContent:l,invisible:c,max:d,displayValue:f}}function Fr(e){return Pt("MuiMenuItem",e)}const Vr=It("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),ke=Vr,Dr=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Ur=(e,n)=>{const{ownerState:r}=e;return[n.root,r.dense&&n.dense,r.divider&&n.divider,!r.disableGutters&&n.gutters]},qr=e=>{const{disabled:n,dense:r,divider:i,disableGutters:o,selected:u,classes:c}=e,d=Tt({root:["root",r&&"dense",n&&"disabled",!o&&"gutters",i&&"divider",u&&"selected"]},Fr,c);return ne({},c,d)},Wr=tt(tr,{shouldForwardProp:e=>rr(e)||e==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:Ur})(({theme:e,ownerState:n})=>ne({},e.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!n.disableGutters&&{paddingLeft:16,paddingRight:16},n.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${ke.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:ze(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${ke.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:ze(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${ke.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:ze(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:ze(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${ke.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${ke.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${xt.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${xt.inset}`]:{marginLeft:52},[`& .${yt.root}`]:{marginTop:0,marginBottom:0},[`& .${yt.inset}`]:{paddingLeft:36},[`& .${bt.root}`]:{minWidth:36}},!n.dense&&{[e.breakpoints.up("sm")]:{minHeight:"auto"}},n.dense&&ne({minHeight:32,paddingTop:4,paddingBottom:4},e.typography.body2,{[`& .${bt.root} svg`]:{fontSize:"1.25rem"}}))),Gr=s.forwardRef(function(n,r){const i=nr({props:n,name:"MuiMenuItem"}),{autoFocus:o=!1,component:u="li",dense:c=!1,divider:l=!1,disableGutters:d=!1,focusVisibleClassName:f,role:j="menuitem",tabIndex:C,className:x}=i,v=Ot(i,Dr),b=s.useContext(jt),g=s.useMemo(()=>({dense:c||b.dense||!1,disableGutters:d}),[b.dense,c,d]),S=s.useRef(null);sr(()=>{o&&S.current&&S.current.focus()},[o]);const y=ne({},i,{dense:g.dense,divider:l,disableGutters:d}),R=qr(i),_=or(S,r);let B;return i.disabled||(B=C!==void 0?C:-1),t.jsx(jt.Provider,{value:g,children:t.jsx(Wr,ne({ref:_,role:j,tabIndex:B,component:u,focusVisibleClassName:Ve(R.focusVisible,f),className:Ve(R.root,x)},v,{ownerState:y,classes:R}))})}),Se=Gr;function Hr(e){return Pt("MuiBadge",e)}const Kr=It("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),re=Kr,Jr=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],Je=10,Ye=4,Yr=ir(),Xr=e=>{const{color:n,anchorOrigin:r,invisible:i,overlap:o,variant:u,classes:c={}}=e,l={root:["root"],badge:["badge",u,i&&"invisible",`anchorOrigin${K(r.vertical)}${K(r.horizontal)}`,`anchorOrigin${K(r.vertical)}${K(r.horizontal)}${K(o)}`,`overlap${K(o)}`,n!=="default"&&`color${K(n)}`]};return Tt(l,Hr,c)},Zr=tt("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,n)=>n.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Qr=tt("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,n)=>{const{ownerState:r}=e;return[n.badge,n[r.variant],n[`anchorOrigin${K(r.anchorOrigin.vertical)}${K(r.anchorOrigin.horizontal)}${K(r.overlap)}`],r.color!=="default"&&n[`color${K(r.color)}`],r.invisible&&n.invisible]}})(({theme:e})=>{var n;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:Je*2,lineHeight:1,padding:"0 6px",height:Je*2,borderRadius:Je,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen}),variants:[...Object.keys(((n=e.vars)!=null?n:e).palette).filter(r=>{var i,o;return((i=e.vars)!=null?i:e).palette[r].main&&((o=e.vars)!=null?o:e).palette[r].contrastText}).map(r=>({props:{color:r},style:{backgroundColor:(e.vars||e).palette[r].main,color:(e.vars||e).palette[r].contrastText}})),{props:{variant:"dot"},style:{borderRadius:Ye,height:Ye*2,minWidth:Ye*2,padding:0}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${re.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${re.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${re.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${re.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${re.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${re.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${re.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${re.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})}}]}}),en=s.forwardRef(function(n,r){var i,o,u,c,l,d;const f=Yr({props:n,name:"MuiBadge"}),{anchorOrigin:j={vertical:"top",horizontal:"right"},className:C,component:x,components:v={},componentsProps:b={},children:g,overlap:S="rectangular",color:y="default",invisible:R=!1,max:_=99,badgeContent:B,slots:A,slotProps:U,showZero:O=!1,variant:Q="standard"}=f,Y=Ot(f,Jr),{badgeContent:M,invisible:T,max:F,displayValue:q}=Br({max:_,invisible:R,badgeContent:B,showZero:O}),L=$t({anchorOrigin:j,color:y,overlap:S,variant:Q,badgeContent:B}),h=T||M==null&&Q!=="dot",{color:m=y,overlap:k=S,anchorOrigin:$=j,variant:w=Q}=h?L:f,W=w!=="dot"?q:void 0,V=ne({},f,{badgeContent:M,invisible:h,max:F,displayValue:W,showZero:O,anchorOrigin:$,color:m,overlap:k,variant:w}),p=Xr(V),N=(i=(o=A==null?void 0:A.root)!=null?o:v.Root)!=null?i:Zr,X=(u=(c=A==null?void 0:A.badge)!=null?c:v.Badge)!=null?u:Qr,he=(l=U==null?void 0:U.root)!=null?l:b.root,me=(d=U==null?void 0:U.badge)!=null?d:b.badge,se=Ct({elementType:N,externalSlotProps:he,externalForwardedProps:Y,additionalProps:{ref:r,as:x},ownerState:V,className:Ve(he==null?void 0:he.className,p.root,C)}),je=Ct({elementType:X,externalSlotProps:me,ownerState:V,className:Ve(p.badge,me==null?void 0:me.className)});return t.jsxs(N,ne({},se,{children:[g,t.jsx(X,ne({},je,{children:W}))]}))}),Mt=en,tn=ar(t.jsx("path",{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.39.08-.75.21-1.1.36l1.51 1.51c.32-.08.69-.13 1.09-.13M5.47 3.92 4.06 5.33 7.5 8.77c0 2.08 1.56 3.22 3.91 3.91l3.51 3.51c-.34.49-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.83-.55 2.46-1.12l2.22 2.22 1.41-1.41z"}),"MoneyOffOutlined");var st={},rn=Te;Object.defineProperty(st,"__esModule",{value:!0});var Nt=st.default=void 0,nn=rn(Oe()),sn=t;Nt=st.default=(0,nn.default)((0,sn.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");var ot={},on=Te;Object.defineProperty(ot,"__esModule",{value:!0});var zt=ot.default=void 0,an=on(Oe()),ln=t;zt=ot.default=(0,an.default)((0,ln.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle");var it={},cn=Te;Object.defineProperty(it,"__esModule",{value:!0});var _t=it.default=void 0,un=cn(Oe()),dn=t;_t=it.default=(0,un.default)((0,dn.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Mail");var at={},pn=Te;Object.defineProperty(at,"__esModule",{value:!0});var Bt=at.default=void 0,hn=pn(Oe()),mn=t;Bt=at.default=(0,hn.default)((0,mn.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications");var lt={},fn=Te;Object.defineProperty(lt,"__esModule",{value:!0});var Ft=lt.default=void 0,gn=fn(Oe()),vn=t;Ft=lt.default=(0,gn.default)((0,vn.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert");const bn=e=>{var d;const{data:n}=lr(),[r,i]=s.useState(!1),[o,u]=s.useState((d=e.user)==null?void 0:d.phone),c=async(f,j)=>{const{data:C}=await Z.custom({url:"",method:"post",meta:{operation:"selfUpdateUserProfileInformations",variables:{phone:{value:j,type:"String",required:!1}},fields:["success","message"]}}).catch(x=>({data:null})).then(x=>x);C&&(C.success?(E.success(C.message),i(!1)):E.error(C.message))},l=async f=>{const{data:j}=await Z.custom({url:"",method:"post",meta:{operation:"selfVerifyMobilePhoneNumber",variables:{phone:{value:f,type:"String",required:!0}},fields:["success","message","verified","otpSent"]}}).catch(C=>({data:null})).then(C=>C);if(j)if(j.success){if(j.otpSent)return!0}else E.error(j.message);return!1};return s.useEffect(()=>{},[e.randKey]),t.jsxs(t.Fragment,{children:[t.jsxs(ue,{title:"",column:1,labelStyle:{fontSize:22,fontWeight:"bolder"},contentStyle:{fontSize:20},children:[t.jsx(ue.Item,{label:"First Name",children:n==null?void 0:n.firstName}),t.jsx(ue.Item,{label:"Middle Name",children:n==null?void 0:n.middleName}),t.jsx(ue.Item,{label:"Last Name",children:n==null?void 0:n.lastName}),t.jsx(ue.Item,{label:"Email Address",children:t.jsx(Qe.Title,{level:4,style:{fontSize:20,width:"100%",fontWeight:"normal",marginTop:3},children:n==null?void 0:n.email})}),t.jsx(ue.Item,{label:"Gender",children:n==null?void 0:n.gender}),t.jsx(ue.Item,{label:"Mobile Phone Number",children:t.jsxs(Qe.Title,{editable:{onChange:async f=>{f&&(u(f),await l(f)&&i(!0))}},level:4,style:{fontSize:20,fontWeight:"normal",marginTop:5},children:[o&&t.jsx(t.Fragment,{children:o}),!o&&t.jsx(t.Fragment,{children:n==null?void 0:n.phone})]})})]}),t.jsx(Me,{title:"Mobile Phone Number Verification",open:r,onClose:f=>i(f),children:t.jsx(xn,{user:n,phone:o,onFinish:c})})]})},xn=e=>{const[n]=_e.useForm(),[r,i]=s.useState(!1),o=async(u,c)=>{const{data:l}=await Z.custom({url:"",method:"post",meta:{operation:"selfVerifyMobilePhoneNumber",variables:{phone:{value:u,type:"String",required:!0},otp:{value:c,type:"String",required:!1}},fields:["success","message","verified","otpSent"]}}).catch(d=>({data:null})).then(d=>d);if(l)if(l.success){if(l.verified)return!0}else E.error(l.message);return!1};return t.jsxs(t.Fragment,{children:[t.jsx(Ar,{message:`Verification code sent to ${e.phone}, check a recent SMS with four digits`,type:"info"}),t.jsxs(_e,{layout:"vertical",form:n,onFinish:u=>{e.onFinish(u.otp,e.phone)},requiredMark:!0,children:[t.jsx(_e.Item,{name:"otp",label:"Verification Code",rules:[({getFieldValue:u})=>({async validator(c,l){return l.length>=4?(i(!0),await o(e.phone,l)?Promise.resolve():Promise.reject(new Error("Verification Code is not valid"))):Promise.reject(new Error("Verification Code must be 4 characters long"))}})],children:t.jsx(cr,{size:"large",placeholder:"Enter Verification Code ..."})}),t.jsx(_e.Item,{children:t.jsx(ye,{size:"large",danger:!0,style:{float:"right"},disabled:!r,onClick:()=>{e.onFinish(n.getFieldValue("otp"),e.phone)},children:"Verify"})})]})]})},yn=e=>{const[n,r]=s.useTransition(),{push:i}=rt();return t.jsx(t.Fragment,{children:t.jsx(ur,{span:e.colSize,children:t.jsx(Qe.Link,{disabled:!e.app.canAccess,children:t.jsx(De,{spinning:n,children:t.jsx($r,{onClick:()=>{e.app.isActive?r(()=>{i("/"+e.app.url),e.onClose()}):E("Under Construction")},children:t.jsx("div",{style:{marginRight:10,marginTop:10},children:t.jsxs(Ie,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center",textAlign:"center"},children:[t.jsx(pe,{size:{xs:24,sm:32,md:40,lg:40,xl:40,xxl:50},icon:t.jsx(Et,{}),src:e.app.icon}),t.jsx("span",{style:{fontWeight:"bolder",fontSize:16},children:e.app.name})]})})})})})})})},Fe=()=>{const e=localStorage.getItem("apps");return e?JSON.parse(e):[]},jn=e=>{const[n,r]=s.useState(Fe()),[i,o]=s.useState(!0),c=!nt.useBreakpoint().lg,l=async()=>{o(!0);const{data:d}=await Z.custom({url:"",method:"get",meta:{operation:"apps",fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","icon","url","created","updated","canAccess","isActive"]}]}});localStorage.setItem("apps",JSON.stringify(d.results)),r(d.results),o(!1)};return s.useEffect(()=>{l()},[]),t.jsxs(t.Fragment,{children:[Fe().length==0&&t.jsx("div",{style:{width:"100%",textAlign:"center",marginTop:20},children:t.jsx(De,{})}),Fe().length>0&&t.jsx(dr,{align:"top",children:Fe().map(d=>t.jsx(yn,{app:d,colSize:c?12:4,onClose:()=>e.onClose()}))})]})},Cn=e=>{const[n,r]=s.useState([]),[i,o]=s.useState(!0);rt();const u=async()=>{const{data:l}=await Z.custom({url:"",method:"get",meta:{operation:"myNotifications",fields:["pages","total","page","hasNext","hasPrev",{results:["id","message","url",{sender:["id","firstName","lastName","middleName","pic","fullName"]},{receiver:["id","firstName","lastName","middleName","pic","fullName"]},"isRead","created","updated","isActive"]}]}}).catch(d=>(E.error("Failed to get notifications"),{data:null})).then(d=>d);l&&r([...n,...l.results]),o(!1)},c=async()=>{const{data:l}=await Z.custom({url:"",method:"post",meta:{operation:"clearNotifications",fields:["success","message"]}}).catch(d=>(E.error("Failed to clear notifications"),{data:null})).then(d=>d);l&&(l.success?(E.success(l.message),u()):E.error(l.message))};return s.useEffect(()=>{u(),window.addEventListener("unload",()=>{wn()})},[]),t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{paddingLeft:20,display:"flex",justifyContent:"space-between",paddingTop:20},children:[t.jsx("h3",{children:"Notifications"}),t.jsxs("span",{children:[t.jsx(Pe,{title:"Clear All",children:t.jsx("a",{style:{marginRight:20},onClick:c,children:t.jsx(pr,{})})}),t.jsx("a",{style:{marginRight:20},onClick:()=>E("Notification Settings"),children:t.jsx(hr,{})})]})]}),t.jsx(At,{style:{marginTop:0,marginBottom:0}}),t.jsx("div",{style:{maxHeight:"70vh",overflowY:"auto",overflowX:"hidden",paddingLeft:"20px"},children:t.jsx(De,{spinning:i,children:t.jsx(Ke,{itemLayout:"horizontal",dataSource:n,renderItem:l=>t.jsx("a",{children:t.jsx(Ke.Item,{children:t.jsx(Ke.Item.Meta,{avatar:t.jsx(pe,{src:l.sender.pic}),title:t.jsx("a",{children:l.message}),description:mr(l.created).fromNow()})})})})})})]})};function wn(e){throw new Error("Function not implemented.")}const{Dragger:kn}=et,Sn=e=>{const[n,r]=s.useState([]),i=o=>{const u=["png","jpg","jpeg","gif","bmp","webp","tiff","svg","psd"],c=o.name.split(".").pop();return u.indexOf(c)===-1?(E.error("File type not supported"),et.LIST_IGNORE):o.size/1024/1024>50?(E.error("File size too large"),et.LIST_IGNORE):(r([o,...n]),!0)};return s.useEffect(()=>{r([])},[e.random]),t.jsx(t.Fragment,{children:t.jsxs(kn,{customRequest:e.handleUpload,beforeUpload:i,fileList:n,multiple:!1,accept:"image/*",children:[t.jsx("p",{className:"ant-upload-drag-icon",children:t.jsx(fr,{})}),t.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload a Profile Picture"})]})})},{TabPane:Mn}=Lt,In=e=>{var c;const[n,r]=s.useState(!1),i=(l,d)=>{e.changeWidth(l),r(d)},o=async()=>{const{data:l}=await Z.custom({url:"",method:"post",meta:{operation:"removeUserProfilePhoto",variables:{id:{value:parseInt(e.user.id),type:"Int",required:!0}},fields:["success","message"]}});l.success?(E.success(l.message),e.close(),window.location.reload()):E.error(l.message)},u=async l=>{const{onSuccess:d,onError:f,file:j,onProgress:C}=l,{data:x}=await Z.custom({url:"",method:"post",meta:{operation:"uploadUserProfilePhoto",variables:{id:{value:parseInt(e.user.id),type:"Int",required:!0},photo:{value:j,type:"Upload",required:!0}},onUploadProgress:v=>{const{loaded:b,total:g}=v,S=Math.floor(b*100/g);C(S)},onError:v=>{f(v),E.error(v.message)},fields:["success","message",{user:["id","firstName","middleName","lastName","fullName","pic","email","isAdmin","isStaff","isActive"]}]}});if(x.success){d("ok"),E.success(x.message),localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(x.user));const v=localStorage.getItem("user"),{pic:b}=JSON.parse(v||"");x.user.pic===b&&window.location.reload()}else E.error(x.message)};return s.useEffect(()=>{e.triggerClose&&(r(!1),e.close())},[e.changeWidth]),t.jsx(t.Fragment,{children:n?t.jsx(Lt,{defaultActiveKey:"1",centered:!0,draggable:!0,children:t.jsxs(Mn,{tab:t.jsx("span",{style:{fontSize:18},children:"From Computer"}),children:[t.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:30,marginBottom:30},children:t.jsx(Sn,{user:e.user,handleUpload:u})}),t.jsx("span",{style:{marginRight:10},children:t.jsx(ye,{icon:t.jsx(gr,{}),size:"large",onClick:()=>i(30,!1),children:"Back"})})]},"3")}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[t.jsx("span",{style:{fontSize:18,fontWeight:"bolder"},children:"Profile picture"}),t.jsx("span",{style:{display:"block",marginTop:10},children:"A picture helps people recognize you and lets you know when you’re signed in to your account"}),t.jsxs("span",{style:{display:"block",marginTop:10},children:[t.jsx(vr,{}),"Visible across ",de.system_name," services.",t.jsx("a",{children:"Learn more"})]})]}),t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsx(pe,{src:(c=e.user)==null?void 0:c.pic,style:{width:225,height:225}})}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:30},children:[t.jsx("span",{style:{marginRight:10},children:t.jsx(ye,{icon:t.jsx(br,{}),size:"large",onClick:()=>i(60,!0),children:"Change"})}),t.jsx("span",{children:t.jsx(ye,{icon:t.jsx(xr,{}),size:"large",onClick:o,children:"Remove"})})]})]})})},{LogoutOutlined:Pn,UserOutlined:On}=Ir,Tn=()=>{const[e,n]=s.useTransition(),{data:r}=yr();jr();const[i,o]=s.useState(0),[u,c]=s.useState(!1),[l,d]=s.useState(30),[f,j]=s.useState(!1),[C,x]=s.useState(0),[v,b]=s.useState(!1),[g,S]=s.useState(!1),[y,R]=s.useState(!1),{mutate:_}=Rt(),{push:B}=rt(),A=nt.useBreakpoint(),[U,O]=s.useState(!1),[Q,Y]=s.useState(!0),M=s.useRef(null),T=!A.lg,[F,q]=s.useState(!1),L=w=>{d(w)},h=async()=>{const{data:w}=await Z.custom({url:"",method:"get",meta:{operation:"totalNotifications",fields:["total"]}}).catch(W=>({data:null})).then(W=>W);w&&o(w.total)},m=()=>{d(30),j(!0),x(Math.random())};s.useEffect(()=>{h(),q(T)},[]);const k=t.jsx(De,{spinning:e,children:t.jsx(ce,{style:{width:400,backgroundColor:"white",padding:20},children:t.jsxs("span",{ref:M,style:{margin:10,padding:30},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[t.jsx(pe,{src:r==null?void 0:r.pic,style:{width:75,height:75}}),t.jsx(Pe,{title:"Change Profile Picture",color:"green",placement:"left",children:t.jsx(ye,{shape:"circle",icon:t.jsx(Cr,{}),style:{position:"absolute",marginLeft:75,marginTop:40},onClick:()=>c(!0)})})]}),t.jsx("div",{style:{display:"flex",justifyContent:"center",fontWeight:"bolder",color:"black",marginTop:20,marginBottom:30,fontSize:24},children:r==null?void 0:r.fullName}),t.jsx(Nr,{}),t.jsx(At,{}),t.jsx(ce.Item,{onClick:()=>R(!0),icon:t.jsx(On,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Profile"},"profile"),r!=null&&r.isStaff||r!=null&&r.isAdmin?t.jsxs(t.Fragment,{children:[t.jsx(ce.Item,{onClick:()=>{n(()=>{B("/control/analytics")})},icon:t.jsx(wr,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Control Panel"},"controlpanel"),t.jsx(ce.Item,{onClick:()=>{n(()=>{B("/opay")})},style:{fontSize:18,color:"black"},icon:t.jsx(tn,{style:{color:"red"}}),children:"Billing Management"},"controlpanel")]}):t.jsx(t.Fragment,{}),!(r!=null&&r.ldapAuth)&&t.jsx(Pe,{title:"Click to Change Your Password",color:"green",children:t.jsx(ce.Item,{onClick:()=>b(!0),icon:t.jsx(kr,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Change Password"},"accountChangePassword")}),t.jsx(ce.Item,{onClick:()=>_(),icon:t.jsx(Pn,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Logout"},"logout")]})})}),$=t.jsx(ce,{style:{width:500,minHeight:50},children:t.jsx(Cn,{})});return t.jsxs(Ie,{children:[t.jsx(Ie,{style:{marginLeft:"0px",marginRight:"20px"},children:t.jsx(En,{})}),t.jsx(Ie,{style:{marginLeft:"0px",marginRight:"20px"},children:t.jsx(wt,{overlay:$,trigger:["click"],overlayStyle:{zIndex:9999},children:t.jsx(Pe,{title:"Notifications",placement:"bottom",color:"green",children:t.jsx(Sr,{count:i,children:t.jsx("a",{children:t.jsx(pe,{icon:t.jsx(Mr,{}),style:{backgroundColor:"silver"}})})})})})}),t.jsx(Ie,{style:{marginLeft:"10px"},children:t.jsx(wt,{overlay:k,trigger:["click"],overlayStyle:{zIndex:9999},children:t.jsx("a",{onClick:()=>O(!U),children:(r==null?void 0:r.pic)&&t.jsx(pe,{src:r==null?void 0:r.pic,alt:r==null?void 0:r.fullName})})})}),t.jsx(Me,{title:t.jsx(t.Fragment,{children:l>30&&t.jsx("span",{children:"Change Profile Picture"})||t.jsxs("span",{children:[de.system_name," Account"]})}),open:u,width:l+"vw",onClose:w=>c(w),children:t.jsx(In,{user:r,changeWidth:L,triggerClose:f,close:m})}),t.jsx(Me,{title:"Change Password",open:v,width:"30vw",onClose:w=>b(w),children:t.jsx(Lr,{onFinish:()=>{Y(!1)}})}),t.jsx(Me,{title:"Account Payment Settings",destroyOnClose:!0,closable:!0,open:g,width:"40vw",onClose:w=>S(w),children:t.jsx("p",{children:"Account Payment Settings"})}),t.jsx(Me,{title:(r==null?void 0:r.fullName)+" Profile Information's",open:y,width:"60vw",onClose:w=>R(w),children:t.jsx(bn,{randKey:Math.random(),user:r})})]})};function En(){const[e,n]=s.useState(null),r=!!e,o=!nt.useBreakpoint().lg,u=l=>{n(l.currentTarget)},c=()=>{n(null)};return t.jsxs("div",{children:[t.jsx(Pe,{title:"Apps",color:"green",placement:"left",children:t.jsx("span",{id:"basic-button","aria-controls":r?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":r?"true":void 0,onClick:u,style:{cursor:"pointer"},children:t.jsx(pe,{icon:t.jsx(Et,{}),style:{backgroundColor:"silver"}})})}),t.jsx(Ze,{id:"basic-menu",anchorEl:e,open:r,onClose:c,MenuListProps:{"aria-labelledby":"basic-button",style:{width:o?"100vw":"70vw"}},children:t.jsx(jn,{onClose:()=>{c()}})})]})}var Rn=Object.create,Vt=Object.defineProperty,Ln=Object.getOwnPropertyDescriptor,An=Object.getOwnPropertyNames,$n=Object.getPrototypeOf,Nn=Object.prototype.hasOwnProperty,zn=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),_n=(e,n,r,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of An(n))!Nn.call(e,o)&&o!==r&&Vt(e,o,{get:()=>n[o],enumerable:!(i=Ln(n,o))||i.enumerable});return e},Bn=(e,n,r)=>(r=e!=null?Rn($n(e)):{},_n(n||!e||!e.__esModule?Vt(r,"default",{value:e,enumerable:!0}):r,e)),Fn=zn((e,n)=>{(function(r,i){typeof e=="object"&&typeof n<"u"?i(e):typeof define=="function"&&define.amd?define(["exports"],i):(r=typeof globalThis<"u"?globalThis:r||self,i(r.fastUniqueNumbers={}))})(e,function(r){var i=function(v){return function(b){var g=v(b);return b.add(g),g}},o=function(v){return function(b,g){return v.set(b,g),g}},u=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,c=536870912,l=c*2,d=function(v,b){return function(g){var S=b.get(g),y=S===void 0?g.size:S<l?S+1:0;if(!g.has(y))return v(g,y);if(g.size<c){for(;g.has(y);)y=Math.floor(Math.random()*l);return v(g,y)}if(g.size>u)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;g.has(y);)y=Math.floor(Math.random()*u);return v(g,y)}},f=new WeakMap,j=o(f),C=d(j,f),x=i(C);r.addUniqueNumber=x,r.generateUniqueNumber=C})});Bn(Fn());var ee=(typeof window>"u"?"undefined":typeof window)=="object",J={setTimeout:ee?setTimeout.bind(window):setTimeout,clearTimeout:ee?clearTimeout.bind(window):clearTimeout,setInterval:ee?setInterval.bind(window):setInterval,clearInterval:ee?clearInterval.bind(window):clearInterval};function Vn(e){J.setTimeout=e.setTimeout,J.clearTimeout=e.clearTimeout,J.setInterval=e.setInterval,J.clearInterval=e.clearInterval}var be={},Dn=class{constructor(e){I(this,"name");I(this,"closed",!1);I(this,"mc",new MessageChannel);this.name=e,be[e]=be[e]||[],be[e].push(this),this.mc.port1.start(),this.mc.port2.start(),this.onStorage=this.onStorage.bind(this),window.addEventListener("storage",this.onStorage)}onStorage(e){if(e.storageArea!==window.localStorage||e.key.substring(0,this.name.length)!==this.name||e.newValue===null)return;let n=JSON.parse(e.newValue);this.mc.port2.postMessage(n)}postMessage(e){if(this.closed)throw new Error("InvalidStateError");let n=JSON.stringify(e),r=`${this.name}:${String(Date.now())}${String(Math.random())}`;window.localStorage.setItem(r,n),J.setTimeout(()=>{window.localStorage.removeItem(r)},500),be[this.name].forEach(i=>{i!==this&&i.mc.port2.postMessage(JSON.parse(n))})}close(){if(this.closed)return;this.closed=!0,this.mc.port1.close(),this.mc.port2.close(),window.removeEventListener("storage",this.onStorage);let e=be[this.name].indexOf(this);be[this.name].splice(e,1)}get onmessage(){return this.mc.port1.onmessage}set onmessage(e){this.mc.port1.onmessage=e}get onmessageerror(){return this.mc.port1.onmessageerror}set onmessageerror(e){this.mc.port1.onmessageerror=e}addEventListener(e,n){return this.mc.port1.addEventListener(e,n)}removeEventListener(e,n){return this.mc.port1.removeEventListener(e,n)}dispatchEvent(e){return this.mc.port1.dispatchEvent(e)}},Un=typeof window>"u"?void 0:typeof window.BroadcastChannel=="function"?window.BroadcastChannel:Dn;function qn(e=0){return new Promise(n=>J.setTimeout(n,e))}function Dt(){return Math.random().toString(36).substring(2)}var Wn=class{constructor(e,n){I(this,"options");I(this,"channel");I(this,"token",Dt());I(this,"isLeader",!1);I(this,"isDead",!1);I(this,"isApplying",!1);I(this,"reApply",!1);I(this,"intervals",[]);I(this,"listeners",[]);I(this,"deferred");this.channel=e,this.options=n,this.apply=this.apply.bind(this),this.awaitLeadership=this.awaitLeadership.bind(this),this.sendAction=this.sendAction.bind(this)}async apply(){if(this.isLeader||this.isDead)return!1;if(this.isApplying)return this.reApply=!0,!1;this.isApplying=!0;let e=!1,n=r=>{let{token:i,action:o}=r.data;i!==this.token&&(o===0&&i>this.token&&(e=!0),o===1&&(e=!0))};this.channel.addEventListener("message",n);try{return this.sendAction(0),await qn(this.options.responseTime),this.channel.removeEventListener("message",n),this.isApplying=!1,e?this.reApply?this.apply():!1:(this.assumeLead(),!0)}catch{return!1}}awaitLeadership(){if(this.isLeader)return Promise.resolve();let e=!1,n=null;return new Promise(r=>{let i=()=>{if(e)return;e=!0;try{J.clearInterval(n)}catch{}let u=this.intervals.indexOf(n);u>=0&&this.intervals.splice(u,1),this.channel.removeEventListener("message",o),r()};n=J.setInterval(()=>{this.apply().then(()=>{this.isLeader&&i()})},this.options.fallbackInterval),this.intervals.push(n);let o=u=>{let{action:c}=u.data;c===2&&this.apply().then(()=>{this.isLeader&&i()})};this.channel.addEventListener("message",o)})}sendAction(e){this.channel.postMessage({action:e,token:this.token})}assumeLead(){this.isLeader=!0;let e=n=>{let{action:r}=n.data;r===0&&this.sendAction(1)};return this.channel.addEventListener("message",e),this.listeners.push(e),this.sendAction(1)}waitForLeadership(){return this.deferred?this.deferred:(this.deferred=this.awaitLeadership(),this.deferred)}close(){if(!this.isDead){this.isDead=!0,this.isLeader=!1,this.sendAction(2);try{this.listeners.forEach(e=>this.channel.removeEventListener("message",e)),this.intervals.forEach(e=>J.clearInterval(e))}catch{}}}},Gn=class{constructor(e){I(this,"channel");I(this,"options");I(this,"elector");I(this,"token",Dt());I(this,"registry",new Map);I(this,"allIdle",!1);I(this,"isLastActive",!1);let{channelName:n}=e;if(this.options=e,this.channel=new Un(n),this.registry.set(this.token,1),e.leaderElection){let r={fallbackInterval:2e3,responseTime:100};this.elector=new Wn(this.channel,r),this.elector.waitForLeadership()}this.channel.addEventListener("message",r=>{let{action:i,token:o,data:u}=r.data;switch(i){case 3:this.registry.set(o,2);break;case 4:this.registry.delete(o);break;case 5:this.idle(o);break;case 6:this.active(o);break;case 7:this.prompt(o);break;case 8:this.start(o);break;case 9:this.reset(o);break;case 10:this.activate(o);break;case 11:this.pause(o);break;case 12:this.resume(o);break;case 13:this.options.onMessage(u);break}}),this.send(3)}get isLeader(){if(!this.elector)throw new Error('❌ Leader election is not enabled. To Enable it set the "leaderElection" property to true.');return this.elector.isLeader}prompt(e=this.token){this.registry.set(e,0);let n=[...this.registry.values()].every(r=>r===0);e===this.token&&this.send(7),n&&this.options.onPrompt()}idle(e=this.token){this.registry.set(e,2);let n=[...this.registry.values()].every(r=>r===2);e===this.token&&this.send(5),!this.allIdle&&n&&(this.allIdle=!0,this.options.onIdle())}active(e=this.token){this.allIdle=!1,this.registry.set(e,1);let n=[...this.registry.values()].some(r=>r===1);e===this.token&&this.send(6),n&&this.options.onActive(),this.isLastActive=e===this.token}start(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(8):this.options.start(!0),this.isLastActive=e===this.token}reset(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(9):this.options.reset(!0),this.isLastActive=e===this.token}activate(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(10):this.options.activate(!0),this.isLastActive=e===this.token}pause(e=this.token){e===this.token?this.send(11):this.options.pause(!0)}resume(e=this.token){e===this.token?this.send(12):this.options.resume(!0)}message(e){try{this.channel.postMessage({action:13,token:this.token,data:e})}catch{}}send(e){try{this.channel.postMessage({action:e,token:this.token})}catch{}}close(){this.options.leaderElection&&this.elector.close(),this.send(4),this.channel.close()}},Hn=ee?document:null,Kn=["mousemove","keydown","wheel","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","MSPointerDown","MSPointerMove","visibilitychange","focus"];function Jn(e,n){let r;function i(...o){r&&clearTimeout(r),r=setTimeout(()=>{e(...o),r=null},n)}return i.cancel=function(){clearTimeout(r)},i}function Xe(e,n){let r=0;return function(...i){let o=new Date().getTime();if(!(o-r<n))return r=o,e(...i)}}var P=()=>Date.now(),xe=2147483647;function Yn({timeout:e=1e3*60*20,promptTimeout:n=0,promptBeforeIdle:r=0,element:i=Hn,events:o=Kn,timers:u=void 0,immediateEvents:c=[],onPresenceChange:l=()=>{},onPrompt:d=()=>{},onIdle:f=()=>{},onActive:j=()=>{},onAction:C=()=>{},onMessage:x=()=>{},debounce:v=0,throttle:b=0,eventsThrottle:g=200,startOnMount:S=!0,startManually:y=!1,stopOnIdle:R=!1,crossTab:_=!1,name:B="idle-timer",syncTimers:A=0,leaderElection:U=!1,disabled:O=!1}={}){let Q=s.useRef(P()),Y=s.useRef(P()),M=s.useRef(null),T=s.useRef(null),F=s.useRef(0),q=s.useRef(0),L=s.useRef(0),h=s.useRef(0),m=s.useRef(!1),k=s.useRef(!1),$=s.useRef(!1),w=s.useRef(!0),W=s.useRef(!1),V=s.useRef(null),p=s.useRef(null),N=s.useRef(e),X=s.useRef(0);s.useEffect(()=>{if(n&&console.warn("⚠️ IdleTimer -- The `promptTimeout` property has been deprecated in favor of `promptBeforeIdle`. It will be removed in the next major release."),r&&n)throw new Error("❌ Both promptTimeout and promptBeforeIdle can not be set. The promptTimeout property will be deprecated in a future version.");if(e>=xe)throw new Error(`❌ The value for the timeout property must fit in a 32 bit signed integer, ${xe}.`);if(n>=xe)throw new Error(`❌ The value for the promptTimeout property must fit in a 32 bit signed integer, ${xe}.`);if(r>=xe)throw new Error(`❌ The value for the promptBeforeIdle property must fit in a 32 bit signed integer, ${xe}.`);if(r>=e)throw new Error(`❌ The value for the promptBeforeIdle property must be less than the timeout property, ${e}.`);if(r?(N.current=e-r,X.current=r):(N.current=e,X.current=n),!w.current){if(y||O)return;m.current&&(fe.current(null,D),p.current&&p.current.active()),le()}},[e,n,r,y,O]);let he=s.useRef(R);s.useEffect(()=>{he.current=R},[R]);let me=s.useRef(c),se=s.useRef(i),je=s.useRef([...new Set([...o,...c]).values()]),G=s.useRef(O);s.useEffect(()=>{G.current=O,!w.current&&(O?$e():y||le())},[O]);let Ce=s.useRef(l);s.useEffect(()=>{Ce.current=l},[l]);let Ee=s.useRef(d);s.useEffect(()=>{Ee.current=d},[d]);let Re=s.useRef(f);s.useEffect(()=>{Re.current=f},[f]);let fe=s.useRef(j);s.useEffect(()=>{fe.current=j},[j]);let Le=s.useRef(C);s.useEffect(()=>{Le.current=C},[C]);let ge=s.useRef(x);s.useEffect(()=>{ge.current=x},[x]);let oe=s.useMemo(()=>{let a=(z,Ne)=>Le.current(z,Ne);return v>0?Jn(a,v):b>0?Xe(a,b):a},[b,v]),ct=s.useRef();s.useEffect(()=>{_&&A&&(ct.current=Xe(()=>{p.current.active()},A))},[_,A]);let H=()=>{V.current!==null&&(J.clearTimeout(V.current),V.current=null)},ie=(a,z=!0)=>{H(),V.current=J.setTimeout(qe,a||N.current),z&&(T.current=P())},ut=a=>{!k.current&&!m.current&&(Ee.current(a,D),Ce.current({type:"active",prompted:!0},D)),h.current=0,L.current=P(),k.current=!0,ie(X.current,!1)},dt=()=>{H(),m.current||(Re.current(null,D),Ce.current({type:"idle"},D)),m.current=!0,M.current=P(),he.current?ae():k.current&&(L.current=0,k.current=!1)},Ue=a=>{H(),(m.current||k.current)&&(fe.current(a,D),Ce.current({type:"active",prompted:!1},D)),k.current=!1,L.current=0,m.current=!1,F.current+=P()-M.current,q.current+=P()-M.current,te(),ie()},qe=a=>{if(!m.current){oe.cancel&&oe.cancel();let z=P()-T.current;if(!(N.current+X.current<z)&&X.current>0&&!k.current){p.current?p.current.prompt():ut(a);return}p.current?p.current.idle():dt();return}p.current?p.current.active():Ue(a)},We=a=>{if(!S&&!T.current&&(T.current=P(),fe.current(null,D)),oe(a,D),k.current)return;if(H(),!m.current&&me.current.includes(a.type)){qe(a);return}let z=P()-T.current;if(m.current&&!R||!m.current&&z>=N.current){qe(a);return}$.current=!1,h.current=0,L.current=0,ie(),_&&A&&ct.current()},Ae=s.useRef(We);s.useEffect(()=>{let a=W.current;a&&ae(),g>0?Ae.current=Xe(We,g):Ae.current=We,a&&te()},[g,b,v,Le,_,A]);let te=()=>{ee&&se.current&&(W.current||(je.current.forEach(a=>{se.current.addEventListener(a,Ae.current,{capture:!0,passive:!0})}),W.current=!0))},ae=(a=!1)=>{ee&&se.current&&(W.current||a)&&(je.current.forEach(z=>{se.current.removeEventListener(z,Ae.current,{capture:!0})}),W.current=!1)},le=s.useCallback(a=>G.current?!1:(H(),te(),m.current=!1,k.current=!1,$.current=!1,h.current=0,L.current=0,p.current&&!a&&p.current.start(),ie(),!0),[V,m,G,N,p]),Ge=s.useCallback(a=>G.current?!1:(H(),te(),Y.current=P(),F.current+=P()-M.current,q.current+=P()-M.current,F.current=0,m.current=!1,k.current=!1,$.current=!1,h.current=0,L.current=0,p.current&&!a&&p.current.reset(),y||ie(),!0),[V,m,N,y,G,p]),pt=s.useCallback(a=>G.current?!1:(H(),te(),(m.current||k.current)&&Ue(),m.current=!1,k.current=!1,$.current=!1,h.current=0,L.current=0,Y.current=P(),p.current&&!a&&p.current.activate(),ie(),!0),[V,m,k,G,N,p]),$e=s.useCallback((a=!1)=>G.current||$.current?!1:(h.current=ht(),$.current=!0,ae(),H(),p.current&&!a&&p.current.pause(),!0),[V,G,p]),He=s.useCallback((a=!1)=>G.current||!$.current?!1:($.current=!1,k.current||te(),m.current||ie(h.current),L.current&&(L.current=P()),p.current&&!a&&p.current.resume(),!0),[V,N,G,h,p]),Ut=s.useCallback((a,z)=>(p.current?(z&&ge.current(a,D),p.current.message(a)):z&&ge.current(a,D),!0),[x]),qt=s.useCallback(()=>m.current,[m]),Wt=s.useCallback(()=>k.current,[k]),Gt=s.useCallback(()=>p.current?p.current.isLeader:null,[p]),Ht=s.useCallback(()=>p.current?p.current.isLastActive:null,[p]),Kt=s.useCallback(()=>p.current?p.current.token:null,[p]),ht=s.useCallback(()=>{if($.current)return h.current;let a=h.current?h.current:X.current+N.current,z=T.current?P()-T.current:0,Ne=Math.floor(a-z);return Ne<0?0:Math.abs(Ne)},[N,X,k,h,T]),mt=s.useCallback(()=>Math.round(P()-Y.current),[Y]),ft=s.useCallback(()=>Math.round(P()-Q.current),[Q]),Jt=s.useCallback(()=>M.current?new Date(M.current):null,[M]),Yt=s.useCallback(()=>T.current?new Date(T.current):null,[T]),gt=s.useCallback(()=>m.current?Math.round(P()-M.current+F.current):Math.round(F.current),[M,F]),vt=s.useCallback(()=>m.current?Math.round(P()-M.current+q.current):Math.round(q.current),[M,q]),Xt=s.useCallback(()=>{let a=Math.round(mt()-gt());return a>=0?a:0},[M,F]),Zt=s.useCallback(()=>{let a=Math.round(ft()-vt());return a>=0?a:0},[M,F]);s.useEffect(()=>{if(v>0&&b>0)throw new Error("❌ onAction can either be throttled or debounced, not both.");u&&Vn(u);let a=()=>{p.current&&p.current.close(),oe.cancel&&oe.cancel(),H(),ae(!0)};return ee&&window.addEventListener("beforeunload",a),()=>{ee&&window.removeEventListener("beforeunload",a),p.current&&p.current.close(),oe.cancel&&oe.cancel(),H(),ae(!0)}},[]),s.useEffect(()=>{p.current&&p.current.close(),_?p.current=new Gn({channelName:B,leaderElection:U,onPrompt:()=>{ut()},onIdle:()=>{dt()},onActive:()=>{Ue()},onMessage:a=>{ge.current(a,D)},start:le,reset:Ge,activate:pt,pause:$e,resume:He}):p.current=null},[_,B,U,Ee,Re,fe,ge,le,Ge,$e,He]),s.useEffect(()=>{w.current||(H(),ae(!0)),!(y||O)&&(S?le():te())},[y,S,O,w]),s.useEffect(()=>{if(!w.current){let a=[...new Set([...o,...c]).values()];if(ae(),je.current=a,se.current=i,me.current=c,y||O)return;S?le():te()}},[i,JSON.stringify(o),JSON.stringify(c),w,O,y,S]),s.useEffect(()=>{w.current&&(w.current=!1)},[w]);let D={message:Ut,start:le,reset:Ge,activate:pt,pause:$e,resume:He,isIdle:qt,isPrompted:Wt,isLeader:Gt,isLastActiveTab:Ht,getTabId:Kt,getRemainingTime:ht,getElapsedTime:mt,getTotalElapsedTime:ft,getLastIdleTime:Jt,getLastActiveTime:Yt,getIdleTime:gt,getTotalIdleTime:vt,getActiveTime:Xt,getTotalActiveTime:Zt,setOnPresenceChange:a=>{l=a,Ce.current=a},setOnPrompt:a=>{d=a,Ee.current=a},setOnIdle:a=>{f=a,Re.current=a},setOnActive:a=>{j=a,fe.current=a},setOnAction:a=>{C=a,Le.current=a},setOnMessage:a=>{x=a,ge.current=a}};return D}var Xn=s.createContext(null);Xn.Consumer;const Zn=({onIdle:e,onAction:n,idleTime:r=1})=>{const i=1e3*r,[o,u]=s.useState(!1),c=()=>{u(!0)},l=Yn({timeout:i,promptTimeout:i/2,onPrompt:e,onIdle:c,debounce:500,crossTab:!0,onAction:n,events:["mousemove","keydown","mousedown","touchstart","scroll","click","focus","resize","visibilitychange","pagehide","pageshow","beforeunload"]});return{isIdle:o,setIdle:u,idleTimer:l}},ks=e=>{const n=Pr(),[r,i]=s.useState(!1),{mutate:o}=Rt(),u=()=>{i(!0)},c=()=>{const h=localStorage.getItem("lastLoginAttemp"),m=new Date(h??new Date),k=parseInt(localStorage.getItem("expires")??"600");console.log(m),m.setSeconds(m.getSeconds()+k),m.getTime()-new Date().getTime()<2e4&&L()},{idleTimer:l}=Zn({onIdle:u,idleTime:parseInt(localStorage.getItem("expires")??"600"),onAction:c}),d=()=>{o(),i(!1)},f=kt(h=>h.collapsed),[j,C]=s.useState(null),[x,v]=s.useState(""),[b,g]=s.useState(null),S=!!j,y=!!b,R=kt(h=>h.hasSidebar),{setSiderCollapsed:_,setMobileSiderOpen:B}=Or(),A=h=>{C(h.currentTarget)},U=()=>{g(null)},O=()=>{C(null),U()},Q=h=>{g(h.currentTarget)},Y="primary-search-account-menu",M=t.jsxs(Ze,{anchorEl:j,anchorOrigin:{vertical:"top",horizontal:"right"},id:Y,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:S,onClose:O,children:[t.jsx(Se,{onClick:O,children:"Profile"}),t.jsx(Se,{onClick:O,children:"My account"})]}),T="primary-search-account-menu-mobile",F=t.jsxs(Ze,{anchorEl:b,anchorOrigin:{vertical:"top",horizontal:"right"},id:T,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:y,onClose:U,children:[t.jsxs(Se,{children:[t.jsx(we,{size:"large","aria-label":"show 4 new mails",color:"inherit",children:t.jsx(Mt,{badgeContent:4,color:"error",children:t.jsx(_t,{})})}),t.jsx("p",{children:"Messages"})]}),t.jsxs(Se,{children:[t.jsx(we,{size:"large","aria-label":"show 17 new notifications",color:"inherit",children:t.jsx(Mt,{badgeContent:17,color:"error",children:t.jsx(Bt,{})})}),t.jsx("p",{children:"Notifications"})]}),t.jsxs(Se,{onClick:A,children:[t.jsx(we,{size:"large","aria-label":"account of current user","aria-controls":"primary-search-account-menu","aria-haspopup":"true",color:"inherit",children:t.jsx(zt,{})}),t.jsx("p",{children:"Profile"})]})]}),q=de.tenantNames,L=async()=>{const{data:h}=await Z.custom({url:"",method:"post",meta:{operation:"refreshToken",variables:{token:{value:localStorage.getItem("token"),type:"String",required:!0},sessionKey:{value:localStorage.getItem("sessionKey"),type:"String",required:!1}},fields:["success","message","expires","token","sessionKey"]}}).catch(()=>({data:null})).then(m=>m);h!=null&&h.success?(localStorage.setItem("lastLoginAttemp",new Date().toString()),localStorage.setItem("token",h.token),localStorage.setItem("sessionKey",h.sessionKey),localStorage.setItem("expires",h.expires),i(!1),l.reset()):d()};return s.useEffect(()=>{v(n.pathname.split("/")[1].toString())},[n]),t.jsxs(ve,{position:"fixed",sx:{width:"100%",zIndex:100},children:[t.jsx(Tr,{position:"fixed",children:t.jsxs(Er,{children:[R&&t.jsx(we,{size:"large",edge:"start",color:"inherit","aria-label":"open drawer",sx:{mr:2},onClick:()=>{B(!0)},children:t.jsx(Nt,{})}),!R&&t.jsx(ve,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:t.jsx(Be,{to:"/",children:t.jsx(Rr,{src:de.brandLogo,sx:{width:50,height:50,mr:1,border:"1px solid #ccc"}})})}),!f&&x.length==0&&t.jsx(St,{variant:"h6",noWrap:!0,component:Be,to:"/",sx:{display:{xs:"none",sm:"block"},textDecoration:"none",textTransform:"none",color:"black",fontWeight:"bold"},children:de.system_name}),(f||de.appWithNoSidebar.includes(x))&&t.jsxs(St,{variant:"h6",noWrap:!0,component:Be,to:"/",sx:{display:{xs:"none",sm:"block"},textDecoration:"none",textTransform:"none",color:"black",fontWeight:"bold"},children:[de.system_name," | ",q[x]||x]}),t.jsx(ve,{sx:{flexGrow:1}}),t.jsx(ve,{sx:{display:{xs:"flex",md:"flex"}},children:t.jsx(Tn,{})}),t.jsx(ve,{sx:{display:{xs:"none",md:"none"}},children:t.jsx(we,{size:"large","aria-label":"show more","aria-controls":T,"aria-haspopup":"true",onClick:Q,color:"inherit",children:t.jsx(Ft,{})})})]})}),F,M,t.jsx(zr,{closable:!1,centered:!0,open:r,onOk:()=>{},onCancel:()=>{},footer:[],children:t.jsxs(ve,{sx:{padding:"20px",textAlign:"center",fontSize:"1.4em"},children:[t.jsx("p",{children:"Your session has expired. Please log in again."}),t.jsx(Be,{to:"/login",children:t.jsx(ye,{children:"Login"})})]})})]})};export{ks as Header};
