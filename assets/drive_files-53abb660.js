import{r,aV as j,c as $,u as W,j as e,aZ as p,aR as d,a7 as ee,aw as u,aP as h,cq as U,df as te,a0 as se,cT as re,cX as oe,iL as ie,B as ae,aX as ne,b$ as M,g as y,_ as m,c7 as le}from"./index-ccfcd4da.js";import{U as ce,a as de}from"./upload_folder-18d72a10.js";import{D as me}from"./drive_info-c3ac8f8f.js";import{d as pe,f as ue}from"./data_objects-ce8f5e44.js";import{F as he}from"./files_component-67e684ff.js";import{G as xe}from"./index-efb9c68a.js";import{A as B}from"./index-8ddfcaf4.js";import{C as fe}from"./index-e733c2fd.js";import"./index-200f56a0.js";import"./Upload-a74f9032.js";import"./fade-dd39912a.js";import"./index-0a57a0d3.js";import"./defineProperty-396cb65c.js";import"./useNotification-bc6f4548.js";import"./DialogWrap-1d0538d4.js";import"./index-98406364.js";import"./localeData-8c06fba4.js";import"./SinglePicker-5ae69ed8.js";import"./index-5c2e1e93.js";import"./useMutateObserver-ca2a7753.js";import"./index-477d9320.js";import"./InputNumber-df6a3867.js";import"./Image-eeb38737.js";import"./Rate-1c034551.js";import"./index-ba1d69b2.js";import"./index-a75cd6c4.js";import"./index-b8a04bf2.js";import"./transButton-719ccb9d.js";import"./file_item_component-d475cd2c.js";import"./index-3cbde207.js";import"./index-36291a54.js";import"./pdf_document_viewer-45e7c6a7.js";import"./index-b84643af.js";import"./index-27f5ca3f.js";import"./index-afc6ce50.js";import"./ActionButton-3b8e0c74.js";import"./index.esm-a9bf82b4.js";import"./iconBase-fee9e477.js";import"./index-885f566c.js";import"./index-3bfb9ed3.js";import"./index-08a49527.js";import"./index-7da8bd4f.js";import"./index-65dd5ac4.js";import"./InfoCircleFilled-f916d949.js";import"./Skeleton-a2d4f426.js";const ge=A=>{const[x,q]=r.useState(!1),[t,z]=r.useState(),[f,v]=r.useState([]),[C,F]=r.useState(!0),[n,P]=r.useState(1),[je,E]=r.useState(0),[g,R]=r.useState(20),[K,L]=r.useState(0),[ye,N]=r.useState(!0),[S,O]=r.useState(""),[T]=j.useForm(),{push:H}=$(),[V,Y]=r.useState(Math.random()),[_,w]=r.useState(!1),i=W(),[G,b]=r.useState(!1),D=!xe.useBreakpoint().lg,X=()=>{Y(Math.random()),w(!0)},I=async s=>{const{data:o}=await y.custom({url:"",method:"get",meta:{operation:"drive",variables:{id:{value:s,type:"Int",required:!0}},fields:pe}}).catch(()=>(m.error("Error occured while fetching drive data"),{data:null})).then(c=>c);o&&(z(o),q(!0))},k=s=>{v([...s,...f])},l=async(s,o="",c=20)=>{F(!0);const{data:a}=await y.custom({url:"",method:"get",meta:{operation:"driveFiles",variables:{id:{value:parseInt(i.drive.toString()),type:"Int",required:!0},page:{value:s,type:"Int",required:!0},key:{value:o,type:"String",required:!1},pageSize:{value:c,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:ue}]}}).catch(()=>(m.error("Error occured while fetching files"),{data:null})).then(Z=>Z);a&&(L(a.total),P(a.page),E(a.pages),N(a.hasNext),v(a.results)),F(!1)},J=(s,o)=>{R(o),l(n,S,o)},Q=async s=>{const{data:o}=await y.custom({url:"",method:"post",meta:{operation:"connectDrive",variables:{id:{value:s,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(m.error("Drive connection failed"),{data:null})).then(c=>c);o&&(o.success?(m(o.message),I(parseInt(i.drive.toString())),l(n,"",20)):m.error(o.message))};return r.useEffect(()=>{I(parseInt(i.drive.toString())),l(n,"",20)},[i.drive]),x?t!=null&&t.isBlocked?e.jsx("div",{children:e.jsx(B,{message:"You can not Access this Drive, you are blocked",type:"error",showIcon:!0})}):t!=null&&t.isConnected?e.jsxs(e.Fragment,{children:[t&&e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsxs(d,{span:24,style:{display:"flex",justifyContent:"space-between",marginBottom:10},children:[e.jsxs(h,{children:[e.jsx(h.Item,{children:e.jsx(U,{to:"/odrive",children:"Home"})}),e.jsx(h.Item,{children:e.jsx(U,{to:"/odrive/drives",children:"Drives"})}),e.jsxs(h.Item,{children:[t==null?void 0:t.name," - Files"]})]}),e.jsx("div",{children:e.jsx(u,{size:"large",icon:e.jsx(te,{}),disabled:!(t!=null&&t.canManage)||(t==null?void 0:t.isArchived),onClick:()=>H("/odrive/drive/"+i.drive+"/"+i.code+"/members"),children:"Members"})})]})}),e.jsxs(p,{children:[e.jsx(d,{span:12,children:e.jsx(j,{layout:"vertical",form:T,onFinish:s=>{O(s.key),l(1,s.key,g)},children:e.jsx(j.Item,{name:"key",children:e.jsx(se,{size:"large",placeholder:"Search file(s)...",prefix:e.jsx(re,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(d,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(u,{size:"large",icon:e.jsx(oe,{}),onClick:()=>X(),loading:!x,disabled:!(t!=null&&t.isAuthor)||(t==null?void 0:t.isArchived),children:"Upload File(s)"}),e.jsx(u,{size:"large",icon:e.jsx(ie,{}),onClick:()=>b(!0),loading:!x,disabled:!(t!=null&&t.isAuthor)||(t==null?void 0:t.isArchived),children:"Upload Folder"})]})]}),e.jsx(ae,{sx:{maxHeight:"calc(100vh - 270px)",overflowY:"auto"},children:e.jsx(he,{showDrive:!1,loading:C,data:f,min:A.min??!1})})]}),!C&&f.length>0&&e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:10,marginTop:15},children:e.jsx(ne,{showSizeChanger:!0,showQuickJumper:!0,defaultCurrent:n,current:n,total:K,pageSize:g,onShowSizeChange:J,onChange:s=>l(s,S,g)})}),e.jsx(M,{title:"Uploading Files",open:_,onClose:s=>w(s),width:D?"100vw":"50vw",children:e.jsx(ce,{onFinish:k,random:V,mode:"drive"})}),e.jsx(M,{title:"Uploading Folder",open:G,onClose:s=>b(s),width:D?"100vw":"50vw",children:e.jsx(de,{onFinish:s=>k(s),mode:"drive",drive:t})})]}):e.jsx(p,{style:{display:"flex",justifyContent:"center"},children:e.jsx(d,{span:12,children:e.jsxs(fe,{children:[e.jsx(B,{message:"You can not Access this Drive, you are not connected, Please Click Connect button Below",type:"error",showIcon:!0,style:{marginBottom:30}}),e.jsx(me,{id:t==null?void 0:t.id}),e.jsx(u,{type:"primary",size:"large",style:{float:"right"},onClick:()=>Q(t==null?void 0:t.id),children:"Connect"})]})})}):e.jsx(p,{children:e.jsx(d,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(ee,{})})})},pt=()=>(r.useEffect(()=>{document.title=le.system_name+": Drive Files"},[]),e.jsx("div",{style:{marginTop:10},children:e.jsx(ge,{})}));export{pt as DriveFilesPage};
