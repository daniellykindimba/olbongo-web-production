import{au as L,_ as oe,g as re,R as o,C as ie,c as B,o as se,fH as H}from"./index-ac5228cb.js";function M(t){let r;const s=c=>()=>{r=null,t.apply(void 0,oe(c))},u=function(){if(r==null){for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];r=L(s(l))}};return u.cancel=()=>{L.cancel(r),r=null},u}const ae=t=>{const{componentCls:r}=t;return{[r]:{position:"fixed",zIndex:t.zIndexPopup}}},ce=t=>({zIndexPopup:t.zIndexBase+10}),le=re("Affix",ae,ce);function C(t){return t!==window?t.getBoundingClientRect():{top:0,bottom:window.innerHeight}}function F(t,r,s){if(s!==void 0&&Math.round(r.top)>Math.round(t.top)-s)return s+r.top}function O(t,r,s){if(s!==void 0&&Math.round(r.bottom)<Math.round(t.bottom)+s){const u=window.innerHeight-r.bottom;return s+u}}const V=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"];function fe(){return typeof window<"u"?window:null}var h;(function(t){t[t.None=0]="None",t[t.Prepare=1]="Prepare"})(h||(h={}));const ue=o.forwardRef((t,r)=>{var s;const{style:u,offsetTop:c,offsetBottom:l,prefixCls:d,className:G,rootClassName:_,children:j,target:p,onChange:S}=t,{getPrefixCls:q,getTargetContainer:D}=o.useContext(ie),A=q("affix",d),[U,$]=o.useState(!1),[f,J]=o.useState(),[K,Q]=o.useState(),E=o.useRef(h.None),T=o.useRef(null),g=o.useRef(),m=o.useRef(null),N=o.useRef(null),R=o.useRef(null),a=(s=p??D)!==null&&s!==void 0?s:fe,P=l===void 0&&c===void 0?0:c,W=()=>{if(E.current!==h.Prepare||!N.current||!m.current||!a)return;const i=a();if(i){const n={status:h.None},e=C(m.current);if(e.top===0&&e.left===0&&e.width===0&&e.height===0)return;const v=C(i),w=F(e,v,P),I=O(e,v,l);w!==void 0?(n.affixStyle={position:"fixed",top:w,width:e.width,height:e.height},n.placeholderStyle={width:e.width,height:e.height}):I!==void 0&&(n.affixStyle={position:"fixed",bottom:I,width:e.width,height:e.height},n.placeholderStyle={width:e.width,height:e.height}),n.lastAffix=!!n.affixStyle,U!==n.lastAffix&&(S==null||S(n.lastAffix)),E.current=n.status,J(n.affixStyle),Q(n.placeholderStyle),$(n.lastAffix)}},b=()=>{E.current=h.Prepare,W()},x=M(()=>{b()}),y=M(()=>{if(a&&f){const i=a();if(i&&m.current){const n=C(i),e=C(m.current),v=F(e,n,P),w=O(e,n,l);if(v!==void 0&&f.top===v||w!==void 0&&f.bottom===w)return}}b()}),z=()=>{const i=a==null?void 0:a();i&&(V.forEach(n=>{var e;g.current&&((e=T.current)===null||e===void 0||e.removeEventListener(n,g.current)),i==null||i.addEventListener(n,y)}),T.current=i,g.current=y)},X=()=>{R.current&&(clearTimeout(R.current),R.current=null);const i=a==null?void 0:a();V.forEach(n=>{var e;i==null||i.removeEventListener(n,y),g.current&&((e=T.current)===null||e===void 0||e.removeEventListener(n,g.current))}),x.cancel(),y.cancel()};o.useImperativeHandle(r,()=>({updatePosition:x})),o.useEffect(()=>(R.current=setTimeout(z),()=>X()),[]),o.useEffect(()=>{z()},[p,f]),o.useEffect(()=>{x()},[p,c,l]);const[Y,Z,k]=le(A),ee=B(_,Z,A,k),te=B({[ee]:f});let ne=se(t,["prefixCls","offsetTop","offsetBottom","target","onChange","rootClassName"]);return Y(o.createElement(H,{onResize:x},o.createElement("div",Object.assign({style:u,className:G,ref:m},ne),f&&o.createElement("div",{style:K,"aria-hidden":"true"}),o.createElement("div",{className:te,ref:N,style:f},o.createElement(H,{onResize:x},j)))))}),he=ue;export{he as A,M as t};
