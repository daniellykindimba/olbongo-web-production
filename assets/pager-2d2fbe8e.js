import{bE as ut,aM as e,r as a,aC as u,aG as Z,ay as B,M as U,cF as ce,aI as ge,aH as ae,$ as K,ae as q,cS as Je,cR as we,bJ as E,bK as r,aJ as F,co as Te,f0 as xe,bP as ne,bV as Ie,ac as qe,aB as ht,ax as ke,df as mt,cB as xt,d2 as Xe,bI as de,bT as Ce,S as R,cL as G,cP as Ne,bU as Ye,aw as le,c8 as be,de as Qe,bL as Ze,f1 as gt,cM as et,cY as tt,eD as yt,eT as pt,f2 as Be,aA as at,aD as he,cy as st,f3 as Oe,aK as jt,f4 as ze}from"./index-2fc17c3b.js";import{t as ft}from"./text_truncate-315d9efa.js";import{G as ye}from"./index-7067581d.js";import{D as ve}from"./index-ce61678e.js";import{C as St}from"./index-eec1f499.js";import{P as ee}from"./index-9c7bc008.js";import{D as Y}from"./index-d62905de.js";import{D as nt}from"./index-38c6ae99.js";import{T as ue}from"./index-81b1d18b.js";import{A as Se}from"./index-389401b2.js";import{D as _e}from"./index-72c63eba.js";import{L as me}from"./index-ca65b019.js";import{u as bt}from"./utc-0853ea4b.js";import{C as vt,T as Tt}from"./index-f023b25a.js";import{I as rt}from"./index-8aa917b6.js";import{T as Ge}from"./index-0b5f66ee.js";import"./index-e8e9ceb4.js";import"./PickerPanel-be3ca01f.js";import"./localeData-6904e615.js";import"./index-651f824b.js";import"./ActionButton-e92b0465.js";import"./InfoCircleFilled-c05f8e68.js";import"./RangePicker-7a53e9ae.js";import"./Skeleton-94302138.js";import"./InputNumber-5bec0d4b.js";import"./index-9abc7cc3.js";import"./transButton-b0336faf.js";const It=ut(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),Ct=t=>{a.useState();const[y,l]=a.useState([]),[p,i]=a.useState(0),[f,T]=a.useState(!0),[I,P]=a.useState(10),[_,n]=a.useState(""),[c]=u.useForm(),j=[{title:"Student",dataIndex:"student",fixed:!0,render:(w,A,v)=>e.jsx("span",{children:e.jsxs(ae,{direction:"vertical",children:[e.jsx("a",{children:A.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#"}),":"," ",A.member.registrationNumber]})]})})},{title:"",dataIndex:"status",render:(w,A,v)=>e.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[e.jsx("span",{style:{margin:5},children:e.jsx(K,{title:"Take as Present",color:"green",children:e.jsx(q,{icon:e.jsx(Je,{style:{color:"green"}}),onClick:()=>C(A.id,t.event.id,1)})})}),e.jsx("span",{style:{margin:5},children:e.jsx(K,{title:"Take as Absent",color:"red",children:e.jsx(q,{icon:e.jsx(we,{style:{color:"red"}}),onClick:()=>C(A.id,t.event.id,2)})})})]})}],C=async(w,A,v)=>{const{data:S}=await E.custom({url:"",method:"post",meta:{operation:"takeAttendance",variables:{studentId:{value:w,type:"Int",required:!0},entryId:{value:A,type:"Int",required:!0},present:{value:v,type:"Int",required:!0}},fields:["success","message"]}}).catch(z=>({data:null})).then(z=>z);r.remove(),S&&S.success&&(r.success(S.message),M(1,"",10),t.onAdd()),T(!1)},M=async(w,A="",v=20)=>{T(!0);const{data:S}=await E.custom({url:"",method:"get",meta:{operation:"studentsToTakeAttendance",variables:{page:{value:w,type:"Int",required:!0},key:{value:A,type:"String",required:!1},pageSize:{value:v,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]}]}}).catch(z=>({data:null})).then(z=>z);S&&(i(S.total),l([...S.results])),T(!1)};return a.useEffect(()=>{M(1,"",10)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{style:{marginTop:10},children:e.jsx(B,{span:24,children:e.jsx(u,{layout:"vertical",form:c,onFinish:w=>{n(w.key),y.length=0,M(1,w.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:f,columns:j,dataSource:y,pagination:{onChange:(w,A)=>{P(A),M(w,_,A)},total:p,pageSize:I,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"68vh"}})]})},Et=t=>{const[y,l]=a.useState([]),[p,i]=a.useState(0),[f,T]=a.useState(!0),[I,P]=a.useState(20),[_,n]=a.useState(""),[c]=u.useForm(),C=!ye.useBreakpoint().lg,M=[{title:"Student",dataIndex:"student",fixed:!0,render:(A,v,S)=>e.jsx("span",{children:e.jsxs(ae,{direction:"vertical",children:[e.jsx("a",{children:v.student.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#:"}),e.jsx("span",{style:{marginLeft:10},children:v.student.member.registrationNumber})]})]})})},{title:"Status",dataIndex:"status",render:(A,v,S)=>e.jsx("span",{children:v.status===1?e.jsx("a",{children:e.jsx(F,{color:"green",children:v.statusDisplay})}):e.jsx("a",{children:e.jsx(F,{color:"red",children:v.statusDisplay})})})}],w=async(A,v="",S=20)=>{T(!0);const{data:z}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelAttendancesByDate",variables:{page:{value:A,type:"Int",required:!0},key:{value:v,type:"String",required:!1},pageSize:{value:S,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0},date:{value:t.date.format("YYYY/MM/DD"),type:"String",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(r.remove(),r.error("Error occured while fetching roles"),{data:null})).then(g=>g);z&&(i(z.total),l([...z.results])),T(!1)};return a.useEffect(()=>{w(1,"",20)},[t.randKey,t.date,t.event]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:C?24:16,children:e.jsx(u,{layout:"vertical",form:c,onFinish:A=>{n(A.key),y.length=0,w(1,A.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:C?24:2,children:e.jsx(q,{icon:e.jsx(ce,{}),size:"large",onClick:()=>c.submit()})})]}),e.jsx(ge,{loading:f,columns:M,dataSource:y,pagination:{onChange:(A,v)=>{P(v),w(A,_,v)},total:p,pageSize:I,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(100vh - 470px)"}})]})},Re=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],At=t=>{var O,oe;const[y,l]=a.useState([]),[p,i]=a.useState(0),[f,T]=a.useState(!0),[I,P]=a.useState(20),[_,n]=a.useState(""),[c]=u.useForm(),C=!ye.useBreakpoint().lg,[M,w]=a.useState(!1),[A,v]=a.useState(!1),[S,z]=a.useState(!1),[g,L]=a.useState(),b=async V=>{L(V),z(!0)},h=async V=>{v(!1),w(V)},o=[{title:"Student",dataIndex:"student",fixed:!0,render:(V,H,$)=>e.jsx("span",{children:e.jsxs(ae,{direction:"vertical",children:[e.jsx("a",{children:H.student.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#:"}),e.jsx("span",{style:{marginLeft:10},children:H.student.member.registrationNumber})]})]})})},{title:"Status",dataIndex:"status",render:(V,H,$)=>e.jsx("span",{children:H.status===1?e.jsx(ee,{title:"Are you sure to mark Absent?",onConfirm:()=>m(H.id,2),onCancel:()=>{},okText:"Absent",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{children:e.jsx(F,{color:"green",children:H.statusDisplay})})}):e.jsx(ee,{title:"Are you sure to mark as Present?",onConfirm:()=>m(H.id,1),onCancel:()=>{},okText:"Present",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{children:e.jsx(F,{color:"red",children:H.statusDisplay})})})})},{title:"",dataIndex:"status",render:(V,H,$)=>e.jsx(ee,{title:"Are you sure to delete this Attendance Entry?",onConfirm:()=>x(H.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ie,{})})})}],s=async(V,H="",$=20)=>{T(!0);const{data:te}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelAttendances",variables:{page:{value:V,type:"Int",required:!0},key:{value:H,type:"String",required:!1},pageSize:{value:$,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(r.remove(),r.error("Error occured while fetching roles"),{data:null})).then(Ee=>Ee);te&&(i(te.total),l([...te.results])),T(!1)},x=async V=>{const{data:H}=await E.custom({url:"",method:"post",meta:{operation:"deleteStudentAttendance",variables:{attendanceId:{value:parseInt(V.toString()),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(r.remove(),r.error("Error occured while deleting attendance entry"),{data:null})).then($=>$);H&&(H.success?(r.remove(),r.success(H.message),l(y.filter($=>$.id!==V))):(r.remove(),r.error(H.message)))},m=async(V,H)=>{const{data:$}=await E.custom({url:"",method:"post",meta:{operation:"updateStudentAttendance",variables:{attendanceId:{value:parseInt(V.toString()),type:"Int",required:!0},present:{value:H,type:"Int",required:!0}},fields:["success","message",{attendance:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(r.remove(),r.error("Error occured while updating attendance"),{data:null})).then(te=>te);r.remove(),$&&($.success?(r.success($.message),l(y.map(te=>parseInt(te.id.toString())===parseInt($.attendance.id.toString())?$.attendance:te))):r.error($.message)),T(!1)},D=async()=>{s(1,"",20)};return a.useEffect(()=>{s(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:C?24:16,children:e.jsx(u,{layout:"vertical",form:c,onFinish:V=>{n(V.key),y.length=0,s(1,V.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{disabled:A,size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:C?24:2,children:e.jsx(q,{disabled:A,icon:e.jsx(ce,{}),size:"large",onClick:()=>c.submit()})}),t.event.canTakeAttendance&&e.jsx(B,{span:C?24:6,children:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(K,{title:"Start Taking Attendance",children:e.jsx(q,{icon:e.jsx(Te,{}),size:"large",onClick:()=>h(!0),children:"Take Attendance"})}),e.jsx(K,{title:"View Taken Attendances",children:e.jsx(q,{disabled:A,icon:e.jsx(xe,{}),size:"large",onClick:()=>v(!0),children:"View Attendances"})})]})}),!t.event.canTakeAttendance&&e.jsx(B,{span:C?24:6,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(K,{title:"View Taken Attendances",children:e.jsx(q,{disabled:A,icon:e.jsx(xe,{}),size:"large",onClick:()=>v(!0),children:"View Attendances"})})})})]}),A?e.jsx(e.Fragment,{children:e.jsx("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:e.jsx(St,{onSelect:V=>{var H;if(V<ne().endOf("day")){const $=Re.indexOf((H=t==null?void 0:t.entry)==null?void 0:H.name)+1,te=V.day();$===te?b(V):r("No attendance taken on this day")}},disabledDate:V=>{var te;const H=Re.indexOf((te=t==null?void 0:t.entry)==null?void 0:te.name)+1,$=V.day();return V&&V>ne().endOf("day")||H!==$}})})}):e.jsx(ge,{loading:f,columns:o,dataSource:y,pagination:{onChange:(V,H)=>{P(H),s(V,_,H)},total:p,pageSize:I,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(100vh - 470px)"}}),e.jsx(ve,{title:"Taking Attendance",width:"28vw",anchor:"right",onClose:V=>w(V),open:M,children:e.jsx(Ct,{event:t.event,randKey:Math.random(),onAdd:D})}),e.jsx(ve,{title:((O=t.event)==null?void 0:O.subject.name)+" - "+((oe=t.event)==null?void 0:oe.educationLevel.name)+" Attendance taken on "+(g==null?void 0:g.format("YYYY MMM, DD")),width:"50vw",anchor:"left",onClose:V=>z(V),open:S,children:e.jsx(Et,{event:t.event,date:g,randKey:Math.random()})})]})},{TextArea:kt}=U,_t=t=>{const[y,l]=a.useState(!1),[p,i]=a.useState(!1),[f,T]=a.useState([]),[I,P]=a.useState(null),[_,n]=a.useState(null),[c]=u.useForm(),[j,C]=a.useState(!1),[M,w]=a.useState(!1),v=!ye.useBreakpoint().lg,S=(b,h)=>{P(h),n(b),C(!0)},z=async b=>{const{data:h}=await E.custom({url:"",method:"post",meta:{operation:"openTimetableEntry",variables:{entryId:{value:b,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(r.error("Something Went Wrong ..."),{data:null})).then(o=>o);h&&(h.success?(r.success(h.message),L()):r.error(h.message))},g=async b=>{const{data:h}=await E.custom({url:"",method:"post",meta:{operation:"cancelTimetableEntry",variables:{entryId:{value:b.entryId,type:"Int",required:!0},reason:{value:b.reason,type:"String",required:!0},verify:{value:b.notify,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(()=>(r.error("Something Went Wrong ..."),{data:null})).then(o=>o);h&&(h.success?(r.success(h.message),c.resetFields(),L()):r.error(h.message))},L=async()=>{l(!0);const{data:b}=await E.custom({url:"",method:"get",meta:{operation:"myWeeklyTimetableEntries",fields:["entries","hasTimetable"]}}).catch(()=>(r.error("Something Went Wrong ..."),{data:null})).then(h=>h);b&&(console.error("data",b),i(b.hasTimetable),T(b.entries)),l(!1)};return a.useEffect(()=>{L()},[]),e.jsxs(e.Fragment,{children:[e.jsxs(qe,{spinning:y,children:[!p&&!y&&e.jsx(e.Fragment,{children:e.jsx(Z,{align:"middle",style:{height:"80vh",display:"flex",justifyContent:"center"},children:e.jsx(ht,{description:e.jsx(e.Fragment,{children:e.jsx("span",{style:{fontSize:22},children:"You are not Connected to any published Timetable"})})})})}),p&&e.jsx(Z,{style:{overflowX:"auto",marginTop:v?65:0,marginLeft:10},wrap:!1,children:f.map(b=>e.jsxs("span",{style:{width:v?"100vw":"14.1vw",margin:"1px",padding:"0px"},children:[e.jsx(Z,{style:{display:"flex",justifyContent:"space-between",backgroundColor:"white"},children:e.jsxs("span",{style:{marginLeft:10,marginRight:10,display:"flex",justifyContent:"space-between",width:"100%",height:35,paddingTop:2},children:[e.jsx("span",{style:{fontSize:19,fontWeight:"bolder"},children:b.name}),e.jsx("span",{children:e.jsx(K,{title:"Bulk Processing of Action(s)",color:"red",placement:"left",children:e.jsx(q,{icon:e.jsx(we,{})})})})]})}),e.jsx("div",{style:{maxHeight:"83vh",overflowY:"auto",overflowX:"hidden",marginTop:5,marginRight:5},children:b.events.map(h=>e.jsx("div",{style:{backgroundColor:"white",paddingLeft:5},children:e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:18},children:[h.isTeacher&&e.jsx(e.Fragment,{children:e.jsxs("div",{style:{borderBottom:"1"},children:[e.jsx("span",{style:{marginLeft:5},children:e.jsx(K,{title:"View/Take Attendance",color:"green",children:e.jsx(q,{size:"small",onClick:()=>S(h,b),children:e.jsx(xe,{})})})}),h.canCancell&&!h.isCancelled&&!h.isExam&&e.jsx("span",{style:{marginLeft:5},children:e.jsx(ee,{title:e.jsx(e.Fragment,{children:e.jsxs(ae,{direction:"vertical",children:[e.jsx("span",{children:"Are you sure to Cancel?"}),e.jsx("span",{style:{fontWeight:"bolder"},children:"Reason"}),e.jsx("span",{children:e.jsxs(u,{layout:"vertical",form:c,initialValues:{notify:!0},onFinish:o=>{o.entryId=h.id,g(o)},onFinishFailed:()=>{},autoComplete:"off",children:[e.jsx(u.Item,{name:"reason",rules:[{required:!0,message:"Please input your reason!"}],children:e.jsx(kt,{rows:6,onChange:o=>{o.target.value.length>0?w(!0):w(!1)}})}),e.jsx(u.Item,{name:"notify",valuePropName:"checked",children:e.jsx(ke,{children:"Notify Students"})})]})})]})}),onConfirm:()=>{c.submit()},onCancel:()=>{},okText:"Yes",cancelText:"No",okButtonProps:{disabled:!M},overlayStyle:{zIndex:9999},children:e.jsx(q,{size:"small",children:e.jsx(mt,{color:"red",style:{color:"red"}})})})}),e.jsx("span",{style:{float:"right"},children:e.jsx(K,{title:"Click to see all about this timetable Entry",color:"green",children:e.jsx(q,{icon:e.jsx(xt,{})})})})]})}),e.jsxs("span",{style:{display:"block"},children:[!h.advanced&&e.jsx(K,{overlayInnerStyle:{fontSize:19},title:"Subject: "+h.subject.name,color:"green",placement:"right",children:ft(h.subject.name,15)}),h.advanced&&e.jsx(K,{overlayInnerStyle:{fontSize:19},title:"Module: "+h.module.name,color:"green",placement:"right",children:h.module.code})]}),!h.advanced&&e.jsx(ae,{children:h.group&&e.jsx(e.Fragment,{children:e.jsx(F,{color:"orange",children:h.group.name})})})]}),e.jsxs("span",{style:{fontSize:18},children:[e.jsx(K,{title:"Venue: "+h.venue.name,color:"green",children:e.jsx(F,{color:"red",children:h.venue.name})}),e.jsx(K,{title:e.jsxs(e.Fragment,{children:[!h.advanced&&e.jsx(e.Fragment,{children:h.isExam?e.jsxs(Y,{title:"Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.supervisor.firstName," ",h.supervisor.middleName," ",h.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:h.supervisor.phone})]}):e.jsxs(Y,{title:"Teacher Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.teacher.firstName," ",h.teacher.middleName," ",h.teacher.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.teacher.email}),e.jsx(Y.Item,{label:"Phone",children:h.teacher.phone})]})}),h.advanced&&e.jsx(e.Fragment,{children:h.isExam?e.jsxs(Y,{title:"Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.supervisor.firstName," ",h.supervisor.middleName," ",h.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:h.supervisor.phone})]}):e.jsxs(Y,{title:"Lecturer Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.lecturer.firstName," ",h.lecturer.middleName," ",h.lecturer.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.lecturer.email}),e.jsx(Y.Item,{label:"Phone",children:h.lecturer.phone})]})})]}),color:"white",overlayInnerStyle:{color:"black"},children:e.jsx(q,{type:"primary",shape:"circle",icon:e.jsx(Xe,{})})})]}),h.isCancelled&&e.jsx("span",{children:e.jsxs(F,{color:"red",style:{fontSize:24,padding:10,marginTop:10},children:["Cancelled",h.isTeacher&&h.canCancell&&e.jsx(ee,{title:"Are you sure to Open?",onConfirm:()=>z(h.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{style:{marginLeft:2},size:"small",children:"Re-open"})})]})}),e.jsxs(nt,{children:[h.isExam&&e.jsx("p",{style:{fontSize:"18px"},children:ne(h.dueDate).format("YYYY MMM, DD")}),h.startAt," - ",h.endAt]})]})}))})]}))})]}),e.jsx(de,{title:e.jsx(e.Fragment,{children:e.jsxs(ae,{direction:"vertical",children:[e.jsxs("span",{children:[_==null?void 0:_.subject.name," - ",_==null?void 0:_.educationLevel.name," - Attendance",e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:I==null?void 0:I.name})})]}),e.jsxs("span",{children:[_==null?void 0:_.startAt," - ",_==null?void 0:_.endAt]})]})}),width:"70vw",open:j,onClose:b=>C(b),children:e.jsx(At,{event:_,entry:I,randKey:Math.random()})})]})},wt=()=>(a.useEffect(()=>(document.title=Ce.system_name+": Timetable Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsx("div",{style:{marginTop:10},children:e.jsx(_t,{})})),{Option:Fe}=R,De="HH:mm",qt=t=>{const[y,l]=a.useState(!1),[p,i]=a.useState(!0),[f,T]=a.useState([]),[I,P]=a.useState([]),[_,n]=a.useState([]),[c,j]=a.useState([]),C=()=>{l(!0)},M=g=>{t.form.setFieldsValue({teacher:void 0}),v(1,g)},w=async(g,L="",b=100)=>{const{data:h}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:g,type:"Int",required:!0},key:{value:L,type:"String",required:!1},pageSize:{value:b,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(()=>(r.error("Error occured while loading Venues"),{data:null})).then(o=>o);h&&j(h.results)},A=async(g,L="",b=20)=>{var o;const{data:h}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjects",variables:{schoolEducationLevelId:{value:parseInt(((o=t.schoolTimetableEducationLevel)==null?void 0:o.schoolEducationLevel.id.toString())??"0")},page:{value:g,type:"Int",required:!0},key:{value:L,type:"String",required:!1},pageSize:{value:b,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolSubject:[{subject:["id","name"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(s=>(r.error("Error occured while loading Subjects"),{data:null})).then(s=>s);h&&T(h.results)},v=async(g,L,b="",h=20)=>{i(!0);const{data:o}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjectTeachers",variables:{schoolEducationLevelSubjectId:{value:parseInt(L.toString()??"0")},page:{value:g,type:"Int",required:!0},key:{value:b,type:"String",required:!1},pageSize:{value:h,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolMember:["id","registrationNumber",{user:["id","firstName","lastName","middleName","fullName"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(s=>(r.error("Error occured while loading Teachers"),{data:null})).then(s=>s);o&&P(o.results),i(!1)},S=async(g,L="",b=20)=>{var o;const{data:h}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelGroups",variables:{schoolEducationLevelId:{value:parseInt(((o=t.schoolTimetableEducationLevel)==null?void 0:o.schoolEducationLevel.id.toString())??"0")},page:{value:g,type:"Int",required:!0},key:{value:L,type:"String",required:!1},pageSize:{value:b,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(s=>(r.error("Error occured while loading Groups"),{data:null})).then(s=>s);h&&n(h.results)},z=async g=>{const{data:L}=await E.custom({url:"",method:"post",meta:{operation:"createTimetableEntry",variables:{subjectId:{value:g.subject_id,type:"Int",required:!0},teacherId:{value:g.teacher_id,type:"Int",required:!0},timetableId:{value:g.timetable_id,type:"Int",required:!0},groupId:{value:g.group_id,type:"Int",required:!1},venueId:{value:g.venue_id,type:"Int",required:!0},day:{value:g.day,type:"String",required:!0},startAt:{value:g.start_at,type:"String",required:!0},endAt:{value:g.end_at,type:"String",required:!0}},fields:["success","message"]}}).catch(b=>(r.error("Error occured while creating school timetable"),{data:null})).then(b=>b);L&&(L.success?(r.success(L.message),t.form.resetFields(),t.onFinish()):r.error(L.message))};return a.useEffect(()=>{S(1),w(1),A(1)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(u,{layout:"vertical",form:t.form,onFinish:g=>{var L;g.start_at=ne(g.start_at).format("HH:mm"),g.end_at=ne(g.end_at).format("HH:mm"),g.day=t.entry.name,g.timetable_id=parseInt(((L=t.schoolTimetableEducationLevel)==null?void 0:L.id.toString())??"0"),z(g)},requiredMark:!1,children:[e.jsx(u.Item,{name:"subject_id",label:"Subject",rules:[{required:!0,type:"integer",message:"Please Choose Subject"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Subject",allowClear:!0,showSearch:!0,onChange:M,dropdownStyle:{zIndex:9999},children:f.map(g=>e.jsx(Fe,{value:g.id,children:g.schoolSubject.subject.name},g.id))})}),e.jsx(u.Item,{name:"teacher_id",label:"Teacher",rules:[{required:!0,type:"integer",message:"Please Choose Teacher"}],children:e.jsx(R,{size:"large",loading:p,disabled:p,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:I.map(g=>e.jsxs(Fe,{value:g.id,children:[g.schoolMember.user.fullName,g.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:g.schoolMember.registrationNumber})})]},g.id))})}),e.jsx(u.Item,{name:"group_id",label:"Group",rules:[{required:!1,type:"integer",message:"Please Choose Groups"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Groups",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:_.map(g=>e.jsx(Fe,{value:parseInt(g.id.toString()),children:g.name},g.id))})}),e.jsx(u.Item,{name:"venue_id",label:"Venue",rules:[{required:!0,type:"integer",message:"Please Choose Venue"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Venue",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:c.map(g=>e.jsx(Fe,{value:parseInt(g.id.toString()),children:g.name},g.id))})}),e.jsxs(Z,{children:[e.jsx(B,{span:6,children:e.jsx(u.Item,{name:"start_at",label:e.jsx(e.Fragment,{children:e.jsxs(ae,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Start At"}),e.jsx(q,{type:"link",onClick:()=>C(),children:"Check Slots"})]})}),initialValue:G("07:00","HH:mm"),children:e.jsx(ue,{size:"large",allowClear:!0,defaultValue:G("07:00",De),hourStep:1,minuteStep:45,format:De,style:{width:"100%"},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:6,children:e.jsx(u.Item,{name:"end_at",label:e.jsx(e.Fragment,{children:e.jsxs(ae,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"End At"}),e.jsx(q,{type:"link",onClick:()=>C(),children:"Check Slots"})]})}),initialValue:G("07:45","HH:mm"),children:e.jsx(ue,{size:"large",allowClear:!0,defaultValue:G("07:45",De),hourStep:1,minuteStep:45,format:De,inputReadOnly:!0,style:{width:"100%"},popupStyle:{zIndex:9999}})})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",disabled:!0,children:"Save"})})]}),e.jsx(ve,{title:"Available Time Slots",anchor:"right",onClose:g=>l(g),open:y,children:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Some contents..."}),e.jsx("p",{children:"Some contents..."}),e.jsx("p",{children:"Some contents..."})]})})]})},{Option:je}=R,Ue="HH:mm",Mt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],$e=t=>{var k,X,re,fe,Me,He,We,Ke;const[y,l]=a.useState(!1),[p,i]=a.useState(!1),[f,T]=a.useState(!0),[I,P]=a.useState([]),[_,n]=a.useState([]),[c,j]=a.useState([]),[C,M]=a.useState([]),[w,A]=a.useState([]);a.useState(),a.useState();const[v,S]=a.useState([]);a.useState(!1),a.useState(!1);const[z,g]=a.useState("07:00"),[L,b]=a.useState("07:45");Ne();const[h,o]=a.useState([]),[s,x]=a.useState([]),[m,D]=a.useState([]),[O]=u.useForm(),oe=()=>{i(!0)},V=d=>{var W;t.form.setFieldsValue({teacher:void 0}),((W=t==null?void 0:t.schoolTimetable)==null?void 0:W.forExamination)===!0?te(1):Ee(1,d)},H=async(d,W="",J=100)=>{const{data:se}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:d,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:J,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(ie=>(r.error("Error occured while loading Venues"),{data:null})).then(ie=>ie);se&&A(se.results)},$=async(d,W="",J=20)=>{var ie;const{data:se}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjects",variables:{schoolEducationLevelId:{value:parseInt(((ie=t.schoolTimetableEducationLevel)==null?void 0:ie.schoolEducationLevel.id.toString())??"0")},page:{value:d,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:J,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolSubject:[{subject:["id","name"]}]},"subjectType","subjectTypeDisplay","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(r.error("Error occured while loading Subjects"),{data:null})).then(pe=>pe);se&&P(se.results)},te=async(d,W="",J=20)=>{T(!0);const{data:se}=await E.custom({url:"",method:"get",meta:{operation:"schoolMembers",variables:{page:{value:d,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:J,type:"Int",required:!1},rolesString:{value:["Teacher"],type:"[String]",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","registrationNumber","firstName","middleName","lastName","fullName","email","phone",{user:["id","firstName","lastName","middleName","fullName"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(ie=>(r.error("Error occured while loading Teachers"),{data:null})).then(ie=>ie);se&&j(se.results),T(!1)},Ee=async(d,W,J="",se=20)=>{T(!0);const{data:ie}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjectTeachers",variables:{schoolEducationLevelSubjectId:{value:parseInt(W.toString()??"0")},page:{value:d,type:"Int",required:!0},key:{value:J,type:"String",required:!1},pageSize:{value:se,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolMember:["id","registrationNumber",{user:["id","firstName","lastName","middleName","fullName"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(r.error("Error occured while loading Teachers"),{data:null})).then(pe=>pe);ie&&n(ie.results),T(!1)},Pe=async(d,W="",J=20)=>{var ie;const{data:se}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelGroups",variables:{schoolEducationLevelId:{value:parseInt(((ie=t.schoolTimetableEducationLevel)==null?void 0:ie.schoolEducationLevel.id.toString())??"0")},page:{value:d,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:J,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(r.error("Error occured while loading Groups"),{data:null})).then(pe=>pe);se&&M(se.results)},Le=async d=>{l(!0);const{data:W}=await E.custom({url:"",method:"post",meta:{operation:"createTimetableEntry",variables:{advanced:{value:t.advanced,type:"Boolean",required:!1},moduleId:{value:d.module_id,type:"Int",required:!1},subjectId:{value:d.subject_id,type:"Int",required:!1},teacherId:{value:d.teacher_id,type:"Int",required:!1},timetableId:{value:d.timetable_id,type:"Int",required:!0},groupId:{value:d.group_id,type:"Int",required:!1},venueId:{value:d.venue_id,type:"Int",required:!0},day:{value:d.day,type:"String",required:!0},startAt:{value:d.start_at,type:"String",required:!0},endAt:{value:d.end_at,type:"String",required:!0},supervisorId:{value:d.supervisor_id,type:"Int",required:!1},dueDate:{value:d.due_date,type:"String",required:!1}},fields:["success","message"]}}).catch(J=>(r.error("Error occured while creating school timetable"),{data:null})).then(J=>J);l(!1),W&&(W.success?(r.success(W.message),S([]),t.form.resetFields(),t.onFinish()):S(W.message))},Ae=async()=>{var J;const d=((J=t==null?void 0:t.studyCourse)==null?void 0:J.id)??"0",{data:W}=await E.custom({url:"",method:"get",meta:{operation:"timetableStudyCourseModules",variables:{timetableStudyCourseId:{value:parseInt(d.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(se=>(r.error("Something Went Wrong ..."),{data:null})).then(se=>se);W&&o(W.results)},N=async d=>{T(!0);const{data:W}=await E.custom({url:"",method:"get",meta:{operation:"moduleMembers",variables:{moduleId:{value:d,type:"Int",required:!0},memberType:{value:"Teacher",type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{module:["id"]},{schoolMember:["id","registrationNumber","firstName","middleName","lastName","email","phone",{user:["id","firstName","middleName","lastName","email","fullName","pic"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(J=>(r.error("Something Went Wrong ..."),{data:null})).then(J=>J);T(!1),W&&D(W.results)};return a.useEffect(()=>{Ae(),Pe(1),H(1),$(1)},[t.randKey]),e.jsxs(e.Fragment,{children:[((k=t==null?void 0:t.schoolTimetable)==null?void 0:k.forExamination)&&e.jsx("div",{style:{marginBottom:10},children:e.jsx(Se,{type:"info",message:e.jsx(e.Fragment,{children:e.jsxs("p",{style:{fontSize:18},children:[e.jsx("b",{children:"Notice:"})," This timetable is for examination. You can only add entries for examination.",e.jsx("p",{style:{color:"red"},children:"Validation wont apply against Non-Examination Timetable"})," ","But it will be applied against Examination Timetable"]})})})}),e.jsx("div",{children:v.map(d=>e.jsx(Se,{message:d,type:"error",style:{fontSize:18,marginBottom:"3px"},onClose:()=>{S([])},closable:!0}))}),e.jsxs(u,{layout:"vertical",form:O,onFinish:d=>{var W,J;d.start_at=z,d.end_at=L,d.day=t.entry.name,t.advanced?d.timetable_id=parseInt(((W=t==null?void 0:t.studyCourse)==null?void 0:W.id.toString())??"0"):d.timetable_id=parseInt(((J=t==null?void 0:t.schoolTimetableEducationLevel)==null?void 0:J.id.toString())??"0"),Le(d)},children:[t.advanced?e.jsx(u.Item,{name:"module_id",label:"Module",rules:[{required:!0,type:"integer",message:"Please Choose Module"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Module",allowClear:!0,showSearch:!0,onChange:d=>{O.setFieldsValue({teacher_id:void 0}),N(d)},dropdownStyle:{zIndex:9999},children:h.map(d=>e.jsx(je,{value:parseInt(d.id.toString()),children:d.name},d.id))})}):e.jsx(u.Item,{name:"subject_id",label:"Subject",rules:[{required:!0,type:"integer",message:"Please Choose Subject"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Subject",allowClear:!0,showSearch:!0,onChange:V,dropdownStyle:{zIndex:9999},children:I.map(d=>e.jsxs(je,{value:d.id,children:[d.schoolSubject.subject.name,e.jsx(F,{style:{marginLeft:5},color:"green",children:d.subjectTypeDisplay})]},d.id))})}),!t.advanced&&e.jsx(e.Fragment,{children:(X=t==null?void 0:t.schoolTimetable)!=null&&X.forExamination?e.jsx(u.Item,{name:"supervisor_id",label:e.jsx(e.Fragment,{children:"Teachers Supervising"}),rules:[{required:(re=t==null?void 0:t.schoolTimetable)==null?void 0:re.forExamination,type:"integer",message:"Please Choose Supervisor"}],children:e.jsx(R,{size:"large",loading:f,disabled:f,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:c.map(d=>e.jsxs(je,{value:parseInt(d.id.toString()),children:[d.user.fullName,d.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:d.registrationNumber})}),e.jsxs("p",{style:{marginTop:3},children:[e.jsx("span",{style:{color:"red"},children:"Email:"})," ",e.jsx(F,{children:d==null?void 0:d.email}),","," ",e.jsx("span",{style:{color:"red"},children:"Phone:"})," ",e.jsx(F,{children:d==null?void 0:d.phone})]})]},d.id))})}):e.jsx(u.Item,{name:"teacher_id",label:e.jsx(e.Fragment,{children:"Teacher"}),rules:[{required:!((fe=t==null?void 0:t.schoolTimetable)!=null&&fe.forExamination),type:"integer",message:"Please Choose Teacher"}],children:e.jsx(R,{size:"large",loading:f,disabled:f,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:_.map(d=>e.jsxs(je,{value:d.id,children:[d.schoolMember.user.fullName,d.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:d.schoolMember.registrationNumber})})]},d.id))})})}),t.advanced&&e.jsx(e.Fragment,{children:(Me=t==null?void 0:t.schoolTimetable)!=null&&Me.forExamination?e.jsx(u.Item,{name:"supervisor_id",label:e.jsx(e.Fragment,{children:"Lecturer/Tutor Supervising"}),rules:[{required:(He=t==null?void 0:t.schoolTimetable)==null?void 0:He.forExamination,type:"integer",message:"Please Choose Supervisor"}],children:e.jsx(R,{size:"large",loading:f,disabled:f,style:{width:"100%"},placeholder:"Please Choose Lecturer/Tutor",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:s.map(d=>e.jsxs(je,{value:parseInt(d.id.toString()),children:[d.user.fullName,d.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:d.registrationNumber})}),e.jsxs("p",{style:{marginTop:3},children:[e.jsx("span",{style:{color:"red"},children:"Email:"})," ",e.jsx(F,{children:d==null?void 0:d.email}),","," ",e.jsx("span",{style:{color:"red"},children:"Phone:"})," ",e.jsx(F,{children:d==null?void 0:d.phone})]})]},d.id))})}):e.jsx(u.Item,{name:"teacher_id",label:e.jsx(e.Fragment,{children:"Lecturer/Tutor"}),rules:[{required:!((We=t==null?void 0:t.schoolTimetable)!=null&&We.forExamination),type:"integer",message:"Please Choose Lecturer/Tutor"}],children:e.jsx(R,{size:"large",loading:f,disabled:f,style:{width:"100%"},placeholder:"Please Choose Lecturer/Tutor",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:m.map(d=>{var W;return e.jsxs(je,{value:parseInt(d.schoolMember.id.toString()),children:[(W=d==null?void 0:d.schoolMember.user)==null?void 0:W.fullName,d.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:d.schoolMember.registrationNumber})})]},d.id)})})})}),!t.advanced&&e.jsx(u.Item,{name:"group_id",label:"Group",rules:[{required:!1,type:"integer",message:"Please Choose Groups"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Groups",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:C.map(d=>e.jsx(je,{value:parseInt(d.id.toString()),children:d.name},d.id))})}),e.jsx(u.Item,{name:"venue_id",label:"Venue",rules:[{required:!0,type:"integer",message:"Please Choose Venue"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Venue",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:w.map(d=>e.jsx(je,{value:parseInt(d.id.toString()),children:d.name},d.id))})}),e.jsxs(Z,{children:[((Ke=t==null?void 0:t.schoolTimetable)==null?void 0:Ke.forExamination)&&e.jsx(B,{span:8,children:e.jsx(u.Item,{name:"due_date",label:"Due Date",rules:[{required:!0,type:"object",message:"Please Choose Due Date"}],children:e.jsx(_e,{size:"large",style:{width:"100%"},placeholder:"Please Choose Due Date",disabledDate:d=>!(d.day()===Mt.indexOf(t.entry.name)+1),popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:8,children:e.jsx(u.Item,{name:"start_at",rules:[{required:!0,type:"object",message:"Please Choose Start Time"}],label:e.jsx(e.Fragment,{children:e.jsxs(ae,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Start At"}),e.jsx(q,{type:"link",onClick:()=>oe(),children:"Check Slots"})]})}),initialValue:G("07:00","HH:mm"),children:e.jsx(ue,{allowClear:!0,hourStep:1,minuteStep:45,format:Ue,defaultValue:G("07:00","HH:mm"),style:{width:"100%"},size:"large",onChange:d=>{g((d==null?void 0:d.hour().toString())+":"+(d==null?void 0:d.minute().toString()))},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:8,children:e.jsx(u.Item,{name:"end_at",rules:[{required:!0,type:"object",message:"Please Choose End Time"}],label:e.jsx(e.Fragment,{children:e.jsxs(ae,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"End At"}),e.jsx(q,{type:"link",onClick:()=>oe(),children:"Check Slots"})]})}),initialValue:G("07:45","HH:mm"),children:e.jsx(ue,{allowClear:!0,hourStep:1,minuteStep:45,format:Ue,inputReadOnly:!0,defaultValue:G("07:45","HH:mm"),style:{width:"100%"},size:"large",onChange:d=>{b((d==null?void 0:d.hour().toString())+":"+(d==null?void 0:d.minute().toString()))},popupStyle:{zIndex:9999}})})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",loading:y,disabled:y,children:"Save"})})]}),e.jsx(ve,{title:"Available Time Slots",width:"30vw",anchor:"right",onClose:d=>i(d),open:p,children:e.jsx("span",{children:"Slot Schecker"})})]})},it=t=>{const[y,l]=a.useState(!1),[p,i]=a.useState(),[f,T]=a.useState([]),[I,P]=a.useState(),[_,n]=a.useState(!1),[c,j]=a.useState(!1),[C,M]=a.useState(!1),[w]=u.useForm();u.useForm();const A=Ne(),v=async(b,h)=>{P(b),i(h),j(!0)},S=async()=>{g()},z=async b=>{P(b),t.advanced?M(!0):n(!0)},g=async()=>{l(!0);const{data:b}=await E.custom({url:"",method:"get",meta:{operation:"weeklyTimetableEntries",variables:{schoolEducationLevelTimetableId:{value:parseInt(A.id),type:"Int",required:!0}},fields:["entries"]}}).catch(h=>(r.error("Something Went Wrong ..."),{data:null})).then(h=>h);b&&T(b.entries),l(!1)},L=async b=>{const{data:h}=await E.custom({url:"",method:"post",meta:{operation:"deleteTimetableEntry",variables:{timetableEntryId:{value:b,type:"Int",required:!0}},fields:["success","message"]}}).catch(o=>(r.error("Something Went Wrong ..."),{data:null})).then(o=>o);h&&(h.success?(r.success(h.message),g()):r.error(h.message)),l(!1)};return a.useEffect(()=>{g()},[]),e.jsxs(e.Fragment,{children:[e.jsx(qe,{spinning:y,children:e.jsx(Z,{style:{overflowX:"auto"},wrap:!1,children:f.map(b=>{var h,o;return e.jsxs("span",{style:{width:"14.1vw",margin:"1px",padding:"0px"},children:[e.jsxs(Z,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{marginLeft:5},children:e.jsx("h2",{children:b.name})}),e.jsx("span",{style:{position:"relative",right:"0px",marginTop:8},children:e.jsx(K,{title:"Click to Start Scheduling for "+b.name,color:"green",placement:"left",children:e.jsx(q,{disabled:t.advanced?(h=t.studyCourse)==null?void 0:h.published:(o=t.schoolTimetableEducationLevel)==null?void 0:o.published,size:"small",icon:e.jsx(Te,{}),onClick:()=>z(b),children:"Add"})})})]}),e.jsx("div",{style:{maxHeight:"83vh",overflowY:"auto",overflowX:"hidden"},children:e.jsx(me,{style:{margin:"0px",padding:"0px"},bordered:!0,dataSource:b.events,renderItem:s=>e.jsxs(e.Fragment,{children:[e.jsx(me.Item,{children:e.jsxs(ae,{direction:"vertical",children:[e.jsxs("span",{style:{fontSize:18},children:[s.advanced?e.jsx(e.Fragment,{children:e.jsx(K,{title:s.module.name,color:"green",children:e.jsx(F,{color:"green",children:s.module.code})})}):e.jsx(e.Fragment,{children:s.subject.name}),!s.advanced&&e.jsxs(ae,{children:[e.jsx(F,{color:"green",style:{marginLeft:10},children:s.educationLevel.name}),s.group&&e.jsx(e.Fragment,{children:e.jsx(F,{color:"green",children:s.group.name})})]})]}),e.jsx("span",{style:{fontSize:18},children:e.jsxs(ae,{children:[e.jsx(F,{color:"green",children:s.venue.name}),e.jsx(ee,{title:"Are you sure to delete this Timetable Entry?",onConfirm:()=>L(s.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ie,{})})}),e.jsx(q,{icon:e.jsx(Ye,{}),onClick:()=>v(b,s.id)}),e.jsx(K,{title:e.jsxs(e.Fragment,{children:[!s.advanced&&e.jsxs(e.Fragment,{children:[s.teacher.firstName&&e.jsxs(Y,{title:"Teacher Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.teacher.firstName," ",s.teacher.middleName," ",s.teacher.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.teacher.email}),e.jsx(Y.Item,{label:"Phone",children:s.teacher.phone})]}),s.supervisor.firstName&&e.jsxs(Y,{title:"Exam Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.supervisor.firstName," ",s.supervisor.middleName," ",s.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:s.supervisor.phone})]})]}),s.advanced&&e.jsxs(e.Fragment,{children:[s.lecturer.firstName&&e.jsxs(Y,{title:"Lecturer Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.lecturer.firstName," ",s.lecturer.middleName," ",s.lecturer.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.lecturer.email}),e.jsx(Y.Item,{label:"Phone",children:s.lecturer.phone})]}),s.supervisor.firstName&&e.jsxs(Y,{title:"Exam Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.supervisor.firstName," ",s.supervisor.middleName," ",s.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:s.supervisor.phone})]})]})]}),color:"white",overlayInnerStyle:{color:"black"},children:e.jsx(q,{type:"primary",shape:"circle",icon:e.jsx(Xe,{})})})]})})]})}),s.isExam&&e.jsx(me.Item,{children:e.jsx("span",{style:{fontSize:18},children:ne(s.dueDate).format("YYYY MMM, DD")})}),e.jsxs(nt,{children:[s.startAt," - ",s.endAt]})]})})})]})})})}),e.jsx(de,{title:(I==null?void 0:I.name)+" Scheduler",width:"45vw",open:_,onClose:b=>n(b),children:e.jsx($e,{advanced:t.advanced,schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:w,entry:I,onFinish:S})}),e.jsx(de,{title:(I==null?void 0:I.name)+" Scheduler",width:"45vw",open:C,onClose:b=>M(b),children:e.jsx($e,{advanced:t.advanced,schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:w,entry:I,onFinish:S,studyCourse:t.studyCourse})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[I==null?void 0:I.name," Scheduler"]}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:"Editting"})})]}),width:"45vw",open:c,onClose:b=>j(b),children:e.jsx(qt,{schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:w,entry:I,onFinish:S})})]})},Ft=()=>{var P,_,n,c,j;const[t,y]=a.useState(),[l,p]=a.useState(),i=Ne(),f=async(C,M)=>{const{data:w}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolStudyCourseTimetable",variables:{schoolStudyCourseTimetableId:{value:C,type:"Int",required:!0},published:{value:M,type:"Boolean",required:!0}},fields:["success","message",{schoolStudyCourseTimetable:["id",{studyCourse:["id","year","semester","semesterDisplay","level","levelDisplay",{course:["id","name"]}]},"published","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(A=>(r.error("Something Went Wrong ..."),{data:null})).then(A=>A);w&&(w.success?(p(w.schoolStudyCourseTimetable),r.success(w.message)):r.error(w.message))},T=async()=>{const{data:C}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCourse",variables:{id:{value:parseInt(i.id),type:"Int",required:!0}},fields:["id",{studyCourse:["id","year","semester","semesterDisplay","level","levelDisplay",{course:["id","name"]}]},"published","created","updated","isActive","canEdit","canDelete","canManage"]}}).catch(M=>(r.error("Something Went Wrong ..."),{data:null})).then(M=>M);C&&p(C)},I=async()=>{const{data:C}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetable",variables:{id:{value:parseInt(i.tid),type:"Int",required:!0}},fields:["id","title","description",{school:["id"]},"forExamination","created","updated","isActive","canEdit","canDelete","canManage"]}}).catch(M=>(r.error("Something Went Wrong ..."),{data:null})).then(M=>M);C&&y(C)};return a.useEffect(()=>{document.title=Ce.system_name+": Timetable Scheduler",I(),T()},[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(le,{children:[e.jsx(le.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(le.Item,{children:e.jsxs(be,{to:"/timetable/timetables",children:["Timetables - ",t==null?void 0:t.title]})}),e.jsxs(le.Item,{children:["Scheduler - ",(_=(P=l==null?void 0:l.studyCourse)==null?void 0:P.course)==null?void 0:_.name," -"," ",(n=l==null?void 0:l.studyCourse)==null?void 0:n.year," -"," ",(c=l==null?void 0:l.studyCourse)==null?void 0:c.semesterDisplay," -"," ",(j=l==null?void 0:l.studyCourse)==null?void 0:j.levelDisplay]})]}),e.jsxs("div",{children:[!(l!=null&&l.published)&&e.jsx(q,{size:"large",icon:e.jsx(we,{style:{color:"red"}}),onClick:()=>f(l==null?void 0:l.id,!0),children:"Not Published"}),(l==null?void 0:l.published)&&e.jsx(q,{size:"large",icon:e.jsx(Qe,{style:{color:"green"}}),onClick:()=>f(l==null?void 0:l.id,!1),children:"Published"})]})]}),e.jsx(it,{advanced:!0,schoolTimetable:t,studyCourse:l})]})},Dt=t=>{const[y,l]=a.useState([]),[p,i]=a.useState(0),[f,T]=a.useState(20),[I,P]=a.useState(""),[_,n]=a.useState(!0),[c]=u.useForm(),C=!ye.useBreakpoint().lg,M=[{title:"Name",dataIndex:"name",fixed:!0,render:(v,S)=>e.jsxs("span",{children:[e.jsx("a",{children:S.educationLevel.name}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:S.educationLevel.schoolType.name})})]})},{title:"",dataIndex:"action",render:(v,S)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ee,{title:"Are you sure to delete this task?",onConfirm:()=>w(S.id),onCancel:()=>{},okText:"Yes",cancelText:"No",disabled:!S.canManage,overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Te,{}),children:"Add"})})})}],w=async v=>{var z;const{data:S}=await E.custom({url:"",method:"post",meta:{operation:"createSchoolEducationLevelTimetable",variables:{schoolTimetableId:{value:parseInt(((z=t.schoolTimetable)==null?void 0:z.id.toString())??"0"),type:"Int",required:!0},schoolEducationLevelId:{value:parseInt(v.toString()),type:"Int",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(g=>(r.error("Something Went Wrong ..."),{data:null})).then(g=>g);S&&(S.success?(r.success(S.message),t.onAdd(S.schoolEducationLevelTimetable),l(y.filter(g=>g.id.toString()!==v.toString()))):r.error(S.message)),n(!1)},A=async(v,S="",z=20)=>{var L;const{data:g}=await E.custom({url:"",method:"get",meta:{operation:"timetableNotAssignedSchoolEducationLevels",variables:{schoolTimetableId:{value:parseInt(((L=t.schoolTimetable)==null?void 0:L.id.toString())??"0"),type:"Int",required:!0},page:{value:v,type:"Int",required:!0},key:{value:S,type:"String",required:!1},pageSize:{value:z,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{school:["id","name"]},{educationLevel:["id","name",{schoolType:["id","name","code"]}]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(b=>(r.error("Something Went Wrong ..."),{data:null})).then(b=>b);g&&(i(g.total),l([...g.results])),n(!1)};return a.useEffect(()=>{A(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{style:{marginTop:10},children:e.jsx(B,{span:C?24:20,children:e.jsx(u,{layout:"vertical",form:c,onFinish:v=>{P(v.key),y.length=0,A(1,v.key,f)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:_,columns:M,dataSource:y,pagination:{onChange:(v,S)=>{T(S),A(v,I,S)},total:p,pageSize:f,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})]})},lt=t=>{var o,s;const[y,l]=a.useState([]),[p,i]=a.useState(1),[f,T]=a.useState(0),[I,P]=a.useState(!1),[_,n]=a.useState(!0),{push:c}=Ze(),[j]=u.useForm();u.useForm(),ye.useBreakpoint().lg;const[M,w]=a.useState(!1),A=async x=>{l([x,...y])},v=async x=>{const{data:m}=await E.custom({url:"",method:"post",meta:{operation:"synchronizeTimetableEducationLevels",variables:{timetableId:{value:parseInt(x),type:"Int",required:!0}},fields:["success","message"]}}).catch(D=>(r.error("Error in synchronizing Timetable Education Levels"),{data:null})).then(D=>D);m&&(m.success?(r(m.message),b(1,"")):r.error(m.message))},S=async x=>{const{data:m}=await E.custom({url:"",method:"post",meta:{operation:"deleteSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(x.toString()),type:"Int",required:!0}},fields:["success","message"]}});m.success?(r.success(m.message),l(y.filter(D=>D.id!==x))):r.error(m.message)},z=async(x,m)=>{const{data:D}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(x.toString()),type:"Int",required:!0},publish:{value:m,type:"Boolean",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});D.success?(r.success(D.message),l(y.map(O=>O.id===D.schoolEducationLevelTimetable.id?D.schoolEducationLevelTimetable:O))):r.error(D.message)},g=()=>{r("Canceled")},L=[{title:"Name",dataIndex:"name",fixed:!0,render:(x,m,D)=>e.jsx("span",{children:e.jsx("a",{children:m.schoolEducationLevel.educationLevel.name})})},{title:"Has Entries",dataIndex:"hasEntries",fixed:!0,render:(x,m,D)=>e.jsx("span",{children:m.hasEntries?e.jsx(e.Fragment,{children:e.jsx(F,{color:"green",children:"Yes"})}):e.jsx(e.Fragment,{children:e.jsx(F,{color:"red",children:"No"})})})},{title:"Created",dataIndex:"created",render:(x,m,D)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(m.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(x,m,D)=>e.jsx("a",{children:m!=null&&m.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"Published",dataIndex:"published",render:(x,m,D)=>e.jsx("a",{children:m!=null&&m.published?e.jsx(ee,{title:"Are you sure to Un-publish?",onConfirm:()=>z(m.id,!1),onCancel:()=>{},okText:"Unpublish",cancelText:"No",okButtonProps:{disabled:!m.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(F,{color:"green",children:"Published"})}):e.jsx(ee,{title:"Are you sure to Publish?",onConfirm:()=>z(m.id,!0),onCancel:()=>{},okText:"Publish",cancelText:"No",okButtonProps:{disabled:!m.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(F,{color:"red",children:"Not Published"})})})},{title:"",dataIndex:"action",render:(x,m,D)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(K,{title:"Schedule",placement:"left",children:e.jsx(q,{icon:e.jsx(xe,{}),disabled:!m.canManage,onClick:()=>{var O;return c("/timetable/education/level/scheduler/"+((O=t==null?void 0:t.schoolTimetable)==null?void 0:O.id)+"/"+m.id)}})}),e.jsx(ee,{title:"Are you sure to delete this School Education Level Timetable?",onConfirm:()=>S(m==null?void 0:m.id),onCancel:()=>g,okText:"Yes",cancelText:"No",disabled:!(m!=null&&m.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ie,{}),disabled:!(m!=null&&m.canDelete)})})]})}],b=async(x,m="")=>{var O;const{data:D}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableEducationLevels",variables:{schoolTimetableId:{value:parseInt(((O=t.schoolTimetable)==null?void 0:O.id.toString())??"0"),type:"Int",required:!0},page:{value:x,type:"Int",required:!0},key:{value:m,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(oe=>(r.error("Failed loading School Timetable Education Levels"),{data:null})).then(oe=>oe);D&&(i(D.page),T(D.total),P(D.hasNext),l([...D.results])),n(!1)},h=async x=>{var D;const{data:m}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetables",variables:{timetableId:{value:parseInt(((D=t==null?void 0:t.schoolTimetable)==null?void 0:D.id.toString())??"0"),type:"Int",required:!0},publish:{value:x,type:"Boolean",required:!0}},fields:["success","message"]}});m.success?(r.success(m.message),y.length=0,l([]),b(1)):r.error(m.message)};return a.useEffect(()=>{b(p)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:12,children:e.jsx(u,{layout:"vertical",form:j,onFinish:x=>{i(1),y.length=0,b(1,x.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(B,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(K,{title:"Click to Publish All timetables Listed Below",color:"green",children:e.jsx(q,{size:"large",icon:e.jsx(gt,{style:{color:"green"}}),onClick:()=>h(!0),children:"Publish All"})}),e.jsx(K,{title:"Click to Unpublish All Timetables listed Below",color:"red",children:e.jsx(q,{size:"large",icon:e.jsx(we,{style:{color:"red"}}),onClick:()=>h(!1),children:"Unpublish All"})}),e.jsx(q,{size:"large",icon:e.jsx(et,{}),onClick:()=>w(!0),children:"Add"}),((o=t.schoolTimetable)==null?void 0:o.forExamination)&&e.jsx(K,{title:"Synchronization All Education Levels Related to Examination",placement:"top",color:"green",children:e.jsx(q,{size:"large",icon:e.jsx(tt,{}),onClick:()=>{var x;return v((x=t.schoolTimetable)==null?void 0:x.id)},children:"Sync"})})]})]}),e.jsx(ge,{loading:_,columns:L,dataSource:y,pagination:!1,scroll:{y:"60vh"}}),e.jsx(ve,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Adding School Education Levels to "}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:(s=t.schoolTimetable)==null?void 0:s.title})})]}),width:"45vw",anchor:"right",onClose:x=>w(x),open:M,children:e.jsx(Dt,{randKey:Math.random(),schoolTimetable:t.schoolTimetable,onAdd:A})})]})},Nt=()=>{const[t,y]=a.useState(),[l,p]=a.useState(),[i,f]=a.useState(!1),T=Ne(),I=async()=>{const{data:n}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableEducationLevel",variables:{id:{value:parseInt(T.id),type:"Int",required:!0}},fields:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},"created","updated","isActive","published","canEdit","canDelete","canManage"]}}).catch(c=>(r.error("Something Went Wrong ..."),{data:null})).then(c=>c);n&&p(n)},P=async()=>{const{data:n}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetable",variables:{id:{value:parseInt(T.tid),type:"Int",required:!0}},fields:["id","title","description",{school:["id"]},"forExamination","created","updated","isActive","isPublished","canEdit","canDelete","canManage"]}}).catch(c=>(r.error("Something Went Wrong ..."),{data:null})).then(c=>c);n&&y(n)},_=async(n,c)=>{const{data:j}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(n.toString()),type:"Int",required:!0},publish:{value:c,type:"Boolean",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});j.success?(r.success(j.message),p(j.schoolEducationLevelTimetable)):r.error(j.message)};return a.useEffect(()=>{document.title=Ce.system_name+": School Timetable Education Level Scheduler",P(),I()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(le,{children:[e.jsx(le.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(le.Item,{children:e.jsxs(be,{to:"/timetable/timetables",children:["Timetables - ",t==null?void 0:t.title]})}),e.jsxs(le.Item,{children:["Scheduler -"," ",l==null?void 0:l.schoolEducationLevel.educationLevel.name]}),(l==null?void 0:l.published)&&e.jsx(e.Fragment,{children:e.jsx(F,{color:"red",style:{fontSize:16,padding:3},children:"To Continue Scheduling this Timetable, you first need to Unpublish"})})]}),e.jsxs("div",{style:{float:"right"},children:[(l==null?void 0:l.published)&&e.jsx(ee,{title:"Are you sure to Unpublish Timetable",placement:"left",onConfirm:()=>_(l==null?void 0:l.id,!1),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(yt,{style:{color:"red"}}),style:{float:"right"},children:"Unpublish"})}),!(l!=null&&l.published)&&e.jsx(e.Fragment,{children:e.jsx(ee,{title:"Are you sure to Publish Timetable",placement:"left",onConfirm:()=>_(l==null?void 0:l.id,!0),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Qe,{style:{color:"green"}}),style:{float:"right"},children:"Publish"})})}),e.jsx(K,{title:"Click to Switch to Other Related Timetables, so as to continue scheduling",color:"green",placement:"left",children:e.jsx(q,{icon:e.jsx(pt,{style:{color:"green"}}),style:{float:"right"},onClick:()=>f(!0),children:"Switch"})})]}),e.jsx("div",{style:{marginTop:45},children:e.jsx(it,{advanced:!1,schoolTimetable:t,schoolTimetableEducationLevel:l})})]}),e.jsx(de,{title:"Timetable Switcher",width:"70vw",open:i,onClose:n=>f(n),children:e.jsx(lt,{schoolTimetable:t,randKey:Math.random()})})]})};G.extend(bt);const Q="HH:mm",Pt=t=>{const[y,l]=a.useState(!1),[p]=u.useForm(),[i,f]=a.useState(),[T,I]=a.useState(!0),[P,_]=a.useState(!1),[n,c]=a.useState(!1),[j,C]=a.useState(!1),[M,w]=a.useState(!1),[A,v]=a.useState(!1),[S,z]=a.useState(!1),[g,L]=a.useState(!1),b=async o=>{l(!0);const{data:s}=await E.custom({url:"",method:"post",meta:{operation:"updateSchoolTimetablingSettings",variables:{perPeriodDuration:{value:o.per_period_duration,type:"Int",required:!0},periodsStartsAt:{value:o.periods_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"),type:"String",required:!1},periodsEndsAt:{value:o.periods_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"),type:"String",required:!1},breaktimeStartAt:{value:o.breaktime_start_at?o.breaktime_start_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},breaktimeEndAt:{value:o.breaktime_end_at?o.breaktime_end_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},allowSaturdayScheduling:{value:o.allow_saturday_scheduling??!1,type:"Boolean",required:!1},allowSundayScheduling:{value:o.allow_sunday_scheduling??!1,type:"Boolean",required:!1},morningSessionStartsAt:{value:o.morning_session_starts_at?o.morning_session_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},morningSessionEndsAt:{value:o.morning_session_ends_at?o.morning_session_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},eveningSessionStartsAt:{value:o.evening_session_starts_at?o.evening_session_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},eveningSessionEndsAt:{value:o.evening_session_ends_at?o.evening_session_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1}},fields:["success","message",{schoolTimetablingSettings:["id",{school:Be},"perPeriodDuration","periodsStartsAt","periodsEndsAt","breaktimeStartAt","breaktimeEndAt","morningSessionStartsAt","morningSessionEndsAt","eveningSessionStartsAt","eveningSessionEndsAt","allowSaturdayScheduling","allowSundayScheduling","created","updated","canEdit","canDelete","canManage"]}]}}).catch(x=>(console.error(x),r.error("Error occured while updating Timetabling Settings"),{data:null})).then(x=>x);s?s.success&&(r.success(s.message),s.periodsStartsAt=G(s.periodsStartsAt).utc(),s.periodsEndsAt=G(s.periodsEndsAt).utc(),s.breaktimeStartAt=G(s.breaktimeStartAt).utc(),s.breaktimeEndAt=G(s.breaktimeEndAt).utc(),f(s.schoolTimetablingSettings)):r.error("Something Went Wrong ... please try again ..."),l(!1)},h=async()=>{l(!0);const{data:o}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetablingSetting",fields:["id",{school:Be},"perPeriodDuration","periodsStartsAt","periodsEndsAt","breaktimeStartAt","breaktimeEndAt","morningSessionStartsAt","morningSessionEndsAt","eveningSessionStartsAt","eveningSessionEndsAt","allowSaturdayScheduling","allowSundayScheduling","created","updated","canEdit","canDelete","canManage"]}}).catch(s=>(console.error(s),r.error("Error occured while getting Timetabling Settings"),{data:null})).then(s=>s);o&&f(o),l(!1)};return a.useEffect(()=>{h()},[]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:y,children:i&&e.jsx(Z,{style:{marginTop:10},children:e.jsx(B,{span:24,children:e.jsx(vt,{children:e.jsxs(u,{layout:"horizontal",form:p,onFinish:o=>{console.log(o),b(o)},requiredMark:!0,initialValues:{per_period_duration:(i==null?void 0:i.perPeriodDuration)??60,periods_starts_at:i!=null&&i.periodsEndsAt?G(i==null?void 0:i.periodsStartsAt,Q):void 0,periods_ends_at:i!=null&&i.periodsEndsAt?G(i==null?void 0:i.periodsEndsAt,Q):void 0,breaktime_start_at:i!=null&&i.breaktimeStartAt?G(i==null?void 0:i.breaktimeStartAt,Q):void 0,breaktime_end_at:i!=null&&i.breaktimeEndAt?G(i==null?void 0:i.breaktimeEndAt,Q):void 0,allow_saturday_scheduling:(i==null?void 0:i.allowSaturdayScheduling)??!1,allow_sunday_scheduling:(i==null?void 0:i.allowSundayScheduling)??!1,morning_session_starts_at:i!=null&&i.morningSessionStartsAt?G(i==null?void 0:i.morningSessionStartsAt,Q):void 0,morning_session_ends_at:i!=null&&i.morningSessionEndsAt?G(i==null?void 0:i.morningSessionEndsAt,Q):void 0,evening_session_starts_at:i!=null&&i.eveningSessionStartsAt?G(i==null?void 0:i.eveningSessionStartsAt,Q):void 0,evening_session_ends_at:i!=null&&i.eveningSessionEndsAt?G(i==null?void 0:i.eveningSessionEndsAt,Q):void 0},children:[e.jsx(u.Item,{label:"Per Period Duration in Minutes",name:"per_period_duration",rules:[{required:!0,message:"Please input Per Period Duration in Minutes!"}],style:{width:"50%"},children:e.jsx(U,{})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(ae,{direction:"horizontal",children:[e.jsx(u.Item,{label:"Periods Start At(24 Hours Format)",name:"periods_starts_at",rules:[{required:T,message:"Please input Periods Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:G("12:00",Q),format:Q,minuteStep:15,hourStep:1,onChange:o=>{_(!!o)}})}),e.jsx(u.Item,{label:"Periods End At(24 Hours Format)",name:"periods_ends_at",rules:[{required:P,message:"Please input Periods End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Q,minuteStep:15,hourStep:1,onChange:o=>{I(!!o)},disabledHours:()=>p.getFieldValue("periods_starts_at")?Array.from({length:p.getFieldValue("periods_starts_at").hour()},(o,s)=>s):[],disabledMinutes:o=>p.getFieldValue("periods_starts_at")&&p.getFieldValue("periods_starts_at").hour()===o?Array.from({length:p.getFieldValue("periods_starts_at").minute()},(s,x)=>x):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(ae,{direction:"horizontal",children:[e.jsx(u.Item,{label:"Morning Session Start At(24 Hours Format)",name:"morning_session_starts_at",rules:[{required:M,message:"Please input Morning Session Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:G("12:00",Q),format:Q,minuteStep:15,hourStep:1,onChange:o=>{v(!!o)}})}),e.jsx(u.Item,{label:"Morning Session End At(24 Hours Format)",name:"morning_session_ends_at",rules:[{required:A,message:"Please input Morning Session End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Q,minuteStep:15,hourStep:1,onChange:o=>{w(!!o)},disabledHours:()=>p.getFieldValue("morning_session_starts_at")?Array.from({length:p.getFieldValue("morning_session_starts_at").hour()},(o,s)=>s):[],disabledMinutes:o=>p.getFieldValue("morning_session_starts_at")&&p.getFieldValue("morning_session_starts_at").hour()===o?Array.from({length:p.getFieldValue("morning_session_starts_at").minute()},(s,x)=>x):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(ae,{direction:"horizontal",children:[e.jsx(u.Item,{label:"Evening Session Start At(24 Hours Format)",name:"evening_session_starts_at",rules:[{required:S,message:"Please input Evening Session Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:G("12:00",Q),format:Q,minuteStep:15,hourStep:1,onChange:o=>{L(!!o)}})}),e.jsx(u.Item,{label:"Evening Session End At(24 Hours Format)",name:"evening_session_ends_at",rules:[{required:g,message:"Please input Evening Session End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Q,minuteStep:15,hourStep:1,onChange:o=>{z(!!o)},disabledHours:()=>p.getFieldValue("evening_session_starts_at")?Array.from({length:p.getFieldValue("evening_session_starts_at").hour()},(o,s)=>s):[],disabledMinutes:o=>p.getFieldValue("evening_session_starts_at")&&p.getFieldValue("evening_session_starts_at").hour()===o?Array.from({length:p.getFieldValue("evening_session_starts_at").minute()},(s,x)=>x):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(ae,{direction:"horizontal",children:[e.jsx(u.Item,{label:"Break start At (24 Hours Format)",name:"breaktime_start_at",rules:[{required:n,message:"Please input Break Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Q,minuteStep:15,hourStep:1,onChange:o=>{C(!!o)}})}),e.jsx(u.Item,{label:"Break End At (24 Hours Format)",name:"breaktime_end_at",rules:[{required:j,message:"Please input Break End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Q,minuteStep:15,hourStep:1,onChange:o=>{c(!!o)},disabledHours:()=>p.getFieldValue("breaktime_start_at")?Array.from({length:p.getFieldValue("breaktime_start_at").hour()},(o,s)=>s):[],disabledMinutes:o=>p.getFieldValue("breaktime_start_at")&&p.getFieldValue("breaktime_start_at").hour()===o?Array.from({length:p.getFieldValue("breaktime_start_at").minute()},(s,x)=>x):[]})})]})}),e.jsx(u.Item,{label:"Allow Saturday Scheduling",name:"allow_saturday_scheduling",rules:[{required:!1,type:"boolean",message:"Allow Saturday Scheduling"}],style:{width:"50%"},valuePropName:"checked",children:e.jsx(ke,{defaultChecked:(i==null?void 0:i.allowSaturdayScheduling)??!1})}),e.jsx(u.Item,{label:"Allow Sunday Scheduling",name:"allow_sunday_scheduling",rules:[{type:"boolean",required:!1,message:"Allow Sunday Scheduling"}],style:{width:"50%"},valuePropName:"checked",children:e.jsx(ke,{})}),e.jsx(u.Item,{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",htmlType:"submit",children:"Save"})})]})})})})})})},Lt=()=>(a.useEffect(()=>(document.title=Ce.system_name+": Timetable Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsx("div",{style:{marginTop:10},children:e.jsx(Pt,{})})),{TextArea:zt}=U,{Option:Vt}=R,Yt=t=>{const[y,l]=a.useState(!1),[p,i]=a.useState([]),[f,T]=a.useState(),I=n=>{T(n)},P=async(n=1,c="")=>{l(!0);const{data:j}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenueTypes",variables:{page:{value:n,type:"Int",required:!0},key:{value:c,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","isActive","created","updated","canEdit","canDelete","canManage"]}]}});i(j.results),l(!1)},_=async n=>{const{data:c}=await E.custom({url:"",method:"post",meta:{operation:"createSchoolVenue",variables:{name:{value:n.name,type:"String",required:!0},code:{value:n.code,type:"String",required:!0},schoolVenueTypeId:{value:parseInt(n.school_venue_type_id),type:"Int",required:!0},description:{value:n.description,type:"String",required:!1},capacity:{value:parseInt(n.capacity),type:"Int",required:!1},longitude:{value:n.longitude,type:"Float",required:!1},latitude:{value:n.latitude,type:"Float",required:!1}},fields:["success","message",{schoolVenue:["id","name","code","description",{schoolVenueType:["id","name"]},"capacity","latitude","longitude","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(j=>(r.error("Error occured while creating school venue"),{data:null})).then(j=>j);c&&(c.success?(r.success(c.message),t.onFinish(c.schoolVenue),t.form.resetFields()):r.error(c.message))};return a.useEffect(()=>{P()},[t.randKey]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:y,children:e.jsxs(u,{layout:"vertical",form:t.form,onFinish:n=>{n.school_venue_type_id=f,_(n)},children:[e.jsx(u.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Name ..."})}),e.jsx(u.Item,{name:"code",label:"Code",rules:[{required:!0,type:"string",message:"Please input Code"}],children:e.jsx(U,{size:"large",placeholder:"Enter Code ..."})}),e.jsx(u.Item,{name:"capacity",label:"Capacity",children:e.jsx(rt,{size:"large",min:0,defaultValue:45,style:{width:"100%"}})}),e.jsx(u.Item,{label:"School Type",rules:[{required:!0,type:"string",message:"Please choose School Type"}],children:e.jsx(R,{showSearch:!0,size:"large",placeholder:"Select a School Venue Type",optionFilterProp:"children",onChange:I,onSearch:n=>{},filterOption:(n,c)=>c.children.toLowerCase().includes(n.toLowerCase()),dropdownStyle:{zIndex:9999},children:p.map((n,c)=>e.jsx(Vt,{value:n.id,children:n.name}))})}),e.jsx(u.Item,{name:"latitude",label:"Latitude",rules:[{required:!1,type:"number",message:"Please input Latidue"}],children:e.jsx(U,{size:"large",placeholder:"Enter Latitude ..."})}),e.jsx(u.Item,{name:"longitude",label:"Longitude",rules:[{required:!1,type:"number",message:"Please input Longitude"}],children:e.jsx(U,{size:"large",placeholder:"Enter Longitude ..."})}),e.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(zt,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})})},{TextArea:Ht}=U,{Option:Wt}=R,Kt=t=>{var n;const[y,l]=a.useState(!1),[p,i]=a.useState([]),[f,T]=a.useState(),I=c=>{T(c)},P=async(c=1,j="")=>{l(!0);const{data:C}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenueTypes",variables:{page:{value:c,type:"Int",required:!0},key:{value:j,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","isActive","created","updated","canEdit","canDelete","canManage"]}]}});i(C.results),l(!1)},_=async c=>{const{data:j}=await E.custom({url:"",method:"post",meta:{operation:"updateSchoolVenue",variables:{schoolVenueId:{value:parseInt(c.school_venue_id),type:"Int",required:!0},name:{value:c.name,type:"String",required:!0},code:{value:c.code,type:"String",required:!0},schoolVenueTypeId:{value:parseInt(c.school_venue_type_id),type:"Int",required:!0},description:{value:c.description,type:"String",required:!1},capacity:{value:parseInt(c.capacity),type:"Int",required:!1},longitude:{value:c.longitude,type:"Float",required:!1},latitude:{value:c.latitude,type:"Float",required:!1}},fields:["success","message",{schoolVenue:["id","name","code","description",{schoolVenueType:["id","name"]},"capacity","latitude","longitude","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(C=>(r.error("Error occured while Updating school venue"),{data:null})).then(C=>C);j&&(j.success?(r.success(j.message),t.onFinish(j.schoolVenue),t.form.resetFields()):r.error(j.message))};return a.useEffect(()=>{var c,j,C,M,w,A,v,S;P(),t.form.setFieldsValue({name:(c=t.venue)==null?void 0:c.name,code:(j=t.venue)==null?void 0:j.code,capacity:(C=t.venue)==null?void 0:C.capacity,description:(M=t.venue)==null?void 0:M.description,school_venue_type_id:(w=t.venue)==null?void 0:w.schoolVenueType.id,longitude:(A=t.venue)==null?void 0:A.longitude,latitude:(v=t.venue)==null?void 0:v.latitude}),I((S=t.venue)==null?void 0:S.schoolVenueType.id)},[t.randKey]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:y,children:e.jsxs(u,{layout:"vertical",form:t.form,onFinish:c=>{var j;c.school_venue_type_id=f,c.school_venue_id=(j=t.venue)==null?void 0:j.id,_(c)},requiredMark:!1,children:[e.jsx(u.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Name ..."})}),e.jsx(u.Item,{name:"code",label:"Code",rules:[{required:!0,type:"string",message:"Please input Code"}],children:e.jsx(U,{size:"large",placeholder:"Enter Code ..."})}),e.jsx(u.Item,{name:"capacity",label:"Capacity",children:e.jsx(rt,{min:0,defaultValue:45,style:{width:"100%"}})}),e.jsx(u.Item,{label:"School Type",rules:[{required:!0,type:"string",message:"Please choose School Type"}],children:e.jsx(R,{showSearch:!0,placeholder:"Select a School Venue Type",optionFilterProp:"children",onChange:I,defaultValue:(n=t.venue)==null?void 0:n.schoolVenueType.id,onSearch:c=>{},filterOption:(c,j)=>j.children.toLowerCase().includes(c.toLowerCase()),dropdownStyle:{zIndex:9999},children:p.map((c,j)=>e.jsx(Wt,{value:c.id,children:c.name}))})}),e.jsx(u.Item,{name:"latitude",label:"Latitude",rules:[{required:!1,type:"number",message:"Please input Latidue"}],children:e.jsx(U,{size:"large",placeholder:"Enter Latitude ..."})}),e.jsx(u.Item,{name:"longitude",label:"Longitude",rules:[{required:!1,type:"number",message:"Please input Longitude"}],children:e.jsx(U,{size:"large",placeholder:"Enter Longitude ..."})}),e.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(Ht,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})})},Bt=t=>{const[y,l]=a.useState(),[p,i]=a.useState([]),[f,T]=a.useState(0),[I,P]=a.useState(!0),[_,n]=a.useState(20),[c,j]=a.useState(""),[C]=u.useForm(),[M]=u.useForm(),A=!ye.useBreakpoint().lg,[v,S]=a.useState(!1),[z,g]=a.useState(!1),L=x=>{l(x),g(!0)},b=async x=>{const{data:m}=await E.custom({url:"",method:"post",meta:{operation:"deleteSchoolVenue",variables:{schoolVenueId:{value:x,type:"Int",required:!0}},fields:["success","message"]}}).catch(D=>(r.error("Error occured while Deleting School Venue"),{data:null})).then(D=>D);m&&(m.success?(r.success(m.message),i(p.filter(D=>D.id.toString()!==x.toString()))):r.error(m.message))},h=async x=>{i([x,...p]),M.resetFields()},o=async x=>{const m=p.findIndex(D=>D.id===x.id);p[m]=x,i([...p]),M.resetFields(),l(void 0),g(!1)},s=async(x,m="",D=20)=>{P(!0);const{data:O}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:x,type:"Int",required:!0},key:{value:m,type:"String",required:!1},pageSize:{value:D,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","capacity","description","latitude","longitude",{school:["id"]},{schoolVenueType:["id","name"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(oe=>(r.error("Error occured while fetching roles"),{data:null})).then(oe=>oe);O&&(T(O.total),i([...O.results])),P(!1)};return a.useEffect(()=>{s(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:A?24:10,children:e.jsx(u,{layout:"vertical",form:C,onFinish:x=>{j(x.key),p.length=0,s(1,x.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:A?24:2,children:e.jsx(q,{icon:e.jsx(ce,{}),size:"large",onClick:()=>C.submit()})}),e.jsx(B,{span:A?24:12,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(K,{title:"Register a New Venue/Class",children:e.jsx(q,{icon:e.jsx(Te,{}),size:"large",onClick:()=>S(!0),children:"Add Venue"})})})})]}),e.jsx(ge,{loading:I,columns:[{title:"Name",dataIndex:"name",fixed:!0,render:(x,m,D)=>e.jsx("span",{children:e.jsx("a",{children:m.name})})},{title:"Code",dataIndex:"code",render:(x,m,D)=>e.jsx("span",{children:m.code})},{title:"Venue Type",dataIndex:"venue_type",render:(x,m,D)=>{var O;return e.jsx("span",{children:e.jsx(F,{color:"green",children:(O=m==null?void 0:m.schoolVenueType)==null?void 0:O.name})})}},{title:"Capacity",dataIndex:"capacity",render:(x,m,D)=>e.jsx("span",{children:m.capacity})},{title:"Date Created",dataIndex:"created",render:(x,m,D)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(m.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(x,m,D)=>e.jsx("span",{children:m!=null&&m.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(x,m,D)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(at,{trigger:["click"],overlay:e.jsxs(he,{children:[e.jsx(he.Item,{icon:e.jsx(Ie,{}),disabled:!m.canDelete,children:e.jsx(ee,{placement:"topLeft",title:`Are you sure you want to delete ${m.name} Venue?`,onConfirm:()=>b(parseInt(m.id)),okText:"Yes",cancelText:"No",children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(he.Item,{icon:e.jsx(Ye,{}),disabled:!m.canEdit,onClick:()=>L(m),children:e.jsx("a",{rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:O=>O.preventDefault(),children:e.jsx(st,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}],dataSource:p,pagination:{onChange:(x,m)=>{n(m),s(x,c,m)},total:f,pageSize:_,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(80vh - 80px)"}}),e.jsx(de,{title:"Register New Venue/Class",width:"30vw",open:v,onClose:x=>S(x),children:e.jsx(Yt,{randKey:Math.random(),form:M,onFinish:h})}),e.jsx(de,{title:"Edditing Venue/Class",width:"30vw",open:z,onClose:x=>g(x),children:e.jsx(Kt,{randKey:Math.random(),form:M,onFinish:o,venue:y})})]})},Ot=()=>(a.useEffect(()=>(document.title=Ce.system_name+": School Venues",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(le,{children:[e.jsx(le.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(le.Item,{children:"Venues/Classes"})]}),e.jsx(Bt,{})]})),{TextArea:Gt}=U,{Option:Ve}=R,ot=[];for(let t=2022;t<new Date().getFullYear()+3;t++)ot.push(e.jsx(Ve,{value:t,children:t.toString()},t.toString()));const Rt=t=>{const[y,l]=a.useState(!1),[p,i]=a.useState([]),[f,T]=a.useState([]),I=async()=>{const{data:n}=await E.custom({url:"",method:"get",meta:{operation:"schoolExaminations",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(c=>(r.error("Failed to get school Examinations"),{data:null})).then(c=>c);n&&i(n.results)},P=async()=>{const{data:n}=await E.custom({url:"",method:"get",meta:{operation:"schoolTypes",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(c=>(r.error("Error occured while fetching school types"),{data:null})).then(c=>c);n&&T(n.results)},_=async n=>{const{data:c}=await E.custom({url:"",method:"post",meta:{operation:"createSchoolTimetable",variables:{title:{value:n.title,type:"String",required:!0},description:{value:n.description,type:"String",required:!1},startAt:{value:n.start_at,type:"DateTime",required:!0},endAt:{value:n.end_at,type:"DateTime",required:!0},year:{value:n.year,type:"Int",required:!0},timetableType:{value:parseInt(n.timetable_type),type:"Int",required:!0},forExamination:{value:n.for_examination,type:"Boolean",required:!1},schoolExaminationId:{value:parseInt(n.school_examination_id),type:"Int",required:!1}},fields:["success","message",{schoolTimetable:["id","title","description","startAt","endAt","timetableType","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id","name"]},{schoolExamination:["id","name"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(j=>(r.error("Error occured while creating school timetable"),{data:null})).then(j=>j);c&&(c.success?(r.success(c.message),t.onFinish(c.schoolTimetable),t.form.resetFields()):r.error(c.message))};return a.useEffect(()=>{I(),P()},[t.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:t.form,onFinish:n=>{n.for_examination=y,n.year?n.year=parseInt(n.year):n.year=new Date().getFullYear(),_(n)},children:[e.jsx(u.Item,{name:"timetable_type",label:"Timetable Type",rules:[{required:!0,type:"string",message:"Please select Timetable Type"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Timetable Type ...",dropdownStyle:{zIndex:9999},children:f.map(n=>e.jsx(Ve,{value:n.id,children:n.name},n.id))})}),e.jsx(u.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Title"}],children:e.jsx(U,{size:"large",placeholder:"Enter Title ..."})}),e.jsx(u.Item,{name:"year",label:"Academic Year",children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Select Year",defaultValue:new Date().getFullYear(),dropdownStyle:{zIndex:9999},children:ot})}),e.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(Gt,{rows:4})}),e.jsxs(Z,{children:[e.jsx(B,{span:12,children:e.jsx(u.Item,{name:"start_at",label:"Start At",rules:[{required:!0,type:"date",message:"Please input Start At Date"}],children:e.jsx(_e,{style:{width:"100%"},disabledDate:n=>{const c=ne().format("YYYY-MM-DD");return n&&n<ne(c,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:12,children:e.jsx(u.Item,{name:"end_at",label:"End At",rules:[{required:!0,type:"date",message:"Please input End At Date"}],children:e.jsx(_e,{style:{width:"100%"},disabledDate:n=>{const c=ne().format("YYYY-MM-DD");return n&&n<ne(c,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})})]}),e.jsx(u.Item,{name:"for_examination",valuePropName:"checked",children:e.jsx(ke,{onChange:n=>{n.target.checked?l(!0):l(!1)},children:"For Examination"})}),y&&e.jsx(u.Item,{name:"school_examination_id",label:"Examination",rules:[{required:y,type:"string",message:"Please select Examination"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Examination ...",dropdownStyle:{zIndex:9999},children:p==null?void 0:p.map(n=>e.jsx(Ve,{value:n.id.toString(),children:n.name},n.id))})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{Option:dt}=R,{TextArea:Ut}=U,ct=[];for(let t=2022;t<new Date().getFullYear()+3;t++)ct.push(e.jsx(dt,{value:t,children:t.toString()},t.toString()));const $t=t=>{const[y,l]=a.useState([]),p=async()=>{const{data:f}=await E.custom({url:"",method:"get",meta:{operation:"schoolTypes",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(T=>(r.error("Error occured while fetching school types"),{data:null})).then(T=>T);f&&l(f.results)},i=async f=>{const{data:T}=await E.custom({url:"",method:"post",meta:{operation:"updateSchoolTimetable",variables:{schoolTimetableId:{value:parseInt(f.school_timetable_id),type:"Int",required:!0},title:{value:f.title,type:"String",required:!0},description:{value:f.description,type:"String",required:!1},startAt:{value:f.start_at,type:"DateTime",required:!0},endAt:{value:f.end_at,type:"DateTime",required:!0},year:{value:f.year,type:"Int",required:!0},timetableType:{value:parseInt(f.timetable_type),type:"Int",required:!0},forExamination:{value:f.for_examination,type:"Boolean",required:!1}},fields:["success","message",{schoolTimetable:["id","title","description","startAt","endAt","timetableType","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id","name"]},{schoolExamination:["id","name"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(I=>(r.error("Error occured while creating school timetable"),{data:null})).then(I=>I);T&&(T.success?(r.success(T.message),t.onFinish(T.schoolTimetable),t.form.resetFields()):r.error(T.message))};return a.useEffect(()=>{var f,T,I,P,_,n,c,j;p(),t.form.setFieldsValue({title:(f=t==null?void 0:t.schoolTimetable)==null?void 0:f.title,description:(T=t==null?void 0:t.schoolTimetable)==null?void 0:T.description,start_at:G((I=t==null?void 0:t.schoolTimetable)==null?void 0:I.startAt),end_at:G((P=t==null?void 0:t.schoolTimetable)==null?void 0:P.endAt),timetable_type:(n=(_=t==null?void 0:t.schoolTimetable)==null?void 0:_.timetableSchoolType)==null?void 0:n.id,year:(c=t==null?void 0:t.schoolTimetable)==null?void 0:c.year,for_examination:(j=t==null?void 0:t.schoolTimetable)==null?void 0:j.forExamination})},[t.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:t.form,onFinish:f=>{var T;f.school_timetable_id=(T=t.schoolTimetable)==null?void 0:T.id,i(f)},children:[e.jsx(u.Item,{name:"timetable_type",label:"Timetable Type",children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Timetable Type ...",disabled:!0,dropdownStyle:{zIndex:9999},children:y.map(f=>e.jsx(dt,{value:f.id,children:f.name},f.id))})}),e.jsx(u.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Title"}],children:e.jsx(U,{size:"large",placeholder:"Enter Title ..."})}),e.jsx(u.Item,{name:"year",label:"Academic Year",children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Select Year",defaultValue:new Date().getFullYear(),dropdownStyle:{zIndex:9999},children:ct})}),e.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(Ut,{rows:4,maxLength:6})}),e.jsxs(Z,{children:[e.jsx(B,{span:12,children:e.jsx(u.Item,{name:"start_at",label:"Start At",rules:[{required:!0,type:"date",message:"Please input Start At Date"}],children:e.jsx(_e,{style:{width:"100%"},disabledDate:f=>{var I;const T=ne((I=t.schoolTimetable)==null?void 0:I.startAt).format("YYYY-MM-DD");return f&&f<ne(T,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:12,children:e.jsx(u.Item,{name:"end_at",label:"End At",rules:[{required:!0,type:"date",message:"Please input End At Date"}],children:e.jsx(_e,{style:{width:"100%"},disabledDate:f=>{var I;const T=ne((I=t.schoolTimetable)==null?void 0:I.startAt).format("YYYY-MM-DD");return f&&f<ne(T,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})})]}),e.jsx(u.Item,{name:"for_examination",valuePropName:"checked",children:e.jsx(ke,{disabled:!0,children:"For Examination"})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},Jt=t=>{const[y,l]=a.useState([]),[p,i]=a.useState(0),[f,T]=a.useState(20),[I,P]=a.useState(""),[_,n]=a.useState(!0),[c]=u.useForm(),C=!ye.useBreakpoint().lg,M=[{title:"Name",dataIndex:"name",fixed:!0,render:(v,S)=>e.jsx("span",{children:S.course.name})},{title:"Year",dataIndex:"year",fixed:!0,render:(v,S)=>e.jsx("span",{children:S.year})},{title:"Semester",dataIndex:"Semester",fixed:!0,render:(v,S)=>e.jsx("span",{children:S.semesterDisplay})},{title:"",dataIndex:"action",render:(v,S)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ee,{title:"Are you sure to delete this task?",onConfirm:()=>w(S.id),onCancel:()=>{},okText:"Yes",cancelText:"No",disabled:!S.canManage,overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Te,{}),children:"Add"})})})}],w=async v=>{var z;const{data:S}=await E.custom({url:"",method:"post",meta:{operation:"createTimetableStudyCourse",variables:{schoolTimetableId:{value:parseInt(((z=t.schoolTimetable)==null?void 0:z.id.toString())??"0"),type:"Int",required:!0},studyCourseId:{value:parseInt(v.toString()),type:"Int",required:!0}},fields:["success","message",{timetableStudyCourse:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(g=>(r.error("Something Went Wrong ..."),{data:null})).then(g=>g);S&&(S.success?(r.success(S.message),t.onAdd(S.timetableStudyCourse),l(y.filter(g=>g.id.toString()!==v.toString()))):r.error(S.message)),n(!1)},A=async(v,S="",z=20)=>{var L;const{data:g}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCoursesToAdd",variables:{schoolTimetableId:{value:parseInt(((L=t.schoolTimetable)==null?void 0:L.id.toString())??"0"),type:"Int",required:!0},page:{value:v,type:"Int",required:!0},key:{value:S,type:"String",required:!1},pageSize:{value:z,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{course:["id","name"]},"year","semester","semesterDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(b=>(r.error("Something Went Wrong ..."),{data:null})).then(b=>b);g&&(i(g.total),l([...g.results])),n(!1)};return a.useEffect(()=>{A(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{style:{marginTop:10},children:e.jsx(B,{span:C?24:20,children:e.jsx(u,{layout:"vertical",form:c,onFinish:v=>{P(v.key),y.length=0,A(1,v.key,f)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:_,columns:M,dataSource:y,pagination:{onChange:(v,S)=>{T(S),A(v,I,S)},total:p,pageSize:f,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})]})},Xt=t=>{var h;const[y,l]=a.useState([]),[p,i]=a.useState(1),[f,T]=a.useState(0),[I,P]=a.useState(!1),[_,n]=a.useState(!0),{push:c}=Ze(),[j]=u.useForm();u.useForm(),ye.useBreakpoint().lg;const[M,w]=a.useState(!1),A=async o=>{l([o,...y])},v=async o=>{const{data:s}=await E.custom({url:"",method:"post",meta:{operation:"deleteTimetableStudyCourse",variables:{id:{value:parseInt(o.toString()),type:"Int",required:!0}},fields:["success","message"]}});s.success?(r.success(s.message),l(y.filter(x=>x.id!==o))):r.error(s.message)},S=async(o,s)=>{const{data:x}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolStudyCourseTimetable",variables:{schoolStudyCourseTimetableId:{value:parseInt(o.toString()),type:"Int",required:!0},published:{value:s,type:"Boolean",required:!0}},fields:["success","message",{schoolStudyCourseTimetable:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});x.success?(r.success(x.message),l(y.map(m=>m.id===x.schoolStudyCourseTimetable.id?x.schoolStudyCourseTimetable:m))):r.error(x.message)},z=()=>{r("Canceled")},g=[{title:"Name",dataIndex:"name",fixed:!0,render:(o,s,x)=>e.jsx("span",{children:e.jsx("a",{children:s.studyCourse.course.name})})},{title:"Year",dataIndex:"year",fixed:!0,render:(o,s,x)=>e.jsx("span",{children:s.studyCourse.year})},{title:"Semester",dataIndex:"Semester",fixed:!0,render:(o,s,x)=>e.jsx("span",{children:s.studyCourse.semesterDisplay})},{title:"Has Entries",dataIndex:"hasEntries",fixed:!0,render:(o,s,x)=>e.jsx("span",{children:s.hasEntries?e.jsx(e.Fragment,{children:e.jsx(F,{color:"green",children:"Yes"})}):e.jsx(e.Fragment,{children:e.jsx(F,{color:"red",children:"No"})})})},{title:"Created",dataIndex:"created",render:(o,s,x)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(s.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(o,s,x)=>e.jsx("a",{children:s!=null&&s.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"Published",dataIndex:"published",render:(o,s,x)=>e.jsx("a",{children:s!=null&&s.published?e.jsx(ee,{title:"Are you sure to Un-publish?",onConfirm:()=>S(s.id,!1),onCancel:()=>{},okText:"Unpublish",cancelText:"No",okButtonProps:{disabled:!s.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(F,{color:"green",children:"Published"})}):e.jsx(ee,{title:"Are you sure to Publish?",onConfirm:()=>S(s.id,!0),onCancel:()=>{},okText:"Publish",cancelText:"No",okButtonProps:{disabled:!s.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(F,{color:"red",children:"Not Published"})})})},{title:"",dataIndex:"action",render:(o,s,x)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(K,{title:"Schedule",placement:"left",children:e.jsx(q,{icon:e.jsx(xe,{}),disabled:!s.canManage,onClick:()=>{var m;return c("/timetable/study/course/scheduler/"+((m=t==null?void 0:t.schoolTimetable)==null?void 0:m.id)+"/"+s.id)}})}),e.jsx(ee,{title:"Are you sure to delete this Timetable Study Course?",onConfirm:()=>v(s==null?void 0:s.id),onCancel:()=>z,okText:"Yes",cancelText:"No",disabled:!(s!=null&&s.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ie,{}),disabled:!(s!=null&&s.canDelete)})})]})}],L=async(o,s="")=>{var m;const{data:x}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCourses",variables:{schoolTimetableId:{value:parseInt(((m=t.schoolTimetable)==null?void 0:m.id.toString())??"0"),type:"Int",required:!0},page:{value:o,type:"Int",required:!0},key:{value:s,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(D=>(r.error("Failed loading School Timetable Education Levels"),{data:null})).then(D=>D);x&&(i(x.page),T(x.total),P(x.hasNext),l([...x.results])),n(!1)},b=async o=>{var x;const{data:s}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishAllSchoolStudyCourseTimetables",variables:{schoolTimetableId:{value:parseInt(((x=t.schoolTimetable)==null?void 0:x.id.toString())??"0"),type:"Int",required:!0},published:{value:o,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(m=>(r.error("Failed to publish/unpublish all study courses"),{data:null})).then(m=>m);s&&(s.success?(r.success(s.message),L(1)):r.error(s.message))};return a.useEffect(()=>{L(p)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:12,children:e.jsx(u,{layout:"vertical",form:j,onFinish:o=>{i(1),y.length=0,L(1,o.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(B,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(K,{title:"Click to Publish All Timetables",color:"green",children:e.jsx(q,{size:"large",icon:e.jsx(Je,{style:{color:"green"}}),onClick:()=>b(!0),children:"Publish All"})}),e.jsx(K,{title:"Click to Unpublish All Timetables",color:"red",children:e.jsx(q,{size:"large",icon:e.jsx(we,{style:{color:"red"}}),onClick:()=>b(!1),children:"Unpublish All"})}),e.jsx(K,{title:"Auto Generate Timetable",color:"red",children:e.jsx(q,{size:"large",icon:e.jsx(tt,{style:{color:"red"}}),onClick:()=>t.autoGenerate(),children:"Auto Generate"})}),e.jsx(q,{size:"large",icon:e.jsx(et,{}),onClick:()=>w(!0),children:"Add"})]})]}),e.jsx(ge,{loading:_,columns:g,dataSource:y,pagination:!1,scroll:{y:"60vh"}}),e.jsx(ve,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Adding Study Courses to "}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:(h=t.schoolTimetable)==null?void 0:h.title})})]}),width:"45vw",anchor:"right",onClose:o=>w(o),open:M,children:e.jsx(Jt,{randKey:Math.random(),schoolTimetable:t.schoolTimetable,onAdd:A})})]})},Qt=t=>{const[y,l]=a.useState([]),[p,i]=a.useState({}),[f,T]=a.useState([]),I=async()=>{var c;const{data:n}=await E.custom({url:"",method:"post",meta:{operation:"uniTimetableAutoScheduler",variables:{schoolTimetableId:{value:parseInt(((c=t.schoolTimetable)==null?void 0:c.id.toString())??"0"),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(r.error("Something Went Wrong ..."),{data:null})).then(j=>j);n&&(n.success?r.success(n.message):r.error(n.message))},P=async()=>{var c;const{data:n}=await E.custom({url:"",method:"get",meta:{operation:"autoTimetableSchedulerValidityCheck",variables:{timetableId:{value:parseInt(((c=t.schoolTimetable)==null?void 0:c.id.toString())??"0"),type:"Int",required:!0}},fields:["data"]}}).catch(j=>(r.error("Something Went Wrong ..."),{data:null})).then(j=>j);n&&(i(n.data),l(n.data.validities.map(j=>({title:e.jsxs(e.Fragment,{children:[e.jsx(K,{title:"Course Name",children:j.name}),"- ",e.jsx(K,{title:"Maximum Number of Students",children:e.jsxs(F,{color:"green",children:[j.maxStudents," Max Students"]})}),!j.capacityFit&&e.jsxs(F,{color:"red",children:["No available Venue with capacity of ",j.maxStudents," Students for this course"]})]}),key:"sc-"+j.id,icon:e.jsx(ze,{}),children:j.modules.length>0?j.modules.map(C=>({title:e.jsxs(e.Fragment,{children:[e.jsxs(K,{title:"Module Name",children:[C.name,e.jsx(F,{color:"green",children:C.code})]}),e.jsx(K,{title:"Number of Periods per Week",children:e.jsxs(F,{color:"green",children:[C.periodsPerWeek," Periods/Week"]})})]}),key:"sc-"+j.id+"-"+C.id,icon:e.jsx(ze,{}),children:C.teachers.length>0?C.teachers.map(M=>({title:e.jsxs(e.Fragment,{children:[M.fullName," - ",e.jsx(F,{color:"green",children:M.phone})," ",e.jsx(F,{color:"blue",children:M.email})]}),key:"sc-"+j.id+"-"+C.id+"-"+M.id})):[{title:e.jsx(e.Fragment,{children:e.jsx(F,{color:"red",children:"No available Teacher for this course"})}),key:"sc-"+j.id+"-"+C.id+"-0"}]})):[{title:"No Module Found",key:"sc-"+j.id+"-0",icon:e.jsx(ze,{})}]}))),T(n.data.map(j=>"sc-"+j.id)))},_=[{key:"1",label:"Validity Check Summary",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[p.canGenerate&&e.jsx(Se,{message:"Timetable can be generated, no errors found",type:"success"}),!p.canGenerate&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{message:"Timetable can't be generated, please fix the errors highlited",type:"error"}),e.jsx(me,{bordered:!0,dataSource:p.issues,renderItem:n=>e.jsx(me.Item,{children:e.jsx(me.Item.Meta,{avatar:e.jsx(Oe,{style:{color:"red"}}),title:e.jsx(Ge.Text,{children:n})})})})]})]})},{key:"2",label:"Validity Check Details Tree",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[y.length>0&&e.jsx(jt,{showLine:!0,showIcon:!0,autoExpandParent:!0,expandedKeys:f,onExpand:n=>{T(n)},treeData:y}),y.length<=0&&e.jsx(Se,{message:"No Data Found",type:"error"})]})},{key:"3",label:"Venues",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[p.venues&&e.jsx(me,{bordered:!0,dataSource:p.venues,renderItem:n=>e.jsx(me.Item,{children:e.jsx(me.Item.Meta,{avatar:n.capacity>0?e.jsx(It,{style:{color:"green"}}):e.jsx(Oe,{style:{color:"red"}}),title:e.jsxs(Ge.Text,{children:[n.name,e.jsxs(F,{color:"green",style:{marginLeft:"10px"},children:[n.capacity," Max Students"]})]})})})}),!p.venues&&e.jsx(Se,{message:"No Venue Registered",type:"error"})]})}];return a.useEffect(()=>{P()},[t.randKey]),e.jsx("div",{style:{maxHeight:"80vh",minHeight:"80vh",overflowY:"auto",overflowX:"hidden"},children:e.jsx(Tt,{defaultActiveKey:"1",items:_,onChange:n=>{console.log(n)},tabBarExtraContent:e.jsxs(e.Fragment,{children:[p.canGenerate&&e.jsx(q,{type:"default",onClick:()=>I(),children:"Generate Timetable"}),!p.canGenerate&&e.jsx(Se,{message:"Timetable can't be generated, please fix the errors highlited",type:"error"})]})})})},Zt=t=>{const[y,l]=a.useState(),[p,i]=a.useState([]),[f,T]=a.useState(0),[I,P]=a.useState(!0),[_,n]=a.useState(20),[c,j]=a.useState(""),[C]=u.useForm(),[M]=u.useForm(),[w]=u.useForm(),v=!ye.useBreakpoint().lg,[S,z]=a.useState(!1),[g,L]=a.useState(!1),[b,h]=a.useState(!1),[o,s]=a.useState(!1),[x,m]=a.useState(!1),[D,O]=a.useState(!1),oe=N=>{l(N),O(!0)},V=N=>{l(N),m(!0)},H=N=>{l(N),s(!0)},$=N=>{l(N),h(!0)},te=N=>{l(N),L(!0)},Ee=async N=>{const{data:k}=await E.custom({url:"",method:"post",meta:{operation:"deleteSchoolTimetable",variables:{schoolTimetableId:{value:N,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(r.error("Error occured while Deleting School Venue"),{data:null})).then(X=>X);k&&(k.success?(r.success(k.message),i(p.filter(X=>X.id.toString()!==N.toString()))):r.error(k.message))},Pe=async N=>{i([N,...p]),M.resetFields()},Le=async N=>{const k=p.findIndex(X=>X.id===N.id);p[k]=N,i([...p]),w.resetFields(),l(void 0),L(!1)},Ae=async(N,k="",X=20)=>{P(!0);const{data:re}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetables",variables:{page:{value:N,type:"Int",required:!0},key:{value:k,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","isPublished","startAt","endAt","timetableType","timetableTypeDisplay","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id"]},{author:["id","firstName","middleName","lastName","fullName"]},{schoolExamination:["id","name"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(r.error("Error occured while fetching roles"),{data:null})).then(fe=>fe);re&&(T(re.total),i([...re.results])),P(!1)};return a.useEffect(()=>{Ae(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{marginTop:10},children:[e.jsx(B,{span:v?24:10,children:e.jsx(u,{layout:"vertical",form:C,onFinish:N=>{j(N.key),p.length=0,Ae(1,N.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:v?24:2,children:e.jsx(q,{icon:e.jsx(ce,{}),size:"large",onClick:()=>C.submit()})}),e.jsx(B,{span:v?24:12,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(K,{title:"Register a New Venue/Class",children:e.jsx(q,{icon:e.jsx(Te,{}),size:"large",onClick:()=>z(!0),children:"Add Timetable"})})})})]}),e.jsx(ge,{loading:I,columns:[{title:"Title",dataIndex:"title",fixed:!0,render:(N,k,X)=>{var re;return e.jsx("span",{children:e.jsxs("a",{children:[k.title,k.forExamination&&e.jsx(F,{color:"red",style:{marginLeft:10},children:(re=k==null?void 0:k.schoolExamination)==null?void 0:re.name})]})})}},{title:"Examination",dataIndex:"examination",fixed:!0,render:(N,k,X)=>e.jsx("span",{children:e.jsx("a",{children:k.forExamination?e.jsx(F,{color:"green",children:"Yes"}):e.jsx(F,{color:"red",children:"No"})})})},{title:"Year",dataIndex:"year",fixed:!0,render:(N,k,X)=>e.jsx("span",{children:e.jsx("a",{children:k.year})})},{title:"Timetable Type",dataIndex:"Timetable Type",fixed:!0,render:(N,k,X)=>{var re;return e.jsx("span",{children:e.jsx("a",{children:(re=k==null?void 0:k.timetableSchoolType)==null?void 0:re.name})})}},{title:"Start AT",dataIndex:"startAt",fixed:!0,render:(N,k,X)=>e.jsx("span",{children:ne(new Date(k.startAt)).format("MMM Do Y")})},{title:"End At",dataIndex:"endAt",fixed:!0,render:(N,k,X)=>e.jsx("span",{children:ne(new Date(k.endAt)).format("MMM Do Y")})},{title:"Date Created",dataIndex:"created",render:(N,k,X)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(k.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(N,k,X)=>e.jsx("a",{children:k!=null&&k.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(N,k,X)=>{var re,fe;return e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(at,{trigger:["click"],overlay:e.jsxs(he,{children:[e.jsx(he.Item,{icon:e.jsx(Ie,{}),disabled:!k.canDelete,children:e.jsx(ee,{placement:"topLeft",title:`Are you sure you want to delete ${k.name} Timetable?`,onConfirm:()=>Ee(parseInt(k.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(he.Item,{icon:e.jsx(Ye,{}),disabled:!k.canEdit,onClick:()=>te(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Edit"})}),["pr","osc","asc","	tert"].includes((re=k==null?void 0:k.timetableSchoolType)==null?void 0:re.code)&&e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>$(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Scheduler"})}),["uni","poly","col","ous"].includes((fe=k==null?void 0:k.timetableSchoolType)==null?void 0:fe.code)&&e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>H(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Scheduler"})}),e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>oe(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Auto Generate"})}),e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>V(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Schedules Drafts"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:Me=>Me.preventDefault(),children:e.jsx(st,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}}],dataSource:p,pagination:{onChange:(N,k)=>{n(k),Ae(N,c,k)},total:f,pageSize:_,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(80vh - 80px)"}}),e.jsx(de,{title:"Creating New School Timetable",width:"30vw",open:S,onClose:N=>z(N),children:e.jsx(Rt,{randKey:Math.random(),form:M,onFinish:Pe})}),e.jsx(de,{title:"Edditing School Timetable",width:"30vw",open:g,onClose:N=>L(N),children:e.jsx($t,{randKey:Math.random(),form:w,onFinish:Le,schoolTimetable:y})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"School Timetable Education Levels"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:y==null?void 0:y.title})})]}),width:"60vw",open:b,onClose:N=>h(N),children:e.jsx(lt,{schoolTimetable:y,randKey:Math.random()})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetable Study Courses"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:y==null?void 0:y.title})})]}),width:"80vw",open:o,onClose:N=>s(N),children:e.jsx(Xt,{schoolTimetable:y,randKey:Math.random(),autoGenerate:()=>{O(!0)}})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetables Schedules Drafts"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:y==null?void 0:y.title})})]}),width:"90vw",open:x,onClose:N=>m(N),children:e.jsx(e.Fragment,{children:"Drafts"})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetable Auto Generation"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(F,{color:"green",children:y==null?void 0:y.title})})]}),width:"60vw",open:D,onClose:N=>O(N),children:e.jsx(Qt,{schoolTimetable:y,randKey:Math.random()})})]})},ea=()=>(a.useEffect(()=>(document.title=Ce.system_name+": School Timetables",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(le,{children:[e.jsx(le.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(le.Item,{children:"Timetables"})]}),e.jsx(Zt,{})]})),ka=t=>{const{page:y}=t;return y==="SchoolTimetablesPage"?e.jsx(ea,{}):y==="SchoolVenuesPage"?e.jsx(Ot,{}):y==="SchoolTimetableEducationLevelSchedulerPage"?e.jsx(Nt,{}):y==="SchoolTimetableStudyCourseSchedulerPage"?e.jsx(Ft,{}):y==="TimetableDashboardPage"?e.jsx(wt,{}):y==="SchoolTimetableSettingsPage"?e.jsx(Lt,{}):e.jsx("div",{children:"Page not found ..."})};export{ka as TimetablePages};
