import{r as t,c as se,aU as u,j as e,aY as H,aQ as f,$ as U,cZ as Q,av as E,aT as ue,dx as Ae,dm as Le,a$ as Y,aZ as ne,c6 as ie,g as w,_ as d,a_ as ye,ad as le,d7 as te,ar as pe,dy as Z,S as Ce,dj as _e,dz as Ke,dA as Ve,aS as ce,aV as O,cc as de,ds as Ie,dB as Be,cS as he,c2 as $,d0 as je,dC as Ne,ca as ee,aO as N,ct as L,cH as me,cb as xe,c3 as Oe,aW as Ue,cJ as Re,cQ as He,c7 as Ye,d1 as Fe}from"./index-62ca8c71.js";import{L as fe}from"./index-a5f62a10.js";import{C as _}from"./index-2520e10c.js";import{A as ke}from"./index-c9a71fc6.js";import{S as W}from"./index-193d3022.js";import{A as oe}from"./index-d0bf4e29.js";import{S as Ee}from"./Skeleton-26b0114a.js";import{F as Pe}from"./index-0b7dca93.js";import{M as ge}from"./index-57e02f2b.js";import{l as Se}from"./index-72829d9f.js";import{G as We}from"./index-b877aff7.js";import{P as be}from"./index-7f983f75.js";import{U as $e}from"./index-4606efc5.js";import"./index-30f2475f.js";import"./InfoCircleFilled-8c818918.js";import"./ActionButton-e3468a72.js";import"./DialogWrap-720f6df3.js";import"./index-243c6e9a.js";import"./fade-6a3d81d7.js";import"./defineProperty-d9a91b7a.js";import"./useNotification-2cd7d170.js";import"./index-9484e0cf.js";import"./localeData-90cc4ac5.js";import"./SinglePicker-da7dc94a.js";import"./useMutateObserver-678ff4f3.js";import"./index-641f7544.js";import"./InputNumber-f45fbc30.js";import"./Image-fd2d922e.js";import"./Upload-af63b42f.js";import"./Rate-de48e710.js";import"./index-5b3a58f1.js";import"./index-c11e1580.js";const Qe=()=>{const[a,i]=t.useState([]),[r,s]=t.useState(!1),[h,n]=t.useState(!1),[c,l]=t.useState(20),[x,j]=t.useState(0),[I,F]=t.useState(1);t.useState(""),se();const[D]=u.useForm(),M=async(y,b,C=20)=>{s(!0);const{data:S}=await w.custom({url:"",method:"get",meta:{operation:"messagesDispatches",variables:{page:{value:y,type:"Int",required:!0},key:{value:b,type:"String",required:!1},pageSize:{value:C,type:"Int",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","receipientPhoneNumber","carrier",{channelMessage:["id","message",{channel:["id","name","code"]}]},{receipient:["id","firstName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(P=>(d.error("Error fetching Recently Messages Dispatched"),{data:null})).then(P=>P);S&&(j(S.total),F(S.page+1),i([...a,...S.results])),s(!1),n(!1)},K=y=>{y.currentTarget.scrollHeight-y.currentTarget.scrollTop===window.innerHeight/1.4&&M(I,"",20)};return t.useEffect(()=>{M(I,"",20)},[]),e.jsx(e.Fragment,{children:e.jsxs(H,{children:[e.jsx(f,{children:e.jsx("span",{style:{fontSize:16,fontWeight:"bolder"},children:"Recently Dispatched Messages"})}),e.jsx(f,{span:20,style:{height:45},children:e.jsx(u,{layout:"vertical",form:D,onFinish:y=>{n(!0),M(I,y.key,c)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:h,placeholder:"Search Phone Number(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-start",height:45},children:e.jsx(E,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{D.submit()},loading:h||r,disabled:h||r})}),e.jsxs(f,{span:24,children:[a.length===0&&e.jsx(ue,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No recently dispatched message ..."})}),e.jsx(fe,{style:{paddingRight:10},children:e.jsx(Ae,{data:a,height:window.innerHeight/1.4,itemHeight:47,itemKey:"phoneNumber",onScroll:K,children:y=>{var b,C;return e.jsx(_,{children:e.jsx(fe.Item,{children:e.jsx(fe.Item.Meta,{avatar:e.jsx(ke,{icon:e.jsx(Le,{})}),title:e.jsxs("a",{children:[y.receipientPhoneNumber,e.jsxs("span",{style:{marginLeft:5},children:[e.jsx(Y,{color:"green",children:(C=(b=y==null?void 0:y.channelMessage)==null?void 0:b.channel)==null?void 0:C.name}),y.carrier&&e.jsx(Y,{color:"red",children:y.carrier})]})]}),description:e.jsx(e.Fragment,{children:e.jsxs(ne,{direction:"vertical",children:[e.jsx("span",{children:y.channelMessage.message.length>100?y.channelMessage.message.substring(0,100)+"...":y.channelMessage.message}),e.jsxs("span",{children:[e.jsx("b",{children:"Dispatched"}),":"," ",ie(y.created).format("lll")]})]})})})},y.receipientPhoneNumber)})}})})]})]})})},Je=a=>{const[i,r]=t.useState([]);t.useState();const[s,h]=t.useState(!1),[n,c]=t.useState(!1),[l,x]=t.useState(20),[j,I]=t.useState(0),[F,D]=t.useState("");se();const[M]=u.useForm(),K=async(b,C,S=20)=>{h(!0);const{data:P}=await w.custom({url:"",method:"get",meta:{operation:"channelMessageDispatches",variables:{page:{value:b,type:"Int",required:!0},key:{value:C,type:"String",required:!1},pageSize:{value:S,type:"Int",required:!1},filterType:{value:a.filterType,type:"String",required:!0},messageId:{value:a.messageId,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","receipientPhoneNumber","status","statusColor","carrier","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(q=>(d.error("Error fetching Dispatches"),{data:null})).then(q=>q);P&&(I(P.total),r(P.results)),h(!1),c(!1)},y=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(b,C,S)=>e.jsx("a",{onClick:()=>{},children:C.receipientPhoneNumber})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(b,C,S)=>e.jsx(Y,{color:"green",children:C.carrier})},{title:"Created",dataIndex:"created",key:"created",render:(b,C,S)=>e.jsx(le,{title:ie(C.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:ie(C.created).format("Y-mm-d hh:mm:ss")})})},{title:"Status",dataIndex:"status",key:"status",render:(b,C,S)=>e.jsx(Y,{color:C.statusColor,children:C.status})},{title:"",dataIndex:"Action",key:"action",render:(b,C,S)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"}})}];return t.useEffect(()=>{K(1,"",20)},[a.randKey,a.filterType]),e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsx(f,{span:24,children:e.jsx(u,{layout:"vertical",form:M,onFinish:b=>{c(!0),K(0,b.key,l)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:n,placeholder:"Search Phone Number(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ye,{loading:s,columns:y,dataSource:i,pagination:{onChange:(b,C)=>{x(C),K(b,F,C)},total:j,pageSize:l,position:["bottomCenter"],showQuickJumper:!0},scroll:{x:!0,y:"40vh"}})]})},Ze=["receipients","delivered","notdelivered","failed"],Ge=["All Receipients","All Delivered","All Not Delivered","All Failed"],Me=a=>{var x;te(),se();const[i,r]=t.useState(!1),[s,h]=t.useState(),[n,c]=t.useState("receipients"),l=async()=>{var I;r(!0);const{data:j}=await w.custom({url:"",method:"get",meta:{operation:"channelMessageDispatchAnalytics",variables:{messageId:{value:(I=a.channelMessage)==null?void 0:I.id,type:"Int",required:!0}},fields:["analytics"]}}).catch(F=>(d.error("Error fetching Message Dispatch analytics"),{data:null})).then(F=>F);j&&h(j.analytics),r(!1)};return t.useEffect(()=>{l()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(pe,{spinning:i,children:[e.jsxs(H,{style:{display:"flex",justifyContent:"center",marginTop:2},children:[e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>c("receipients"),children:e.jsx(_,{children:e.jsx(W,{title:"Total Receipients",value:s==null?void 0:s.total_receipients,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>c("delivered"),children:e.jsx(_,{children:e.jsx(W,{title:"Delivered",value:s==null?void 0:s.total_delivered,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>c("notdelivered"),children:e.jsx(_,{children:e.jsx(W,{title:"Not Delievered",value:s==null?void 0:s.total_not_delivered,precision:0,valueStyle:{color:"#5E0321"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>c("failed"),children:e.jsx(_,{children:e.jsx(W,{title:"Failed",value:s==null?void 0:s.total_failed,precision:0,valueStyle:{color:"#700107"},prefix:e.jsx(Z,{})})})})})]}),e.jsxs("div",{style:{marginTop:2},children:[e.jsx("h3",{children:Ge[Ze.indexOf(n)]}),e.jsx(Je,{randKey:Math.random(),filterType:n,messageId:(x=a.channelMessage)==null?void 0:x.id})]})]})})},{TextArea:Xe}=U,es=a=>{const[i,r]=t.useState([]),[s,h]=t.useState([]),n=async(j=1,I=25,F="")=>{const{data:D}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:j,type:"Int",required:!0},pageSize:{value:I,type:"Int",required:!0},key:{value:F,type:"String",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code"]}]}}).catch(()=>(d.remove(),d.error("Error fetching Channels"),{data:null})).then(M=>M);D&&r(D.results)},c=async j=>{console.error(j);const{data:I}=await w.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelMessage",variables:{channels:{value:j.channels,type:"[Int]",required:!0},message:{value:j.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessages:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","dispatched","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(F=>(console.error(F),d.remove(),d.error("Error creating channel message"),{data:null})).then(F=>F);console.log(I),I&&(I.success?(d.success(I.message),a.onFinish(I.njiwaChannelMessages)):d.error(I.message))},l=j=>{h(j)},x=j=>{};return t.useEffect(()=>{n()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:a.form,onFinish:j=>{console.log("values",j),j.channels=s,c(j)},requiredMark:!0,children:[e.jsx(u.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(Xe,{rows:4})}),e.jsx(u.Item,{name:"channels",label:"Channels",rules:[{required:!0,type:"array",message:"Please Choose Channels ..."}],children:e.jsx(Ce,{size:"large",showSearch:!0,allowClear:!0,mode:"multiple",placeholder:"Select a Channel ...",optionFilterProp:"children",onChange:l,onSearch:x,filterOption:(j,I)=>((I==null?void 0:I.label)??"").toLowerCase().includes(j.toLowerCase()),options:i.map(j=>({value:j.id,label:j.name+" --> "+j.code})),dropdownStyle:{zIndex:9999}})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},ss=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),[n,c]=t.useState(""),[l,x]=t.useState(""),[j,I]=t.useState(!1),[F,D]=t.useState(""),[M,K]=t.useState(""),y=async C=>{r(!0);const{data:S}=await w.custom({url:"",method:"post",meta:{operation:"messagePreDispatchSummary",variables:{messageId:{value:C,type:"Int",required:!0}},fields:["success","message",{data:["data"]}]}}).catch(P=>(console.error(P),d.remove(),d.error(P.message),{data:null})).then(P=>P);S&&(h(S.data.data),S.success?c(S.message):x(S.message)),r(!1)},b=async C=>{r(!0);const{data:S}=await w.custom({url:"",method:"post",meta:{operation:"dispatchChannelMessage",variables:{channelMessageId:{value:C,type:"Int",required:!0}},fields:["success","message",{channelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","dispatched","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(P=>(d.remove(),d.error(P.message),{data:null})).then(P=>P);d.remove(),S&&(I(!0),S.success?(K(S.message),a.onDispatch(S.channelMessage)):D(S.message))};return t.useEffect(()=>{y(a.channelMessage.id)},[a.channelMessage.id]),j?e.jsxs(e.Fragment,{children:[M.length>0&&e.jsx(oe,{message:M,type:"success",showIcon:!0}),F.length>0&&e.jsx(oe,{message:F,type:"error",showIcon:!0})]}):e.jsxs(Ee,{loading:i,active:!0,children:[n.length>0&&e.jsx(oe,{message:n,type:"success",showIcon:!0}),l.length>0&&e.jsx(oe,{message:l,type:"error",showIcon:!0}),e.jsxs("div",{children:[e.jsxs("p",{children:["Message Count: ",s==null?void 0:s.totalMessages]}),e.jsxs("p",{children:["Message Units: ",s==null?void 0:s.messageUnits]}),e.jsxs("p",{children:["Total Contacts: ",s==null?void 0:s.totalContacts]})]}),e.jsx(Pe,{gap:10,style:{marginTop:20},justify:"flex-end",children:e.jsx(E,{disabled:!(s!=null&&s.dispatchable),type:"primary",onClick:()=>b(a.channelMessage.id),children:"Dispatch"})})]})},De=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,c]=t.useState(!1),[l,x]=t.useState(!1),[j,I]=t.useState(20);t.useState(""),se(),u.useForm();const[F]=u.useForm(),[D,M]=t.useState(!1),[K,y]=t.useState(!1),[b,C]=t.useState(!1),S=async p=>{h(p),M(!0)},P=p=>{h(p),C(!0)},q=async p=>{const{data:R}=await w.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannelMessage",variables:{id:{value:p,type:"Int",required:!0}},fields:["success","message"]}});d.remove(),R.success?(d.success(R.message),r(i.filter(G=>G.id.toString()!==p.toString()))):d.error(R.message)},z=async p=>{r(i.map(R=>R.id===p.id?p:R))},k=p=>{ge.confirm({title:"Deleting Njiwa Channel Message",icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>q(parseInt(p.toString()))})},A=async(p,R,G=20)=>{c(!0);const{data:ae}=await w.custom({url:"",method:"get",meta:{operation:"njiwaChannelsMessages",variables:{page:{value:p,type:"Int",required:!0},key:{value:R,type:"String",required:!1},pageSize:{value:G,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"dispatched","messageCount","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>({data:null})).then(re=>re);ae&&r(ae.results),c(!1),x(!1)},J=async p=>{r([...p,...i]),y(!1)};return t.useEffect(()=>{A(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(u,{layout:"vertical",form:F,onFinish:p=>{x(!0),A(0,p.key,j)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Channel Message(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",autoFocus:!0,allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{F.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(le,{title:"Click to Create Message",placement:"top",color:"green",children:e.jsx(E,{size:"large",icon:e.jsx(_e,{}),onClick:()=>{y(!0)},loading:l||n,disabled:l||n,style:{marginRight:30}})})})]}),e.jsx(pe,{spinning:n,children:e.jsx("div",{style:{maxHeight:a.dash?"69vh":"",overflowY:"auto"},children:e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(ue,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Message Found ..."})})}),i.map(p=>{var R;return e.jsx(f,{span:24,children:e.jsxs(_,{hoverable:p.isActive,style:{marginRight:10,marginBottom:3},children:[e.jsxs(ne,{style:{right:0,position:"absolute"},children:[p.dispatched?e.jsx(e.Fragment,{children:e.jsx(le,{title:"Dispatched",placement:"top",color:"green",children:e.jsx(Ke,{style:{color:"green"}})})}):e.jsx(e.Fragment,{children:e.jsx(le,{title:"Not Dispatched",placement:"top",color:"red",children:e.jsx(Ve,{style:{color:"red"}})})}),e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{icon:e.jsx(de,{}),onClick:()=>{k(p.id)},disabled:!(p!=null&&p.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}),!p.dispatched&&e.jsx(O.Item,{icon:e.jsx(Ie,{}),disabled:!(p!=null&&p.canDelete),onClick:()=>{P(p)},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch"})}),e.jsx(O.Item,{icon:e.jsx(Be,{}),disabled:!(p!=null&&p.canDelete),onClick:()=>S(p),children:e.jsx("a",{rel:"noopener noreferrer",children:"Dispatch Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:G=>G.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})]}),e.jsxs(ne,{direction:"vertical",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created By:"}),e.jsx("span",{style:{marginLeft:5},children:(R=p==null?void 0:p.creator)==null?void 0:R.fullName})]}),e.jsx("span",{children:p.message}),e.jsxs(ne,{direction:"horizontal",children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created On:"}),e.jsx("span",{style:{marginLeft:5},children:ie(p.created).format("YYYY/MM/DD HH:MM")})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Channel:"}),e.jsxs("span",{style:{marginLeft:5},children:[p==null?void 0:p.channel.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:p==null?void 0:p.channel.code})})]})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Message Count:"}),e.jsx("span",{style:{marginLeft:5},children:e.jsx(Y,{color:"green",children:p==null?void 0:p.messageCount})})]})]})]})]})})})]})})}),e.jsx($,{title:"Dispatch Report",width:"80vw",open:D,onClose:p=>M(p),children:e.jsx(Me,{randKey:Math.random(),channelMessage:s})}),e.jsx($,{title:"Creating Message",open:K,width:"40vw",onClose:p=>y(p),children:e.jsx(es,{onFinish:J})}),e.jsx($,{title:"Dispatching Message",open:b,width:"40vw",onClose:p=>C(p),children:e.jsx(ss,{channelMessage:s,onDispatch:p=>z(p)})})]})},ts=a=>{const[i,r]=t.useState(!1),[s]=u.useForm(),[h,n]=t.useState(1),[c,l]=t.useState(),[x,j]=t.useState(""),[I,F]=t.useState(!1),D=async()=>{r(!0);const{data:y}=await w.custom({url:"",method:"get",meta:{operation:"systemSettings",fields:["smsCostPerUnit"]}}).catch(()=>(d.remove(),d.error("Error fetching system settings"),{data:null})).then(b=>b);y&&l(y),r(!1)},M=async y=>{console.log(y);const{data:b}=await w.custom({url:"",method:"post",meta:{operation:"purchaseSmsOrder",variables:{messages:{value:y.messages,type:"Int",required:!0},phone:{value:y.phone,type:"String",required:!0}},fields:["success","message"]}}).catch(C=>(d.remove(),console.error(C),d.error("Error creating order"),{data:null})).then(C=>C);b&&(b.success?(d.success(b.message),n(3)):(j(b.message),F(!0)))},K=y=>y.toLocaleString("en-US",{style:"currency",currency:"TZS"});return t.useEffect(()=>{D()},[a.randKey]),e.jsxs(Ee,{loading:i,active:!0,children:[I&&h===2&&e.jsx(oe,{message:x,type:"error",showIcon:!0}),h===1&&e.jsxs(u,{layout:"vertical",form:s,onFinish:()=>{j(""),F(!1),n(2)},requiredMark:!0,children:[e.jsx(oe,{message:"Please note that the minimum number of messages is 100",type:"info",showIcon:!0}),e.jsx(Pe,{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",marginBottom:"10px"},children:e.jsx("div",{children:e.jsxs("h3",{children:["Cost per message: ",c==null?void 0:c.smsCostPerUnit," Tsh"]})})}),e.jsx(u.Item,{name:"messages",label:"Total Messages (5 Tsh per message)",rules:[{type:"number",min:100,message:"Minimum number of messages is 100"}],children:e.jsx(Se.InputNumber,{min:100,style:{width:"100%"}})}),e.jsx(u.Item,{name:"phone",label:"Phone Number (will be used for payment)",rules:[{required:!0,message:"Please Enter Phone Number ..."}],children:e.jsx(U,{placeholder:"Enter Phone Number"})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Purchase"})})]}),h===2&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["Total Messages: ",s.getFieldValue("messages")," "]}),e.jsxs("h3",{children:["Total Amount: ",K(parseInt(s.getFieldValue("messages"))*parseFloat((c==null?void 0:c.smsCostPerUnit.toString())??"0.0"))," "]}),e.jsxs("h3",{children:["Phone Number: ",s.getFieldValue("phone")," "]})]}),e.jsxs("div",{children:[e.jsx(E,{type:"primary",size:"large",style:{float:"left"},onClick:()=>n(1),children:"Back"}),e.jsx(E,{type:"primary",size:"large",style:{float:"right"},onClick:()=>{M({messages:s.getFieldValue("messages"),phone:s.getFieldValue("phone")})},children:"Pay"})]})]}),h===3&&e.jsxs("div",{children:[e.jsxs("h3",{children:["Payment request sent to ",s.getFieldValue("phone"),", please check your phone and confirm the payment"]}),e.jsxs("div",{children:[e.jsx(E,{type:"primary",size:"large",style:{float:"left"},onClick:()=>n(2),children:"Back"}),e.jsx(E,{type:"primary",size:"large",style:{float:"right"},onClick:()=>a.onFinish(),children:"Finish"})]})]})]})},ns=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),{push:n}=se(),[c,l]=t.useState(!1),j=!We.useBreakpoint().lg,I=async()=>{r(!0);const{data:F}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolAnalytic",fields:["analytics"]}}).catch(()=>(d.remove(),d.error("Error fetching analytics"),{data:null})).then(D=>D);F&&h(F.analytics),r(!1)};return t.useEffect(()=>{I()},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(Se.Skeleton,{loading:i,children:[e.jsxs(H,{style:{display:"flex",justifyContent:"center"},children:[e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>l(!0),children:e.jsx(_,{children:e.jsx(W,{title:"Balances (Units)",value:s==null?void 0:s.balances,precision:0,valueStyle:{color:"#3f8600"}})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/channels"),children:e.jsx(_,{children:e.jsx(W,{title:"Channels",value:s==null?void 0:s.channels,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/contacts/phonenumbers"),children:e.jsx(_,{children:e.jsx(W,{title:"Phone Numbers",value:s==null?void 0:s.phone_numbers,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/contacts/emails"),children:e.jsx(_,{children:e.jsx(W,{title:"Emails",value:s==null?void 0:s.emails,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages"),children:e.jsx(_,{children:e.jsx(W,{title:"Messages",value:s==null?void 0:s.messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/sent"),children:e.jsx(_,{children:e.jsx(W,{title:"Pending Messages",value:s==null?void 0:s.sent_messages,precision:0,valueStyle:{color:"#770622"},prefix:e.jsx(Ne,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/sent"),children:e.jsx(_,{children:e.jsx(W,{title:"Sent Messages",value:s==null?void 0:s.sent_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/failed"),children:e.jsx(_,{children:e.jsx(W,{title:"Failed Messages",value:s==null?void 0:s.failed_messages,precision:0,valueStyle:{color:"#861400"},prefix:e.jsx(Ne,{})})})})})]}),e.jsxs(H,{children:[e.jsx(f,{span:12,children:e.jsxs("div",{style:{marginTop:20},children:[e.jsx("span",{style:{fontSize:16,fontWeight:"bolder"},children:"Messages"}),e.jsx(De,{dash:!0})]})}),e.jsx(f,{span:12,children:e.jsx("div",{style:{marginTop:20},children:e.jsx(Qe,{})})})]})]}),e.jsx($,{title:"Purchase Messages",open:c,onClose:F=>l(F),width:j?"100vw":"30vw",children:e.jsx(ts,{onFinish:()=>l(!1)})})]})},as=()=>(t.useEffect(()=>{document.title=ee.system_name+": Njiwa"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Channels"})]})}),e.jsx(ns,{})]})),{TextArea:rs}=U,ve=a=>{const i=async r=>{const{data:s}=await w.custom({url:"",method:"post",meta:{operation:"createNjiwaChannel",variables:{name:{value:r.name,type:"String",required:!0},description:{value:r.description,type:"String",required:!1}},fields:["success","message",{njiwaChannel:["id","name","description","code","icon","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(h=>(d.error("Error creating channel"),{data:null})).then(h=>h);s&&(s.success?(d.success(s.message),a.onFinish(s.njiwaChannel)):d.error(s.message))};return t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,children:[e.jsx(u.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Channel Name ..."}],children:e.jsx(U,{size:"large",placeholder:"Enter Channel Name ..."})}),e.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(rs,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{TextArea:is}=U,ls=a=>{const i=async r=>{var h;const{data:s}=await w.custom({url:"",method:"post",meta:{operation:"updateNjiwaChannel",variables:{channelId:{value:(h=a.channel)==null?void 0:h.id,type:"Int",required:!0},name:{value:r.name,type:"String",required:!0},description:{value:r.description,type:"String",required:!1}},fields:["success","message",{njiwaChannel:["id","name","description","code","icon","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(n=>(d.error("Error Updating channel"),{data:null})).then(n=>n);s&&(s.success?(d.success(s.message),a.onFinish(s.njiwaChannel)):d.error(s.message))};return t.useEffect(()=>{var r,s;a.form.setFieldsValue({name:(r=a.channel)==null?void 0:r.name,description:(s=a.channel)==null?void 0:s.description})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,autoComplete:"off",children:[e.jsx(u.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Channel Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Channel Name ..."})}),e.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(is,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},os=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,c]=t.useState(!1),[l,x]=t.useState(!1),[j,I]=t.useState(0),[F,D]=t.useState(1),[M,K]=t.useState(30),[y,b]=t.useState(""),{push:C}=se(),[S,P]=t.useState(!1),[q,z]=t.useState(!1),[k]=u.useForm(),[A]=u.useForm(),[J]=u.useForm(),p=o=>{D(o),V(o,y,M)},R=o=>{h(o),z(!0)},G=()=>{P(!0)},ae=async o=>{r([o,...i]),k.resetFields(),P(!1)},re=async o=>{const m=i.findIndex(v=>v.id===o.id);i[m]=o,r([...i]),A.resetFields(),z(!1)},g=async o=>{const{data:m}=await w.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{channelId:{value:o,type:"Int",required:!0}},fields:["success","message"]}}).catch(v=>(d.error(v.message),{data:null})).then(v=>v);m&&(m.success?(d.success(m.message),r(i.filter(v=>v.id.toString()!==o.toString()))):d.error(m.message))},T=o=>{ge.confirm({title:e.jsxs(e.Fragment,{children:["Deleting ",o.name," Channel"]}),icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Yes",cancelText:"Cancel",onOk:()=>g(parseInt(o.id.toString()))})},V=async(o,m,v=20)=>{c(!0);const{data:B}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:o,type:"Int",required:!0},key:{value:m,type:"String",required:!1},pageSize:{value:v,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(X=>(d.error("Error fetching channels"),{data:null})).then(X=>X);B&&(I(B.total),r(B.results)),c(!1),x(!1)};return t.useEffect(()=>{V(1,y,M)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(u,{layout:"vertical",form:J,onFinish:o=>{b(o.key),x(!0),V(0,o.key,M)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Channel(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{J.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(E,{size:"large",disabled:n||l,onClick:()=>{k.resetFields(),G()},children:[e.jsx(me,{}),"Create Channel"]})})]}),e.jsxs(pe,{spinning:n,size:"large",children:[e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(ue,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(E,{type:"primary",onClick:()=>{k.resetFields(),G()},children:"Create Channel Now"})})}),i.map(o=>e.jsx(f,{span:4,children:e.jsxs(_,{hoverable:o.isActive,style:{marginRight:10},children:[e.jsx(ne,{style:{right:0,position:"absolute"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{icon:e.jsx(xe,{}),onClick:()=>{R(o)},disabled:!(o!=null&&o.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(O.Item,{icon:e.jsx(de,{}),onClick:()=>{T(o)},disabled:!(o!=null&&o.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:m=>m.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsx("a",{onClick:()=>C("/njiwa/channel/"+o.id+"/"+o.name),children:e.jsxs(ne,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsx(ke,{size:{xs:24,sm:32,md:40,lg:40,xl:40,xxl:80},icon:e.jsx(Oe,{}),src:o.icon}),e.jsx(le,{title:o.name,children:o.name.length>10?o.name.substring(0,10)+"...":o.name}),e.jsx("span",{children:e.jsx(Y,{color:"green",children:o.code})})]})})]})}))]}),i.length>0&&e.jsx(H,{style:{display:"flex",justifyContent:"center"},children:e.jsx("span",{style:{marginTop:20},children:e.jsx(Ue,{showQuickJumper:!0,showTotal:(o,m)=>`Total ${o} Channels`,defaultCurrent:F,total:j,pageSize:M,onChange:p,showSizeChanger:!0,onShowSizeChange:(o,m)=>{K(m),V(o,y,m)},disabled:n||l})})})]}),e.jsx($,{title:"Create Njiwa Channel",width:"40vw",open:S,onClose:o=>P(o),children:e.jsx(ve,{form:k,randKey:Math.random(),onFinish:ae})}),e.jsx($,{title:"Edit "+(s==null?void 0:s.name)+" Channel",width:"40vw",open:q,onClose:o=>z(o),children:e.jsx(ls,{form:A,randKey:Math.random(),onFinish:re,channel:s})})]})},cs=()=>(t.useEffect(()=>{document.title=ee.system_name+": Channels"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:5,marginBottom:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Channels"})]})}),e.jsx(os,{randKey:Math.random()})]})),ds=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Emails"})})),hs=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=te(),c=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(x=>(d.error("Error fetching channel"),{data:null})).then(x=>x);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel Emails",c()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:5,marginBottom:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(N.Item,{children:e.jsxs(L,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Emails"})]})}),e.jsx(ds,{randKey:Math.random(),channel:s})]})},us=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Failed Messages"})})),ms=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=te(),c=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(x=>(d.error("Error fetching channel"),{data:null})).then(x=>x);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Failed Messages",c()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(N.Item,{children:e.jsxs(L,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx(N.Item,{children:"Messages"}),e.jsx("span",{children:"Failed"})]})}),e.jsx(us,{randKey:Math.random(),channel:s})]})},{TextArea:xs}=U,ps=a=>{const i=te(),r=async s=>{const{data:h}=await w.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelMessage",variables:{channelId:{value:parseInt(i.channelId),type:"Int",required:!0},message:{value:s.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(n=>(d.error("Error creating channel message"),{data:null})).then(n=>n);h&&(h.success?(d.success(h.message),a.onFinish(h.njiwaChannelMessage)):d.error(h.message))};return t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:a.form,onFinish:s=>{r(s)},requiredMark:!0,children:[e.jsx(u.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(xs,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{TextArea:js}=U,gs=a=>{te();const i=async r=>{const{data:s}=await w.custom({url:"",method:"post",meta:{operation:"updateNjiwaChannelMessage",variables:{channelMessageId:{value:r.channel_message_id,type:"Int",required:!0},message:{value:r.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(h=>(d.error("Error creating channel message"),{data:null})).then(h=>h);s&&(s.success?(d.success(s.message),a.onFinish(s.njiwaChannelMessage)):d.error(s.message))};return t.useEffect(()=>{var r;a.form.setFieldsValue({message:(r=a==null?void 0:a.channelMessage)==null?void 0:r.message})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:a.form,onFinish:r=>{var s;r.channel_message_id=(s=a.channelMessage)==null?void 0:s.id,i(r)},requiredMark:!0,children:[e.jsx(u.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(js,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},fs=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,c]=t.useState(!1),[l,x]=t.useState(!1),[j,I]=t.useState(20);t.useState(""),se();const[F,D]=t.useState(!1),[M,K]=t.useState(!1),[y,b]=t.useState(!1),[C]=u.useForm(),[S]=u.useForm(),[P]=u.useForm(),q=te(),z=g=>{h(g),b(!0)},k=g=>{h(g),K(!0)},A=()=>{D(!0)},J=async g=>{r([g,...i]),C.resetFields(),D(!1)},p=async g=>{r(i.map(T=>T.id.toString()===g.id.toString()?g:T)),S.resetFields(),K(!1)},R=async g=>{const{data:T}=await w.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannelMessage",variables:{channelMessageId:{value:g,type:"Int",required:!0}},fields:["success","message"]}});T.success?(d.success(T.message),r(i.filter(V=>V.id.toString()!==g.toString()))):d.error(T.message)},G=async g=>{d("dispatching");const{data:T}=await w.custom({url:"",method:"post",meta:{operation:"dispatchChannelMessage",variables:{channelMessageId:{value:g,type:"Int",required:!0}},fields:["success","message"]}}).catch(V=>(d.error(V.message),{data:null})).then(V=>V);T&&(T.success?d.success(T.message):d.error(T.message))},ae=g=>{ge.confirm({title:"Deleting Njiwa Channel Message",icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>R(parseInt(g.toString()))})},re=async(g,T,V=20)=>{const{data:o}=await w.custom({url:"",method:"get",meta:{operation:"njiwaChannelMessages",variables:{page:{value:g,type:"Int",required:!0},key:{value:T,type:"String",required:!1},pageSize:{value:V,type:"Int",required:!1},channelId:{value:parseInt(q.channelId),type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(m=>(d.error("Failed to fetch Channel Messages"),{data:null})).then(m=>m);o&&r(o.results),c(!1),x(!1)};return t.useEffect(()=>{re(1,"",20)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(u,{layout:"vertical",form:P,onFinish:g=>{x(!0),re(0,g.key,j)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Channel Message(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{P.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(E,{size:"large",disabled:n||l,onClick:()=>{C.resetFields(),A()},children:[e.jsx(me,{}),"Create Message"]})})]}),e.jsx(pe,{spinning:n,children:e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(ue,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(E,{type:"primary",onClick:()=>{C.resetFields(),A()},children:"Create Message"})})}),i.map(g=>{var T;return e.jsx(f,{span:24,children:e.jsxs(_,{hoverable:g.isActive,style:{marginRight:10},children:[e.jsx(ne,{style:{right:0,position:"absolute"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{icon:e.jsx(xe,{}),onClick:()=>{k(g)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(O.Item,{icon:e.jsx(de,{}),onClick:()=>{ae(g.id)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}),e.jsx(O.Item,{icon:e.jsx(Ie,{}),disabled:!(g!=null&&g.canDelete),children:e.jsx(be,{title:"Are you sure to Start Sending/Dispatching SMS?",onConfirm:()=>G(g.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch"})})}),e.jsx(O.Item,{icon:e.jsx(Re,{}),onClick:()=>{z(g)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:V=>V.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsxs(ne,{direction:"vertical",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsx("span",{children:g.message}),e.jsxs(ne,{direction:"horizontal",children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created On:"}),e.jsx("span",{style:{marginLeft:5},children:ie(g.created).format("YYYY/MM/DD HH:MM")})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created By:"}),e.jsx("span",{style:{marginLeft:5},children:(T=g==null?void 0:g.creator)==null?void 0:T.fullName})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Channel:"}),e.jsx("span",{style:{marginLeft:5},children:g==null?void 0:g.channel.name})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Message Count:"}),e.jsx("span",{style:{marginLeft:5},children:e.jsx(Y,{color:"green",children:g==null?void 0:g.messageCount})})]})]})]})]})})})]})}),e.jsx($,{title:"Create Njiwa Channel Message",width:"40vw",open:F,onClose:g=>D(g),children:e.jsx(ps,{form:C,randKey:Math.random(),onFinish:J})}),e.jsx($,{title:"Edit Njiwa Channel Message",width:"40vw",open:M,onClose:g=>K(g),children:e.jsx(gs,{form:S,randKey:Math.random(),onFinish:p,channelMessage:s})}),e.jsx($,{title:"Dispatch Report",width:"50vw",open:y,onClose:g=>b(g),children:e.jsx(Me,{randKey:Math.random(),channelMessage:s})})]})},ys=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=te(),c=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(x=>(d.error("Error fetching channel"),{data:null})).then(x=>x);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel Messages",c()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(N.Item,{children:e.jsxs(L,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Messages"})]})}),e.jsx(fs,{randKey:Math.random(),channel:s})]})},Cs=a=>{const i=te(),{push:r}=se(),[s,h]=t.useState(!1),[n,c]=t.useState(),l=async()=>{h(!0);const{data:x}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannelAnalytic",variables:{channelId:{value:parseInt(i.channelId),type:"Int",required:!0}},fields:["analytics"]}}).catch(j=>(d.error("Error fetching analytics"),{data:null})).then(j=>j);x&&c(x.analytics),h(!1)};return t.useEffect(()=>{l()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(H,{style:{display:"flex",justifyContent:"center",marginTop:10},children:[e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{var x,j;return r("/njiwa/channel/"+((x=a.channel)==null?void 0:x.id)+"/"+((j=a.channel)==null?void 0:j.name)+"/phonenumbers")},children:e.jsx(_,{children:e.jsx(W,{title:"Phone Numbers",value:n==null?void 0:n.phone_numbers,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Emails",value:n==null?void 0:n.emails_addresses,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{var x,j;return r("/njiwa/channel/"+((x=a.channel)==null?void 0:x.id)+"/"+((j=a.channel)==null?void 0:j.name)+"/messages")},children:e.jsx(_,{children:e.jsx(W,{title:"Messages",value:n==null?void 0:n.messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Pending Messages",value:n==null?void 0:n.pending_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Sent Messages",value:n==null?void 0:n.sent_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(_,{children:e.jsx(W,{title:"Failed Messages",value:n==null?void 0:n.failed_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Z,{})})})})})]})})},Ss=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=te(),c=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(x=>(d.error("Error fetching channel"),{data:null})).then(x=>x);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel",c()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsxs("span",{children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})]})}),e.jsx(Cs,{randKey:Math.random(),channel:s})]})},qe=a=>{const[i,r]=t.useState([]),s=async n=>{const{data:c}=await w.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelsPhoneNumber",variables:{phoneNumber:{value:n.phoneNumber,type:"String",required:!0},name:{value:n.name,type:"String",required:!1},channels:{value:n.channels,type:"[Int]",required:!0}},fields:["success","message"]}}).catch(l=>(d.error("Error creating channels phone number"),{data:null})).then(l=>l);c&&(c.success?(d.success(c.message),a.onFinish(c.njiwaChannel)):d.error(c.message))},h=async(n,c,l=20)=>{const{data:x}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:n,type:"Int",required:!0},key:{value:c,type:"String",required:!1},pageSize:{value:l,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(j=>(d.error("Error fetching channels"),{data:null})).then(j=>j);x&&r(x.results)};return t.useEffect(()=>{h(1,"",50)},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:a.form,onFinish:n=>{n.channels=a.channel?[a.channel.id]:[],s(n)},requiredMark:!0,autoComplete:"off",children:[e.jsx(u.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,type:"string",message:"Please input Phone Number"}],children:e.jsx(U,{size:"large",placeholder:"Enter Phone Number ..."})}),e.jsx(u.Item,{name:"name",label:"Full Name",rules:[{required:!1,type:"string",message:"Please input Full Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Full Name ..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},ze=a=>{const i=async r=>{var h;const{data:s}=await w.custom({url:"",method:"post",meta:{operation:"updateNjiwaPhoneNumber",variables:{phoneNumberId:{value:(h=a.phoneNumber)==null?void 0:h.id,type:"Int",required:!0},phoneNumber:{value:r.phoneNumber,type:"String",required:!0},name:{value:r.name,type:"String",required:!1}},fields:["success","message",{phoneNumber:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(n=>(d.error("Error Updating Phone number"),{data:null})).then(n=>n);s&&(s.success?(d.success(s.message),a.onFinish(s.phoneNumber)):d.error(s.message))};return t.useEffect(()=>{var r,s;a.form.setFieldsValue({phoneNumber:(r=a.phoneNumber)==null?void 0:r.phoneNumber,name:(s=a.phoneNumber)==null?void 0:s.name})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,autoComplete:"off",children:[e.jsx(u.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,type:"string",message:"Please input Phone Number"}],children:e.jsx(U,{size:"large",placeholder:"Enter Phone Number ..."})}),e.jsx(u.Item,{name:"name",label:"Full Name",rules:[{required:!1,type:"string",message:"Please input Full Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Full Name ..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Update"})})]})})},{Option:bs}=Ce,vs=a=>Array.isArray(a)?a:a==null?void 0:a.fileList,Te=a=>{const[i,r]=t.useState([]),s=async n=>{const{data:c}=await w.custom({url:"",method:"post",meta:{operation:"uploadNjiwaChannelsPhoneNumbers",variables:{channels:{value:n.channels,type:"[Int]",required:!0},file:{value:n.file,type:"Upload",required:!0}},fields:["success","message"]}}).catch(l=>(d.error("Error creating channels phone number"),{data:null})).then(l=>l);c&&(c.success?(d.success(c.message),a.onFinish(c.njiwaChannel)):d.error(c.message))},h=async(n,c,l=20)=>{const{data:x}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:n,type:"Int",required:!0},key:{value:c,type:"String",required:!1},pageSize:{value:l,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(j=>(d.error("Error fetching channels"),{data:null})).then(j=>j);x&&r(x.results)};return t.useEffect(()=>{h(1,"",50)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsxs("a",{target:"_blank",href:ee.base_url+"/static/templates/njiwa_channels_phone_numbers_template.xlsx",rel:"noreferrer",children:["Download Excel Template ",e.jsx(He,{})]})}),e.jsxs(u,{layout:"vertical",form:a.form,onFinish:n=>{n.channels=n.channels.map(c=>parseInt(c)),s(n)},requiredMark:!0,autoComplete:"off",children:[e.jsx(u.Item,{label:"Contacts File(Excel)",children:e.jsx(u.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:vs,noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload students excel file"}],children:e.jsxs($e.Dragger,{name:"file",accept:".xls, .xlsx",multiple:!1,beforeUpload:()=>!1,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(Ye,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload."})]})})}),e.jsx(u.Item,{name:"channels",label:"Channels",rules:[{required:!0,type:"array",message:"Please select Channel(s)..."}],children:e.jsx(Ce,{size:"large",mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"Please select",defaultValue:[],dropdownStyle:{zIndex:9999},children:i.map(n=>e.jsxs(bs,{value:n.id,children:[n.name,e.jsx("span",{style:{marginLeft:5},children:e.jsx(Y,{color:"green",children:n.code})})]},n.id))})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})]})},ws=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,c]=t.useState(!1),[l,x]=t.useState(!1),[j,I]=t.useState(20),[F,D]=t.useState(0),[M,K]=t.useState("");se();const[y,b]=t.useState(!1),[C,S]=t.useState(!1),[P,q]=t.useState(!1),[z]=u.useForm(),[k]=u.useForm(),[A]=u.useForm(),[J]=u.useForm(),p=te(),R=m=>{h(m),S(!0)},G=()=>{b(!0)},ae=async()=>{V(1,"",20),b(!1),z.resetFields()},re=async m=>{r(i.map(v=>v.id.toString()===m.id.toString()?m:v)),k.resetFields(),S(!1)},g=async()=>{V(1,"",20),A.resetFields(),q(!1)},T=async m=>{const{data:v}=await w.custom({url:"",method:"post",meta:{operation:"deleteChannelPhoneNumber",variables:{id:{value:m,type:"Int",required:!0}},fields:["success","message"]}});v.success?(d.success(v.message),r(i.filter(B=>B.id.toString()!==m.toString()))):d.error(v.message)},V=async(m,v,B=20)=>{c(!0);const{data:X}=await w.custom({url:"",method:"get",meta:{operation:"njiwaChannelPhoneNumbers",variables:{page:{value:m,type:"Int",required:!0},key:{value:v,type:"String",required:!1},pageSize:{value:B,type:"Int",required:!1},channelId:{value:parseInt(p.channelId),type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id",{phoneContact:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]}]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(we=>(d.error("Error fetching phone numbers"),{data:null})).then(we=>we);X&&(D(X.total),r(X.results)),c(!1),x(!1)},o=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(m,v,B)=>e.jsx("a",{onClick:()=>{},children:v.phoneContact.phoneNumber})},{title:"Full Name",dataIndex:"fullName",key:"name",render:(m,v,B)=>e.jsx("span",{children:v.phoneContact.name})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(m,v,B)=>{var X;return e.jsx(Y,{color:"green",children:(X=v.phoneContact.carrier)==null?void 0:X.name})}},{title:"Created",dataIndex:"created",key:"created",render:(m,v,B)=>e.jsx(le,{title:ie(v.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:ie(v.created).format("Y-mm-d hh:mm:ss")})})},{title:"",dataIndex:"Action",key:"action",render:(m,v,B)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{disabled:!v.canDelete,icon:e.jsx(de,{}),onClick:()=>{},children:e.jsx(be,{placement:"topLeft",title:"Deleting Phone Number",onConfirm:()=>T(parseInt(v.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(O.Item,{disabled:!v.canEdit,icon:e.jsx(xe,{}),onClick:()=>R(v),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:X=>X.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}];return t.useEffect(()=>{V(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:8,children:e.jsx(u,{layout:"vertical",form:J,onFinish:m=>{x(!0),V(0,m.key,j)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Phone Number(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{J.submit()},loading:l||n,disabled:l||n})}),e.jsxs(f,{span:10,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(E,{size:"large",disabled:n||l,onClick:()=>{z.resetFields(),G()},icon:e.jsx(me,{}),children:"Add Phone Number"}),e.jsx(E,{size:"large",disabled:n||l,onClick:()=>q(!0),icon:e.jsx(Fe,{}),children:"Upload Phone Numbers"})]})]}),e.jsx(ye,{loading:n,columns:o,dataSource:i,pagination:{onChange:(m,v)=>{I(v),V(m,M,v)},total:F,pageSize:j,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}}),e.jsx($,{title:"Adding Phone Number",width:"40vw",open:y,onClose:m=>b(m),children:e.jsx(qe,{form:z,onFinish:ae,randKey:Math.random(),channel:a.channel})}),e.jsx($,{title:"Editting Phone Number",width:"40vw",open:C,onClose:m=>S(m),children:e.jsx(ze,{form:k,onFinish:re,randKey:Math.random()})}),e.jsx($,{title:"Uploading Phone Numbers",width:"40vw",open:P,onClose:m=>q(m),children:e.jsx(Te,{form:A,onFinish:g,randKey:Math.random()})})]})},Ns=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=te(),c=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(x=>(d.error("Error fetching channel"),{data:null})).then(x=>x);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Phone Numbers",c()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(N.Item,{children:e.jsxs(L,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Phone Numbers"})]})}),e.jsx(ws,{randKey:Math.random(),channel:s})]})},Is=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Sent Messages"})})),Fs=a=>{const[i,r]=t.useState(!1),[s,h]=t.useState(),n=te(),c=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(x=>(d.error("Error fetching channel"),{data:null})).then(x=>x);l&&h(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Sent Messages",c()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(N.Item,{children:e.jsxs(L,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(Y,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx(N.Item,{children:"Messages"}),e.jsx("span",{children:"Sent"})]})}),e.jsx(Is,{randKey:Math.random(),channel:s})]})},ks="/assets/nodata-fff54bfe.png",Es=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,c]=t.useState(!1),[l,x]=t.useState(!1),[j,I]=t.useState(20);t.useState(""),se();const[F,D]=t.useState(!1),[M,K]=t.useState(!1),[y]=u.useForm();u.useForm();const[b]=u.useForm(),C=k=>{h(k),K(!0)},S=()=>{D(!0)},P=async k=>{const{data:A}=await w.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{id:{value:k,type:"Int",required:!0}},fields:["success","message"]}});A.success?(d.success(A.message),r(i.filter(J=>J.id.toString()!==k.toString()))):d.error(A.message)},q=k=>{ge.confirm({title:"Deleting Njiwa Email Address",icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>P(parseInt(k.toString()))})},z=async(k,A,J=20)=>{const{data:p}=await w.custom({url:"",method:"get",meta:{operation:"njiwaChannels",variables:{control:{value:!0,type:"Boolean",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","icon","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}});r(p.results),c(!1),x(!1)};return t.useEffect(()=>{z(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(u,{layout:"vertical",form:b,onFinish:k=>{x(!0),z(0,k.key,j)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Channel(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{b.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(E,{size:"large",disabled:n||l,onClick:()=>{},children:[e.jsx(me,{}),"Add Email Address"]})})]}),e.jsxs(H,{align:"top",children:[i.length===0&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(ue,{image:ks,imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(E,{type:"primary",onClick:()=>{y.resetFields(),S()},children:"Create Email Address Now"})})}),i.map(k=>e.jsx(f,{span:4,children:e.jsxs(_,{hoverable:k.isActive,style:{marginRight:10},children:[e.jsx(ne,{style:{right:0,position:"absolute"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{icon:e.jsx(xe,{}),onClick:()=>{C(k)},disabled:!(k!=null&&k.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(O.Item,{icon:e.jsx(de,{}),onClick:()=>{q(k.id)},disabled:!(k!=null&&k.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:A=>A.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsx(ne,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:k.emailAddress})]})}))]}),e.jsx($,{title:"Create Njiwa Email Address",width:"40vw",open:F,onClose:k=>D(k),children:e.jsx(ve,{})})]})},Ps=()=>(t.useEffect(()=>{document.title=ee.system_name+": Emails"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Emails Addresses"})]})}),e.jsx(Es,{})]})),Ms=()=>(t.useEffect(()=>{document.title=ee.system_name+": Messages"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Messages"})]})}),e.jsx(De,{})]})),Ds=a=>(t.useEffect(()=>{},[]),e.jsx(e.Fragment,{children:e.jsx("span",{children:"Settings"})})),qs=()=>(t.useEffect(()=>{document.title=ee.system_name+": Settings"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Settings"})]})}),e.jsx(Ds,{})]})),zs=a=>{const[i,r]=t.useState([]),[s,h]=t.useState(),[n,c]=t.useState(!1),[l,x]=t.useState(!1),[j,I]=t.useState(20),[F,D]=t.useState(0),[M,K]=t.useState("");se();const[y,b]=t.useState(!1),[C,S]=t.useState(!1),[P,q]=t.useState(!1),[z]=u.useForm(),[k]=u.useForm(),[A]=u.useForm(),[J]=u.useForm(),p=o=>{h(o),S(!0)},R=()=>{b(!0)},G=async()=>{T(1,"",20),b(!1),z.resetFields()},ae=async o=>{r(i.map(m=>m.id.toString()===o.id.toString()?o:m)),k.resetFields(),S(!1)},re=async()=>{T(1,"",20),A.resetFields(),q(!1)},g=async o=>{const{data:m}=await w.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{id:{value:o,type:"Int",required:!0}},fields:["success","message"]}});m.success?(d.success(m.message),r(i.filter(v=>v.id.toString()!==o.toString()))):d.error(m.message)},T=async(o,m,v=20)=>{c(!0);const{data:B}=await w.custom({url:"",method:"get",meta:{operation:"njiwaChannelsPhoneContacts",variables:{page:{value:o,type:"Int",required:!0},key:{value:m,type:"String",required:!1},pageSize:{value:v,type:"Int",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(X=>(d.error("Error fetching phone numbers"),{data:null})).then(X=>X);B&&(D(B.total),r(B.results)),c(!1),x(!1)},V=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(o,m,v)=>e.jsx("a",{onClick:()=>{},children:m.phoneNumber})},{title:"Full Name",dataIndex:"fullName",key:"name",render:(o,m,v)=>e.jsx("span",{children:m.name})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(o,m,v)=>{var B;return e.jsx(Y,{color:"green",children:(B=m.carrier)==null?void 0:B.name})}},{title:"Created",dataIndex:"created",key:"created",render:(o,m,v)=>e.jsx(le,{title:ie(m.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:ie(m.created).format("Y-mm-d hh:mm:ss")})})},{title:"",dataIndex:"Action",key:"action",render:(o,m,v)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(O,{children:[e.jsx(O.Item,{disabled:!m.canDelete,icon:e.jsx(de,{}),onClick:()=>{},children:e.jsx(be,{placement:"topLeft",title:"Deleting Phone Number",onConfirm:()=>g(parseInt(m.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(O.Item,{disabled:!m.canEdit,icon:e.jsx(xe,{}),onClick:()=>p(m),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:B=>B.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}];return t.useEffect(()=>{T(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:8,children:e.jsx(u,{layout:"vertical",form:J,onFinish:o=>{x(!0),T(0,o.key,j)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:l,placeholder:"Search Phone Number(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{J.submit()},loading:l||n,disabled:l||n})}),e.jsxs(f,{span:10,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(E,{size:"large",disabled:n||l,onClick:()=>{z.resetFields(),R()},icon:e.jsx(me,{}),children:"Add Phone Number"}),e.jsx(E,{size:"large",disabled:n||l,onClick:()=>q(!0),icon:e.jsx(Fe,{}),children:"Upload Phone Numbers"})]})]}),e.jsx(ye,{loading:n,columns:V,dataSource:i,pagination:{onChange:(o,m)=>{I(m),T(o,M,m)},total:F,pageSize:j,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}}),e.jsx($,{title:"Adding Phone Number",width:"40vw",open:y,onClose:o=>b(o),children:e.jsx(qe,{form:z,onFinish:G,randKey:Math.random()})}),e.jsx($,{title:"Editting Phone Number",width:"40vw",open:C,onClose:o=>S(o),children:e.jsx(ze,{phoneNumber:s,form:k,onFinish:ae,randKey:Math.random()})}),e.jsx($,{title:"Uploading Phone Numbers",width:"40vw",open:P,onClose:o=>q(o),children:e.jsx(Te,{form:A,onFinish:re,randKey:Math.random()})})]})},Ts=()=>(t.useEffect(()=>{document.title=ee.system_name+": Phone Numbers"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Phone Numbers"})]})}),e.jsx(zs,{})]})),As=a=>{const[i,r]=t.useState([]);t.useState();const[s,h]=t.useState(!1),[n,c]=t.useState(!1),[l,x]=t.useState(20),[j,I]=t.useState(0),[F,D]=t.useState(1),[M,K]=t.useState("");se();const[y,b]=t.useState(!1);t.useState(!1),u.useForm(),u.useForm();const[C]=u.useForm(),S=async(q,z,k=20)=>{const{data:A}=await w.custom({url:"",method:"get",meta:{operation:"schoolNjiwaAccountBillings",variables:{control:{value:!0,type:"Boolean",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","created","updated","canEdit","canDelete","canManage"]}]}});r(A.results),I(A.total),D(A.page),h(!1),c(!1)},P=[{title:"Bill #",dataIndex:"billNumber",key:"billNumber"},{title:"Amount",dataIndex:"amount",key:"amount",render:(q,z)=>z.amount.toFixed(2)},{title:"Units",dataIndex:"units",key:"units"},{title:"Status",dataIndex:"status",key:"status",render:(q,z)=>z.isPaid?e.jsx(Y,{color:"green",children:"Paid"}):e.jsx(Y,{color:"red",children:"Unpaid"})}];return t.useEffect(()=>{S(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(u,{layout:"vertical",form:C,onFinish:q=>{c(!0),S(0,q.key,l)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",disabled:n,placeholder:"Search Bill(s)...",prefix:e.jsx(Q,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(Q,{}),onClick:()=>{C.submit()},loading:n||s,disabled:n||s})})]}),e.jsx(H,{children:e.jsx(f,{span:24,children:e.jsx(Se.Table,{dataSource:i,columns:P,pagination:{position:["bottomCenter"],pageSize:l,showSizeChanger:!0,showQuickJumper:!0,total:j,current:F,onChange:(q,z)=>{S(q,M,z)},onShowSizeChange:(q,z)=>{x(z),S(q,M,z)}}})})}),e.jsx($,{title:"Create Njiwa Email Address",width:"40vw",open:y,onClose:q=>b(q),children:e.jsx(ve,{})})]})},Ls=()=>(t.useEffect(()=>{document.title=ee.system_name+": Emails"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(N,{children:[e.jsx(N.Item,{children:e.jsx(L,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Payments"})]})}),e.jsx(As,{})]})),jt=a=>{const{page:i}=a;return i==="PhoneNumbersPage"?e.jsx(Ts,{}):i==="NjiwaSettingsPage"?e.jsx(qs,{}):i==="MessagesPage"?e.jsx(Ms,{}):i==="EmailsPage"?e.jsx(Ps,{}):i==="ChannelSentMessagesPage"?e.jsx(Fs,{}):i==="ChannelPhoneNumbersPage"?e.jsx(Ns,{}):i==="ChannelPage"?e.jsx(Ss,{}):i==="ChannelMessagesPage"?e.jsx(ys,{}):i==="ChannelFailedMessagesPage"?e.jsx(ms,{}):i==="ChannelEmailsPage"?e.jsx(hs,{}):i==="ChannelsPage"?e.jsx(cs,{}):i==="NjiwaDashboardPage"?e.jsx(as,{}):i==="NjiwaPaymentsPage"?e.jsx(Ls,{}):e.jsx("div",{children:"Page not found ..."})};export{jt as NjiwaPages};
