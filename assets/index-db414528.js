var Qt=Object.defineProperty;var er=(e,n,r)=>n in e?Qt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r;var M=(e,n,r)=>(er(e,typeof n!="symbol"?n+"":n,r),r);import{r as s,bK as Mt,bL as Pt,bG as tt,bM as tr,bN as rr,v as le,bO as bt,bP as ze,bQ as xt,bR as yt,bF as nr,b5 as Ot,bS as jt,bT as sr,bU as or,j as t,bV as Ve,bW as Tt,bX as Q,bY as Ct,bZ as ir,b_ as ar,b$ as Ne,c0 as Re,c1 as lr,c2 as Pe,aU as _e,$ as cr,av as ke,g as K,_ as R,c as rt,aQ as ur,ar as De,aZ as Oe,c3 as Nt,aY as dr,ad as Te,c4 as pr,c5 as hr,c6 as mr,c7 as fr,c8 as gr,c9 as vr,ca as ge,cb as br,cc as xr,cd as yr,ce as jr,cf as Cr,cg as Rt,aV as me,ch as wr,ci as kr,cj as Sr,aS as wt,ac as Ir,ck as Mr,cl as Xe,cm as Pr,cn as Or,co as kt,cp as Tr,B as je,cq as Nr,cr as Rr,cs as Se,ct as Be,cu as Er,cv as St}from"./index-62ca8c71.js";import{C as Ar}from"./change_password_form-65eb0082.js";import{D as fe}from"./index-d089a0a9.js";import{T as Qe}from"./index-3f73f4a1.js";import{A as Lr}from"./index-d0bf4e29.js";import{C as $r,T as Et}from"./index-2520e10c.js";import{A as ve}from"./index-c9a71fc6.js";import{G as nt}from"./index-b877aff7.js";import{D as At}from"./index-08039974.js";import{L as Ke}from"./index-a5f62a10.js";import{S as zr}from"./school_switcher_component-7e4a8635.js";import{U as et}from"./index-4606efc5.js";import{M as _r}from"./index-57e02f2b.js";import"./transButton-697c9585.js";import"./index-c11e1580.js";import"./InfoCircleFilled-8c818918.js";import"./Skeleton-26b0114a.js";import"./index-30f2475f.js";import"./index-7f983f75.js";import"./ActionButton-e3468a72.js";import"./Upload-af63b42f.js";import"./fade-6a3d81d7.js";import"./DialogWrap-720f6df3.js";import"./index-243c6e9a.js";const Br=e=>{const n=s.useRef({});return s.useEffect(()=>{n.current=e}),n.current},Lt=Br;function Fr(e){const{badgeContent:n,invisible:r=!1,max:a=99,showZero:i=!1}=e,d=Lt({badgeContent:n,max:a});let o=r;r===!1&&n===0&&!i&&(o=!0);const{badgeContent:c,max:p=a}=o?d:e,f=c&&Number(c)>p?`${p}+`:c;return{badgeContent:c,invisible:o,max:p,displayValue:f}}function Vr(e){return Pt("MuiMenuItem",e)}const Dr=Mt("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),Ie=Dr,Ur=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],qr=(e,n)=>{const{ownerState:r}=e;return[n.root,r.dense&&n.dense,r.divider&&n.divider,!r.disableGutters&&n.gutters]},Wr=e=>{const{disabled:n,dense:r,divider:a,disableGutters:i,selected:d,classes:o}=e,p=Tt({root:["root",r&&"dense",n&&"disabled",!i&&"gutters",a&&"divider",d&&"selected"]},Vr,o);return le({},o,p)},Gr=tt(tr,{shouldForwardProp:e=>rr(e)||e==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:qr})(({theme:e,ownerState:n})=>le({},e.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!n.disableGutters&&{paddingLeft:16,paddingRight:16},n.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Ie.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:ze(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${Ie.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:ze(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${Ie.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:ze(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:ze(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${Ie.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Ie.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${xt.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${xt.inset}`]:{marginLeft:52},[`& .${yt.root}`]:{marginTop:0,marginBottom:0},[`& .${yt.inset}`]:{paddingLeft:36},[`& .${bt.root}`]:{minWidth:36}},!n.dense&&{[e.breakpoints.up("sm")]:{minHeight:"auto"}},n.dense&&le({minHeight:32,paddingTop:4,paddingBottom:4},e.typography.body2,{[`& .${bt.root} svg`]:{fontSize:"1.25rem"}}))),Hr=s.forwardRef(function(n,r){const a=nr({props:n,name:"MuiMenuItem"}),{autoFocus:i=!1,component:d="li",dense:o=!1,divider:c=!1,disableGutters:p=!1,focusVisibleClassName:f,role:j="menuitem",tabIndex:x,className:y}=a,b=Ot(a,Ur),C=s.useContext(jt),v=s.useMemo(()=>({dense:o||C.dense||!1,disableGutters:p}),[C.dense,o,p]),S=s.useRef(null);sr(()=>{i&&S.current&&S.current.focus()},[i]);const w=le({},a,{dense:v.dense,divider:c,disableGutters:p}),A=Wr(a),V=or(S,r);let W;return a.disabled||(W=x!==void 0?x:-1),t.jsx(jt.Provider,{value:v,children:t.jsx(Gr,le({ref:V,role:j,tabIndex:W,component:d,focusVisibleClassName:Ve(A.focusVisible,f),className:Ve(A.root,y)},b,{ownerState:w,classes:A}))})}),Me=Hr;function Kr(e){return Pt("MuiBadge",e)}const Jr=Mt("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),ae=Jr,Yr=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],Je=10,Ye=4,Zr=ir(),Xr=e=>{const{color:n,anchorOrigin:r,invisible:a,overlap:i,variant:d,classes:o={}}=e,c={root:["root"],badge:["badge",d,a&&"invisible",`anchorOrigin${Q(r.vertical)}${Q(r.horizontal)}`,`anchorOrigin${Q(r.vertical)}${Q(r.horizontal)}${Q(i)}`,`overlap${Q(i)}`,n!=="default"&&`color${Q(n)}`]};return Tt(c,Kr,o)},Qr=tt("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,n)=>n.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),en=tt("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,n)=>{const{ownerState:r}=e;return[n.badge,n[r.variant],n[`anchorOrigin${Q(r.anchorOrigin.vertical)}${Q(r.anchorOrigin.horizontal)}${Q(r.overlap)}`],r.color!=="default"&&n[`color${Q(r.color)}`],r.invisible&&n.invisible]}})(({theme:e})=>{var n;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:Je*2,lineHeight:1,padding:"0 6px",height:Je*2,borderRadius:Je,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen}),variants:[...Object.keys(((n=e.vars)!=null?n:e).palette).filter(r=>{var a,i;return((a=e.vars)!=null?a:e).palette[r].main&&((i=e.vars)!=null?i:e).palette[r].contrastText}).map(r=>({props:{color:r},style:{backgroundColor:(e.vars||e).palette[r].main,color:(e.vars||e).palette[r].contrastText}})),{props:{variant:"dot"},style:{borderRadius:Ye,height:Ye*2,minWidth:Ye*2,padding:0}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})}}]}}),tn=s.forwardRef(function(n,r){var a,i,d,o,c,p;const f=Zr({props:n,name:"MuiBadge"}),{anchorOrigin:j={vertical:"top",horizontal:"right"},className:x,component:y,components:b={},componentsProps:C={},children:v,overlap:S="rectangular",color:w="default",invisible:A=!1,max:V=99,badgeContent:W,slots:B,slotProps:D,showZero:O=!1,variant:G="standard"}=f,te=Ot(f,Yr),{badgeContent:I,invisible:T,max:U,displayValue:J}=Fr({max:V,invisible:A,badgeContent:W,showZero:O}),z=Lt({anchorOrigin:j,color:w,overlap:S,variant:G,badgeContent:W}),m=T||I==null&&G!=="dot",{color:g=w,overlap:k=S,anchorOrigin:E=j,variant:_=G}=m?z:f,Y=_!=="dot"?J:void 0,L=le({},f,{badgeContent:I,invisible:m,max:U,displayValue:Y,showZero:O,anchorOrigin:E,color:g,overlap:k,variant:_}),u=Xr(L),$=(a=(i=B==null?void 0:B.root)!=null?i:b.Root)!=null?a:Qr,H=(d=(o=B==null?void 0:B.badge)!=null?o:b.Badge)!=null?d:en,se=(c=D==null?void 0:D.root)!=null?c:C.root,oe=(p=D==null?void 0:D.badge)!=null?p:C.badge,re=Ct({elementType:$,externalSlotProps:se,externalForwardedProps:te,additionalProps:{ref:r,as:y},ownerState:L,className:Ve(se==null?void 0:se.className,u.root,x)}),ce=Ct({elementType:H,externalSlotProps:oe,ownerState:L,className:Ve(u.badge,oe==null?void 0:oe.className)});return t.jsxs($,le({},re,{children:[v,t.jsx(H,le({},ce,{children:Y}))]}))}),It=tn,rn=ar(t.jsx("path",{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.39.08-.75.21-1.1.36l1.51 1.51c.32-.08.69-.13 1.09-.13M5.47 3.92 4.06 5.33 7.5 8.77c0 2.08 1.56 3.22 3.91 3.91l3.51 3.51c-.34.49-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.83-.55 2.46-1.12l2.22 2.22 1.41-1.41z"}),"MoneyOffOutlined");var st={},nn=Re;Object.defineProperty(st,"__esModule",{value:!0});var $t=st.default=void 0,sn=nn(Ne()),on=t;$t=st.default=(0,sn.default)((0,on.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");var ot={},an=Re;Object.defineProperty(ot,"__esModule",{value:!0});var zt=ot.default=void 0,ln=an(Ne()),cn=t;zt=ot.default=(0,ln.default)((0,cn.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle");var it={},un=Re;Object.defineProperty(it,"__esModule",{value:!0});var _t=it.default=void 0,dn=un(Ne()),pn=t;_t=it.default=(0,dn.default)((0,pn.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Mail");var at={},hn=Re;Object.defineProperty(at,"__esModule",{value:!0});var Bt=at.default=void 0,mn=hn(Ne()),fn=t;Bt=at.default=(0,mn.default)((0,fn.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications");var lt={},gn=Re;Object.defineProperty(lt,"__esModule",{value:!0});var Ft=lt.default=void 0,vn=gn(Ne()),bn=t;Ft=lt.default=(0,vn.default)((0,bn.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert");const xn=e=>{var p;const{data:n}=lr(),[r,a]=s.useState(!1),[i,d]=s.useState((p=e.user)==null?void 0:p.phone),o=async(f,j)=>{const{data:x}=await K.custom({url:"",method:"post",meta:{operation:"selfUpdateUserProfileInformations",variables:{phone:{value:j,type:"String",required:!1}},fields:["success","message"]}}).catch(y=>({data:null})).then(y=>y);x&&(x.success?(R.success(x.message),a(!1)):R.error(x.message))},c=async f=>{const{data:j}=await K.custom({url:"",method:"post",meta:{operation:"selfVerifyMobilePhoneNumber",variables:{phone:{value:f,type:"String",required:!0}},fields:["success","message","verified","otpSent"]}}).catch(x=>({data:null})).then(x=>x);if(j)if(j.success){if(j.otpSent)return!0}else R.error(j.message);return!1};return s.useEffect(()=>{},[e.randKey]),t.jsxs(t.Fragment,{children:[t.jsxs(fe,{title:"",column:1,labelStyle:{fontSize:22,fontWeight:"bolder"},contentStyle:{fontSize:20},children:[t.jsx(fe.Item,{label:"First Name",children:n==null?void 0:n.firstName}),t.jsx(fe.Item,{label:"Middle Name",children:n==null?void 0:n.middleName}),t.jsx(fe.Item,{label:"Last Name",children:n==null?void 0:n.lastName}),t.jsx(fe.Item,{label:"Email Address",children:t.jsx(Qe.Title,{level:4,style:{fontSize:20,width:"100%",fontWeight:"normal",marginTop:3},children:n==null?void 0:n.email})}),t.jsx(fe.Item,{label:"Gender",children:n==null?void 0:n.gender}),t.jsx(fe.Item,{label:"Mobile Phone Number",children:t.jsxs(Qe.Title,{editable:{onChange:async f=>{f&&(d(f),await c(f)&&a(!0))}},level:4,style:{fontSize:20,fontWeight:"normal",marginTop:5},children:[i&&t.jsx(t.Fragment,{children:i}),!i&&t.jsx(t.Fragment,{children:n==null?void 0:n.phone})]})})]}),t.jsx(Pe,{title:"Mobile Phone Number Verification",open:r,onClose:f=>a(f),children:t.jsx(yn,{user:n,phone:i,onFinish:o})})]})},yn=e=>{const[n]=_e.useForm(),[r,a]=s.useState(!1),i=async(d,o)=>{const{data:c}=await K.custom({url:"",method:"post",meta:{operation:"selfVerifyMobilePhoneNumber",variables:{phone:{value:d,type:"String",required:!0},otp:{value:o,type:"String",required:!1}},fields:["success","message","verified","otpSent"]}}).catch(p=>({data:null})).then(p=>p);if(c)if(c.success){if(c.verified)return!0}else R.error(c.message);return!1};return t.jsxs(t.Fragment,{children:[t.jsx(Lr,{message:`Verification code sent to ${e.phone}, check a recent SMS with four digits`,type:"info"}),t.jsxs(_e,{layout:"vertical",form:n,onFinish:d=>{e.onFinish(d.otp,e.phone)},requiredMark:!0,children:[t.jsx(_e.Item,{name:"otp",label:"Verification Code",rules:[({getFieldValue:d})=>({async validator(o,c){return c.length>=4?(a(!0),await i(e.phone,c)?Promise.resolve():Promise.reject(new Error("Verification Code is not valid"))):Promise.reject(new Error("Verification Code must be 4 characters long"))}})],children:t.jsx(cr,{size:"large",placeholder:"Enter Verification Code ..."})}),t.jsx(_e.Item,{children:t.jsx(ke,{size:"large",danger:!0,style:{float:"right"},disabled:!r,onClick:()=>{e.onFinish(n.getFieldValue("otp"),e.phone)},children:"Verify"})})]})]})},jn=e=>{const[n,r]=s.useTransition(),{push:a}=rt();return t.jsx(t.Fragment,{children:t.jsx(ur,{span:e.colSize,children:t.jsx(Qe.Link,{disabled:!e.app.canAccess,children:t.jsx(De,{spinning:n,children:t.jsx($r,{onClick:()=>{e.app.isActive?r(()=>{a("/"+e.app.url),e.onClose()}):R("Under Construction")},children:t.jsx("div",{style:{marginRight:10,marginTop:10},children:t.jsxs(Oe,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center",textAlign:"center"},children:[t.jsx(ve,{size:{xs:24,sm:32,md:40,lg:40,xl:40,xxl:50},icon:t.jsx(Nt,{}),src:e.app.icon}),t.jsx("span",{style:{fontWeight:"bolder",fontSize:16},children:e.app.name})]})})})})})})})},Fe=()=>{const e=localStorage.getItem("apps");return e?JSON.parse(e):[]},Cn=e=>{const[n,r]=s.useState(Fe()),[a,i]=s.useState(!0),o=!nt.useBreakpoint().lg,c=async()=>{i(!0);const{data:p}=await K.custom({url:"",method:"get",meta:{operation:"apps",fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","icon","url","created","updated","canAccess","isActive"]}]}});localStorage.setItem("apps",JSON.stringify(p.results)),r(p.results),i(!1)};return s.useEffect(()=>{c()},[]),t.jsxs(t.Fragment,{children:[Fe().length==0&&t.jsx("div",{style:{width:"100%",textAlign:"center",marginTop:20},children:t.jsx(De,{})}),Fe().length>0&&t.jsx(dr,{align:"top",children:Fe().map(p=>t.jsx(jn,{app:p,colSize:o?12:4,onClose:()=>e.onClose()}))})]})},wn=e=>{const[n,r]=s.useState([]),[a,i]=s.useState(!0);rt();const d=async()=>{const{data:c}=await K.custom({url:"",method:"get",meta:{operation:"myNotifications",fields:["pages","total","page","hasNext","hasPrev",{results:["id","message","url",{sender:["id","firstName","lastName","middleName","pic","fullName"]},{receiver:["id","firstName","lastName","middleName","pic","fullName"]},"isRead","created","updated","isActive"]}]}}).catch(p=>(R.error("Failed to get notifications"),{data:null})).then(p=>p);c&&r([...n,...c.results]),i(!1)},o=async()=>{const{data:c}=await K.custom({url:"",method:"post",meta:{operation:"clearNotifications",fields:["success","message"]}}).catch(p=>(R.error("Failed to clear notifications"),{data:null})).then(p=>p);c&&(c.success?(R.success(c.message),d()):R.error(c.message))};return s.useEffect(()=>{d()},[e.randKey,e.notifications]),t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{paddingLeft:20,display:"flex",justifyContent:"space-between",paddingTop:20},children:[t.jsx("h3",{children:"Notifications"}),t.jsxs("span",{children:[t.jsx(Te,{title:"Clear All",children:t.jsx("a",{style:{marginRight:20},onClick:o,children:t.jsx(pr,{})})}),t.jsx("a",{style:{marginRight:20},onClick:()=>R("Notification Settings"),children:t.jsx(hr,{})})]})]}),t.jsx(At,{style:{marginTop:0,marginBottom:0}}),t.jsx("div",{style:{maxHeight:"70vh",overflowY:"auto",overflowX:"hidden",paddingLeft:"20px"},children:t.jsx(De,{spinning:a,children:t.jsx(Ke,{itemLayout:"horizontal",dataSource:e.notifications,renderItem:c=>t.jsx("a",{children:t.jsx(Ke.Item,{onClick:()=>{e.onNotificationClick(c)},children:t.jsx(Ke.Item.Meta,{avatar:t.jsx(ve,{src:c.sender.pic}),title:t.jsx("a",{children:c.message}),description:mr(c.created).fromNow()})})})})})})]})},{Dragger:kn}=et,Sn=e=>{const[n,r]=s.useState([]),a=i=>{const d=["png","jpg","jpeg","gif","bmp","webp","tiff","svg","psd"],o=i.name.split(".").pop();return d.indexOf(o)===-1?(R.error("File type not supported"),et.LIST_IGNORE):i.size/1024/1024>50?(R.error("File size too large"),et.LIST_IGNORE):(r([i,...n]),!0)};return s.useEffect(()=>{r([])},[e.random]),t.jsx(t.Fragment,{children:t.jsxs(kn,{customRequest:e.handleUpload,beforeUpload:a,fileList:n,multiple:!1,accept:"image/*",children:[t.jsx("p",{className:"ant-upload-drag-icon",children:t.jsx(fr,{})}),t.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload a Profile Picture"})]})})},{TabPane:In}=Et,Mn=e=>{var o;const[n,r]=s.useState(!1),a=(c,p)=>{e.changeWidth(c),r(p)},i=async()=>{const{data:c}=await K.custom({url:"",method:"post",meta:{operation:"removeUserProfilePhoto",variables:{id:{value:parseInt(e.user.id),type:"Int",required:!0}},fields:["success","message"]}});c.success?(R.success(c.message),e.close(),window.location.reload()):R.error(c.message)},d=async c=>{const{onSuccess:p,onError:f,file:j,onProgress:x}=c,{data:y}=await K.custom({url:"",method:"post",meta:{operation:"uploadUserProfilePhoto",variables:{id:{value:parseInt(e.user.id),type:"Int",required:!0},photo:{value:j,type:"Upload",required:!0}},onUploadProgress:b=>{const{loaded:C,total:v}=b,S=Math.floor(C*100/v);x(S)},onError:b=>{f(b),R.error(b.message)},fields:["success","message",{user:["id","firstName","middleName","lastName","fullName","pic","email","isAdmin","isStaff","isActive"]}]}});if(y.success){p("ok"),R.success(y.message),localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(y.user));const b=localStorage.getItem("user"),{pic:C}=JSON.parse(b||"");y.user.pic===C&&window.location.reload()}else R.error(y.message)};return s.useEffect(()=>{e.triggerClose&&(r(!1),e.close())},[e.changeWidth]),t.jsx(t.Fragment,{children:n?t.jsx(Et,{defaultActiveKey:"1",centered:!0,draggable:!0,children:t.jsxs(In,{tab:t.jsx("span",{style:{fontSize:18},children:"From Computer"}),children:[t.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:30,marginBottom:30},children:t.jsx(Sn,{user:e.user,handleUpload:d})}),t.jsx("span",{style:{marginRight:10},children:t.jsx(ke,{icon:t.jsx(gr,{}),size:"large",onClick:()=>a(30,!1),children:"Back"})})]},"3")}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[t.jsx("span",{style:{fontSize:18,fontWeight:"bolder"},children:"Profile picture"}),t.jsx("span",{style:{display:"block",marginTop:10},children:"A picture helps people recognize you and lets you know when you’re signed in to your account"}),t.jsxs("span",{style:{display:"block",marginTop:10},children:[t.jsx(vr,{}),"Visible across ",ge.system_name," services.",t.jsx("a",{children:"Learn more"})]})]}),t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsx(ve,{src:(o=e.user)==null?void 0:o.pic,style:{width:225,height:225}})}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:30},children:[t.jsx("span",{style:{marginRight:10},children:t.jsx(ke,{icon:t.jsx(br,{}),size:"large",onClick:()=>a(60,!0),children:"Change"})}),t.jsx("span",{children:t.jsx(ke,{icon:t.jsx(xr,{}),size:"large",onClick:i,children:"Remove"})})]})]})})},{LogoutOutlined:Pn,UserOutlined:On}=Pr,Tn=()=>{const e=s.useContext(yr),{ready:n,value:r,send:a}=e,[i,d]=s.useTransition(),{data:o}=jr();Cr();const[c,p]=s.useState(0),[f,j]=s.useState(!1),[x,y]=s.useState(30),[b,C]=s.useState(!1),[v,S]=s.useState(0),[w,A]=s.useState(!1),[V,W]=s.useState(!1),[B,D]=s.useState(!1),{mutate:O}=Rt(),{push:G}=rt(),te=nt.useBreakpoint(),[I,T]=s.useState(!1),[U,J]=s.useState(!0),z=s.useRef(null),m=!te.lg,[g,k]=s.useState(!1),[E,_]=s.useState([]),[Y,L]=s.useState(!1),u=async()=>{const{data:h}=await K.custom({url:"",method:"get",meta:{operation:"myNotifications",fields:["pages","total","page","hasNext","hasPrev",{results:["id","message","url",{sender:["id","firstName","lastName","middleName","pic","fullName"]},{receiver:["id","firstName","lastName","middleName","pic","fullName"]},"isRead","created","updated","isActive"]}]}}).catch(N=>(R.error("Failed to get notifications"),{data:null})).then(N=>N);if(h){const N=h.results.filter(Z=>!E.some(be=>be.id===Z.id));_([...N,...E])}},$=async h=>{const{data:N}=await K.custom({url:"",method:"post",meta:{operation:"markNotificationAsRead",variables:{notificationId:{value:parseInt(h.toString()),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>({data:null})).then(Z=>Z);N&&N.success&&(_(E.filter(Z=>Z.id.toString()!==h.toString())),p(c-1))},H=h=>{y(h)},se=async()=>{const{data:h}=await K.custom({url:"",method:"get",meta:{operation:"totalNotifications",fields:["total"]}}).catch(N=>({data:null})).then(N=>N);h&&p(h.total)},oe=()=>{y(30),C(!0),S(Math.random())};s.useEffect(()=>{if(console.log("value:",r),Notification.permission!=="granted"&&Notification.requestPermission(),Notification.permission==="granted"&&r!==null&&r!==""&&r!==void 0&&r!=="null"&&r!="Nil")try{const h=JSON.parse(r);console.log("data:",h),"Notification"in window?(Notification.requestPermission().then(N=>{if(N==="granted"){const Z=new Notification(h.message.title,{body:h.message.body})}else console.error("Notification permission denied")}),u()):console.error("Notification API not supported")}catch(h){console.error(h)}se(),u(),k(m)},[n,r,a]);const re=t.jsx(De,{spinning:i,children:t.jsx(me,{style:{width:400,backgroundColor:"white",padding:20},children:t.jsxs("span",{ref:z,style:{margin:10,padding:30},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[t.jsx(ve,{src:o==null?void 0:o.pic,style:{width:75,height:75}}),t.jsx(Te,{title:"Change Profile Picture",color:"green",placement:"left",children:t.jsx(ke,{shape:"circle",icon:t.jsx(wr,{}),style:{position:"absolute",marginLeft:75,marginTop:40},onClick:()=>j(!0)})})]}),t.jsx("div",{style:{display:"flex",justifyContent:"center",fontWeight:"bolder",color:"black",marginTop:20,marginBottom:30,fontSize:24},children:o==null?void 0:o.fullName}),t.jsx(zr,{}),t.jsx(At,{}),t.jsx(me.Item,{onClick:()=>D(!0),icon:t.jsx(On,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Profile"},"profile"),o!=null&&o.isStaff||o!=null&&o.isAdmin?t.jsxs(t.Fragment,{children:[t.jsx(me.Item,{onClick:()=>{d(()=>{G("/control/analytics")})},icon:t.jsx(kr,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Control Panel"},"controlpanel"),t.jsx(me.Item,{onClick:()=>{d(()=>{G("/opay")})},style:{fontSize:18,color:"black"},icon:t.jsx(rn,{style:{color:"red"}}),children:"Billing Management"},"controlpanel")]}):t.jsx(t.Fragment,{}),!(o!=null&&o.ldapAuth)&&t.jsx(Te,{title:"Click to Change Your Password",color:"green",children:t.jsx(me.Item,{onClick:()=>A(!0),icon:t.jsx(Sr,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Change Password"},"accountChangePassword")}),t.jsx(me.Item,{onClick:()=>O(),icon:t.jsx(Pn,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Logout"},"logout")]})})}),ce=t.jsx(me,{style:{width:500,minHeight:50},children:t.jsx(wn,{randKey:Math.random(),notifications:E,onNotificationClick:h=>{$(h.id),h.url&&(L(!1),G(h.url))}})});return t.jsxs(Oe,{children:[t.jsx(Oe,{style:{marginLeft:"0px",marginRight:"20px"},children:t.jsx(Nn,{})}),t.jsx(Oe,{style:{marginLeft:"0px",marginRight:"20px"},children:t.jsx(wt,{overlay:ce,open:Y,trigger:["click"],overlayStyle:{zIndex:9999},children:t.jsx(Te,{title:"Notifications",placement:"bottom",color:"green",children:t.jsx(Ir,{count:c,children:t.jsx("a",{onClick:()=>{L(!Y)},children:t.jsx(ve,{icon:t.jsx(Mr,{}),style:{backgroundColor:"silver"}})})})})})}),t.jsx(Oe,{style:{marginLeft:"10px"},children:t.jsx(wt,{overlay:re,trigger:["click"],overlayStyle:{zIndex:9999},children:t.jsx("a",{onClick:()=>T(!I),children:(o==null?void 0:o.pic)&&t.jsx(ve,{src:o==null?void 0:o.pic,alt:o==null?void 0:o.fullName})})})}),t.jsx(Pe,{title:t.jsx(t.Fragment,{children:x>30&&t.jsx("span",{children:"Change Profile Picture"})||t.jsxs("span",{children:[ge.system_name," Account"]})}),open:f,width:x+"vw",onClose:h=>j(h),children:t.jsx(Mn,{user:o,changeWidth:H,triggerClose:b,close:oe})}),t.jsx(Pe,{title:"Change Password",open:w,width:"30vw",onClose:h=>A(h),children:t.jsx(Ar,{onFinish:()=>{J(!1)}})}),t.jsx(Pe,{title:"Account Payment Settings",destroyOnClose:!0,closable:!0,open:V,width:"40vw",onClose:h=>W(h),children:t.jsx("p",{children:"Account Payment Settings"})}),t.jsx(Pe,{title:(o==null?void 0:o.fullName)+" Profile Information's",open:B,width:"60vw",onClose:h=>D(h),children:t.jsx(xn,{randKey:Math.random(),user:o})})]})};function Nn(){const[e,n]=s.useState(null),r=!!e,i=!nt.useBreakpoint().lg,d=c=>{n(c.currentTarget)},o=()=>{n(null)};return t.jsxs("div",{children:[t.jsx(Te,{title:"Apps",color:"green",placement:"left",children:t.jsx("span",{id:"basic-button","aria-controls":r?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":r?"true":void 0,onClick:d,style:{cursor:"pointer"},children:t.jsx(ve,{icon:t.jsx(Nt,{}),style:{backgroundColor:"silver"}})})}),t.jsx(Xe,{id:"basic-menu",anchorEl:e,open:r,onClose:o,MenuListProps:{"aria-labelledby":"basic-button",style:{width:i?"100vw":"70vw"}},children:t.jsx(Cn,{onClose:()=>{o()}})})]})}var Rn=Object.create,Vt=Object.defineProperty,En=Object.getOwnPropertyDescriptor,An=Object.getOwnPropertyNames,Ln=Object.getPrototypeOf,$n=Object.prototype.hasOwnProperty,zn=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),_n=(e,n,r,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of An(n))!$n.call(e,i)&&i!==r&&Vt(e,i,{get:()=>n[i],enumerable:!(a=En(n,i))||a.enumerable});return e},Bn=(e,n,r)=>(r=e!=null?Rn(Ln(e)):{},_n(n||!e||!e.__esModule?Vt(r,"default",{value:e,enumerable:!0}):r,e)),Fn=zn((e,n)=>{(function(r,a){typeof e=="object"&&typeof n<"u"?a(e):typeof define=="function"&&define.amd?define(["exports"],a):(r=typeof globalThis<"u"?globalThis:r||self,a(r.fastUniqueNumbers={}))})(e,function(r){var a=function(b){return function(C){var v=b(C);return C.add(v),v}},i=function(b){return function(C,v){return b.set(C,v),v}},d=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,c=o*2,p=function(b,C){return function(v){var S=C.get(v),w=S===void 0?v.size:S<c?S+1:0;if(!v.has(w))return b(v,w);if(v.size<o){for(;v.has(w);)w=Math.floor(Math.random()*c);return b(v,w)}if(v.size>d)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;v.has(w);)w=Math.floor(Math.random()*d);return b(v,w)}},f=new WeakMap,j=i(f),x=p(j,f),y=a(x);r.addUniqueNumber=y,r.generateUniqueNumber=x})});Bn(Fn());var ne=(typeof window>"u"?"undefined":typeof window)=="object",ee={setTimeout:ne?setTimeout.bind(window):setTimeout,clearTimeout:ne?clearTimeout.bind(window):clearTimeout,setInterval:ne?setInterval.bind(window):setInterval,clearInterval:ne?clearInterval.bind(window):clearInterval};function Vn(e){ee.setTimeout=e.setTimeout,ee.clearTimeout=e.clearTimeout,ee.setInterval=e.setInterval,ee.clearInterval=e.clearInterval}var Ce={},Dn=class{constructor(e){M(this,"name");M(this,"closed",!1);M(this,"mc",new MessageChannel);this.name=e,Ce[e]=Ce[e]||[],Ce[e].push(this),this.mc.port1.start(),this.mc.port2.start(),this.onStorage=this.onStorage.bind(this),window.addEventListener("storage",this.onStorage)}onStorage(e){if(e.storageArea!==window.localStorage||e.key.substring(0,this.name.length)!==this.name||e.newValue===null)return;let n=JSON.parse(e.newValue);this.mc.port2.postMessage(n)}postMessage(e){if(this.closed)throw new Error("InvalidStateError");let n=JSON.stringify(e),r=`${this.name}:${String(Date.now())}${String(Math.random())}`;window.localStorage.setItem(r,n),ee.setTimeout(()=>{window.localStorage.removeItem(r)},500),Ce[this.name].forEach(a=>{a!==this&&a.mc.port2.postMessage(JSON.parse(n))})}close(){if(this.closed)return;this.closed=!0,this.mc.port1.close(),this.mc.port2.close(),window.removeEventListener("storage",this.onStorage);let e=Ce[this.name].indexOf(this);Ce[this.name].splice(e,1)}get onmessage(){return this.mc.port1.onmessage}set onmessage(e){this.mc.port1.onmessage=e}get onmessageerror(){return this.mc.port1.onmessageerror}set onmessageerror(e){this.mc.port1.onmessageerror=e}addEventListener(e,n){return this.mc.port1.addEventListener(e,n)}removeEventListener(e,n){return this.mc.port1.removeEventListener(e,n)}dispatchEvent(e){return this.mc.port1.dispatchEvent(e)}},Un=typeof window>"u"?void 0:typeof window.BroadcastChannel=="function"?window.BroadcastChannel:Dn;function qn(e=0){return new Promise(n=>ee.setTimeout(n,e))}function Dt(){return Math.random().toString(36).substring(2)}var Wn=class{constructor(e,n){M(this,"options");M(this,"channel");M(this,"token",Dt());M(this,"isLeader",!1);M(this,"isDead",!1);M(this,"isApplying",!1);M(this,"reApply",!1);M(this,"intervals",[]);M(this,"listeners",[]);M(this,"deferred");this.channel=e,this.options=n,this.apply=this.apply.bind(this),this.awaitLeadership=this.awaitLeadership.bind(this),this.sendAction=this.sendAction.bind(this)}async apply(){if(this.isLeader||this.isDead)return!1;if(this.isApplying)return this.reApply=!0,!1;this.isApplying=!0;let e=!1,n=r=>{let{token:a,action:i}=r.data;a!==this.token&&(i===0&&a>this.token&&(e=!0),i===1&&(e=!0))};this.channel.addEventListener("message",n);try{return this.sendAction(0),await qn(this.options.responseTime),this.channel.removeEventListener("message",n),this.isApplying=!1,e?this.reApply?this.apply():!1:(this.assumeLead(),!0)}catch{return!1}}awaitLeadership(){if(this.isLeader)return Promise.resolve();let e=!1,n=null;return new Promise(r=>{let a=()=>{if(e)return;e=!0;try{ee.clearInterval(n)}catch{}let d=this.intervals.indexOf(n);d>=0&&this.intervals.splice(d,1),this.channel.removeEventListener("message",i),r()};n=ee.setInterval(()=>{this.apply().then(()=>{this.isLeader&&a()})},this.options.fallbackInterval),this.intervals.push(n);let i=d=>{let{action:o}=d.data;o===2&&this.apply().then(()=>{this.isLeader&&a()})};this.channel.addEventListener("message",i)})}sendAction(e){this.channel.postMessage({action:e,token:this.token})}assumeLead(){this.isLeader=!0;let e=n=>{let{action:r}=n.data;r===0&&this.sendAction(1)};return this.channel.addEventListener("message",e),this.listeners.push(e),this.sendAction(1)}waitForLeadership(){return this.deferred?this.deferred:(this.deferred=this.awaitLeadership(),this.deferred)}close(){if(!this.isDead){this.isDead=!0,this.isLeader=!1,this.sendAction(2);try{this.listeners.forEach(e=>this.channel.removeEventListener("message",e)),this.intervals.forEach(e=>ee.clearInterval(e))}catch{}}}},Gn=class{constructor(e){M(this,"channel");M(this,"options");M(this,"elector");M(this,"token",Dt());M(this,"registry",new Map);M(this,"allIdle",!1);M(this,"isLastActive",!1);let{channelName:n}=e;if(this.options=e,this.channel=new Un(n),this.registry.set(this.token,1),e.leaderElection){let r={fallbackInterval:2e3,responseTime:100};this.elector=new Wn(this.channel,r),this.elector.waitForLeadership()}this.channel.addEventListener("message",r=>{let{action:a,token:i,data:d}=r.data;switch(a){case 3:this.registry.set(i,2);break;case 4:this.registry.delete(i);break;case 5:this.idle(i);break;case 6:this.active(i);break;case 7:this.prompt(i);break;case 8:this.start(i);break;case 9:this.reset(i);break;case 10:this.activate(i);break;case 11:this.pause(i);break;case 12:this.resume(i);break;case 13:this.options.onMessage(d);break}}),this.send(3)}get isLeader(){if(!this.elector)throw new Error('❌ Leader election is not enabled. To Enable it set the "leaderElection" property to true.');return this.elector.isLeader}prompt(e=this.token){this.registry.set(e,0);let n=[...this.registry.values()].every(r=>r===0);e===this.token&&this.send(7),n&&this.options.onPrompt()}idle(e=this.token){this.registry.set(e,2);let n=[...this.registry.values()].every(r=>r===2);e===this.token&&this.send(5),!this.allIdle&&n&&(this.allIdle=!0,this.options.onIdle())}active(e=this.token){this.allIdle=!1,this.registry.set(e,1);let n=[...this.registry.values()].some(r=>r===1);e===this.token&&this.send(6),n&&this.options.onActive(),this.isLastActive=e===this.token}start(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(8):this.options.start(!0),this.isLastActive=e===this.token}reset(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(9):this.options.reset(!0),this.isLastActive=e===this.token}activate(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(10):this.options.activate(!0),this.isLastActive=e===this.token}pause(e=this.token){e===this.token?this.send(11):this.options.pause(!0)}resume(e=this.token){e===this.token?this.send(12):this.options.resume(!0)}message(e){try{this.channel.postMessage({action:13,token:this.token,data:e})}catch{}}send(e){try{this.channel.postMessage({action:e,token:this.token})}catch{}}close(){this.options.leaderElection&&this.elector.close(),this.send(4),this.channel.close()}},Hn=ne?document:null,Kn=["mousemove","keydown","wheel","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","MSPointerDown","MSPointerMove","visibilitychange","focus"];function Jn(e,n){let r;function a(...i){r&&clearTimeout(r),r=setTimeout(()=>{e(...i),r=null},n)}return a.cancel=function(){clearTimeout(r)},a}function Ze(e,n){let r=0;return function(...a){let i=new Date().getTime();if(!(i-r<n))return r=i,e(...a)}}var P=()=>Date.now(),we=2147483647;function Yn({timeout:e=1e3*60*20,promptTimeout:n=0,promptBeforeIdle:r=0,element:a=Hn,events:i=Kn,timers:d=void 0,immediateEvents:o=[],onPresenceChange:c=()=>{},onPrompt:p=()=>{},onIdle:f=()=>{},onActive:j=()=>{},onAction:x=()=>{},onMessage:y=()=>{},debounce:b=0,throttle:C=0,eventsThrottle:v=200,startOnMount:S=!0,startManually:w=!1,stopOnIdle:A=!1,crossTab:V=!1,name:W="idle-timer",syncTimers:B=0,leaderElection:D=!1,disabled:O=!1}={}){let G=s.useRef(P()),te=s.useRef(P()),I=s.useRef(null),T=s.useRef(null),U=s.useRef(0),J=s.useRef(0),z=s.useRef(0),m=s.useRef(0),g=s.useRef(!1),k=s.useRef(!1),E=s.useRef(!1),_=s.useRef(!0),Y=s.useRef(!1),L=s.useRef(null),u=s.useRef(null),$=s.useRef(e),H=s.useRef(0);s.useEffect(()=>{if(n&&console.warn("⚠️ IdleTimer -- The `promptTimeout` property has been deprecated in favor of `promptBeforeIdle`. It will be removed in the next major release."),r&&n)throw new Error("❌ Both promptTimeout and promptBeforeIdle can not be set. The promptTimeout property will be deprecated in a future version.");if(e>=we)throw new Error(`❌ The value for the timeout property must fit in a 32 bit signed integer, ${we}.`);if(n>=we)throw new Error(`❌ The value for the promptTimeout property must fit in a 32 bit signed integer, ${we}.`);if(r>=we)throw new Error(`❌ The value for the promptBeforeIdle property must fit in a 32 bit signed integer, ${we}.`);if(r>=e)throw new Error(`❌ The value for the promptBeforeIdle property must be less than the timeout property, ${e}.`);if(r?($.current=e-r,H.current=r):($.current=e,H.current=n),!_.current){if(w||O)return;g.current&&(xe.current(null,q),u.current&&u.current.active()),he()}},[e,n,r,w,O]);let se=s.useRef(A);s.useEffect(()=>{se.current=A},[A]);let oe=s.useRef(o),re=s.useRef(a),ce=s.useRef([...new Set([...i,...o]).values()]),h=s.useRef(O);s.useEffect(()=>{h.current=O,!_.current&&(O?Le():w||he())},[O]);let N=s.useRef(c);s.useEffect(()=>{N.current=c},[c]);let Z=s.useRef(p);s.useEffect(()=>{Z.current=p},[p]);let be=s.useRef(f);s.useEffect(()=>{be.current=f},[f]);let xe=s.useRef(j);s.useEffect(()=>{xe.current=j},[j]);let Ee=s.useRef(x);s.useEffect(()=>{Ee.current=x},[x]);let ye=s.useRef(y);s.useEffect(()=>{ye.current=y},[y]);let ue=s.useMemo(()=>{let l=(F,$e)=>Ee.current(F,$e);return b>0?Jn(l,b):C>0?Ze(l,C):l},[C,b]),ct=s.useRef();s.useEffect(()=>{V&&B&&(ct.current=Ze(()=>{u.current.active()},B))},[V,B]);let X=()=>{L.current!==null&&(ee.clearTimeout(L.current),L.current=null)},de=(l,F=!0)=>{X(),L.current=ee.setTimeout(qe,l||$.current),F&&(T.current=P())},ut=l=>{!k.current&&!g.current&&(Z.current(l,q),N.current({type:"active",prompted:!0},q)),m.current=0,z.current=P(),k.current=!0,de(H.current,!1)},dt=()=>{X(),g.current||(be.current(null,q),N.current({type:"idle"},q)),g.current=!0,I.current=P(),se.current?pe():k.current&&(z.current=0,k.current=!1)},Ue=l=>{X(),(g.current||k.current)&&(xe.current(l,q),N.current({type:"active",prompted:!1},q)),k.current=!1,z.current=0,g.current=!1,U.current+=P()-I.current,J.current+=P()-I.current,ie(),de()},qe=l=>{if(!g.current){ue.cancel&&ue.cancel();let F=P()-T.current;if(!($.current+H.current<F)&&H.current>0&&!k.current){u.current?u.current.prompt():ut(l);return}u.current?u.current.idle():dt();return}u.current?u.current.active():Ue(l)},We=l=>{if(!S&&!T.current&&(T.current=P(),xe.current(null,q)),ue(l,q),k.current)return;if(X(),!g.current&&oe.current.includes(l.type)){qe(l);return}let F=P()-T.current;if(g.current&&!A||!g.current&&F>=$.current){qe(l);return}E.current=!1,m.current=0,z.current=0,de(),V&&B&&ct.current()},Ae=s.useRef(We);s.useEffect(()=>{let l=Y.current;l&&pe(),v>0?Ae.current=Ze(We,v):Ae.current=We,l&&ie()},[v,C,b,Ee,V,B]);let ie=()=>{ne&&re.current&&(Y.current||(ce.current.forEach(l=>{re.current.addEventListener(l,Ae.current,{capture:!0,passive:!0})}),Y.current=!0))},pe=(l=!1)=>{ne&&re.current&&(Y.current||l)&&(ce.current.forEach(F=>{re.current.removeEventListener(F,Ae.current,{capture:!0})}),Y.current=!1)},he=s.useCallback(l=>h.current?!1:(X(),ie(),g.current=!1,k.current=!1,E.current=!1,m.current=0,z.current=0,u.current&&!l&&u.current.start(),de(),!0),[L,g,h,$,u]),Ge=s.useCallback(l=>h.current?!1:(X(),ie(),te.current=P(),U.current+=P()-I.current,J.current+=P()-I.current,U.current=0,g.current=!1,k.current=!1,E.current=!1,m.current=0,z.current=0,u.current&&!l&&u.current.reset(),w||de(),!0),[L,g,$,w,h,u]),pt=s.useCallback(l=>h.current?!1:(X(),ie(),(g.current||k.current)&&Ue(),g.current=!1,k.current=!1,E.current=!1,m.current=0,z.current=0,te.current=P(),u.current&&!l&&u.current.activate(),de(),!0),[L,g,k,h,$,u]),Le=s.useCallback((l=!1)=>h.current||E.current?!1:(m.current=ht(),E.current=!0,pe(),X(),u.current&&!l&&u.current.pause(),!0),[L,h,u]),He=s.useCallback((l=!1)=>h.current||!E.current?!1:(E.current=!1,k.current||ie(),g.current||de(m.current),z.current&&(z.current=P()),u.current&&!l&&u.current.resume(),!0),[L,$,h,m,u]),Ut=s.useCallback((l,F)=>(u.current?(F&&ye.current(l,q),u.current.message(l)):F&&ye.current(l,q),!0),[y]),qt=s.useCallback(()=>g.current,[g]),Wt=s.useCallback(()=>k.current,[k]),Gt=s.useCallback(()=>u.current?u.current.isLeader:null,[u]),Ht=s.useCallback(()=>u.current?u.current.isLastActive:null,[u]),Kt=s.useCallback(()=>u.current?u.current.token:null,[u]),ht=s.useCallback(()=>{if(E.current)return m.current;let l=m.current?m.current:H.current+$.current,F=T.current?P()-T.current:0,$e=Math.floor(l-F);return $e<0?0:Math.abs($e)},[$,H,k,m,T]),mt=s.useCallback(()=>Math.round(P()-te.current),[te]),ft=s.useCallback(()=>Math.round(P()-G.current),[G]),Jt=s.useCallback(()=>I.current?new Date(I.current):null,[I]),Yt=s.useCallback(()=>T.current?new Date(T.current):null,[T]),gt=s.useCallback(()=>g.current?Math.round(P()-I.current+U.current):Math.round(U.current),[I,U]),vt=s.useCallback(()=>g.current?Math.round(P()-I.current+J.current):Math.round(J.current),[I,J]),Zt=s.useCallback(()=>{let l=Math.round(mt()-gt());return l>=0?l:0},[I,U]),Xt=s.useCallback(()=>{let l=Math.round(ft()-vt());return l>=0?l:0},[I,U]);s.useEffect(()=>{if(b>0&&C>0)throw new Error("❌ onAction can either be throttled or debounced, not both.");d&&Vn(d);let l=()=>{u.current&&u.current.close(),ue.cancel&&ue.cancel(),X(),pe(!0)};return ne&&window.addEventListener("beforeunload",l),()=>{ne&&window.removeEventListener("beforeunload",l),u.current&&u.current.close(),ue.cancel&&ue.cancel(),X(),pe(!0)}},[]),s.useEffect(()=>{u.current&&u.current.close(),V?u.current=new Gn({channelName:W,leaderElection:D,onPrompt:()=>{ut()},onIdle:()=>{dt()},onActive:()=>{Ue()},onMessage:l=>{ye.current(l,q)},start:he,reset:Ge,activate:pt,pause:Le,resume:He}):u.current=null},[V,W,D,Z,be,xe,ye,he,Ge,Le,He]),s.useEffect(()=>{_.current||(X(),pe(!0)),!(w||O)&&(S?he():ie())},[w,S,O,_]),s.useEffect(()=>{if(!_.current){let l=[...new Set([...i,...o]).values()];if(pe(),ce.current=l,re.current=a,oe.current=o,w||O)return;S?he():ie()}},[a,JSON.stringify(i),JSON.stringify(o),_,O,w,S]),s.useEffect(()=>{_.current&&(_.current=!1)},[_]);let q={message:Ut,start:he,reset:Ge,activate:pt,pause:Le,resume:He,isIdle:qt,isPrompted:Wt,isLeader:Gt,isLastActiveTab:Ht,getTabId:Kt,getRemainingTime:ht,getElapsedTime:mt,getTotalElapsedTime:ft,getLastIdleTime:Jt,getLastActiveTime:Yt,getIdleTime:gt,getTotalIdleTime:vt,getActiveTime:Zt,getTotalActiveTime:Xt,setOnPresenceChange:l=>{c=l,N.current=l},setOnPrompt:l=>{p=l,Z.current=l},setOnIdle:l=>{f=l,be.current=l},setOnActive:l=>{j=l,xe.current=l},setOnAction:l=>{x=l,Ee.current=l},setOnMessage:l=>{y=l,ye.current=l}};return q}var Zn=s.createContext(null);Zn.Consumer;const Xn=({onIdle:e,onAction:n,idleTime:r=1})=>{const a=1e3*r,[i,d]=s.useState(!1),o=()=>{d(!0)},c=Yn({timeout:a,promptTimeout:a/2,onPrompt:e,onIdle:o,debounce:500,crossTab:!0,onAction:n,events:["mousemove","keydown","mousedown","touchstart","scroll","click","focus","resize","visibilitychange","pagehide","pageshow","beforeunload"]});return{isIdle:i,setIdle:d,idleTimer:c}},ks=e=>{const n=Or(),[r,a]=s.useState(!1),{mutate:i}=Rt(),d=()=>{a(!0)},o=()=>{const m=localStorage.getItem("lastLoginAttemp"),g=new Date(m??new Date),k=parseInt(localStorage.getItem("expires")??"600");console.log(g),g.setSeconds(g.getSeconds()+k),g.getTime()-new Date().getTime()<2e4&&z()},{idleTimer:c}=Xn({onIdle:d,idleTime:parseInt(localStorage.getItem("expires")??"600"),onAction:o}),p=()=>{i(),a(!1)},f=kt(m=>m.collapsed),[j,x]=s.useState(null),[y,b]=s.useState(""),[C,v]=s.useState(null),S=!!j,w=!!C,A=kt(m=>m.hasSidebar),{setSiderCollapsed:V,setMobileSiderOpen:W}=Tr(),B=m=>{x(m.currentTarget)},D=()=>{v(null)},O=()=>{x(null),D()},G=m=>{v(m.currentTarget)},te="primary-search-account-menu",I=t.jsxs(Xe,{anchorEl:j,anchorOrigin:{vertical:"top",horizontal:"right"},id:te,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:S,onClose:O,children:[t.jsx(Me,{onClick:O,children:"Profile"}),t.jsx(Me,{onClick:O,children:"My account"})]}),T="primary-search-account-menu-mobile",U=t.jsxs(Xe,{anchorEl:C,anchorOrigin:{vertical:"top",horizontal:"right"},id:T,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:w,onClose:D,children:[t.jsxs(Me,{children:[t.jsx(Se,{size:"large","aria-label":"show 4 new mails",color:"inherit",children:t.jsx(It,{badgeContent:4,color:"error",children:t.jsx(_t,{})})}),t.jsx("p",{children:"Messages"})]}),t.jsxs(Me,{children:[t.jsx(Se,{size:"large","aria-label":"show 17 new notifications",color:"inherit",children:t.jsx(It,{badgeContent:17,color:"error",children:t.jsx(Bt,{})})}),t.jsx("p",{children:"Notifications"})]}),t.jsxs(Me,{onClick:B,children:[t.jsx(Se,{size:"large","aria-label":"account of current user","aria-controls":"primary-search-account-menu","aria-haspopup":"true",color:"inherit",children:t.jsx(zt,{})}),t.jsx("p",{children:"Profile"})]})]}),J=ge.tenantNames,z=async()=>{const{data:m}=await K.custom({url:"",method:"post",meta:{operation:"refreshToken",variables:{token:{value:localStorage.getItem("token"),type:"String",required:!0},sessionKey:{value:localStorage.getItem("sessionKey"),type:"String",required:!1}},fields:["success","message","expires","token","sessionKey"]}}).catch(()=>({data:null})).then(g=>g);m!=null&&m.success?(localStorage.setItem("lastLoginAttemp",new Date().toString()),localStorage.setItem("token",m.token),localStorage.setItem("sessionKey",m.sessionKey),localStorage.setItem("expires",m.expires),a(!1),c.reset()):p()};return s.useEffect(()=>{b(n.pathname.split("/")[1].toString())},[n]),t.jsxs(je,{position:"fixed",sx:{width:"100%",zIndex:100},children:[t.jsx(Nr,{position:"fixed",children:t.jsxs(Rr,{children:[A&&t.jsx(Se,{size:"large",edge:"start",color:"inherit","aria-label":"open drawer",sx:{mr:2},onClick:()=>{W(!0)},children:t.jsx($t,{})}),!A&&t.jsx(je,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:t.jsx(Be,{to:"/",children:t.jsx(Er,{src:ge.brandLogo,sx:{width:50,height:50,mr:1,border:"1px solid #ccc"}})})}),!f&&y.length==0&&t.jsx(St,{variant:"h6",noWrap:!0,component:Be,to:"/",sx:{display:{xs:"none",sm:"block"},textDecoration:"none",textTransform:"none",color:"black",fontWeight:"bold"},children:ge.system_name}),(f||ge.appWithNoSidebar.includes(y))&&t.jsxs(St,{variant:"h6",noWrap:!0,component:Be,to:"/",sx:{display:{xs:"none",sm:"block"},textDecoration:"none",textTransform:"none",color:"black",fontWeight:"bold"},children:[ge.system_name," | ",J[y]||y]}),t.jsx(je,{sx:{flexGrow:1}}),t.jsx(je,{sx:{display:{xs:"flex",md:"flex"}},children:t.jsx(Tn,{})}),t.jsx(je,{sx:{display:{xs:"none",md:"none"}},children:t.jsx(Se,{size:"large","aria-label":"show more","aria-controls":T,"aria-haspopup":"true",onClick:G,color:"inherit",children:t.jsx(Ft,{})})})]})}),U,I,t.jsx(_r,{closable:!1,centered:!0,open:r,onOk:()=>{},onCancel:()=>{},footer:[],children:t.jsxs(je,{sx:{padding:"20px",textAlign:"center",fontSize:"1.4em"},children:[t.jsx("p",{children:"Your session has expired. Please log in again."}),t.jsx(Be,{to:"/login",children:t.jsx(ke,{children:"Login"})})]})})]})};export{ks as Header};
