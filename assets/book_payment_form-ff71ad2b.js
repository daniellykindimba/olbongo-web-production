import{r as a,F as h,j as e,bk as x,v as M,B as j,s as b,aa as m,T as B,I as N,J as p,K as f}from"./index-84802c99.js";const V=n=>{const[i,g]=a.useState(!1),[S,o]=a.useState(!1),[E,P]=a.useState(""),[v,k]=a.useState([]),[y,l]=a.useState(""),[F,c]=a.useState(!1),[C,u]=a.useState(!1),[I]=h.useForm(),q=async()=>{const{data:t}=await p.custom({url:"",method:"get",meta:{operation:"paymentSupportedTelecomCarriers",variables:{},fields:[{results:["id","name"]}]}}).catch(r=>({data:null})).then(r=>r);if(t){const r=t.results,s=[];r.forEach(d=>{s.push(d.name)}),k(s)}},z=async t=>{c(!0),u(!1);const{data:r}=await p.custom({url:"",method:"post",meta:{operation:"createBookPurchaseOrder",variables:{bookId:{value:t.book_id,type:"Int",required:!0},phone:{value:t.phone,type:"String",required:!0}},fields:["success","message"]}}).catch(s=>({data:null})).then(s=>s);r&&(r.success?(u(!0),f.success(r.message),n.onFinish()):f.error(r.message)),c(!1)},w=async t=>{g(!0);const{data:r}=await p.custom({url:"",method:"post",meta:{operation:"validateMobilePhoneNumber",variables:{phone:{value:t,type:"String",required:!0}},fields:["success","message","carrier","formattedPhone"]}}).catch(s=>(f.error("Error Validating Mobile Phone Number"),{data:null})).then(s=>s);return r&&(o(r.success),r.success||(P(r.message),l(r.carrier))),g(!1),r};return a.useEffect(()=>{q()},[n.randKey]),C?e.jsx(e.Fragment,{children:e.jsx(x,{type:"success",showIcon:!0,description:e.jsx(e.Fragment,{children:e.jsxs(M,{direction:"vertical",children:[e.jsxs("span",{style:{fontSize:22},children:["Please your phone, we have pushed payment request, you will be requested to Enter ",e.jsx("b",{children:"PIN"})," to authorize this payment."]}),e.jsx(j,{size:"large",onClick:()=>{u(!1),c(!1)},children:"Push Payment Again"})]})})})}):e.jsx(e.Fragment,{children:e.jsxs(b,{spinning:F,children:[e.jsx(x,{description:e.jsxs(e.Fragment,{children:["Payment is supported through"," ",e.jsx("span",{style:{fontSize:20},children:e.jsx("b",{children:v.join(",")})})]}),type:"info",showIcon:!0,style:{fontSize:22,marginBottom:10}}),e.jsxs(m,{title:"Payment For",column:1,labelStyle:{fontSize:22,fontWeight:"bold"},contentStyle:{fontSize:22},children:[e.jsx(m.Item,{label:"Book Name",children:n.book.title}),e.jsxs(m.Item,{label:"Cost",children:[n.book.price," Tsh"]})]}),e.jsxs(h,{layout:"vertical",form:I,onFinish:t=>{t.book_id=n.book.id,z(t)},requiredMark:!0,autoComplete:"off",children:[e.jsx(h.Item,{name:"phone",label:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Mobile Phone Number"}),y.length>0&&e.jsx(B,{color:"green",style:{marginLeft:10},children:y}),i&&e.jsx(b,{spinning:i})]}),rules:[{required:!0,type:"string",message:"Required"},{validator:async(t,r)=>{if(r.length>=10){if(!i){const s=await w(r).then(d=>d);if(s!=null&&s.success)l(s.carrier),o(!0);else return l(""),Promise.reject(s==null?void 0:s.message)}}else o(!1)}}],children:e.jsx(N,{size:"large",placeholder:"Mobile Phone Number ..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(j,{type:"primary",size:"large",htmlType:"submit",disabled:!S,children:"Pay"})})]})]})})};export{V as B};
