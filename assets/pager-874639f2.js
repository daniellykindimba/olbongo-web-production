import{r as s,c as L,j as e,G as D,a7 as le,aU as X,aw as w,cF as ee,b0 as W,cG as je,B as K,a_ as Q,af as G,aZ as q,aR as N,aX as te,b$ as se,a0 as H,g as O,_ as g,c7 as U,aP as v,aV as I,a$ as ce,cH as fe,cI as Te,cJ as xe,aT as be,aW as _,cv as Ae,cK as ye,cL as we,cM as Fe,cN as De,c9 as de,cO as ze,c4 as ke,aY as ve,aQ as Se,cs as J,cP as ie,cQ as Ee,cR as Me,cS as Oe}from"./index-ccfcd4da.js";import{B as ue}from"./book_payment_form-7d47c014.js";import{C as Y}from"./index-e733c2fd.js";import{A as re}from"./index-3bfb9ed3.js";import{A as ae}from"./index-7945450f.js";import{D as ne}from"./index-36291a54.js";import{P as qe}from"./pdf_document_viewer-45e7c6a7.js";import{L as oe}from"./index-885f566c.js";import{P as Z}from"./index-27f5ca3f.js";import{S as Le}from"./Skeleton-a2d4f426.js";import{D as V}from"./index-440571f1.js";import{d as Pe,C as Be}from"./ckeditor-6faf30fb.js";import{U as Ce}from"./index-200f56a0.js";import{I as Ie}from"./index-e9b3f5aa.js";import{G as Re}from"./index-efb9c68a.js";import{F as me}from"./index-b84643af.js";import"./index-8ddfcaf4.js";import"./InfoCircleFilled-f916d949.js";import"./index-5c2e1e93.js";import"./index-afc6ce50.js";import"./ActionButton-3b8e0c74.js";import"./Upload-a74f9032.js";import"./fade-dd39912a.js";import"./InputNumber-df6a3867.js";const{Search:Ve}=H,Ne=a=>{const[j,y]=s.useState(!1),[z,B]=s.useState(0),[T,F]=s.useState(0),[A,E]=s.useState(1),[b,C]=s.useState([]),[k,M]=s.useState(),[P,S]=s.useState(!1);L();const r=o=>{M(o),S(!0)},f=async o=>{const{data:x}=await O.custom({url:"",method:"post",meta:{operation:"addBookToReadings",variables:{bookId:{value:o,type:"Int",required:!0}},fields:["success","message",{book:["id","title","description","file","cover","price","downloadable","publisherCanAddToReadings","created","updated","isActive","isPublic","canEdit","canDelete","canManage","inLibrary",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}}).catch(()=>(g.error("Error deleting book"),{data:null})).then(c=>c);x&&(x.success?(g.success(x.message),C(b.map(c=>c.id===o?x.book:c))):g.error(x.message))},d=async(o,x="")=>{y(!0);const{data:c}=await O.custom({url:"",method:"get",meta:{operation:"marketplaceBooks",variables:{page:{value:o,type:"Int",required:!0},key:{value:x,type:"String",required:!1},public:{value:a.public,type:"Boolean",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","orderPaid","canEdit","canDelete","canManage","inLibrary",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}}).catch(()=>(g.error("Error getting Books"),{data:null})).then(m=>m);c&&(B(c.total),F(c.pages),E(c.page),C(c.results)),y(!1)};return s.useEffect(()=>{d(A,"")},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(D,{container:!0,spacing:0,sx:{display:"flex",justifyContent:"flex-start"},children:e.jsx(D,{item:!0,xs:12,sm:12,md:4,lg:4,xl:4,children:e.jsx(Ve,{size:"large",placeholder:"Search Book(s) ...",onSearch:o=>d(1,o),style:{width:"100%"}})})}),e.jsxs("div",{style:{maxHeight:"calc(100vh - 150px)",overflowY:"auto"},children:[e.jsx(le,{spinning:j,children:e.jsxs(D,{container:!0,spacing:0,children:[b.length===0&&j&&e.jsx(e.Fragment,{children:e.jsx(D,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:e.jsx(X,{description:"Loading Books"})})}),b.length===0&&!j&&e.jsx(e.Fragment,{children:e.jsx(D,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:e.jsx(X,{description:"No Book Published"})})}),b.map(o=>e.jsx(D,{item:!0,xs:12,sm:12,md:6,lg:6,xl:6,children:e.jsx(Y,{hoverable:!0,bordered:!0,style:{margin:"2px"},type:"inner",actions:[e.jsxs("span",{style:{fontSize:"18px",display:o.price>0?"block":"none"},children:[o.price," Tsh"]}),e.jsx("span",{style:{float:"right",marginRight:"10px",display:"flex"},children:o.isPublic?e.jsx(w,{disabled:o.inLibrary,size:"large",icon:e.jsx(ee,{}),onClick:()=>f(o.id),children:"Add to Readings"}):e.jsxs(e.Fragment,{children:[o.orderPaid&&e.jsx(e.Fragment,{children:e.jsx(W,{color:"green",children:"Already Purchased"})}),!o.orderPaid&&e.jsx(w,{size:"large",icon:e.jsx(je,{}),onClick:()=>r(o),children:"Buy"})]})})],children:e.jsxs(D,{container:!0,spacing:0,children:[e.jsx(D,{item:!0,xs:12,sm:12,md:4,sx:{backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+o.cover+")"},children:e.jsx(K,{sx:{display:{xs:"block",md:"none"},height:100,width:"100%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+o.cover+")"}})}),e.jsx(D,{item:!0,xs:12,sm:12,md:8,children:e.jsx(K,{style:{padding:"10px"},children:e.jsxs(Q,{direction:"vertical",children:[e.jsx("a",{children:e.jsx("h3",{children:o.title.length>50?o.title.substring(0,50)+"...":o.title})}),e.jsx("p",{children:o.description.replace(/(<([^>]+)>)/gi,"").length>100?o.description.replace(/(<([^>]+)>)/gi,"").substring(0,100)+"...":o.description.replace(/(<([^>]+)>)/gi,"")}),e.jsx("div",{children:e.jsx(Q,{children:e.jsx(G,{title:"Click to View Author Profile",children:e.jsxs("a",{children:[e.jsx(re,{size:"small",src:o.author.pic}),e.jsx("span",{style:{marginLeft:"10px"},children:o.author.fullName})]})})})})]})})})]})})}))]})}),b.length>0&&e.jsx(q,{children:e.jsx(N,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(te,{defaultCurrent:A,total:z})})})]}),e.jsx(se,{title:"Purchase Book",open:P,onClose:o=>S(o),width:"40vw",children:e.jsx(ue,{book:k,randKey:Math.random(),onFinish:()=>{S(!1),d(1,"")}})})]})},He=()=>{const{push:a}=L();return s.useEffect(()=>{document.title=U.system_name+": Books MarketPlace"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(v,{children:[e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib"),children:"Home"})}),e.jsx(v.Item,{children:"Books MarketPlace"})]})}),e.jsx(Ne,{public:!1,randKey:Math.random()})]})},Ke=()=>{const{push:a}=L();return s.useEffect(()=>(document.title=U.system_name+": Public Books",document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(v,{children:[e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib"),children:"Home"})}),e.jsx(v.Item,{children:"Public Books"})]})}),e.jsx(Ne,{public:!0,randKey:Math.random()})]})},{Search:_e}=H,Ge=a=>{const[j,y]=s.useState(!1),[z,B]=s.useState(0),[T,F]=s.useState(0),[A,E]=s.useState(1),[b,C]=s.useState(25),[k,M]=s.useState(""),[P,S]=s.useState([]);s.useState(),I.useForm(),s.useState(!1);const[r,f]=s.useState(!1);L();const d=async(x,c="",m=25)=>{y(!0);const{data:h}=await O.custom({url:"",method:"get",meta:{operation:"authorBooksPurchases",variables:{page:{value:x,type:"Int",required:!0},key:{value:c,type:"String",required:!1},pageSize:{value:m,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","price","paymentDate","receiptNumber","isPaid",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]},{user:["id","firstName","middleName","lastName"]},{bill:["id","billNumber"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(l=>(g.error("Error getting Bills"),{data:null})).then(l=>l);h&&(B(h.total),F(h.pages),E(h.page),S(h.results)),y(!1)},o=[{title:"Bill#",dataIndex:"billNumber",fixed:!0,render:(x,c,m)=>{var h;return e.jsx("span",{children:e.jsx("a",{children:(h=c==null?void 0:c.bill)==null?void 0:h.billNumber})})}},{title:"Book Title",dataIndex:"bookTitle",fixed:!0,render:(x,c,m)=>{var h;return e.jsx("span",{children:e.jsx("a",{children:(h=c==null?void 0:c.book)==null?void 0:h.title})})}},{title:"Amount",dataIndex:"billAmount",fixed:!0,render:(x,c,m)=>e.jsxs("span",{children:[c.price," Tsh"]})}];return s.useEffect(()=>{d(A,"",25)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{offsetTop:75,children:e.jsxs(q,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:[e.jsx(N,{span:10,children:e.jsx(_e,{size:"large",placeholder:"Search Disbursement(s) ...",onSearch:x=>d(1,x,25),style:{width:"100%"}})}),e.jsx(N,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{icon:e.jsx(ee,{}),size:"large",onClick:()=>f(!0),children:"Create Disbursement"})})]})}),e.jsx(q,{children:e.jsx(N,{span:24,children:e.jsx(ce,{loading:j,columns:o,dataSource:P,pagination:{onChange:(x,c)=>{C(c),d(x,k,c)},total:z,pageSize:b,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})})}),e.jsx(se,{title:"Creating Dibursement",width:"35vw",open:r,onClose:x=>f(x),children:e.jsx("p",{children:"Creating Dibursement"})})]})},Ue=()=>{const{push:a}=L();return s.useEffect(()=>{document.title=U.system_name+": Books Purchases Disbursement"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(v,{children:[e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib"),children:"Home"})}),e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib/publish/books"),children:"Published Books"})}),e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib/books/purchases"),children:"Books Purchases"})}),e.jsx(v.Item,{children:"Books Purchases Disbursement"})]})}),e.jsx(Ge,{})]})},{Search:$e}=H,We=a=>{const[j,y]=s.useState(!1),[z,B]=s.useState(0),[T,F]=s.useState(0),[A,E]=s.useState(1),[b,C]=s.useState(25),[k,M]=s.useState(""),[P,S]=s.useState([]),[r,f]=s.useState();I.useForm();const[d,o]=s.useState(!1),{push:x}=L(),c=async(h,l="",n=25)=>{y(!0);const{data:t}=await O.custom({url:"",method:"get",meta:{operation:"authorBooksPurchases",variables:{page:{value:h,type:"Int",required:!0},key:{value:l,type:"String",required:!1},pageSize:{value:n,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","price","paymentDate","receiptNumber","isPaid",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]},{user:["id","firstName","middleName","lastName"]},{bill:["id","billNumber"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(u=>(g.error("Error getting Bills"),{data:null})).then(u=>u);t&&(B(t.total),F(t.pages),E(t.page),S(t.results)),y(!1)},m=[{title:"Bill#",dataIndex:"billNumber",fixed:!0,render:(h,l,n)=>{var t;return e.jsx("span",{children:e.jsx("a",{children:(t=l==null?void 0:l.bill)==null?void 0:t.billNumber})})}},{title:"Book Title",dataIndex:"bookTitle",fixed:!0,render:(h,l,n)=>{var t;return e.jsx("span",{children:e.jsx("a",{children:(t=l==null?void 0:l.book)==null?void 0:t.title})})}},{title:"Amount",dataIndex:"billAmount",fixed:!0,render:(h,l,n)=>e.jsxs("span",{children:[l.price," Tsh"]})}];return s.useEffect(()=>{c(A,"",25)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{offsetTop:75,children:e.jsxs(q,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:[e.jsx(N,{span:10,children:e.jsx($e,{size:"large",placeholder:"Search Purchase(s) ...",onSearch:h=>c(1,h,25),style:{width:"100%"}})}),e.jsx(N,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{icon:e.jsx(fe,{}),size:"large",onClick:()=>x("/olib/books/purchases/disbursements"),children:"Disbursement"})})]})}),e.jsx(q,{children:e.jsx(N,{span:24,children:e.jsx(ce,{loading:j,columns:m,dataSource:P,pagination:{onChange:(h,l)=>{C(l),c(h,k,l)},total:z,pageSize:b,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})})}),e.jsx(se,{title:"Order Details & Payment",open:d,width:"50vw",onClose:h=>o(h),children:e.jsx(ue,{book:r==null?void 0:r.book})})]})},Ye=()=>{const{push:a}=L();return s.useEffect(()=>{document.title=U.system_name+": Books Purchases"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(v,{children:[e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib"),children:"Home"})}),e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib/publish/books"),children:"Published Books"})}),e.jsx(v.Item,{children:"Books Purchases"})]})}),e.jsx(We,{})]})},{Search:Ze}=H,Qe=a=>{const[j,y]=s.useState(!1),[z,B]=s.useState(!1),[T,F]=s.useState(),[A,E]=s.useState(0),[b,C]=s.useState(0),[k,M]=s.useState(1),[P,S]=s.useState([]),[r,f]=s.useState(),[d,o]=s.useState(!1);I.useForm();const{push:x}=L(),c=t=>{f(t),o(!0)},m=async(t,u="")=>{y(!0);const{data:p}=await O.custom({url:"",method:"get",meta:{operation:"userBooks",variables:{page:{value:t,type:"Int",required:!0},key:{value:u,type:"String",required:!1},pageSize:{value:20,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","averageRating","downloadable","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}]}}).catch(()=>(g.error("Error getting Books"),{data:null})).then(i=>i);p&&(E(p.total),C(p.pages),M(p.page),S(p.results)),y(!1)},h=async()=>{B(!0);const{data:t}=await O.custom({url:"",method:"get",meta:{operation:"olibDashboardAnalytics",fields:["analytics"]}}).catch(()=>(g.error("Error fetching analytics"),{data:null})).then(u=>u);t&&F(t.analytics),B(!1)},l=async(t,u)=>{const{data:p}=await O.custom({url:"",method:"post",meta:{operation:"createBookRating",variables:{bookId:{value:u,type:"Int",required:!0},rating:{value:t,type:"Int",required:!0}},fields:["success","message",{userBook:["id",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","averageRating","downloadable","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}]}}).catch(i=>(console.log(i),{data:null})).then(i=>i);if(p){const i=P.map(R=>R.id===p.userBook.id?p.userBook:R);S(i)}},n=(t,u)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Rated: "}),e.jsxs("span",{children:[[1,2,3,4,5].map(p=>e.jsx("span",{style:{marginRight:5},children:p<=t?e.jsx(G,{title:p,children:e.jsx("a",{onClick:()=>{l(p,u)},style:{display:"inline"},children:e.jsx(we,{style:{color:"orange"}})})}):e.jsx(G,{title:p,children:e.jsx("a",{onClick:()=>{l(p,u)},style:{display:"inline"},children:e.jsx(Fe,{})})})})),e.jsx(W,{color:"green",children:t})]})]});return s.useEffect(()=>{h(),m(k,"")},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(K,{children:e.jsxs(D,{container:!0,spacing:0,children:[e.jsx(D,{item:!0,xs:6,sm:6,md:2,children:e.jsx("a",{onClick:()=>x("/olib"),children:e.jsxs(Y,{children:[e.jsx(W,{children:T==null?void 0:T.my_books})," Books To Read"]})})}),e.jsx(D,{item:!0,xs:6,sm:6,md:2,children:e.jsx("a",{onClick:()=>x("/olib/books/public"),children:e.jsxs(Y,{style:{cursor:"pointer"},children:[e.jsx(W,{children:T==null?void 0:T.public_books})," Public Books"]})})})]})}),e.jsx(ae,{offsetTop:75,children:e.jsx(K,{sx:{display:"flex",justifyContent:"center",mt:1,mb:1},children:e.jsx(D,{container:!0,spacing:0,sx:{display:"flex",justifyContent:"flex-start"},children:e.jsx(D,{item:!0,xs:12,sm:4,md:6,children:e.jsx(Ze,{size:"large",placeholder:"Enter Book Title, Description to search ...",onSearch:t=>m(1,t),style:{width:"100%"}})})})})}),e.jsx("div",{style:{maxHeight:"calc(100vh - 240px)",overflowY:"auto"},children:e.jsxs(le,{spinning:j,children:[e.jsxs(D,{container:!0,spacing:0,children:[P.length===0&&!j&&e.jsx(e.Fragment,{children:e.jsx(D,{item:!0,xs:12,sm:12,md:12,children:e.jsx(X,{description:"No Book Published"})})}),P.map(t=>e.jsx(D,{item:!0,xs:12,sm:12,md:6,children:e.jsx(Y,{hoverable:!0,bordered:!0,style:{margin:"2px"},type:"inner",actions:[e.jsx("span",{children:n(t.book.averageRating,t.book.id)}),e.jsxs("span",{style:{float:"right",marginRight:"10px",display:"flex"},children:[t.book.downloadable&&e.jsx(w,{icon:e.jsx(Te,{}),children:e.jsx("a",{href:t.book.file,target:"_blank",download:!0,children:"Download"})}),e.jsx(w,{style:{marginRight:"10px"},icon:e.jsx(xe,{}),onClick:()=>c(t),children:"Read"}),e.jsx(be,{trigger:["click"],overlay:e.jsxs(_,{children:[e.jsx(_.Item,{icon:e.jsx(xe,{}),onClick:()=>c(t),children:e.jsx("a",{rel:"noopener noreferrer",children:"Read"})}),e.jsx(_.Item,{icon:e.jsx(Ae,{}),onClick:()=>g("Under construction"),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:u=>u.preventDefault(),children:e.jsx(ye,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})]})],children:e.jsxs(D,{container:!0,spacing:0,children:[e.jsx(D,{item:!0,xs:12,sm:12,md:4,sx:{backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+t.book.cover+")"},children:e.jsx(K,{sx:{display:{xs:"block",md:"none"},height:100,width:"100%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+t.book.cover+")"}})}),e.jsx(D,{item:!0,xs:12,sm:12,md:8,children:e.jsx(K,{style:{padding:"10px"},children:e.jsxs(Q,{direction:"vertical",children:[e.jsx("a",{children:e.jsx("h3",{children:t.book.title.length>50?t.book.title.substring(0,50)+"...":t.book.title})}),e.jsx("p",{children:t.book.description.replace(/(<([^>]+)>)/gi,"").length>100?t.book.description.replace(/(<([^>]+)>)/gi,"").substring(0,100)+"...":t.book.description.replace(/(<([^>]+)>)/gi,"")}),e.jsx("div",{children:e.jsx(Q,{children:e.jsx(G,{title:"Click to View Author Profile",children:e.jsxs("a",{children:[e.jsx(re,{size:"small",src:t.book.author.pic}),e.jsx("span",{style:{marginLeft:"10px"},children:t.book.author.fullName})]})})})})]})})})]})})}))]}),e.jsx(q,{children:e.jsx(N,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(te,{defaultCurrent:k,total:A,defaultPageSize:20,onChange:t=>{M(t),m(t,"")}})})})]})}),e.jsx(ne,{title:r==null?void 0:r.book.title,anchor:"right",width:"80vw",onClose:t=>o(t),open:d,noOverFlow:!0,children:e.jsx(qe,{url:r==null?void 0:r.book.file,onFullWidth:()=>{alert("fullWidth")}})})]})},Je=()=>{const{push:a}=L();return s.useEffect(()=>(document.title=U.system_name+": Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(v,{children:[e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib"),children:"Home"})}),e.jsx(v.Item,{children:"Dashboard"})]})}),e.jsx(Qe,{})]})},{Search:Xe}=H,et=a=>{const[j,y]=s.useState(!0),[z,B]=s.useState(!1),[T,F]=s.useState(0),[A,E]=s.useState(0),[b,C]=s.useState(1),[k,M]=s.useState(25),[P,S]=s.useState(""),[r,f]=s.useState(!1),[d,o]=s.useState([]);L();const x=async(m,h="",l=25)=>{B(!0);const{data:n}=await O.custom({url:"",method:"get",meta:{operation:"booksAuthorsToAdd",variables:{page:{value:m,type:"Int",required:!0},key:{value:h,type:"String",required:!1},pageSize:{value:l,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","firstName","middleName","lastName","fullName","email","pic","isActive","created","updated","canDelete","canManage"]}]}}).catch(()=>(g.error("Error getting authors"),{data:null})).then(t=>t);n&&(F(n.total),E(n.pages),C(n.page),f(n.hasNext),o([...n.results])),B(!1)},c=async m=>{const{data:h}=await O.custom({url:"",method:"post",meta:{operation:"addBooksAuthor",variables:{authorId:{value:m,type:"Int",required:!0}},fields:["success","message",{bookAuthor:["id",{user:["id","firstName","middleName","lastName","fullName","email","pic","isActive","created","updated","canDelete","canManage"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(()=>(g.error("Error Adding Author"),{data:null})).then(l=>l);h&&(h.success?(g.success(h.message),o(d.filter(l=>parseInt(l.id.toString())!==m)),a.onAdd(h.bookAuthor)):g.error(h.message)),B(!1)};return s.useEffect(()=>{x(b,P,k),y(!1)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{offsetTop:90,children:e.jsx(q,{style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(N,{span:10,children:e.jsx(Xe,{size:"large",placeholder:"Search Purchase(s) ...",onSearch:m=>{S(m),x(1,m,k)},style:{width:"100%"}})})})}),e.jsx("div",{style:{maxHeight:"80vh",minHeight:"80vh",overflowY:"auto",overflowX:"hidden",marginTop:"10px"},children:e.jsx(oe,{itemLayout:"horizontal",dataSource:d,renderItem:m=>e.jsx(oe.Item,{actions:[e.jsx(Z,{title:"Adding Books Author??",onConfirm:()=>c(parseInt(m.id.toString())),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(w,{icon:e.jsx(ee,{}),size:"large"})})],children:e.jsx(Le,{avatar:!0,title:!1,loading:z,active:!0,children:e.jsx(oe.Item.Meta,{avatar:e.jsx(re,{src:m.pic}),title:e.jsx("a",{children:m.fullName}),description:e.jsx(e.Fragment,{children:e.jsx(W,{color:"green",children:m.email})})})})})})}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(te,{defaultCurrent:b,total:T,pageSize:25,onChange:(m,h)=>{M(h),C(m),x(m,P,h)}})})]})},{Search:tt}=H,st=a=>{const[j,y]=s.useState(!1),[z,B]=s.useState(0),[T,F]=s.useState(0),[A,E]=s.useState(1),[b,C]=s.useState([]);s.useState(),s.useState(!1);const[k,M]=s.useState(!1),[P,S]=s.useState(!1);I.useForm(),L();const r=async(d,o="")=>{y(!0);const{data:x}=await O.custom({url:"",method:"get",meta:{operation:"vertedBooksPublishers",variables:{page:{value:d,type:"Int",required:!0},key:{value:o,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{user:["id","firstName","lastName","middleName","fullName","email","pic"]},"canEdit","canDelete","canManage"]}]}}).catch(c=>(g.error("Error getting Books"),{data:null})).then(c=>c);x&&(B(x.total),F(x.pages),E(x.page),C(x.results)),y(!1)},f=async d=>{C([d,...b])};return s.useEffect(()=>{r(A,"")},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(q,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:[e.jsx(N,{span:10,children:e.jsx(tt,{size:"large",placeholder:"Search Purchase(s) ...",onSearch:d=>r(1,d),style:{width:"100%"}})}),e.jsx(N,{span:14,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{icon:e.jsx(ee,{}),size:"large",onClick:()=>M(!0),children:"Add Authors"})})]}),e.jsx(le,{spinning:j,children:e.jsxs(q,{children:[b.length===0&&e.jsx(e.Fragment,{children:e.jsx(N,{span:24,children:e.jsx(X,{description:"No Book Published"})})}),b.map(d=>e.jsx(N,{span:6,children:e.jsx(Y,{hoverable:!0,bordered:!0,style:{margin:"2px"},bodyStyle:{minHeight:100,maxHeight:100},actions:[e.jsx(w,{disabled:!0,size:"large",children:"100 Books"}),e.jsx(G,{title:"View Authors Details",color:"green",children:e.jsx(w,{icon:e.jsx(De,{}),size:"large",onClick:()=>S(!0)})}),e.jsx("span",{style:{background:"red"},children:d.canDelete&&e.jsx(Z,{title:"Delete the Author",okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(w,{size:"large",icon:e.jsx(de,{})})})})],children:e.jsx(q,{children:e.jsx(N,{span:24,style:{padding:"10px"},children:e.jsx(Q,{direction:"horizontal",children:e.jsxs("a",{children:[e.jsx(re,{src:d.user.pic,size:"large"}),e.jsx("span",{style:{marginLeft:10},children:d.user.fullName})]})})})})})},d.id))]})}),e.jsx(q,{children:e.jsx(N,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(te,{defaultCurrent:A,total:z})})}),e.jsx(ne,{title:"Adding Authors",anchor:"right",width:"50vw",onClose:d=>M(d),open:k,noOverFlow:!0,children:e.jsx(et,{randKey:Math.random(),onAdd:f})}),e.jsx(ne,{title:"Author Details",width:"50vw",anchor:"right",onClose:d=>S(d),open:P,children:e.jsxs(e.Fragment,{children:[e.jsxs(V,{title:"Author Info",children:[e.jsx(V.Item,{label:"UserName",children:"Zhou Maomao"}),e.jsx(V.Item,{label:"Telephone",children:"1810000000"}),e.jsx(V.Item,{label:"Live",children:"Hangzhou, Zhejiang"}),e.jsx(V.Item,{label:"Remark",children:"empty"}),e.jsx(V.Item,{label:"Address",children:"No. 18, Wantang Road, Xihu District, Hangzhou, Zhejiang, China"})]}),e.jsxs(V,{title:"Author Company Info",children:[e.jsx(V.Item,{label:"UserName",children:"Zhou Maomao"}),e.jsx(V.Item,{label:"Telephone",children:"1810000000"}),e.jsx(V.Item,{label:"Live",children:"Hangzhou, Zhejiang"}),e.jsx(V.Item,{label:"Remark",children:"empty"}),e.jsx(V.Item,{label:"Address",children:"No. 18, Wantang Road, Xihu District, Hangzhou, Zhejiang, China"})]})]})})]})},rt=()=>{const{push:a}=L();return s.useEffect(()=>{document.title=U.system_name+": Books Authors"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(v,{children:[e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib"),children:"Home"})}),e.jsx(v.Item,{children:"Books Authors"})]})}),e.jsx(st,{randKey:Math.random()})]})},{Search:at}=H,it=a=>{const[j,y]=s.useState(!1),[z,B]=s.useState(0),[T,F]=s.useState(0),[A,E]=s.useState(1),[b,C]=s.useState(25),[k,M]=s.useState(""),[P,S]=s.useState([]),[r,f]=s.useState();I.useForm();const[d,o]=s.useState(!1);L();const x=async l=>{f(l),o(!0)},c=async(l,n="",t=25)=>{y(!0);const{data:u}=await O.custom({url:"",method:"get",meta:{operation:"myBooksOrders",variables:{page:{value:l,type:"Int",required:!0},key:{value:n,type:"String",required:!1},pageSize:{value:t,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","price","paymentDate","receiptNumber","isPaid",{book:["id","title","description","file","cover","price","created","updated","isActive","isPublic","hasPurchaseOrder","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]},{user:["id","firstName","middleName","lastName"]},{bill:["id","billNumber"]},"isActive","created","updated","canDelete","canManage"]}]}}).catch(p=>(g.error("Error getting Bills"),{data:null})).then(p=>p);u&&(B(u.total),F(u.pages),E(u.page),S(u.results)),y(!1)},m=async l=>{const{data:n}=await O.custom({url:"",method:"post",meta:{operation:"deleteBookOrder",variables:{id:{value:l,type:"Int",required:!0}},fields:["success","message"]}}).catch(t=>(g.error("Error deleting Order"),{data:null})).then(t=>t);n&&S(P.filter(t=>t.id!==l))},h=[{title:"Bill#",dataIndex:"billNumber",fixed:!0,render:(l,n,t)=>{var u;return e.jsx("span",{children:e.jsx("a",{children:(u=n==null?void 0:n.bill)==null?void 0:u.billNumber})})}},{title:"Book Title",dataIndex:"bookTitle",fixed:!0,render:(l,n,t)=>{var u;return e.jsx("span",{children:e.jsx("a",{children:(u=n==null?void 0:n.book)==null?void 0:u.title})})}},{title:"Bill Amount",dataIndex:"billAmount",fixed:!0,render:(l,n,t)=>e.jsxs("span",{children:[n.price," Tsh"]})},{title:"Paid",dataIndex:"isPaid",fixed:!0,render:(l,n,t)=>e.jsx("span",{children:n.isPaid?e.jsx(W,{color:"green",children:"Yes"}):e.jsx(W,{color:"red",children:"No"})})},{title:"Created",dataIndex:"created",render:(l,n,t)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(n.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(l,n,t)=>e.jsx("a",{children:n!=null&&n.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(l,n,t)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[!n.isPaid&&e.jsx(Z,{title:"Are you sure to delete this Order?",onConfirm:()=>m(n.id),okText:"Yes",cancelText:"No",disabled:!(n!=null&&n.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(w,{icon:e.jsx(de,{}),disabled:!(n!=null&&n.canDelete),size:"large"})}),n.isPaid&&e.jsx(G,{title:"Print Receipt",children:e.jsx(w,{icon:e.jsx(ze,{}),size:"large"})}),!n.isPaid&&e.jsx(G,{title:"View Order Details",placement:"topLeft",children:e.jsx(w,{icon:e.jsx(fe,{}),size:"large",onClick:()=>x(n)})})]})}];return s.useEffect(()=>{c(A,"",25)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{offsetTop:75,children:e.jsx(q,{style:{display:"flex",justifyContent:"flex-start",marginTop:20},children:e.jsx(N,{span:10,children:e.jsx(at,{size:"large",placeholder:"Search Bill(s) ...",onSearch:l=>c(1,l,25),style:{width:"100%"}})})})}),e.jsx(q,{children:e.jsx(N,{span:24,children:e.jsx(ce,{loading:j,columns:h,dataSource:P,pagination:{onChange:(l,n)=>{C(n),c(l,k,n)},total:z,pageSize:b,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})})}),e.jsx(se,{title:"Order Details & Payment",open:d,width:"50vw",onClose:l=>o(l),children:e.jsx(ue,{book:r==null?void 0:r.book})})]})},nt=()=>{const{push:a}=L();return s.useEffect(()=>{document.title=U.system_name+": Books Orders"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(v,{children:[e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib"),children:"Home"})}),e.jsx(v.Item,{children:"Books Orders"})]})}),e.jsx(it,{})]})},pe=[".pdf"],lt=a=>Array.isArray(a)?a:a==null?void 0:a.fileList,ot=a=>{const[j,y]=s.useState(""),[z,B]=s.useState(!1),[T,F]=s.useState(!1),[A,E]=s.useState(!1),[b,C]=s.useState(""),[k]=I.useForm(),M=[{label:"Public (Free)",value:!0},{label:"Private (Payable or Rentable)",value:!1}],P=async r=>{B(!0);const{data:f}=await O.custom({url:"",method:"post",meta:{operation:"publishBook",variables:{file:{value:r.file,type:"Upload",required:!0},title:{value:r.title,type:"String",required:!0},description:{value:r.description,type:"String",required:!0},price:{value:r.price,type:"Float",required:!1},isPublic:{value:r.is_public,type:"Boolean",required:!0},downloadable:{value:r.downloadable,type:"Boolean",required:!1}},fields:["success","message"]}}).catch(d=>(g.error("Error creating publishing book"),{data:null})).then(d=>d);f&&(f.success?(g.success(f.message),a.onFinish()):g.error(f.message)),B(!1)},S=r=>(r=r.replace(/[-_]/g," "),r=r.replace(/.pdf/g,""),r=r.replace(/[.]/g," "),r=r.replace(/\s+/g," "),r=r.trim(),r);return e.jsx(e.Fragment,{children:e.jsx(le,{spinning:z,children:e.jsxs(I,{layout:"vertical",form:k,onFinish:r=>{r.price=r.price??0,r.downloadable=A,r.description=b,P(r)},requiredMark:!0,children:[e.jsx(I.Item,{label:"Pick a Book ("+pe.join()+")",children:e.jsx(I.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:r=>{var d,o;y((d=r==null?void 0:r.file)==null?void 0:d.name);const f=(o=r==null?void 0:r.file)==null?void 0:o.name.split(".");return f.pop(),k.setFieldsValue({title:S(f.join("."))}),lt(r)},noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload Book file"}],children:e.jsxs(Ce.Dragger,{name:"file",accept:pe.join(),multiple:!1,maxCount:1,beforeUpload:()=>!1,onRemove:()=>{y(""),k.setFieldsValue({title:""})},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ke,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})})}),e.jsx(I.Item,{name:"title",label:"Book Title",initialValue:j,rules:[{required:!0,type:"string"}],children:e.jsx(H,{size:"large",placeholder:"Enter Book Title ..."})}),e.jsx(I.Item,{name:"is_public",label:"Availability",initialValue:!0,children:e.jsx(ve.Group,{options:M,onChange:r=>{F(!r.target.value)},value:!0})}),T&&e.jsx(I.Item,{label:"Book Cost (Tsh)",name:"price",rules:[{required:T,type:"number",min:1e3,message:"Price must be greater than 1000"}],children:e.jsx(Ie,{style:{width:"50%"},size:"large"})}),e.jsx(I.Item,{name:"downloadable",valuePropName:"checked",children:e.jsx(Se,{onChange:r=>{E(r.target.checked)},children:"Downloadable"})}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h3",{children:"Description"}),e.jsx(Pe.CKEditor,{disabled:z,editor:Be,data:b,onReady:r=>{r.editing.view.change(f=>{f.setStyle("min-height","100px",r.editing.view.document.getRoot())})},onChange:(r,f)=>{const d=f.getData();C(d)},config:{toolbar:{items:["bold","italic","strikethrough","underline","code","subscript","superscript","removeFormat","|","bulletedList","numberedList","todoList","|","outdent","indent","|","-","fontSize","fontFamily","fontColor","fontBackgroundColor","highlight","|","alignment","|","EmojiPanel"],shouldNotGroupWhenFull:!0},fontFamily:{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0}}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{type:"primary",size:"large",htmlType:"submit",loading:z,children:"Publish"})})]})})})},ge=[".pdf"],ct=a=>Array.isArray(a)?a:a==null?void 0:a.fileList,dt=a=>{var o,x,c,m,h,l,n,t,u,p;const[j,y]=s.useState(0),[z,B]=s.useState(""),[T,F]=s.useState(!1),[A,E]=s.useState(!1),[b,C]=s.useState(!1),[k,M]=s.useState(""),[P]=I.useForm(),[S]=I.useForm(),r=[{label:"Public (Free)",value:!0},{label:"Private (Payable or Rentable)",value:!1}],f=async i=>{F(!0);const{data:R}=await O.custom({url:"",method:"post",meta:{operation:"publishBook",variables:{file:{value:i.file,type:"Upload",required:!0},title:{value:i.title,type:"String",required:!0},description:{value:i.description,type:"String",required:!0},price:{value:i.price,type:"Float",required:!1},isPublic:{value:i.is_public,type:"Boolean",required:!0},downloadable:{value:i.downloadable,type:"Boolean",required:!1}},fields:["success","message"]}}).catch($=>(g.error("Error creating publishing book"),{data:null})).then($=>$);R&&(R.success?(g.success(R.message),a.onFinish()):g.error(R.message)),F(!1)},d=i=>(i=i.replace(/[-_]/g," "),i=i.replace(/.pdf/g,""),i=i.replace(/[.]/g," "),i=i.replace(/\s+/g," "),i=i.trim(),i);return e.jsxs(e.Fragment,{children:[e.jsxs(K,{sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(w,{onClick:()=>y(0),children:"Book Info"}),e.jsx(w,{onClick:()=>y(1),children:"Edit Book Basic Info"}),e.jsx(w,{onClick:()=>y(2),children:"Edit Book Cover Image"})]}),j===0&&e.jsx(e.Fragment,{children:e.jsxs(K,{sx:{width:"100%"},children:[e.jsxs(J,{variant:"h4",gutterBottom:!0,children:[e.jsx("b",{children:"Title"}),": ",(o=a.book)==null?void 0:o.title,e.jsx(ie,{})]}),e.jsxs(J,{variant:"h5",gutterBottom:!0,children:[e.jsx("b",{children:"Availability"}),": ",(x=a.book)!=null&&x.isPublic?"Public":"Private",e.jsx(ie,{})]}),e.jsxs(J,{variant:"h5",gutterBottom:!0,children:[e.jsx("b",{children:"Downloadable"}),": ",(c=a.book)!=null&&c.downloadable?"Yes":"No",e.jsx(ie,{})]}),e.jsxs(J,{variant:"h5",gutterBottom:!0,children:[e.jsx("b",{children:"Price"}),": ",(m=a.book)==null?void 0:m.price," Tsh",e.jsx(ie,{})]}),e.jsxs(J,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Description"}),": ",(h=a.book)==null?void 0:h.description]})]})}),j===1&&e.jsxs(I,{layout:"vertical",form:S,onFinish:i=>{i.price=i.price??0,i.downloadable=b,i.description=k,f(i)},requiredMark:!0,initialValues:{title:(l=a.book)==null?void 0:l.title,is_public:(n=a.book)==null?void 0:n.isPublic,price:(t=a.book)==null?void 0:t.price,downloadable:(u=a.book)==null?void 0:u.downloadable},children:[e.jsx(I.Item,{name:"title",label:"Book Title",initialValue:z,rules:[{required:!0,type:"string"}],children:e.jsx(H,{size:"large",placeholder:"Enter Book Title ..."})}),e.jsx(I.Item,{name:"is_public",label:"Availability",initialValue:!0,children:e.jsx(ve.Group,{options:r,onChange:i=>{E(!i.target.value)},value:!0})}),!((p=a.book)!=null&&p.isPublic)&&e.jsx(I.Item,{label:"Book Cost (Tsh)",name:"price",rules:[{required:A,type:"number",min:0}],children:e.jsx(Ie,{style:{width:"50%"},size:"large"})}),e.jsx(I.Item,{name:"downloadable",valuePropName:"checked",children:e.jsx(Se,{onChange:i=>{C(i.target.checked)},children:"Downloadable"})}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h3",{children:"Description"}),e.jsx(Pe.CKEditor,{disabled:T,editor:Be,data:k,onReady:i=>{i.editing.view.change(R=>{R.setStyle("min-height","100px",i.editing.view.document.getRoot())})},onChange:(i,R)=>{const $=R.getData();M($)},config:{toolbar:{items:["bold","italic","strikethrough","underline","code","subscript","superscript","removeFormat","|","bulletedList","numberedList","todoList","|","outdent","indent","|","-","fontSize","fontFamily","fontColor","fontBackgroundColor","highlight","|","alignment","|","EmojiPanel"],shouldNotGroupWhenFull:!0},fontFamily:{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0}}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{type:"primary",size:"large",htmlType:"submit",loading:T,children:"Publish"})})]}),j===2&&e.jsx(I,{layout:"vertical",form:P,onFinish:i=>{i.price=i.price??0,i.downloadable=b,i.description=k,f(i)},requiredMark:!0,children:e.jsx(I.Item,{label:"Pick a Book ("+ge.join()+")",children:e.jsx(I.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:i=>{var $,he;B(($=i==null?void 0:i.file)==null?void 0:$.name);const R=(he=i==null?void 0:i.file)==null?void 0:he.name.split(".");return R.pop(),P.setFieldsValue({title:d(R.join("."))}),ct(i)},noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload Book file"}],children:e.jsxs(Ce.Dragger,{name:"file",accept:ge.join(),multiple:!1,maxCount:1,beforeUpload:()=>!1,onRemove:()=>{B(""),P.setFieldsValue({title:""})},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ke,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})})})})]})},{Search:ut}=H,ht=a=>{const[j,y]=s.useState(!1);s.useState(!1);const[z,B]=s.useState(0),[T,F]=s.useState(0),[A,E]=s.useState(1),[b,C]=s.useState([]),[k,M]=s.useState();I.useForm();const[P,S]=s.useState(!1),[r,f]=s.useState(!1),{push:d}=L();Re.useBreakpoint().lg;const x=async t=>{M(t),f(!0)},c=async()=>{l(1,""),S(!1)},m=async(t,u)=>{const{data:p}=await O.custom({url:"",method:"post",meta:{operation:"publishUnpublishBook",variables:{bookId:{value:t,type:"Int",required:!0},published:{value:u,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(()=>(g.remove(),u?g.error("Error publishing book"):g.error("Error unpublishing book"),{data:null})).then(i=>i);p&&(p.success?(g.success(p.message),C(b.map(i=>(i.id===t&&(i.published=u),i)))):g.error(p.message))},h=async t=>{const{data:u}=await O.custom({url:"",method:"post",meta:{operation:"deleteBook",variables:{bookId:{value:t,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(g.error("Error deleting book"),{data:null})).then(p=>p);u&&(u.success?(g.success(u.message),C(b.filter(p=>p.id!==t))):g.error(u.message))},l=async(t,u="")=>{y(!0);const{data:p}=await O.custom({url:"",method:"get",meta:{operation:"publisherBooks",variables:{page:{value:t,type:"Int",required:!0},key:{value:u,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","file","cover","price","downloadable","publisherCanAddToReadings","published","created","updated","isActive","isPublic","canEdit","canDelete","canManage",{author:["id","firstName","lastName","middleName","fullName","email","pic"]}]}]}}).catch(()=>(g.error("Error getting Books"),{data:null})).then(i=>i);p&&(B(p.total),F(p.pages),E(p.page),C(p.results)),y(!1)},n=async()=>{const{data:t}=await O.custom({url:"",method:"get",meta:{operation:"checkIfVertedBookPublisher",variables:{},fields:["data"]}}).catch(()=>(g.error("Error getting Books"),{data:null})).then(u=>u);t&&console.log(t)};return s.useEffect(()=>{n(),l(A,"")},[]),e.jsxs(e.Fragment,{children:[e.jsxs(me,{children:[e.jsx(ut,{size:"large",placeholder:"Enter Book Title, Description to search ...",onSearch:t=>l(1,t),style:{width:"100%"}}),e.jsxs(me,{children:[e.jsx(w,{size:"large",style:{float:"right"},icon:e.jsx(je,{}),onClick:()=>d("/olib/books/purchases"),children:"Purchases"}),e.jsx(w,{size:"large",style:{float:"right"},icon:e.jsx(ee,{}),onClick:()=>S(!0),children:"Publish"})]})]}),e.jsxs(q,{children:[b.length===0&&e.jsx(N,{span:24,children:e.jsx(X,{description:"No Book Published"})}),b.map(t=>e.jsx(N,{span:12,xs:24,xl:12,xxl:12,children:e.jsx(Y,{hoverable:!0,bordered:!0,style:{margin:"2px"},bodyStyle:{minHeight:190,maxHeight:190},type:"inner",actions:[e.jsx("span",{style:{fontSize:"18px"},children:t.price>0&&e.jsxs(e.Fragment,{children:[t.price," Tsh"]})})],children:e.jsxs(q,{children:[e.jsx(N,{xs:12,sm:12,md:4,xl:2,lg:2,style:{backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+t.cover+")"},children:e.jsx("div",{style:{height:"100%",width:"100%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url("+t.cover+")"}})}),e.jsx(N,{xs:12,sm:12,md:8,style:{padding:"0px"},children:e.jsxs(K,{style:{padding:"0px"},children:[e.jsxs("div",{children:[e.jsx("a",{children:e.jsx("h3",{children:t.title.length>50?t.title.substring(0,50)+"...":t.title})}),e.jsx("span",{style:{float:"right",display:"flex",position:"absolute",right:0,top:0},children:e.jsx(be,{trigger:["click"],overlay:e.jsxs(_,{children:[e.jsx(_.Item,{icon:e.jsx(Ee,{}),onClick:()=>x(t),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"View"})}),t.published?e.jsx(_.Item,{icon:e.jsx(Me,{}),children:e.jsx(Z,{title:"Are you sure to Unpublish this Book?",description:t.isPublic?e.jsx(e.Fragment,{children:"This will remove the book from the public books and no one can view or read it"}):e.jsx(e.Fragment,{children:"This will remove the book from the market place and no one can purchase it"}),onConfirm:()=>m(t.id,!1),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Unpublish"})})}):e.jsx(_.Item,{icon:e.jsx(Oe,{}),children:e.jsx(Z,{title:"Are you sure to Publish this Book?",description:t.isPublic?e.jsx(e.Fragment,{children:"This will make the book listed in the public books and everyone can view and read it"}):e.jsx(e.Fragment,{children:"This will make the book listed in the market place and anyone can purchase it"}),onConfirm:()=>m(t.id,!0),okText:"Publish",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Publish"})})}),e.jsx(_.Item,{icon:e.jsx(de,{}),children:e.jsx(Z,{title:"Are you sure to delete this Book?",onConfirm:()=>h(t.id),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:u=>u.preventDefault(),children:e.jsx(ye,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})]}),e.jsx("p",{children:t.description.replace(/(<([^>]+)>)/gi,"").length>100?t.description.replace(/(<([^>]+)>)/gi,"").substring(0,100)+"...":t.description.replace(/(<([^>]+)>)/gi,"")}),e.jsx("div",{children:e.jsx(Q,{children:e.jsx(G,{title:"Click to View Author Profile",children:e.jsxs("a",{children:[e.jsx(re,{size:"small",src:t.author.pic}),e.jsx("span",{style:{marginLeft:"10px"},children:t.author.fullName})]})})})})]})})]})})}))]}),e.jsx(q,{children:e.jsx(N,{span:24,style:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"20px"},children:e.jsx(te,{defaultCurrent:A,total:T})})}),e.jsx(se,{title:"Publishing Book",open:P,width:"60vw",onClose:t=>S(t),children:e.jsx(ot,{randKey:Math.random(),onFinish:c})}),e.jsx(ne,{title:k==null?void 0:k.title,width:"80vw",anchor:"right",onClose:t=>f(t),open:r,noOverFlow:!0,children:e.jsx(dt,{book:k})})]})},xt=()=>{const{push:a}=L();return s.useEffect(()=>{document.title=U.system_name+": Publish Books"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsxs(v,{children:[e.jsx(v.Item,{children:e.jsx("a",{onClick:()=>a("/olib"),children:"Home"})}),e.jsx(v.Item,{children:"Publish Books"})]})}),e.jsx(ht,{})]})},qt=a=>{const{page:j}=a;return j==="PublishBooksPage"?e.jsx(xt,{}):j==="OlibOrdersPage"?e.jsx(nt,{}):j==="OlibBooksAuthorsPage"?e.jsx(rt,{}):j==="OlibDashboardPage"?e.jsx(Je,{}):j==="BooksPurchasesPage"?e.jsx(Ye,{}):j==="BooksPurchasesDisbursementsPage"?e.jsx(Ue,{}):j==="BooksPublicPage"?e.jsx(Ke,{}):j==="BooksMarketPlacePage"?e.jsx(He,{}):e.jsx("div",{children:"Page not found ..."})};export{qt as OlibPages};
