import{r as s,aT as S,j as e,aW as N,aP as Y,a1 as P,af as K,av as M,aZ as p,cl as q,g as k,ae as H,_ as z,cP as b,cn as R,cL as _,aN as A,cz as O}from"./index-38408b6c.js";import{L as D}from"./index-6400c1ae.js";import{I as W}from"./InfoCircleFilled-f9391b54.js";import{S as V}from"./Skeleton-5a34f23c.js";import{A as Z}from"./index-764a3998.js";import{D as u}from"./index-f7c6998f.js";import{S as G}from"./SearchOutlined-f5ddfe7f.js";import{D as J}from"./index-7097a23c.js";import{C as Q}from"./index-a92e2748.js";import"./InfoCircleFilled-baaa675e.js";import"./DotChartOutlined-f39c986e.js";import"./index-ba5cdb37.js";import"./index-c7c4e01d.js";import"./index-9c418e79.js";import"./localeData-686f9dcf.js";const U=r=>{const[o,m]=s.useState(!1),[i,l]=s.useState(!1),[h,c]=s.useState(1),[a,y]=s.useState(),[j,n]=s.useState([]),[d,w]=s.useState(""),[E]=S.useForm(),[F,C]=s.useState(!1),L=t=>{y(t),C(!0)},v=async(t,x="",f=20)=>{var I;m(!0);const{data:g}=await k.custom({url:"",method:"get",meta:{operation:"attendeesByDate",variables:{page:{value:t,type:"Int",required:!0},key:{value:x,type:"String",required:!1},pageSize:{value:f,type:"Int",required:!1},attendanceDate:{value:(I=r.date)==null?void 0:I.format("YYYY-MM-DD"),type:"String",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{takenBy:["id","firstName","middleName","lastName","fullName","email","pic"]},{entry:["id","advanced","startTime","endTime",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]}]},{venue:["id","name"]},{subject:["id",{schoolSubject:["id",{subject:["id","name"]}]}]}]},{member:["id","firstName","middleName","lastName","fullName","registrationNumber","email","phone",{user:["pic"]},"created","updated","isActive","canEdit","canManage","canDelete"]}]}]}}).catch(()=>({data:null})).then(B=>B);g&&(l(g.hasNext),c(g.page+1),n([...g.results])),m(!1)},T=i&&!o?e.jsx("div",{style:{textAlign:"center",marginTop:12,height:32,lineHeight:"32px"},children:e.jsx(M,{onClick:()=>{v(h,d,20)},children:"loading more"})}):null;return s.useEffect(()=>{r.date&&v(1,"",10)},[r.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(N,{style:{marginTop:10},children:e.jsx(Y,{span:24,children:e.jsx(S,{layout:"vertical",form:E,onFinish:t=>{w(t.key),j.length=0,v(1,t.key)},children:e.jsx(S.Item,{name:"key",children:e.jsx(P,{size:"large",placeholder:"Search ...",prefix:e.jsx(G,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(N,{children:e.jsx(Y,{span:24,children:e.jsx(D,{loading:o,itemLayout:"horizontal",loadMore:T,dataSource:j,renderItem:t=>{var x,f;return e.jsx(D.Item,{actions:[e.jsx(K,{title:"Click to view Attendance Entry Details",color:"green",placement:"left",children:e.jsx(M,{icon:e.jsx(W,{}),onClick:()=>L(t)})})],children:e.jsx(V,{avatar:!0,title:!1,loading:!1,children:e.jsx(D.Item.Meta,{avatar:e.jsx(Z,{src:(f=(x=t==null?void 0:t.member)==null?void 0:x.user)==null?void 0:f.pic}),title:e.jsx("a",{children:t.member.fullName}),description:e.jsxs(e.Fragment,{children:[e.jsxs(p,{color:"green",children:["Reg#:",t.member.registrationNumber]}),!t.entry.advanced&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{color:"green",children:["Subject:"," ",t.entry.subject.schoolSubject.subject.name]}),e.jsxs(p,{color:"green",children:["Level:"," ",t.entry.schoolEducationLevelTimetable.schoolEducationLevel.educationLevel.name]})]})]})})})})}})})}),e.jsx(q,{title:"Attendance Entry Info",width:"45vw",open:F,onClose:t=>C(t),children:e.jsxs(u,{title:"",column:1,children:[e.jsx(u.Item,{label:"Subject Name",children:a==null?void 0:a.entry.subject.schoolSubject.subject.name}),e.jsx(u.Item,{label:"Venue",children:a==null?void 0:a.entry.venue.name}),e.jsx(u.Item,{label:"Started At",children:a==null?void 0:a.entry.startTime}),e.jsx(u.Item,{label:"Ended At",children:a==null?void 0:a.entry.endTime}),e.jsx(u.Item,{label:"Taken By",children:a==null?void 0:a.takenBy.fullName})]})})]})},X=r=>{const[o,m]=s.useState(!1),i=async()=>{var h;const{data:l}=await k.custom({url:"",method:"get",meta:{operation:"hasAttendeesByDate",variables:{date:{value:(h=r.date)==null?void 0:h.format("YYYY-MM-DD"),type:"String",required:!0}},fields:["hasAttendees"]}}).catch(c=>({data:null})).then(c=>c);l&&m(l.hasAttendees)};return s.useEffect(()=>{i()},[r.randKey,r.date]),e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{style:{cursor:"pointer",height:"100%"},onClick:()=>{r.onClick(r.date)},children:e.jsx(H,{dot:!0,color:"green"})}),!o&&e.jsx("div",{style:{cursor:"pointer",height:"100%"},onClick:()=>{z("No Attendee for this date")}})]})},$=r=>{const[o,m]=s.useState("month"),[i,l]=s.useState(void 0),[h,c]=s.useState(!1),a=(n,d=!1)=>{o==="month"&&d&&n<b().add(1,"day")&&l(n)},y=n=>{l(n),c(!0)},j=n=>e.jsx(X,{date:n,randKey:Math.random(),onClick:y});return s.useEffect(()=>{},[r.randKey]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:10},children:e.jsx(Q,{dateCellRender:j,onPanelChange:(n,d)=>{l(void 0),m(d)},value:void 0,onSelect:n=>{a(n,!0)},disabledDate:n=>{const d=b().add(1,"day").format("YYYY-MM-DD");return n>b(d,"YYYY-MM-DD")}})}),e.jsx(J,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Attendee on "}),e.jsx(p,{color:"green",children:i==null?void 0:i.format("MMM DD, YYYY")})]}),anchor:"right",width:"45vw",open:h,noOverFlow:!0,onClose:n=>c(n),children:e.jsx(U,{date:i,randKey:Math.random()})})]})},ee=()=>(s.useEffect(()=>{document.title=R.system_name+": Attendance Dashboard"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(_,{children:e.jsxs(A,{children:[e.jsx(A.Item,{children:e.jsx(O,{to:"/attendance",children:"Home"})}),e.jsx(A.Item,{children:"Attendance Dashboard"})]})})}),e.jsx($,{})]})),fe=r=>{const{page:o}=r;return o==="AttendanceDashboardPage"?e.jsx(ee,{}):e.jsx("div",{children:"No page found ..."})};export{fe as AttendancePages};
