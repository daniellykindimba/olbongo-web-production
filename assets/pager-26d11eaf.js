import{ch as ht,j as e,r as a,aT as u,aW as ee,aP as B,a1 as U,aY as ge,aX as se,af as O,av as q,g as E,_ as n,aZ as M,ce as Te,cm as re,a8 as qe,aS as mt,aO as _e,cl as de,cn as Ie,cL as Ce,aN as J,S as R,cP as G,u as Pe,cz as be,c as Je,ez as Ke,aR as Qe,aU as he,eA as Ge,a_ as xt}from"./index-50292268.js";import{t as gt}from"./text_truncate-315d9efa.js";import{S as ce}from"./SearchOutlined-95469259.js";import{C as Ze}from"./CheckOutlined-b19a3e7f.js";import{C as Fe}from"./CloseOutlined-0a398da5.js";import{G as ye}from"./index-d7801655.js";import{D as ve}from"./index-9d5dd287.js";import{C as xe,b as yt,a as Ve}from"./CheckCircleOutlined-6c1be2bb.js";import{C as pt}from"./index-a4e0592c.js";import{P as te}from"./index-ceeeade5.js";import{D as Ee}from"./DeleteOutlined-1574dc54.js";import{D as Y}from"./index-ae017361.js";import{D as et}from"./index-23cf927c.js";import{C as jt}from"./CloseCircleOutlined-19947605.js";import{I as ft}from"./InfoOutlined-d7a87333.js";import{U as tt}from"./UserOutlined-e0adb578.js";import{T as ue}from"./index-61d6fd0e.js";import{A as Se}from"./index-00216300.js";import{D as we}from"./index-9657b9f4.js";import{L as me}from"./index-3635f765.js";import{E as He}from"./EditOutlined-0c61d016.js";import{C as at}from"./CheckCircleFilled-b84cf364.js";import{P as st}from"./PlusCircleOutlined-7fe63772.js";import{S as nt}from"./SyncOutlined-69ca4c6a.js";import{C as St,S as bt}from"./SwitcherOutlined-b6102989.js";import{u as vt}from"./utc-c287eb03.js";import{C as Tt}from"./index-2352beac.js";import{I as rt}from"./index-c0343bec.js";import{M as it}from"./MoreOutlined-e66078b1.js";import{T as Re}from"./index-b7c8a18b.js";import{T as It}from"./index-ca4f41ce.js";import"./SwapRightOutlined-c4e52b1e.js";import"./index-d6c96334.js";import"./index-dc6d60d4.js";import"./localeData-808bb536.js";import"./index-13223a6d.js";import"./ActionButton-bfbac247.js";import"./DeleteOutlined-25685737.js";import"./InfoCircleFilled-06e7aa03.js";import"./InfoCircleFilled-baaa675e.js";import"./SinglePicker-0931feec.js";import"./EditOutlined-401a1613.js";import"./Skeleton-0ebe64c3.js";import"./DotChartOutlined-f39c986e.js";import"./UpOutlined-7082c42f.js";import"./InputNumber-a66f4f7d.js";import"./transButton-2099317b.js";import"./index-2fcb7b9d.js";const Ct=ht(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),Et=t=>{a.useState();const[y,l]=a.useState([]),[p,i]=a.useState(0),[f,T]=a.useState(!0),[I,P]=a.useState(10),[_,r]=a.useState(""),[c]=u.useForm(),j=[{title:"Student",dataIndex:"student",fixed:!0,render:(w,A,v)=>e.jsx("span",{children:e.jsxs(se,{direction:"vertical",children:[e.jsx("a",{children:A.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#"}),":"," ",A.member.registrationNumber]})]})})},{title:"",dataIndex:"status",render:(w,A,v)=>e.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[e.jsx("span",{style:{margin:5},children:e.jsx(O,{title:"Take as Present",color:"green",children:e.jsx(q,{icon:e.jsx(Ze,{style:{color:"green"}}),onClick:()=>C(A.id,t.event.id,1)})})}),e.jsx("span",{style:{margin:5},children:e.jsx(O,{title:"Take as Absent",color:"red",children:e.jsx(q,{icon:e.jsx(Fe,{style:{color:"red"}}),onClick:()=>C(A.id,t.event.id,2)})})})]})}],C=async(w,A,v)=>{const{data:S}=await E.custom({url:"",method:"post",meta:{operation:"takeAttendance",variables:{studentId:{value:w,type:"Int",required:!0},entryId:{value:A,type:"Int",required:!0},present:{value:v,type:"Int",required:!0}},fields:["success","message"]}}).catch(z=>({data:null})).then(z=>z);n.remove(),S&&S.success&&(n.success(S.message),F(1,"",10),t.onAdd()),T(!1)},F=async(w,A="",v=20)=>{T(!0);const{data:S}=await E.custom({url:"",method:"get",meta:{operation:"studentsToTakeAttendance",variables:{page:{value:w,type:"Int",required:!0},key:{value:A,type:"String",required:!1},pageSize:{value:v,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]}]}}).catch(z=>({data:null})).then(z=>z);S&&(i(S.total),l([...S.results])),T(!1)};return a.useEffect(()=>{F(1,"",10)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ee,{style:{marginTop:10},children:e.jsx(B,{span:24,children:e.jsx(u,{layout:"vertical",form:c,onFinish:w=>{r(w.key),y.length=0,F(1,w.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:f,columns:j,dataSource:y,pagination:{onChange:(w,A)=>{P(A),F(w,_,A)},total:p,pageSize:I,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"68vh"}})]})},At=t=>{const[y,l]=a.useState([]),[p,i]=a.useState(0),[f,T]=a.useState(!0),[I,P]=a.useState(20),[_,r]=a.useState(""),[c]=u.useForm(),C=!ye.useBreakpoint().lg,F=[{title:"Student",dataIndex:"student",fixed:!0,render:(A,v,S)=>e.jsx("span",{children:e.jsxs(se,{direction:"vertical",children:[e.jsx("a",{children:v.student.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#:"}),e.jsx("span",{style:{marginLeft:10},children:v.student.member.registrationNumber})]})]})})},{title:"Status",dataIndex:"status",render:(A,v,S)=>e.jsx("span",{children:v.status===1?e.jsx("a",{children:e.jsx(M,{color:"green",children:v.statusDisplay})}):e.jsx("a",{children:e.jsx(M,{color:"red",children:v.statusDisplay})})})}],w=async(A,v="",S=20)=>{T(!0);const{data:z}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelAttendancesByDate",variables:{page:{value:A,type:"Int",required:!0},key:{value:v,type:"String",required:!1},pageSize:{value:S,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0},date:{value:t.date.format("YYYY/MM/DD"),type:"String",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(n.remove(),n.error("Error occured while fetching roles"),{data:null})).then(g=>g);z&&(i(z.total),l([...z.results])),T(!1)};return a.useEffect(()=>{w(1,"",20)},[t.randKey,t.date,t.event]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:C?24:16,children:e.jsx(u,{layout:"vertical",form:c,onFinish:A=>{r(A.key),y.length=0,w(1,A.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:C?24:2,children:e.jsx(q,{icon:e.jsx(ce,{}),size:"large",onClick:()=>c.submit()})})]}),e.jsx(ge,{loading:f,columns:F,dataSource:y,pagination:{onChange:(A,v)=>{P(v),w(A,_,v)},total:p,pageSize:I,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(100vh - 470px)"}})]})},Ue=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],kt=t=>{var K,oe;const[y,l]=a.useState([]),[p,i]=a.useState(0),[f,T]=a.useState(!0),[I,P]=a.useState(20),[_,r]=a.useState(""),[c]=u.useForm(),C=!ye.useBreakpoint().lg,[F,w]=a.useState(!1),[A,v]=a.useState(!1),[S,z]=a.useState(!1),[g,L]=a.useState(),b=async V=>{L(V),z(!0)},h=async V=>{v(!1),w(V)},o=[{title:"Student",dataIndex:"student",fixed:!0,render:(V,H,$)=>e.jsx("span",{children:e.jsxs(se,{direction:"vertical",children:[e.jsx("a",{children:H.student.member.fullName}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Reg#:"}),e.jsx("span",{style:{marginLeft:10},children:H.student.member.registrationNumber})]})]})})},{title:"Status",dataIndex:"status",render:(V,H,$)=>e.jsx("span",{children:H.status===1?e.jsx(te,{title:"Are you sure to mark Absent?",onConfirm:()=>m(H.id,2),onCancel:()=>{},okText:"Absent",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{children:e.jsx(M,{color:"green",children:H.statusDisplay})})}):e.jsx(te,{title:"Are you sure to mark as Present?",onConfirm:()=>m(H.id,1),onCancel:()=>{},okText:"Present",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{children:e.jsx(M,{color:"red",children:H.statusDisplay})})})})},{title:"",dataIndex:"status",render:(V,H,$)=>e.jsx(te,{title:"Are you sure to delete this Attendance Entry?",onConfirm:()=>x(H.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ee,{})})})}],s=async(V,H="",$=20)=>{T(!0);const{data:ae}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelAttendances",variables:{page:{value:V,type:"Int",required:!0},key:{value:H,type:"String",required:!1},pageSize:{value:$,type:"Int",required:!1},timetableEntryId:{value:t.event.id,type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(n.remove(),n.error("Error occured while fetching roles"),{data:null})).then(Ae=>Ae);ae&&(i(ae.total),l([...ae.results])),T(!1)},x=async V=>{const{data:H}=await E.custom({url:"",method:"post",meta:{operation:"deleteStudentAttendance",variables:{attendanceId:{value:parseInt(V.toString()),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(n.remove(),n.error("Error occured while deleting attendance entry"),{data:null})).then($=>$);H&&(H.success?(n.remove(),n.success(H.message),l(y.filter($=>$.id!==V))):(n.remove(),n.error(H.message)))},m=async(V,H)=>{const{data:$}=await E.custom({url:"",method:"post",meta:{operation:"updateStudentAttendance",variables:{attendanceId:{value:parseInt(V.toString()),type:"Int",required:!0},present:{value:H,type:"Int",required:!0}},fields:["success","message",{attendance:["id",{student:["id",{member:["id","firstName","middleName","lastName","fullName","registrationNumber"]}]},{entry:["id"]},{takenBy:["id"]},"status","statusDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(n.remove(),n.error("Error occured while updating attendance"),{data:null})).then(ae=>ae);n.remove(),$&&($.success?(n.success($.message),l(y.map(ae=>parseInt(ae.id.toString())===parseInt($.attendance.id.toString())?$.attendance:ae))):n.error($.message)),T(!1)},D=async()=>{s(1,"",20)};return a.useEffect(()=>{s(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:C?24:16,children:e.jsx(u,{layout:"vertical",form:c,onFinish:V=>{r(V.key),y.length=0,s(1,V.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{disabled:A,size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:C?24:2,children:e.jsx(q,{disabled:A,icon:e.jsx(ce,{}),size:"large",onClick:()=>c.submit()})}),t.event.canTakeAttendance&&e.jsx(B,{span:C?24:6,children:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(O,{title:"Start Taking Attendance",children:e.jsx(q,{icon:e.jsx(Te,{}),size:"large",onClick:()=>h(!0),children:"Take Attendance"})}),e.jsx(O,{title:"View Taken Attendances",children:e.jsx(q,{disabled:A,icon:e.jsx(xe,{}),size:"large",onClick:()=>v(!0),children:"View Attendances"})})]})}),!t.event.canTakeAttendance&&e.jsx(B,{span:C?24:6,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(O,{title:"View Taken Attendances",children:e.jsx(q,{disabled:A,icon:e.jsx(xe,{}),size:"large",onClick:()=>v(!0),children:"View Attendances"})})})})]}),A?e.jsx(e.Fragment,{children:e.jsx("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:e.jsx(pt,{onSelect:V=>{var H;if(V<re().endOf("day")){const $=Ue.indexOf((H=t==null?void 0:t.entry)==null?void 0:H.name)+1,ae=V.day();$===ae?b(V):n("No attendance taken on this day")}},disabledDate:V=>{var ae;const H=Ue.indexOf((ae=t==null?void 0:t.entry)==null?void 0:ae.name)+1,$=V.day();return V&&V>re().endOf("day")||H!==$}})})}):e.jsx(ge,{loading:f,columns:o,dataSource:y,pagination:{onChange:(V,H)=>{P(H),s(V,_,H)},total:p,pageSize:I,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(100vh - 470px)"}}),e.jsx(ve,{title:"Taking Attendance",width:"28vw",anchor:"right",onClose:V=>w(V),open:F,noOverFlow:!0,children:e.jsx(Et,{event:t.event,randKey:Math.random(),onAdd:D})}),e.jsx(ve,{title:((K=t.event)==null?void 0:K.subject.name)+" - "+((oe=t.event)==null?void 0:oe.educationLevel.name)+" Attendance taken on "+(g==null?void 0:g.format("YYYY MMM, DD")),width:"50vw",anchor:"left",onClose:V=>z(V),open:S,noOverFlow:!0,children:e.jsx(At,{event:t.event,date:g,randKey:Math.random()})})]})},{TextArea:_t}=U,wt=t=>{const[y,l]=a.useState(!1),[p,i]=a.useState(!1),[f,T]=a.useState([]),[I,P]=a.useState(null),[_,r]=a.useState(null),[c]=u.useForm(),[j,C]=a.useState(!1),[F,w]=a.useState(!1),v=!ye.useBreakpoint().lg,S=(b,h)=>{P(h),r(b),C(!0)},z=async b=>{const{data:h}=await E.custom({url:"",method:"post",meta:{operation:"openTimetableEntry",variables:{entryId:{value:b,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(o=>o);h&&(h.success?(n.success(h.message),L()):n.error(h.message))},g=async b=>{const{data:h}=await E.custom({url:"",method:"post",meta:{operation:"cancelTimetableEntry",variables:{entryId:{value:b.entryId,type:"Int",required:!0},reason:{value:b.reason,type:"String",required:!0},verify:{value:b.notify,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(()=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(o=>o);h&&(h.success?(n.success(h.message),c.resetFields(),L()):n.error(h.message))},L=async()=>{l(!0);const{data:b}=await E.custom({url:"",method:"get",meta:{operation:"myWeeklyTimetableEntries",fields:["entries","hasTimetable"]}}).catch(()=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(h=>h);b&&(console.error("data",b),i(b.hasTimetable),T(b.entries)),l(!1)};return a.useEffect(()=>{L()},[]),e.jsxs(e.Fragment,{children:[e.jsxs(qe,{spinning:y,children:[!p&&!y&&e.jsx(e.Fragment,{children:e.jsx(ee,{align:"middle",style:{height:"80vh",display:"flex",justifyContent:"center"},children:e.jsx(mt,{description:e.jsx(e.Fragment,{children:e.jsx("span",{style:{fontSize:22},children:"You are not Connected to any published Timetable"})})})})}),p&&e.jsx(ee,{style:{overflowX:"auto",marginTop:v?65:0,marginLeft:10},wrap:!1,children:f.map(b=>e.jsxs("span",{style:{width:v?"100vw":"14.1vw",margin:"1px",padding:"0px"},children:[e.jsx(ee,{style:{display:"flex",justifyContent:"space-between",backgroundColor:"white"},children:e.jsxs("span",{style:{marginLeft:10,marginRight:10,display:"flex",justifyContent:"space-between",width:"100%",height:35,paddingTop:2},children:[e.jsx("span",{style:{fontSize:19,fontWeight:"bolder"},children:b.name}),e.jsx("span",{children:e.jsx(O,{title:"Bulk Processing of Action(s)",color:"red",placement:"left",children:e.jsx(q,{icon:e.jsx(Fe,{})})})})]})}),e.jsx("div",{style:{maxHeight:"83vh",overflowY:"auto",overflowX:"hidden",marginTop:5,marginRight:5},children:b.events.map(h=>e.jsx("div",{style:{backgroundColor:"white",paddingLeft:5},children:e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:18},children:[h.isTeacher&&e.jsx(e.Fragment,{children:e.jsxs("div",{style:{borderBottom:"1"},children:[e.jsx("span",{style:{marginLeft:5},children:e.jsx(O,{title:"View/Take Attendance",color:"green",children:e.jsx(q,{size:"small",onClick:()=>S(h,b),children:e.jsx(xe,{})})})}),h.canCancell&&!h.isCancelled&&!h.isExam&&e.jsx("span",{style:{marginLeft:5},children:e.jsx(te,{title:e.jsx(e.Fragment,{children:e.jsxs(se,{direction:"vertical",children:[e.jsx("span",{children:"Are you sure to Cancel?"}),e.jsx("span",{style:{fontWeight:"bolder"},children:"Reason"}),e.jsx("span",{children:e.jsxs(u,{layout:"vertical",form:c,initialValues:{notify:!0},onFinish:o=>{o.entryId=h.id,g(o)},onFinishFailed:()=>{},autoComplete:"off",children:[e.jsx(u.Item,{name:"reason",rules:[{required:!0,message:"Please input your reason!"}],children:e.jsx(_t,{rows:6,onChange:o=>{o.target.value.length>0?w(!0):w(!1)}})}),e.jsx(u.Item,{name:"notify",valuePropName:"checked",children:e.jsx(_e,{children:"Notify Students"})})]})})]})}),onConfirm:()=>{c.submit()},onCancel:()=>{},okText:"Yes",cancelText:"No",okButtonProps:{disabled:!F},overlayStyle:{zIndex:9999},children:e.jsx(q,{size:"small",children:e.jsx(jt,{color:"red",style:{color:"red"}})})})}),e.jsx("span",{style:{float:"right"},children:e.jsx(O,{title:"Click to see all about this timetable Entry",color:"green",children:e.jsx(q,{icon:e.jsx(ft,{})})})})]})}),e.jsxs("span",{style:{display:"block"},children:[!h.advanced&&e.jsx(O,{overlayInnerStyle:{fontSize:19},title:"Subject: "+h.subject.name,color:"green",placement:"right",children:gt(h.subject.name,15)}),h.advanced&&e.jsx(O,{overlayInnerStyle:{fontSize:19},title:"Module: "+h.module.name,color:"green",placement:"right",children:h.module.code})]}),!h.advanced&&e.jsx(se,{children:h.group&&e.jsx(e.Fragment,{children:e.jsx(M,{color:"orange",children:h.group.name})})})]}),e.jsxs("span",{style:{fontSize:18},children:[e.jsx(O,{title:"Venue: "+h.venue.name,color:"green",children:e.jsx(M,{color:"red",children:h.venue.name})}),e.jsx(O,{title:e.jsxs(e.Fragment,{children:[!h.advanced&&e.jsx(e.Fragment,{children:h.isExam?e.jsxs(Y,{title:"Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.supervisor.firstName," ",h.supervisor.middleName," ",h.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:h.supervisor.phone})]}):e.jsxs(Y,{title:"Teacher Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.teacher.firstName," ",h.teacher.middleName," ",h.teacher.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.teacher.email}),e.jsx(Y.Item,{label:"Phone",children:h.teacher.phone})]})}),h.advanced&&e.jsx(e.Fragment,{children:h.isExam?e.jsxs(Y,{title:"Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.supervisor.firstName," ",h.supervisor.middleName," ",h.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:h.supervisor.phone})]}):e.jsxs(Y,{title:"Lecturer Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[h.lecturer.firstName," ",h.lecturer.middleName," ",h.lecturer.lastName]}),e.jsx(Y.Item,{label:"Email",children:h.lecturer.email}),e.jsx(Y.Item,{label:"Phone",children:h.lecturer.phone})]})})]}),color:"white",overlayInnerStyle:{color:"black"},children:e.jsx(q,{type:"primary",shape:"circle",icon:e.jsx(tt,{})})})]}),h.isCancelled&&e.jsx("span",{children:e.jsxs(M,{color:"red",style:{fontSize:24,padding:10,marginTop:10},children:["Cancelled",h.isTeacher&&h.canCancell&&e.jsx(te,{title:"Are you sure to Open?",onConfirm:()=>z(h.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{style:{marginLeft:2},size:"small",children:"Re-open"})})]})}),e.jsxs(et,{children:[h.isExam&&e.jsx("p",{style:{fontSize:"18px"},children:re(h.dueDate).format("YYYY MMM, DD")}),h.startAt," - ",h.endAt]})]})}))})]}))})]}),e.jsx(de,{title:e.jsx(e.Fragment,{children:e.jsxs(se,{direction:"vertical",children:[e.jsxs("span",{children:[_==null?void 0:_.subject.name," - ",_==null?void 0:_.educationLevel.name," - Attendance",e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:I==null?void 0:I.name})})]}),e.jsxs("span",{children:[_==null?void 0:_.startAt," - ",_==null?void 0:_.endAt]})]})}),width:"70vw",open:j,onClose:b=>C(b),children:e.jsx(kt,{event:_,entry:I,randKey:Math.random()})})]})},qt=()=>(a.useEffect(()=>(document.title=Ie.system_name+": Timetable Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{marginBottom:10},children:e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx("a",{href:"/",children:"Home"})}),e.jsx(J.Item,{children:e.jsx("a",{href:"/timetable",children:"Timetable"})}),e.jsx("span",{children:"Dashboard"})]})})}),e.jsx(wt,{})]})),{Option:De}=R,Ne="HH:mm",Ft=t=>{const[y,l]=a.useState(!1),[p,i]=a.useState(!0),[f,T]=a.useState([]),[I,P]=a.useState([]),[_,r]=a.useState([]),[c,j]=a.useState([]),C=()=>{l(!0)},F=g=>{t.form.setFieldsValue({teacher:void 0}),v(1,g)},w=async(g,L="",b=100)=>{const{data:h}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:g,type:"Int",required:!0},key:{value:L,type:"String",required:!1},pageSize:{value:b,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(()=>(n.error("Error occured while loading Venues"),{data:null})).then(o=>o);h&&j(h.results)},A=async(g,L="",b=20)=>{var o;const{data:h}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjects",variables:{schoolEducationLevelId:{value:parseInt(((o=t.schoolTimetableEducationLevel)==null?void 0:o.schoolEducationLevel.id.toString())??"0")},page:{value:g,type:"Int",required:!0},key:{value:L,type:"String",required:!1},pageSize:{value:b,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolSubject:[{subject:["id","name"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(s=>(n.error("Error occured while loading Subjects"),{data:null})).then(s=>s);h&&T(h.results)},v=async(g,L,b="",h=20)=>{i(!0);const{data:o}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjectTeachers",variables:{schoolEducationLevelSubjectId:{value:parseInt(L.toString()??"0")},page:{value:g,type:"Int",required:!0},key:{value:b,type:"String",required:!1},pageSize:{value:h,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolMember:["id","registrationNumber",{user:["id","firstName","lastName","middleName","fullName"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(s=>(n.error("Error occured while loading Teachers"),{data:null})).then(s=>s);o&&P(o.results),i(!1)},S=async(g,L="",b=20)=>{var o;const{data:h}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelGroups",variables:{schoolEducationLevelId:{value:parseInt(((o=t.schoolTimetableEducationLevel)==null?void 0:o.schoolEducationLevel.id.toString())??"0")},page:{value:g,type:"Int",required:!0},key:{value:L,type:"String",required:!1},pageSize:{value:b,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(s=>(n.error("Error occured while loading Groups"),{data:null})).then(s=>s);h&&r(h.results)},z=async g=>{const{data:L}=await E.custom({url:"",method:"post",meta:{operation:"createTimetableEntry",variables:{subjectId:{value:g.subject_id,type:"Int",required:!0},teacherId:{value:g.teacher_id,type:"Int",required:!0},timetableId:{value:g.timetable_id,type:"Int",required:!0},groupId:{value:g.group_id,type:"Int",required:!1},venueId:{value:g.venue_id,type:"Int",required:!0},day:{value:g.day,type:"String",required:!0},startAt:{value:g.start_at,type:"String",required:!0},endAt:{value:g.end_at,type:"String",required:!0}},fields:["success","message"]}}).catch(b=>(n.error("Error occured while creating school timetable"),{data:null})).then(b=>b);L&&(L.success?(n.success(L.message),t.form.resetFields(),t.onFinish()):n.error(L.message))};return a.useEffect(()=>{S(1),w(1),A(1)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(u,{layout:"vertical",form:t.form,onFinish:g=>{var L;g.start_at=re(g.start_at).format("HH:mm"),g.end_at=re(g.end_at).format("HH:mm"),g.day=t.entry.name,g.timetable_id=parseInt(((L=t.schoolTimetableEducationLevel)==null?void 0:L.id.toString())??"0"),z(g)},requiredMark:!1,children:[e.jsx(u.Item,{name:"subject_id",label:"Subject",rules:[{required:!0,type:"integer",message:"Please Choose Subject"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Subject",allowClear:!0,showSearch:!0,onChange:F,dropdownStyle:{zIndex:9999},children:f.map(g=>e.jsx(De,{value:g.id,children:g.schoolSubject.subject.name},g.id))})}),e.jsx(u.Item,{name:"teacher_id",label:"Teacher",rules:[{required:!0,type:"integer",message:"Please Choose Teacher"}],children:e.jsx(R,{size:"large",loading:p,disabled:p,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:I.map(g=>e.jsxs(De,{value:g.id,children:[g.schoolMember.user.fullName,g.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:g.schoolMember.registrationNumber})})]},g.id))})}),e.jsx(u.Item,{name:"group_id",label:"Group",rules:[{required:!1,type:"integer",message:"Please Choose Groups"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Groups",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:_.map(g=>e.jsx(De,{value:parseInt(g.id.toString()),children:g.name},g.id))})}),e.jsx(u.Item,{name:"venue_id",label:"Venue",rules:[{required:!0,type:"integer",message:"Please Choose Venue"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Venue",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:c.map(g=>e.jsx(De,{value:parseInt(g.id.toString()),children:g.name},g.id))})}),e.jsxs(ee,{children:[e.jsx(B,{span:6,children:e.jsx(u.Item,{name:"start_at",label:e.jsx(e.Fragment,{children:e.jsxs(se,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Start At"}),e.jsx(q,{type:"link",onClick:()=>C(),children:"Check Slots"})]})}),initialValue:G("07:00","HH:mm"),children:e.jsx(ue,{size:"large",allowClear:!0,defaultValue:G("07:00",Ne),hourStep:1,minuteStep:45,format:Ne,style:{width:"100%"},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:6,children:e.jsx(u.Item,{name:"end_at",label:e.jsx(e.Fragment,{children:e.jsxs(se,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"End At"}),e.jsx(q,{type:"link",onClick:()=>C(),children:"Check Slots"})]})}),initialValue:G("07:45","HH:mm"),children:e.jsx(ue,{size:"large",allowClear:!0,defaultValue:G("07:45",Ne),hourStep:1,minuteStep:45,format:Ne,inputReadOnly:!0,style:{width:"100%"},popupStyle:{zIndex:9999}})})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",disabled:!0,children:"Save"})})]}),e.jsx(ve,{title:"Available Time Slots",anchor:"right",onClose:g=>l(g),open:y,noOverFlow:!0,children:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Some contents..."}),e.jsx("p",{children:"Some contents..."}),e.jsx("p",{children:"Some contents..."})]})})]})},{Option:je}=R,$e="HH:mm",Mt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Xe=t=>{var k,Q,ie,fe,Me,We,Oe,Be;const[y,l]=a.useState(!1),[p,i]=a.useState(!1),[f,T]=a.useState(!0),[I,P]=a.useState([]),[_,r]=a.useState([]),[c,j]=a.useState([]),[C,F]=a.useState([]),[w,A]=a.useState([]);a.useState(),a.useState();const[v,S]=a.useState([]);a.useState(!1),a.useState(!1);const[z,g]=a.useState("07:00"),[L,b]=a.useState("07:45");Pe();const[h,o]=a.useState([]),[s,x]=a.useState([]),[m,D]=a.useState([]),[K]=u.useForm(),oe=()=>{i(!0)},V=d=>{var W;t.form.setFieldsValue({teacher:void 0}),((W=t==null?void 0:t.schoolTimetable)==null?void 0:W.forExamination)===!0?ae(1):Ae(1,d)},H=async(d,W="",X=100)=>{const{data:ne}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:d,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(le=>(n.error("Error occured while loading Venues"),{data:null})).then(le=>le);ne&&A(ne.results)},$=async(d,W="",X=20)=>{var le;const{data:ne}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjects",variables:{schoolEducationLevelId:{value:parseInt(((le=t.schoolTimetableEducationLevel)==null?void 0:le.schoolEducationLevel.id.toString())??"0")},page:{value:d,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolSubject:[{subject:["id","name"]}]},"subjectType","subjectTypeDisplay","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(n.error("Error occured while loading Subjects"),{data:null})).then(pe=>pe);ne&&P(ne.results)},ae=async(d,W="",X=20)=>{T(!0);const{data:ne}=await E.custom({url:"",method:"get",meta:{operation:"schoolMembers",variables:{page:{value:d,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1},rolesString:{value:["Teacher"],type:"[String]",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","registrationNumber","firstName","middleName","lastName","fullName","email","phone",{user:["id","firstName","lastName","middleName","fullName"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(le=>(n.error("Error occured while loading Teachers"),{data:null})).then(le=>le);ne&&j(ne.results),T(!1)},Ae=async(d,W,X="",ne=20)=>{T(!0);const{data:le}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelSubjectTeachers",variables:{schoolEducationLevelSubjectId:{value:parseInt(W.toString()??"0")},page:{value:d,type:"Int",required:!0},key:{value:X,type:"String",required:!1},pageSize:{value:ne,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolMember:["id","registrationNumber",{user:["id","firstName","lastName","middleName","fullName"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(n.error("Error occured while loading Teachers"),{data:null})).then(pe=>pe);le&&r(le.results),T(!1)},Le=async(d,W="",X=20)=>{var le;const{data:ne}=await E.custom({url:"",method:"get",meta:{operation:"schoolEducationLevelGroups",variables:{schoolEducationLevelId:{value:parseInt(((le=t.schoolTimetableEducationLevel)==null?void 0:le.schoolEducationLevel.id.toString())??"0")},page:{value:d,type:"Int",required:!0},key:{value:W,type:"String",required:!1},pageSize:{value:X,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","description","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(pe=>(n.error("Error occured while loading Groups"),{data:null})).then(pe=>pe);ne&&F(ne.results)},ze=async d=>{l(!0);const{data:W}=await E.custom({url:"",method:"post",meta:{operation:"createTimetableEntry",variables:{advanced:{value:t.advanced,type:"Boolean",required:!1},moduleId:{value:d.module_id,type:"Int",required:!1},subjectId:{value:d.subject_id,type:"Int",required:!1},teacherId:{value:d.teacher_id,type:"Int",required:!1},timetableId:{value:d.timetable_id,type:"Int",required:!0},groupId:{value:d.group_id,type:"Int",required:!1},venueId:{value:d.venue_id,type:"Int",required:!0},day:{value:d.day,type:"String",required:!0},startAt:{value:d.start_at,type:"String",required:!0},endAt:{value:d.end_at,type:"String",required:!0},supervisorId:{value:d.supervisor_id,type:"Int",required:!1},dueDate:{value:d.due_date,type:"String",required:!1}},fields:["success","message"]}}).catch(X=>(n.error("Error occured while creating school timetable"),{data:null})).then(X=>X);l(!1),W&&(W.success?(n.success(W.message),S([]),t.form.resetFields(),t.onFinish()):S(W.message))},ke=async()=>{var X;const d=((X=t==null?void 0:t.studyCourse)==null?void 0:X.id)??"0",{data:W}=await E.custom({url:"",method:"get",meta:{operation:"timetableStudyCourseModules",variables:{timetableStudyCourseId:{value:parseInt(d.toString()),type:"Int",required:!0}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(ne=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(ne=>ne);W&&o(W.results)},N=async d=>{T(!0);const{data:W}=await E.custom({url:"",method:"get",meta:{operation:"moduleMembers",variables:{moduleId:{value:d,type:"Int",required:!0},memberType:{value:"Teacher",type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{module:["id"]},{schoolMember:["id","registrationNumber","firstName","middleName","lastName","email","phone",{user:["id","firstName","middleName","lastName","email","fullName","pic"]}]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(X=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(X=>X);T(!1),W&&D(W.results)};return a.useEffect(()=>{ke(),Le(1),H(1),$(1)},[t.randKey]),e.jsxs(e.Fragment,{children:[((k=t==null?void 0:t.schoolTimetable)==null?void 0:k.forExamination)&&e.jsx("div",{style:{marginBottom:10},children:e.jsx(Se,{type:"info",message:e.jsx(e.Fragment,{children:e.jsxs("p",{style:{fontSize:18},children:[e.jsx("b",{children:"Notice:"})," This timetable is for examination. You can only add entries for examination.",e.jsx("p",{style:{color:"red"},children:"Validation wont apply against Non-Examination Timetable"})," ","But it will be applied against Examination Timetable"]})})})}),e.jsx("div",{children:v.map(d=>e.jsx(Se,{message:d,type:"error",style:{fontSize:18,marginBottom:"3px"},onClose:()=>{S([])},closable:!0}))}),e.jsxs(u,{layout:"vertical",form:K,onFinish:d=>{var W,X;d.start_at=z,d.end_at=L,d.day=t.entry.name,t.advanced?d.timetable_id=parseInt(((W=t==null?void 0:t.studyCourse)==null?void 0:W.id.toString())??"0"):d.timetable_id=parseInt(((X=t==null?void 0:t.schoolTimetableEducationLevel)==null?void 0:X.id.toString())??"0"),ze(d)},children:[t.advanced?e.jsx(u.Item,{name:"module_id",label:"Module",rules:[{required:!0,type:"integer",message:"Please Choose Module"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Module",allowClear:!0,showSearch:!0,onChange:d=>{K.setFieldsValue({teacher_id:void 0}),N(d)},dropdownStyle:{zIndex:9999},children:h.map(d=>e.jsx(je,{value:parseInt(d.id.toString()),children:d.name},d.id))})}):e.jsx(u.Item,{name:"subject_id",label:"Subject",rules:[{required:!0,type:"integer",message:"Please Choose Subject"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Subject",allowClear:!0,showSearch:!0,onChange:V,dropdownStyle:{zIndex:9999},children:I.map(d=>e.jsxs(je,{value:d.id,children:[d.schoolSubject.subject.name,e.jsx(M,{style:{marginLeft:5},color:"green",children:d.subjectTypeDisplay})]},d.id))})}),!t.advanced&&e.jsx(e.Fragment,{children:(Q=t==null?void 0:t.schoolTimetable)!=null&&Q.forExamination?e.jsx(u.Item,{name:"supervisor_id",label:e.jsx(e.Fragment,{children:"Teachers Supervising"}),rules:[{required:(ie=t==null?void 0:t.schoolTimetable)==null?void 0:ie.forExamination,type:"integer",message:"Please Choose Supervisor"}],children:e.jsx(R,{size:"large",loading:f,disabled:f,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:c.map(d=>e.jsxs(je,{value:parseInt(d.id.toString()),children:[d.user.fullName,d.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:d.registrationNumber})}),e.jsxs("p",{style:{marginTop:3},children:[e.jsx("span",{style:{color:"red"},children:"Email:"})," ",e.jsx(M,{children:d==null?void 0:d.email}),","," ",e.jsx("span",{style:{color:"red"},children:"Phone:"})," ",e.jsx(M,{children:d==null?void 0:d.phone})]})]},d.id))})}):e.jsx(u.Item,{name:"teacher_id",label:e.jsx(e.Fragment,{children:"Teacher"}),rules:[{required:!((fe=t==null?void 0:t.schoolTimetable)!=null&&fe.forExamination),type:"integer",message:"Please Choose Teacher"}],children:e.jsx(R,{size:"large",loading:f,disabled:f,style:{width:"100%"},placeholder:"Please Choose Teacher",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:_.map(d=>e.jsxs(je,{value:d.id,children:[d.schoolMember.user.fullName,d.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:d.schoolMember.registrationNumber})})]},d.id))})})}),t.advanced&&e.jsx(e.Fragment,{children:(Me=t==null?void 0:t.schoolTimetable)!=null&&Me.forExamination?e.jsx(u.Item,{name:"supervisor_id",label:e.jsx(e.Fragment,{children:"Lecturer/Tutor Supervising"}),rules:[{required:(We=t==null?void 0:t.schoolTimetable)==null?void 0:We.forExamination,type:"integer",message:"Please Choose Supervisor"}],children:e.jsx(R,{size:"large",loading:f,disabled:f,style:{width:"100%"},placeholder:"Please Choose Lecturer/Tutor",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:s.map(d=>e.jsxs(je,{value:parseInt(d.id.toString()),children:[d.user.fullName,d.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:d.registrationNumber})}),e.jsxs("p",{style:{marginTop:3},children:[e.jsx("span",{style:{color:"red"},children:"Email:"})," ",e.jsx(M,{children:d==null?void 0:d.email}),","," ",e.jsx("span",{style:{color:"red"},children:"Phone:"})," ",e.jsx(M,{children:d==null?void 0:d.phone})]})]},d.id))})}):e.jsx(u.Item,{name:"teacher_id",label:e.jsx(e.Fragment,{children:"Lecturer/Tutor"}),rules:[{required:!((Oe=t==null?void 0:t.schoolTimetable)!=null&&Oe.forExamination),type:"integer",message:"Please Choose Lecturer/Tutor"}],children:e.jsx(R,{size:"large",loading:f,disabled:f,style:{width:"100%"},placeholder:"Please Choose Lecturer/Tutor",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:m.map(d=>{var W;return e.jsxs(je,{value:parseInt(d.schoolMember.id.toString()),children:[(W=d==null?void 0:d.schoolMember.user)==null?void 0:W.fullName,d.schoolMember.registrationNumber&&e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:d.schoolMember.registrationNumber})})]},d.id)})})})}),!t.advanced&&e.jsx(u.Item,{name:"group_id",label:"Group",rules:[{required:!1,type:"integer",message:"Please Choose Groups"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Groups",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:C.map(d=>e.jsx(je,{value:parseInt(d.id.toString()),children:d.name},d.id))})}),e.jsx(u.Item,{name:"venue_id",label:"Venue",rules:[{required:!0,type:"integer",message:"Please Choose Venue"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Venue",allowClear:!0,showSearch:!0,onChange:()=>{},dropdownStyle:{zIndex:9999},children:w.map(d=>e.jsx(je,{value:parseInt(d.id.toString()),children:d.name},d.id))})}),e.jsxs(ee,{children:[((Be=t==null?void 0:t.schoolTimetable)==null?void 0:Be.forExamination)&&e.jsx(B,{span:8,children:e.jsx(u.Item,{name:"due_date",label:"Due Date",rules:[{required:!0,type:"object",message:"Please Choose Due Date"}],children:e.jsx(we,{size:"large",style:{width:"100%"},placeholder:"Please Choose Due Date",disabledDate:d=>!(d.day()===Mt.indexOf(t.entry.name)+1),popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:8,children:e.jsx(u.Item,{name:"start_at",rules:[{required:!0,type:"object",message:"Please Choose Start Time"}],label:e.jsx(e.Fragment,{children:e.jsxs(se,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Start At"}),e.jsx(q,{type:"link",onClick:()=>oe(),children:"Check Slots"})]})}),initialValue:G("07:00","HH:mm"),children:e.jsx(ue,{allowClear:!0,hourStep:1,minuteStep:45,format:$e,defaultValue:G("07:00","HH:mm"),style:{width:"100%"},size:"large",onChange:d=>{g((d==null?void 0:d.hour().toString())+":"+(d==null?void 0:d.minute().toString()))},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:8,children:e.jsx(u.Item,{name:"end_at",rules:[{required:!0,type:"object",message:"Please Choose End Time"}],label:e.jsx(e.Fragment,{children:e.jsxs(se,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"End At"}),e.jsx(q,{type:"link",onClick:()=>oe(),children:"Check Slots"})]})}),initialValue:G("07:45","HH:mm"),children:e.jsx(ue,{allowClear:!0,hourStep:1,minuteStep:45,format:$e,inputReadOnly:!0,defaultValue:G("07:45","HH:mm"),style:{width:"100%"},size:"large",onChange:d=>{b((d==null?void 0:d.hour().toString())+":"+(d==null?void 0:d.minute().toString()))},popupStyle:{zIndex:9999}})})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",loading:y,disabled:y,children:"Save"})})]}),e.jsx(ve,{title:"Available Time Slots",width:"30vw",anchor:"right",onClose:d=>i(d),open:p,noOverFlow:!0,children:e.jsx("span",{children:"Slot Schecker"})})]})},lt=t=>{const[y,l]=a.useState(!1),[p,i]=a.useState(),[f,T]=a.useState([]),[I,P]=a.useState(),[_,r]=a.useState(!1),[c,j]=a.useState(!1),[C,F]=a.useState(!1),[w]=u.useForm();u.useForm();const A=Pe(),v=async(b,h)=>{P(b),i(h),j(!0)},S=async()=>{g()},z=async b=>{P(b),t.advanced?F(!0):r(!0)},g=async()=>{l(!0);const{data:b}=await E.custom({url:"",method:"get",meta:{operation:"weeklyTimetableEntries",variables:{schoolEducationLevelTimetableId:{value:parseInt(A.id),type:"Int",required:!0}},fields:["entries"]}}).catch(h=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(h=>h);b&&T(b.entries),l(!1)},L=async b=>{const{data:h}=await E.custom({url:"",method:"post",meta:{operation:"deleteTimetableEntry",variables:{timetableEntryId:{value:b,type:"Int",required:!0}},fields:["success","message"]}}).catch(o=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(o=>o);h&&(h.success?(n.success(h.message),g()):n.error(h.message)),l(!1)};return a.useEffect(()=>{g()},[]),e.jsxs(e.Fragment,{children:[e.jsx(qe,{spinning:y,children:e.jsx(ee,{style:{overflowX:"auto"},wrap:!1,children:f.map(b=>{var h,o;return e.jsxs("span",{style:{width:"14.1vw",margin:"1px",padding:"0px"},children:[e.jsxs(ee,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{marginLeft:5},children:e.jsx("h2",{children:b.name})}),e.jsx("span",{style:{position:"relative",right:"0px",marginTop:8},children:e.jsx(O,{title:"Click to Start Scheduling for "+b.name,color:"green",placement:"left",children:e.jsx(q,{disabled:t.advanced?(h=t.studyCourse)==null?void 0:h.published:(o=t.schoolTimetableEducationLevel)==null?void 0:o.published,size:"small",icon:e.jsx(Te,{}),onClick:()=>z(b),children:"Add"})})})]}),e.jsx("div",{style:{maxHeight:"83vh",overflowY:"auto",overflowX:"hidden"},children:e.jsx(me,{style:{margin:"0px",padding:"0px"},bordered:!0,dataSource:b.events,renderItem:s=>e.jsxs(e.Fragment,{children:[e.jsx(me.Item,{children:e.jsxs(se,{direction:"vertical",children:[e.jsxs("span",{style:{fontSize:18},children:[s.advanced?e.jsx(e.Fragment,{children:e.jsx(O,{title:s.module.name,color:"green",children:e.jsx(M,{color:"green",children:s.module.code})})}):e.jsx(e.Fragment,{children:s.subject.name}),!s.advanced&&e.jsxs(se,{children:[e.jsx(M,{color:"green",style:{marginLeft:10},children:s.educationLevel.name}),s.group&&e.jsx(e.Fragment,{children:e.jsx(M,{color:"green",children:s.group.name})})]})]}),e.jsx("span",{style:{fontSize:18},children:e.jsxs(se,{children:[e.jsx(M,{color:"green",children:s.venue.name}),e.jsx(te,{title:"Are you sure to delete this Timetable Entry?",onConfirm:()=>L(s.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ee,{})})}),e.jsx(q,{icon:e.jsx(He,{}),onClick:()=>v(b,s.id)}),e.jsx(O,{title:e.jsxs(e.Fragment,{children:[!s.advanced&&e.jsxs(e.Fragment,{children:[s.teacher.firstName&&e.jsxs(Y,{title:"Teacher Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.teacher.firstName," ",s.teacher.middleName," ",s.teacher.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.teacher.email}),e.jsx(Y.Item,{label:"Phone",children:s.teacher.phone})]}),s.supervisor.firstName&&e.jsxs(Y,{title:"Exam Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.supervisor.firstName," ",s.supervisor.middleName," ",s.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:s.supervisor.phone})]})]}),s.advanced&&e.jsxs(e.Fragment,{children:[s.lecturer.firstName&&e.jsxs(Y,{title:"Lecturer Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.lecturer.firstName," ",s.lecturer.middleName," ",s.lecturer.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.lecturer.email}),e.jsx(Y.Item,{label:"Phone",children:s.lecturer.phone})]}),s.supervisor.firstName&&e.jsxs(Y,{title:"Exam Supervisor Informations",column:1,children:[e.jsxs(Y.Item,{label:"Name",children:[s.supervisor.firstName," ",s.supervisor.middleName," ",s.supervisor.lastName]}),e.jsx(Y.Item,{label:"Email",children:s.supervisor.email}),e.jsx(Y.Item,{label:"Phone",children:s.supervisor.phone})]})]})]}),color:"white",overlayInnerStyle:{color:"black"},children:e.jsx(q,{type:"primary",shape:"circle",icon:e.jsx(tt,{})})})]})})]})}),s.isExam&&e.jsx(me.Item,{children:e.jsx("span",{style:{fontSize:18},children:re(s.dueDate).format("YYYY MMM, DD")})}),e.jsxs(et,{children:[s.startAt," - ",s.endAt]})]})})})]})})})}),e.jsx(de,{title:(I==null?void 0:I.name)+" Scheduler",width:"45vw",open:_,onClose:b=>r(b),children:e.jsx(Xe,{advanced:t.advanced,schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:w,entry:I,onFinish:S})}),e.jsx(de,{title:(I==null?void 0:I.name)+" Scheduler",width:"45vw",open:C,onClose:b=>F(b),children:e.jsx(Xe,{advanced:t.advanced,schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:w,entry:I,onFinish:S,studyCourse:t.studyCourse})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[I==null?void 0:I.name," Scheduler"]}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:"Editting"})})]}),width:"45vw",open:c,onClose:b=>j(b),children:e.jsx(Ft,{schoolTimetable:t.schoolTimetable,schoolTimetableEducationLevel:t.schoolTimetableEducationLevel,randKey:Math.random(),form:w,entry:I,onFinish:S})})]})},Dt=()=>{var P,_,r,c,j;const[t,y]=a.useState(),[l,p]=a.useState(),i=Pe(),f=async(C,F)=>{const{data:w}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolStudyCourseTimetable",variables:{schoolStudyCourseTimetableId:{value:C,type:"Int",required:!0},published:{value:F,type:"Boolean",required:!0}},fields:["success","message",{schoolStudyCourseTimetable:["id",{studyCourse:["id","year","semester","semesterDisplay","level","levelDisplay",{course:["id","name"]}]},"published","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(A=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(A=>A);w&&(w.success?(p(w.schoolStudyCourseTimetable),n.success(w.message)):n.error(w.message))},T=async()=>{const{data:C}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCourse",variables:{id:{value:parseInt(i.id),type:"Int",required:!0}},fields:["id",{studyCourse:["id","year","semester","semesterDisplay","level","levelDisplay",{course:["id","name"]}]},"published","created","updated","isActive","canEdit","canDelete","canManage"]}}).catch(F=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(F=>F);C&&p(C)},I=async()=>{const{data:C}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetable",variables:{id:{value:parseInt(i.tid),type:"Int",required:!0}},fields:["id","title","description",{school:["id"]},"forExamination","created","updated","isActive","canEdit","canDelete","canManage"]}}).catch(F=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(F=>F);C&&y(C)};return a.useEffect(()=>{document.title=Ie.system_name+": Timetable Scheduler",I(),T()},[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(J.Item,{children:e.jsxs(be,{to:"/timetable/timetables",children:["Timetables - ",t==null?void 0:t.title]})}),e.jsxs(J.Item,{children:["Scheduler - ",(_=(P=l==null?void 0:l.studyCourse)==null?void 0:P.course)==null?void 0:_.name," -"," ",(r=l==null?void 0:l.studyCourse)==null?void 0:r.year," -"," ",(c=l==null?void 0:l.studyCourse)==null?void 0:c.semesterDisplay," -"," ",(j=l==null?void 0:l.studyCourse)==null?void 0:j.levelDisplay]})]})}),e.jsxs("div",{children:[!(l!=null&&l.published)&&e.jsx(q,{size:"large",icon:e.jsx(Fe,{style:{color:"red"}}),onClick:()=>f(l==null?void 0:l.id,!0),children:"Not Published"}),(l==null?void 0:l.published)&&e.jsx(q,{size:"large",icon:e.jsx(at,{style:{color:"green"}}),onClick:()=>f(l==null?void 0:l.id,!1),children:"Published"})]})]}),e.jsx(lt,{advanced:!0,schoolTimetable:t,studyCourse:l})]})},Nt=t=>{const[y,l]=a.useState([]),[p,i]=a.useState(0),[f,T]=a.useState(20),[I,P]=a.useState(""),[_,r]=a.useState(!0),[c]=u.useForm(),C=!ye.useBreakpoint().lg,F=[{title:"Name",dataIndex:"name",fixed:!0,render:(v,S)=>e.jsxs("span",{children:[e.jsx("a",{children:S.educationLevel.name}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:S.educationLevel.schoolType.name})})]})},{title:"",dataIndex:"action",render:(v,S)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(te,{title:"Are you sure to delete this task?",onConfirm:()=>w(S.id),onCancel:()=>{},okText:"Yes",cancelText:"No",disabled:!S.canManage,overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Te,{}),children:"Add"})})})}],w=async v=>{var z;const{data:S}=await E.custom({url:"",method:"post",meta:{operation:"createSchoolEducationLevelTimetable",variables:{schoolTimetableId:{value:parseInt(((z=t.schoolTimetable)==null?void 0:z.id.toString())??"0"),type:"Int",required:!0},schoolEducationLevelId:{value:parseInt(v.toString()),type:"Int",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(g=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(g=>g);S&&(S.success?(n.success(S.message),t.onAdd(S.schoolEducationLevelTimetable),l(y.filter(g=>g.id.toString()!==v.toString()))):n.error(S.message)),r(!1)},A=async(v,S="",z=20)=>{var L;const{data:g}=await E.custom({url:"",method:"get",meta:{operation:"timetableNotAssignedSchoolEducationLevels",variables:{schoolTimetableId:{value:parseInt(((L=t.schoolTimetable)==null?void 0:L.id.toString())??"0"),type:"Int",required:!0},page:{value:v,type:"Int",required:!0},key:{value:S,type:"String",required:!1},pageSize:{value:z,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{school:["id","name"]},{educationLevel:["id","name",{schoolType:["id","name","code"]}]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(b=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(b=>b);g&&(i(g.total),l([...g.results])),r(!1)};return a.useEffect(()=>{A(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ee,{style:{marginTop:10},children:e.jsx(B,{span:C?24:20,children:e.jsx(u,{layout:"vertical",form:c,onFinish:v=>{P(v.key),y.length=0,A(1,v.key,f)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:_,columns:F,dataSource:y,pagination:{onChange:(v,S)=>{T(S),A(v,I,S)},total:p,pageSize:f,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})]})},ot=t=>{var o,s;const[y,l]=a.useState([]),[p,i]=a.useState(1),[f,T]=a.useState(0),[I,P]=a.useState(!1),[_,r]=a.useState(!0),{push:c}=Je(),[j]=u.useForm();u.useForm(),ye.useBreakpoint().lg;const[F,w]=a.useState(!1),A=async x=>{l([x,...y])},v=async x=>{const{data:m}=await E.custom({url:"",method:"post",meta:{operation:"synchronizeTimetableEducationLevels",variables:{timetableId:{value:parseInt(x),type:"Int",required:!0}},fields:["success","message"]}}).catch(D=>(n.error("Error in synchronizing Timetable Education Levels"),{data:null})).then(D=>D);m&&(m.success?(n(m.message),b(1,"")):n.error(m.message))},S=async x=>{const{data:m}=await E.custom({url:"",method:"post",meta:{operation:"deleteSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(x.toString()),type:"Int",required:!0}},fields:["success","message"]}});m.success?(n.success(m.message),l(y.filter(D=>D.id!==x))):n.error(m.message)},z=async(x,m)=>{const{data:D}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(x.toString()),type:"Int",required:!0},publish:{value:m,type:"Boolean",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});D.success?(n.success(D.message),l(y.map(K=>K.id===D.schoolEducationLevelTimetable.id?D.schoolEducationLevelTimetable:K))):n.error(D.message)},g=()=>{n("Canceled")},L=[{title:"Name",dataIndex:"name",fixed:!0,render:(x,m,D)=>e.jsx("span",{children:e.jsx("a",{children:m.schoolEducationLevel.educationLevel.name})})},{title:"Has Entries",dataIndex:"hasEntries",fixed:!0,render:(x,m,D)=>e.jsx("span",{children:m.hasEntries?e.jsx(e.Fragment,{children:e.jsx(M,{color:"green",children:"Yes"})}):e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",children:"No"})})})},{title:"Created",dataIndex:"created",render:(x,m,D)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(m.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(x,m,D)=>e.jsx("a",{children:m!=null&&m.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"Published",dataIndex:"published",render:(x,m,D)=>e.jsx("a",{children:m!=null&&m.published?e.jsx(te,{title:"Are you sure to Un-publish?",onConfirm:()=>z(m.id,!1),onCancel:()=>{},okText:"Unpublish",cancelText:"No",okButtonProps:{disabled:!m.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"green",children:"Published"})}):e.jsx(te,{title:"Are you sure to Publish?",onConfirm:()=>z(m.id,!0),onCancel:()=>{},okText:"Publish",cancelText:"No",okButtonProps:{disabled:!m.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"red",children:"Not Published"})})})},{title:"",dataIndex:"action",render:(x,m,D)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(O,{title:"Schedule",placement:"left",children:e.jsx(q,{icon:e.jsx(xe,{}),disabled:!m.canManage,onClick:()=>{var K;return c("/timetable/education/level/scheduler/"+((K=t==null?void 0:t.schoolTimetable)==null?void 0:K.id)+"/"+m.id)}})}),e.jsx(te,{title:"Are you sure to delete this School Education Level Timetable?",onConfirm:()=>S(m==null?void 0:m.id),onCancel:()=>g,okText:"Yes",cancelText:"No",disabled:!(m!=null&&m.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ee,{}),disabled:!(m!=null&&m.canDelete)})})]})}],b=async(x,m="")=>{var K;const{data:D}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableEducationLevels",variables:{schoolTimetableId:{value:parseInt(((K=t.schoolTimetable)==null?void 0:K.id.toString())??"0"),type:"Int",required:!0},page:{value:x,type:"Int",required:!0},key:{value:m,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(oe=>(n.error("Failed loading School Timetable Education Levels"),{data:null})).then(oe=>oe);D&&(i(D.page),T(D.total),P(D.hasNext),l([...D.results])),r(!1)},h=async x=>{var D;const{data:m}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetables",variables:{timetableId:{value:parseInt(((D=t==null?void 0:t.schoolTimetable)==null?void 0:D.id.toString())??"0"),type:"Int",required:!0},publish:{value:x,type:"Boolean",required:!0}},fields:["success","message"]}});m.success?(n.success(m.message),y.length=0,l([]),b(1)):n.error(m.message)};return a.useEffect(()=>{b(p)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:12,children:e.jsx(u,{layout:"vertical",form:j,onFinish:x=>{i(1),y.length=0,b(1,x.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(B,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(O,{title:"Click to Publish All timetables Listed Below",color:"green",children:e.jsx(q,{size:"large",icon:e.jsx(yt,{style:{color:"green"}}),onClick:()=>h(!0),children:"Publish All"})}),e.jsx(O,{title:"Click to Unpublish All Timetables listed Below",color:"red",children:e.jsx(q,{size:"large",icon:e.jsx(Fe,{style:{color:"red"}}),onClick:()=>h(!1),children:"Unpublish All"})}),e.jsx(q,{size:"large",icon:e.jsx(st,{}),onClick:()=>w(!0),children:"Add"}),((o=t.schoolTimetable)==null?void 0:o.forExamination)&&e.jsx(O,{title:"Synchronization All Education Levels Related to Examination",placement:"top",color:"green",children:e.jsx(q,{size:"large",icon:e.jsx(nt,{}),onClick:()=>{var x;return v((x=t.schoolTimetable)==null?void 0:x.id)},children:"Sync"})})]})]}),e.jsx(ge,{loading:_,columns:L,dataSource:y,pagination:!1,scroll:{y:"60vh"}}),e.jsx(ve,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Adding School Education Levels to "}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:(s=t.schoolTimetable)==null?void 0:s.title})})]}),width:"45vw",anchor:"right",onClose:x=>w(x),open:F,noOverFlow:!0,children:e.jsx(Nt,{randKey:Math.random(),schoolTimetable:t.schoolTimetable,onAdd:A})})]})},Pt=()=>{const[t,y]=a.useState(),[l,p]=a.useState(),[i,f]=a.useState(!1),T=Pe(),I=async()=>{const{data:r}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableEducationLevel",variables:{id:{value:parseInt(T.id),type:"Int",required:!0}},fields:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},"created","updated","isActive","published","canEdit","canDelete","canManage"]}}).catch(c=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(c=>c);r&&p(r)},P=async()=>{const{data:r}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetable",variables:{id:{value:parseInt(T.tid),type:"Int",required:!0}},fields:["id","title","description",{school:["id"]},"forExamination","created","updated","isActive","isPublished","canEdit","canDelete","canManage"]}}).catch(c=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(c=>c);r&&y(r)},_=async(r,c)=>{const{data:j}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolEducationLevelTimetable",variables:{schoolEducationLevelTimetableId:{value:parseInt(r.toString()),type:"Int",required:!0},publish:{value:c,type:"Boolean",required:!0}},fields:["success","message",{schoolEducationLevelTimetable:["id",{schoolEducationLevel:["id",{educationLevel:["id","name"]}]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});j.success?(n.success(j.message),p(j.schoolEducationLevelTimetable)):n.error(j.message)};return a.useEffect(()=>{document.title=Ie.system_name+": School Timetable Education Level Scheduler",P(),I()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(J.Item,{children:e.jsxs(be,{to:"/timetable/timetables",children:["Timetables - ",t==null?void 0:t.title]})}),e.jsxs(J.Item,{children:["Scheduler -"," ",l==null?void 0:l.schoolEducationLevel.educationLevel.name]}),(l==null?void 0:l.published)&&e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",style:{fontSize:16,padding:3},children:"To Continue Scheduling this Timetable, you first need to Unpublish"})})]})}),e.jsxs("div",{style:{float:"right"},children:[(l==null?void 0:l.published)&&e.jsx(te,{title:"Are you sure to Unpublish Timetable",placement:"left",onConfirm:()=>_(l==null?void 0:l.id,!1),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(St,{style:{color:"red"}}),style:{float:"right"},children:"Unpublish"})}),!(l!=null&&l.published)&&e.jsx(e.Fragment,{children:e.jsx(te,{title:"Are you sure to Publish Timetable",placement:"left",onConfirm:()=>_(l==null?void 0:l.id,!0),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(at,{style:{color:"green"}}),style:{float:"right"},children:"Publish"})})}),e.jsx(O,{title:"Click to Switch to Other Related Timetables, so as to continue scheduling",color:"green",placement:"left",children:e.jsx(q,{icon:e.jsx(bt,{style:{color:"green"}}),style:{float:"right"},onClick:()=>f(!0),children:"Switch"})})]}),e.jsx("div",{style:{marginTop:45},children:e.jsx(lt,{advanced:!1,schoolTimetable:t,schoolTimetableEducationLevel:l})})]}),e.jsx(de,{title:"Timetable Switcher",width:"70vw",open:i,onClose:r=>f(r),children:e.jsx(ot,{schoolTimetable:t,randKey:Math.random()})})]})};G.extend(vt);const Z="HH:mm",Lt=t=>{const[y,l]=a.useState(!1),[p]=u.useForm(),[i,f]=a.useState(),[T,I]=a.useState(!0),[P,_]=a.useState(!1),[r,c]=a.useState(!1),[j,C]=a.useState(!1),[F,w]=a.useState(!1),[A,v]=a.useState(!1),[S,z]=a.useState(!1),[g,L]=a.useState(!1),b=async o=>{l(!0);const{data:s}=await E.custom({url:"",method:"post",meta:{operation:"updateSchoolTimetablingSettings",variables:{perPeriodDuration:{value:o.per_period_duration,type:"Int",required:!0},periodsStartsAt:{value:o.periods_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"),type:"String",required:!1},periodsEndsAt:{value:o.periods_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"),type:"String",required:!1},breaktimeStartAt:{value:o.breaktime_start_at?o.breaktime_start_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},breaktimeEndAt:{value:o.breaktime_end_at?o.breaktime_end_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},allowSaturdayScheduling:{value:o.allow_saturday_scheduling??!1,type:"Boolean",required:!1},allowSundayScheduling:{value:o.allow_sunday_scheduling??!1,type:"Boolean",required:!1},morningSessionStartsAt:{value:o.morning_session_starts_at?o.morning_session_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},morningSessionEndsAt:{value:o.morning_session_ends_at?o.morning_session_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},eveningSessionStartsAt:{value:o.evening_session_starts_at?o.evening_session_starts_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1},eveningSessionEndsAt:{value:o.evening_session_ends_at?o.evening_session_ends_at.utcOffset(0,!0).format("YYYY-MM-DDTHH:mm:ss"):null,type:"String",required:!1}},fields:["success","message",{schoolTimetablingSettings:["id",{school:Ke},"perPeriodDuration","periodsStartsAt","periodsEndsAt","breaktimeStartAt","breaktimeEndAt","morningSessionStartsAt","morningSessionEndsAt","eveningSessionStartsAt","eveningSessionEndsAt","allowSaturdayScheduling","allowSundayScheduling","created","updated","canEdit","canDelete","canManage"]}]}}).catch(x=>(console.error(x),n.error("Error occured while updating Timetabling Settings"),{data:null})).then(x=>x);s?s.success&&(n.success(s.message),s.periodsStartsAt=G(s.periodsStartsAt).utc(),s.periodsEndsAt=G(s.periodsEndsAt).utc(),s.breaktimeStartAt=G(s.breaktimeStartAt).utc(),s.breaktimeEndAt=G(s.breaktimeEndAt).utc(),f(s.schoolTimetablingSettings)):(n.remove(),n.error("Something Went Wrong ... please try again ...")),l(!1)},h=async()=>{l(!0);const{data:o}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetablingSetting",fields:["id",{school:Ke},"perPeriodDuration","periodsStartsAt","periodsEndsAt","breaktimeStartAt","breaktimeEndAt","morningSessionStartsAt","morningSessionEndsAt","eveningSessionStartsAt","eveningSessionEndsAt","allowSaturdayScheduling","allowSundayScheduling","created","updated","canEdit","canDelete","canManage"]}}).catch(s=>(console.error(s),n.error("Error occured while getting Timetabling Settings"),{data:null})).then(s=>s);o&&f(o),l(!1)};return a.useEffect(()=>{h()},[]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:y,children:i&&e.jsx(ee,{style:{marginTop:10},children:e.jsx(B,{span:24,children:e.jsx(Tt,{children:e.jsxs(u,{layout:"horizontal",form:p,onFinish:o=>{console.log(o),b(o)},requiredMark:!0,initialValues:{per_period_duration:(i==null?void 0:i.perPeriodDuration)??60,periods_starts_at:i!=null&&i.periodsEndsAt?G(i==null?void 0:i.periodsStartsAt,Z):void 0,periods_ends_at:i!=null&&i.periodsEndsAt?G(i==null?void 0:i.periodsEndsAt,Z):void 0,breaktime_start_at:i!=null&&i.breaktimeStartAt?G(i==null?void 0:i.breaktimeStartAt,Z):void 0,breaktime_end_at:i!=null&&i.breaktimeEndAt?G(i==null?void 0:i.breaktimeEndAt,Z):void 0,allow_saturday_scheduling:(i==null?void 0:i.allowSaturdayScheduling)??!1,allow_sunday_scheduling:(i==null?void 0:i.allowSundayScheduling)??!1,morning_session_starts_at:i!=null&&i.morningSessionStartsAt?G(i==null?void 0:i.morningSessionStartsAt,Z):void 0,morning_session_ends_at:i!=null&&i.morningSessionEndsAt?G(i==null?void 0:i.morningSessionEndsAt,Z):void 0,evening_session_starts_at:i!=null&&i.eveningSessionStartsAt?G(i==null?void 0:i.eveningSessionStartsAt,Z):void 0,evening_session_ends_at:i!=null&&i.eveningSessionEndsAt?G(i==null?void 0:i.eveningSessionEndsAt,Z):void 0},children:[e.jsx(u.Item,{label:"Per Period Duration in Minutes",name:"per_period_duration",rules:[{required:!0,message:"Please input Per Period Duration in Minutes!"}],style:{width:"50%"},children:e.jsx(U,{})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(se,{direction:"horizontal",children:[e.jsx(u.Item,{label:"Periods Start At(24 Hours Format)",name:"periods_starts_at",rules:[{required:T,message:"Please input Periods Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:G("12:00",Z),format:Z,minuteStep:15,hourStep:1,onChange:o=>{_(!!o)}})}),e.jsx(u.Item,{label:"Periods End At(24 Hours Format)",name:"periods_ends_at",rules:[{required:P,message:"Please input Periods End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Z,minuteStep:15,hourStep:1,onChange:o=>{I(!!o)},disabledHours:()=>p.getFieldValue("periods_starts_at")?Array.from({length:p.getFieldValue("periods_starts_at").hour()},(o,s)=>s):[],disabledMinutes:o=>p.getFieldValue("periods_starts_at")&&p.getFieldValue("periods_starts_at").hour()===o?Array.from({length:p.getFieldValue("periods_starts_at").minute()},(s,x)=>x):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(se,{direction:"horizontal",children:[e.jsx(u.Item,{label:"Morning Session Start At(24 Hours Format)",name:"morning_session_starts_at",rules:[{required:F,message:"Please input Morning Session Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:G("12:00",Z),format:Z,minuteStep:15,hourStep:1,onChange:o=>{v(!!o)}})}),e.jsx(u.Item,{label:"Morning Session End At(24 Hours Format)",name:"morning_session_ends_at",rules:[{required:A,message:"Please input Morning Session End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Z,minuteStep:15,hourStep:1,onChange:o=>{w(!!o)},disabledHours:()=>p.getFieldValue("morning_session_starts_at")?Array.from({length:p.getFieldValue("morning_session_starts_at").hour()},(o,s)=>s):[],disabledMinutes:o=>p.getFieldValue("morning_session_starts_at")&&p.getFieldValue("morning_session_starts_at").hour()===o?Array.from({length:p.getFieldValue("morning_session_starts_at").minute()},(s,x)=>x):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(se,{direction:"horizontal",children:[e.jsx(u.Item,{label:"Evening Session Start At(24 Hours Format)",name:"evening_session_starts_at",rules:[{required:S,message:"Please input Evening Session Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{defaultValue:G("12:00",Z),format:Z,minuteStep:15,hourStep:1,onChange:o=>{L(!!o)}})}),e.jsx(u.Item,{label:"Evening Session End At(24 Hours Format)",name:"evening_session_ends_at",rules:[{required:g,message:"Please input Evening Session End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Z,minuteStep:15,hourStep:1,onChange:o=>{z(!!o)},disabledHours:()=>p.getFieldValue("evening_session_starts_at")?Array.from({length:p.getFieldValue("evening_session_starts_at").hour()},(o,s)=>s):[],disabledMinutes:o=>p.getFieldValue("evening_session_starts_at")&&p.getFieldValue("evening_session_starts_at").hour()===o?Array.from({length:p.getFieldValue("evening_session_starts_at").minute()},(s,x)=>x):[]})})]})}),e.jsx("span",{style:{display:"block"},children:e.jsxs(se,{direction:"horizontal",children:[e.jsx(u.Item,{label:"Break start At (24 Hours Format)",name:"breaktime_start_at",rules:[{required:r,message:"Please input Break Start Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Z,minuteStep:15,hourStep:1,onChange:o=>{C(!!o)}})}),e.jsx(u.Item,{label:"Break End At (24 Hours Format)",name:"breaktime_end_at",rules:[{required:j,message:"Please input Break End Time!"}],style:{width:"100%"},children:e.jsx(ue,{format:Z,minuteStep:15,hourStep:1,onChange:o=>{c(!!o)},disabledHours:()=>p.getFieldValue("breaktime_start_at")?Array.from({length:p.getFieldValue("breaktime_start_at").hour()},(o,s)=>s):[],disabledMinutes:o=>p.getFieldValue("breaktime_start_at")&&p.getFieldValue("breaktime_start_at").hour()===o?Array.from({length:p.getFieldValue("breaktime_start_at").minute()},(s,x)=>x):[]})})]})}),e.jsx(u.Item,{label:"Allow Saturday Scheduling",name:"allow_saturday_scheduling",rules:[{required:!1,type:"boolean",message:"Allow Saturday Scheduling"}],style:{width:"50%"},valuePropName:"checked",children:e.jsx(_e,{defaultChecked:(i==null?void 0:i.allowSaturdayScheduling)??!1})}),e.jsx(u.Item,{label:"Allow Sunday Scheduling",name:"allow_sunday_scheduling",rules:[{type:"boolean",required:!1,message:"Allow Sunday Scheduling"}],style:{width:"50%"},valuePropName:"checked",children:e.jsx(_e,{})}),e.jsx(u.Item,{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",htmlType:"submit",children:"Save"})})]})})})})})})},zt=()=>(a.useEffect(()=>(document.title=Ie.system_name+": Timetable Dashboard",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{marginBottom:10},children:e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx("a",{href:"/",children:"Home"})}),e.jsx(J.Item,{children:e.jsx("a",{href:"/timetable",children:"Timetable"})}),e.jsx("span",{children:"Dashboard"})]})})}),e.jsx(Lt,{})]})),{TextArea:Vt}=U,{Option:Yt}=R,Ht=t=>{const[y,l]=a.useState(!1),[p,i]=a.useState([]),[f,T]=a.useState(),I=r=>{T(r)},P=async(r=1,c="")=>{l(!0);const{data:j}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenueTypes",variables:{page:{value:r,type:"Int",required:!0},key:{value:c,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","isActive","created","updated","canEdit","canDelete","canManage"]}]}});i(j.results),l(!1)},_=async r=>{const{data:c}=await E.custom({url:"",method:"post",meta:{operation:"createSchoolVenue",variables:{name:{value:r.name,type:"String",required:!0},code:{value:r.code,type:"String",required:!0},schoolVenueTypeId:{value:parseInt(r.school_venue_type_id),type:"Int",required:!0},description:{value:r.description,type:"String",required:!1},capacity:{value:parseInt(r.capacity),type:"Int",required:!1},longitude:{value:r.longitude,type:"Float",required:!1},latitude:{value:r.latitude,type:"Float",required:!1}},fields:["success","message",{schoolVenue:["id","name","code","description",{schoolVenueType:["id","name"]},"capacity","latitude","longitude","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(j=>(n.error("Error occured while creating school venue"),{data:null})).then(j=>j);c&&(c.success?(n.success(c.message),t.onFinish(c.schoolVenue),t.form.resetFields()):n.error(c.message))};return a.useEffect(()=>{P()},[t.randKey]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:y,children:e.jsxs(u,{layout:"vertical",form:t.form,onFinish:r=>{r.school_venue_type_id=f,_(r)},children:[e.jsx(u.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Name ..."})}),e.jsx(u.Item,{name:"code",label:"Code",rules:[{required:!0,type:"string",message:"Please input Code"}],children:e.jsx(U,{size:"large",placeholder:"Enter Code ..."})}),e.jsx(u.Item,{name:"capacity",label:"Capacity",children:e.jsx(rt,{size:"large",min:0,defaultValue:45,style:{width:"100%"}})}),e.jsx(u.Item,{label:"School Type",rules:[{required:!0,type:"string",message:"Please choose School Type"}],children:e.jsx(R,{showSearch:!0,size:"large",placeholder:"Select a School Venue Type",optionFilterProp:"children",onChange:I,onSearch:r=>{},filterOption:(r,c)=>c.children.toLowerCase().includes(r.toLowerCase()),dropdownStyle:{zIndex:9999},children:p.map((r,c)=>e.jsx(Yt,{value:r.id,children:r.name}))})}),e.jsx(u.Item,{name:"latitude",label:"Latitude",rules:[{required:!1,type:"number",message:"Please input Latidue"}],children:e.jsx(U,{size:"large",placeholder:"Enter Latitude ..."})}),e.jsx(u.Item,{name:"longitude",label:"Longitude",rules:[{required:!1,type:"number",message:"Please input Longitude"}],children:e.jsx(U,{size:"large",placeholder:"Enter Longitude ..."})}),e.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(Vt,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})})},{TextArea:Wt}=U,{Option:Ot}=R,Bt=t=>{var r;const[y,l]=a.useState(!1),[p,i]=a.useState([]),[f,T]=a.useState(),I=c=>{T(c)},P=async(c=1,j="")=>{l(!0);const{data:C}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenueTypes",variables:{page:{value:c,type:"Int",required:!0},key:{value:j,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","isActive","created","updated","canEdit","canDelete","canManage"]}]}});i(C.results),l(!1)},_=async c=>{const{data:j}=await E.custom({url:"",method:"post",meta:{operation:"updateSchoolVenue",variables:{schoolVenueId:{value:parseInt(c.school_venue_id),type:"Int",required:!0},name:{value:c.name,type:"String",required:!0},code:{value:c.code,type:"String",required:!0},schoolVenueTypeId:{value:parseInt(c.school_venue_type_id),type:"Int",required:!0},description:{value:c.description,type:"String",required:!1},capacity:{value:parseInt(c.capacity),type:"Int",required:!1},longitude:{value:c.longitude,type:"Float",required:!1},latitude:{value:c.latitude,type:"Float",required:!1}},fields:["success","message",{schoolVenue:["id","name","code","description",{schoolVenueType:["id","name"]},"capacity","latitude","longitude","created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(C=>(n.error("Error occured while Updating school venue"),{data:null})).then(C=>C);j&&(j.success?(n.success(j.message),t.onFinish(j.schoolVenue),t.form.resetFields()):n.error(j.message))};return a.useEffect(()=>{var c,j,C,F,w,A,v,S;P(),t.form.setFieldsValue({name:(c=t.venue)==null?void 0:c.name,code:(j=t.venue)==null?void 0:j.code,capacity:(C=t.venue)==null?void 0:C.capacity,description:(F=t.venue)==null?void 0:F.description,school_venue_type_id:(w=t.venue)==null?void 0:w.schoolVenueType.id,longitude:(A=t.venue)==null?void 0:A.longitude,latitude:(v=t.venue)==null?void 0:v.latitude}),I((S=t.venue)==null?void 0:S.schoolVenueType.id)},[t.randKey]),e.jsx(e.Fragment,{children:e.jsx(qe,{spinning:y,children:e.jsxs(u,{layout:"vertical",form:t.form,onFinish:c=>{var j;c.school_venue_type_id=f,c.school_venue_id=(j=t.venue)==null?void 0:j.id,_(c)},requiredMark:!1,children:[e.jsx(u.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Name"}],children:e.jsx(U,{size:"large",placeholder:"Enter Name ..."})}),e.jsx(u.Item,{name:"code",label:"Code",rules:[{required:!0,type:"string",message:"Please input Code"}],children:e.jsx(U,{size:"large",placeholder:"Enter Code ..."})}),e.jsx(u.Item,{name:"capacity",label:"Capacity",children:e.jsx(rt,{min:0,defaultValue:45,style:{width:"100%"}})}),e.jsx(u.Item,{label:"School Type",rules:[{required:!0,type:"string",message:"Please choose School Type"}],children:e.jsx(R,{showSearch:!0,placeholder:"Select a School Venue Type",optionFilterProp:"children",onChange:I,defaultValue:(r=t.venue)==null?void 0:r.schoolVenueType.id,onSearch:c=>{},filterOption:(c,j)=>j.children.toLowerCase().includes(c.toLowerCase()),dropdownStyle:{zIndex:9999},children:p.map((c,j)=>e.jsx(Ot,{value:c.id,children:c.name}))})}),e.jsx(u.Item,{name:"latitude",label:"Latitude",rules:[{required:!1,type:"number",message:"Please input Latidue"}],children:e.jsx(U,{size:"large",placeholder:"Enter Latitude ..."})}),e.jsx(u.Item,{name:"longitude",label:"Longitude",rules:[{required:!1,type:"number",message:"Please input Longitude"}],children:e.jsx(U,{size:"large",placeholder:"Enter Longitude ..."})}),e.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(Wt,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})})},Kt=t=>{const[y,l]=a.useState(),[p,i]=a.useState([]),[f,T]=a.useState(0),[I,P]=a.useState(!0),[_,r]=a.useState(20),[c,j]=a.useState(""),[C]=u.useForm(),[F]=u.useForm(),A=!ye.useBreakpoint().lg,[v,S]=a.useState(!1),[z,g]=a.useState(!1),L=x=>{l(x),g(!0)},b=async x=>{const{data:m}=await E.custom({url:"",method:"post",meta:{operation:"deleteSchoolVenue",variables:{schoolVenueId:{value:x,type:"Int",required:!0}},fields:["success","message"]}}).catch(D=>(n.error("Error occured while Deleting School Venue"),{data:null})).then(D=>D);m&&(m.success?(n.success(m.message),i(p.filter(D=>D.id.toString()!==x.toString()))):n.error(m.message))},h=async x=>{i([x,...p]),F.resetFields()},o=async x=>{const m=p.findIndex(D=>D.id===x.id);p[m]=x,i([...p]),F.resetFields(),l(void 0),g(!1)},s=async(x,m="",D=20)=>{P(!0);const{data:K}=await E.custom({url:"",method:"get",meta:{operation:"schoolVenues",variables:{page:{value:x,type:"Int",required:!0},key:{value:m,type:"String",required:!1},pageSize:{value:D,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","capacity","description","latitude","longitude",{school:["id"]},{schoolVenueType:["id","name"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(oe=>(n.error("Error occured while fetching roles"),{data:null})).then(oe=>oe);K&&(T(K.total),i([...K.results])),P(!1)};return a.useEffect(()=>{s(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:A?24:10,children:e.jsx(u,{layout:"vertical",form:C,onFinish:x=>{j(x.key),p.length=0,s(1,x.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:A?24:2,children:e.jsx(q,{icon:e.jsx(ce,{}),size:"large",onClick:()=>C.submit()})}),e.jsx(B,{span:A?24:12,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(O,{title:"Register a New Venue/Class",children:e.jsx(q,{icon:e.jsx(Te,{}),size:"large",onClick:()=>S(!0),children:"Add Venue"})})})})]}),e.jsx(ge,{loading:I,columns:[{title:"Name",dataIndex:"name",fixed:!0,render:(x,m,D)=>e.jsx("span",{children:e.jsx("a",{children:m.name})})},{title:"Code",dataIndex:"code",render:(x,m,D)=>e.jsx("span",{children:m.code})},{title:"Venue Type",dataIndex:"venue_type",render:(x,m,D)=>{var K;return e.jsx("span",{children:e.jsx(M,{color:"green",children:(K=m==null?void 0:m.schoolVenueType)==null?void 0:K.name})})}},{title:"Capacity",dataIndex:"capacity",render:(x,m,D)=>e.jsx("span",{children:m.capacity})},{title:"Date Created",dataIndex:"created",render:(x,m,D)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(m.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(x,m,D)=>e.jsx("span",{children:m!=null&&m.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(x,m,D)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(Qe,{trigger:["click"],overlay:e.jsxs(he,{children:[e.jsx(he.Item,{icon:e.jsx(Ee,{}),disabled:!m.canDelete,children:e.jsx(te,{placement:"topLeft",title:`Are you sure you want to delete ${m.name} Venue?`,onConfirm:()=>b(parseInt(m.id)),okText:"Yes",cancelText:"No",children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(he.Item,{icon:e.jsx(He,{}),disabled:!m.canEdit,onClick:()=>L(m),children:e.jsx("a",{rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:K=>K.preventDefault(),children:e.jsx(it,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}],dataSource:p,pagination:{onChange:(x,m)=>{r(m),s(x,c,m)},total:f,pageSize:_,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(80vh - 80px)"}}),e.jsx(de,{title:"Register New Venue/Class",width:"30vw",open:v,onClose:x=>S(x),children:e.jsx(Ht,{randKey:Math.random(),form:F,onFinish:h})}),e.jsx(de,{title:"Edditing Venue/Class",width:"30vw",open:z,onClose:x=>g(x),children:e.jsx(Bt,{randKey:Math.random(),form:F,onFinish:o,venue:y})})]})},Gt=()=>(a.useEffect(()=>(document.title=Ie.system_name+": School Venues",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(J.Item,{children:"Venues/Classes"})]})}),e.jsx(Kt,{})]})),{TextArea:Rt}=U,{Option:Ye}=R,dt=[];for(let t=2022;t<new Date().getFullYear()+3;t++)dt.push(e.jsx(Ye,{value:t,children:t.toString()},t.toString()));const Ut=t=>{const[y,l]=a.useState(!1),[p,i]=a.useState([]),[f,T]=a.useState([]),I=async()=>{const{data:r}=await E.custom({url:"",method:"get",meta:{operation:"schoolExaminations",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(c=>(n.error("Failed to get school Examinations"),{data:null})).then(c=>c);r&&i(r.results)},P=async()=>{const{data:r}=await E.custom({url:"",method:"get",meta:{operation:"schoolTypes",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(c=>(n.error("Error occured while fetching school types"),{data:null})).then(c=>c);r&&T(r.results)},_=async r=>{const{data:c}=await E.custom({url:"",method:"post",meta:{operation:"createSchoolTimetable",variables:{title:{value:r.title,type:"String",required:!0},description:{value:r.description,type:"String",required:!1},startAt:{value:r.start_at,type:"DateTime",required:!0},endAt:{value:r.end_at,type:"DateTime",required:!0},year:{value:r.year,type:"Int",required:!0},timetableType:{value:parseInt(r.timetable_type),type:"Int",required:!0},forExamination:{value:r.for_examination,type:"Boolean",required:!1},schoolExaminationId:{value:parseInt(r.school_examination_id),type:"Int",required:!1}},fields:["success","message",{schoolTimetable:["id","title","description","startAt","endAt","timetableType","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id","name"]},{schoolExamination:["id","name"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(j=>(n.error("Error occured while creating school timetable"),{data:null})).then(j=>j);c&&(c.success?(n.success(c.message),t.onFinish(c.schoolTimetable),t.form.resetFields()):n.error(c.message))};return a.useEffect(()=>{I(),P()},[t.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:t.form,onFinish:r=>{r.for_examination=y,r.year?r.year=parseInt(r.year):r.year=new Date().getFullYear(),_(r)},children:[e.jsx(u.Item,{name:"timetable_type",label:"Timetable Type",rules:[{required:!0,type:"string",message:"Please select Timetable Type"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Timetable Type ...",dropdownStyle:{zIndex:9999},children:f.map(r=>e.jsx(Ye,{value:r.id,children:r.name},r.id))})}),e.jsx(u.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Title"}],children:e.jsx(U,{size:"large",placeholder:"Enter Title ..."})}),e.jsx(u.Item,{name:"year",label:"Academic Year",children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Select Year",defaultValue:new Date().getFullYear(),dropdownStyle:{zIndex:9999},children:dt})}),e.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(Rt,{rows:4})}),e.jsxs(ee,{children:[e.jsx(B,{span:12,children:e.jsx(u.Item,{name:"start_at",label:"Start At",rules:[{required:!0,type:"date",message:"Please input Start At Date"}],children:e.jsx(we,{style:{width:"100%"},disabledDate:r=>{const c=re().format("YYYY-MM-DD");return r&&r<re(c,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:12,children:e.jsx(u.Item,{name:"end_at",label:"End At",rules:[{required:!0,type:"date",message:"Please input End At Date"}],children:e.jsx(we,{style:{width:"100%"},disabledDate:r=>{const c=re().format("YYYY-MM-DD");return r&&r<re(c,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})})]}),e.jsx(u.Item,{name:"for_examination",valuePropName:"checked",children:e.jsx(_e,{onChange:r=>{r.target.checked?l(!0):l(!1)},children:"For Examination"})}),y&&e.jsx(u.Item,{name:"school_examination_id",label:"Examination",rules:[{required:y,type:"string",message:"Please select Examination"}],children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Choose Examination ...",dropdownStyle:{zIndex:9999},children:p==null?void 0:p.map(r=>e.jsx(Ye,{value:r.id.toString(),children:r.name},r.id))})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{Option:ct}=R,{TextArea:$t}=U,ut=[];for(let t=2022;t<new Date().getFullYear()+3;t++)ut.push(e.jsx(ct,{value:t,children:t.toString()},t.toString()));const Xt=t=>{const[y,l]=a.useState([]),p=async()=>{const{data:f}=await E.custom({url:"",method:"get",meta:{operation:"schoolTypes",variables:{},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","created","updated","isActive","canEdit","canManage","canDelete"]}]}}).catch(T=>(n.error("Error occured while fetching school types"),{data:null})).then(T=>T);f&&l(f.results)},i=async f=>{const{data:T}=await E.custom({url:"",method:"post",meta:{operation:"updateSchoolTimetable",variables:{schoolTimetableId:{value:parseInt(f.school_timetable_id),type:"Int",required:!0},title:{value:f.title,type:"String",required:!0},description:{value:f.description,type:"String",required:!1},startAt:{value:f.start_at,type:"DateTime",required:!0},endAt:{value:f.end_at,type:"DateTime",required:!0},year:{value:f.year,type:"Int",required:!0},timetableType:{value:parseInt(f.timetable_type),type:"Int",required:!0},forExamination:{value:f.for_examination,type:"Boolean",required:!1}},fields:["success","message",{schoolTimetable:["id","title","description","startAt","endAt","timetableType","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id","name"]},{schoolExamination:["id","name"]},"created","updated","isActive","canEdit","canDelete","canManage"]}]}}).catch(I=>(n.error("Error occured while creating school timetable"),{data:null})).then(I=>I);T&&(T.success?(n.success(T.message),t.onFinish(T.schoolTimetable),t.form.resetFields()):n.error(T.message))};return a.useEffect(()=>{var f,T,I,P,_,r,c,j;p(),t.form.setFieldsValue({title:(f=t==null?void 0:t.schoolTimetable)==null?void 0:f.title,description:(T=t==null?void 0:t.schoolTimetable)==null?void 0:T.description,start_at:G((I=t==null?void 0:t.schoolTimetable)==null?void 0:I.startAt),end_at:G((P=t==null?void 0:t.schoolTimetable)==null?void 0:P.endAt),timetable_type:(r=(_=t==null?void 0:t.schoolTimetable)==null?void 0:_.timetableSchoolType)==null?void 0:r.id,year:(c=t==null?void 0:t.schoolTimetable)==null?void 0:c.year,for_examination:(j=t==null?void 0:t.schoolTimetable)==null?void 0:j.forExamination})},[t.randKey]),e.jsx(e.Fragment,{children:e.jsxs(u,{layout:"vertical",form:t.form,onFinish:f=>{var T;f.school_timetable_id=(T=t.schoolTimetable)==null?void 0:T.id,i(f)},children:[e.jsx(u.Item,{name:"timetable_type",label:"Timetable Type",children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Timetable Type ...",disabled:!0,dropdownStyle:{zIndex:9999},children:y.map(f=>e.jsx(ct,{value:f.id,children:f.name},f.id))})}),e.jsx(u.Item,{name:"title",label:"Title",rules:[{required:!0,type:"string",message:"Please input Title"}],children:e.jsx(U,{size:"large",placeholder:"Enter Title ..."})}),e.jsx(u.Item,{name:"year",label:"Academic Year",children:e.jsx(R,{size:"large",style:{width:"100%"},placeholder:"Please Select Year",defaultValue:new Date().getFullYear(),dropdownStyle:{zIndex:9999},children:ut})}),e.jsx(u.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx($t,{rows:4,maxLength:6})}),e.jsxs(ee,{children:[e.jsx(B,{span:12,children:e.jsx(u.Item,{name:"start_at",label:"Start At",rules:[{required:!0,type:"date",message:"Please input Start At Date"}],children:e.jsx(we,{style:{width:"100%"},disabledDate:f=>{var I;const T=re((I=t.schoolTimetable)==null?void 0:I.startAt).format("YYYY-MM-DD");return f&&f<re(T,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})}),e.jsx(B,{span:12,children:e.jsx(u.Item,{name:"end_at",label:"End At",rules:[{required:!0,type:"date",message:"Please input End At Date"}],children:e.jsx(we,{style:{width:"100%"},disabledDate:f=>{var I;const T=re((I=t.schoolTimetable)==null?void 0:I.startAt).format("YYYY-MM-DD");return f&&f<re(T,"YYYY-MM-DD")},popupStyle:{zIndex:9999}})})})]}),e.jsx(u.Item,{name:"for_examination",valuePropName:"checked",children:e.jsx(_e,{disabled:!0,children:"For Examination"})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(q,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},Jt=t=>{const[y,l]=a.useState([]),[p,i]=a.useState(0),[f,T]=a.useState(20),[I,P]=a.useState(""),[_,r]=a.useState(!0),[c]=u.useForm(),C=!ye.useBreakpoint().lg,F=[{title:"Name",dataIndex:"name",fixed:!0,render:(v,S)=>e.jsx("span",{children:S.course.name})},{title:"Year",dataIndex:"year",fixed:!0,render:(v,S)=>e.jsx("span",{children:S.year})},{title:"Semester",dataIndex:"Semester",fixed:!0,render:(v,S)=>e.jsx("span",{children:S.semesterDisplay})},{title:"",dataIndex:"action",render:(v,S)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(te,{title:"Are you sure to delete this task?",onConfirm:()=>w(S.id),onCancel:()=>{},okText:"Yes",cancelText:"No",disabled:!S.canManage,overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Te,{}),children:"Add"})})})}],w=async v=>{var z;const{data:S}=await E.custom({url:"",method:"post",meta:{operation:"createTimetableStudyCourse",variables:{schoolTimetableId:{value:parseInt(((z=t.schoolTimetable)==null?void 0:z.id.toString())??"0"),type:"Int",required:!0},studyCourseId:{value:parseInt(v.toString()),type:"Int",required:!0}},fields:["success","message",{timetableStudyCourse:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(g=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(g=>g);S&&(S.success?(n.success(S.message),t.onAdd(S.timetableStudyCourse),l(y.filter(g=>g.id.toString()!==v.toString()))):n.error(S.message)),r(!1)},A=async(v,S="",z=20)=>{var L;const{data:g}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCoursesToAdd",variables:{schoolTimetableId:{value:parseInt(((L=t.schoolTimetable)==null?void 0:L.id.toString())??"0"),type:"Int",required:!0},page:{value:v,type:"Int",required:!0},key:{value:S,type:"String",required:!1},pageSize:{value:z,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{course:["id","name"]},"year","semester","semesterDisplay","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(b=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(b=>b);g&&(i(g.total),l([...g.results])),r(!1)};return a.useEffect(()=>{A(1,"",20)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsx(ee,{style:{marginTop:10},children:e.jsx(B,{span:C?24:20,children:e.jsx(u,{layout:"vertical",form:c,onFinish:v=>{P(v.key),y.length=0,A(1,v.key,f)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ge,{loading:_,columns:F,dataSource:y,pagination:{onChange:(v,S)=>{T(S),A(v,I,S)},total:p,pageSize:f,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}})]})},Qt=t=>{var h;const[y,l]=a.useState([]),[p,i]=a.useState(1),[f,T]=a.useState(0),[I,P]=a.useState(!1),[_,r]=a.useState(!0),{push:c}=Je(),[j]=u.useForm();u.useForm(),ye.useBreakpoint().lg;const[F,w]=a.useState(!1),A=async o=>{l([o,...y])},v=async o=>{const{data:s}=await E.custom({url:"",method:"post",meta:{operation:"deleteTimetableStudyCourse",variables:{id:{value:parseInt(o.toString()),type:"Int",required:!0}},fields:["success","message"]}});s.success?(n.success(s.message),l(y.filter(x=>x.id!==o))):n.error(s.message)},S=async(o,s)=>{const{data:x}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishSchoolStudyCourseTimetable",variables:{schoolStudyCourseTimetableId:{value:parseInt(o.toString()),type:"Int",required:!0},published:{value:s,type:"Boolean",required:!0}},fields:["success","message",{schoolStudyCourseTimetable:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}});x.success?(n.success(x.message),l(y.map(m=>m.id===x.schoolStudyCourseTimetable.id?x.schoolStudyCourseTimetable:m))):n.error(x.message)},z=()=>{n("Canceled")},g=[{title:"Name",dataIndex:"name",fixed:!0,render:(o,s,x)=>e.jsx("span",{children:e.jsx("a",{children:s.studyCourse.course.name})})},{title:"Year",dataIndex:"year",fixed:!0,render:(o,s,x)=>e.jsx("span",{children:s.studyCourse.year})},{title:"Semester",dataIndex:"Semester",fixed:!0,render:(o,s,x)=>e.jsx("span",{children:s.studyCourse.semesterDisplay})},{title:"Has Entries",dataIndex:"hasEntries",fixed:!0,render:(o,s,x)=>e.jsx("span",{children:s.hasEntries?e.jsx(e.Fragment,{children:e.jsx(M,{color:"green",children:"Yes"})}):e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",children:"No"})})})},{title:"Created",dataIndex:"created",render:(o,s,x)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(s.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(o,s,x)=>e.jsx("a",{children:s!=null&&s.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"Published",dataIndex:"published",render:(o,s,x)=>e.jsx("a",{children:s!=null&&s.published?e.jsx(te,{title:"Are you sure to Un-publish?",onConfirm:()=>S(s.id,!1),onCancel:()=>{},okText:"Unpublish",cancelText:"No",okButtonProps:{disabled:!s.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"green",children:"Published"})}):e.jsx(te,{title:"Are you sure to Publish?",onConfirm:()=>S(s.id,!0),onCancel:()=>{},okText:"Publish",cancelText:"No",okButtonProps:{disabled:!s.hasEntries},overlayStyle:{zIndex:9999},children:e.jsx(M,{color:"red",children:"Not Published"})})})},{title:"",dataIndex:"action",render:(o,s,x)=>e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(O,{title:"Schedule",placement:"left",children:e.jsx(q,{icon:e.jsx(xe,{}),disabled:!s.canManage,onClick:()=>{var m;return c("/timetable/study/course/scheduler/"+((m=t==null?void 0:t.schoolTimetable)==null?void 0:m.id)+"/"+s.id)}})}),e.jsx(te,{title:"Are you sure to delete this Timetable Study Course?",onConfirm:()=>v(s==null?void 0:s.id),onCancel:()=>z,okText:"Yes",cancelText:"No",disabled:!(s!=null&&s.canDelete),overlayStyle:{zIndex:9999},children:e.jsx(q,{icon:e.jsx(Ee,{}),disabled:!(s!=null&&s.canDelete)})})]})}],L=async(o,s="")=>{var m;const{data:x}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetableStudyCourses",variables:{schoolTimetableId:{value:parseInt(((m=t.schoolTimetable)==null?void 0:m.id.toString())??"0"),type:"Int",required:!0},page:{value:o,type:"Int",required:!0},key:{value:s,type:"String",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id",{studyCourse:["id",{course:["id","name"]},"semester","semesterDisplay","year","created","updated","isActive"]},{schoolTimetable:["id"]},"hasEntries","published","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(D=>(n.error("Failed loading School Timetable Education Levels"),{data:null})).then(D=>D);x&&(i(x.page),T(x.total),P(x.hasNext),l([...x.results])),r(!1)},b=async o=>{var x;const{data:s}=await E.custom({url:"",method:"post",meta:{operation:"publishUnpublishAllSchoolStudyCourseTimetables",variables:{schoolTimetableId:{value:parseInt(((x=t.schoolTimetable)==null?void 0:x.id.toString())??"0"),type:"Int",required:!0},published:{value:o,type:"Boolean",required:!0}},fields:["success","message"]}}).catch(m=>(n.error("Failed to publish/unpublish all study courses"),{data:null})).then(m=>m);s&&(s.success?(n.success(s.message),L(1)):n.error(s.message))};return a.useEffect(()=>{L(p)},[t.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:12,children:e.jsx(u,{layout:"vertical",form:j,onFinish:o=>{i(1),y.length=0,L(1,o.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsxs(B,{span:12,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(O,{title:"Click to Publish All Timetables",color:"green",children:e.jsx(q,{size:"large",icon:e.jsx(Ze,{style:{color:"green"}}),onClick:()=>b(!0),children:"Publish All"})}),e.jsx(O,{title:"Click to Unpublish All Timetables",color:"red",children:e.jsx(q,{size:"large",icon:e.jsx(Fe,{style:{color:"red"}}),onClick:()=>b(!1),children:"Unpublish All"})}),e.jsx(O,{title:"Auto Generate Timetable",color:"red",children:e.jsx(q,{size:"large",icon:e.jsx(nt,{style:{color:"red"}}),onClick:()=>t.autoGenerate(),children:"Auto Generate"})}),e.jsx(q,{size:"large",icon:e.jsx(st,{}),onClick:()=>w(!0),children:"Add"})]})]}),e.jsx(ge,{loading:_,columns:g,dataSource:y,pagination:!1,scroll:{y:"60vh"}}),e.jsx(ve,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Adding Study Courses to "}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:(h=t.schoolTimetable)==null?void 0:h.title})})]}),width:"45vw",anchor:"right",onClose:o=>w(o),open:F,noOverFlow:!0,children:e.jsx(Jt,{randKey:Math.random(),schoolTimetable:t.schoolTimetable,onAdd:A})})]})},Zt=t=>{const[y,l]=a.useState([]),[p,i]=a.useState({}),[f,T]=a.useState([]),I=async()=>{var c;const{data:r}=await E.custom({url:"",method:"post",meta:{operation:"uniTimetableAutoScheduler",variables:{schoolTimetableId:{value:parseInt(((c=t.schoolTimetable)==null?void 0:c.id.toString())??"0"),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(j=>j);r&&(r.success?n.success(r.message):n.error(r.message))},P=async()=>{var c;const{data:r}=await E.custom({url:"",method:"get",meta:{operation:"autoTimetableSchedulerValidityCheck",variables:{timetableId:{value:parseInt(((c=t.schoolTimetable)==null?void 0:c.id.toString())??"0"),type:"Int",required:!0}},fields:["data"]}}).catch(j=>(n.remove(),n.error("Something Went Wrong ..."),{data:null})).then(j=>j);r&&(i(r.data),l(r.data.validities.map(j=>({title:e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Course Name",children:j.name}),"- ",e.jsx(O,{title:"Maximum Number of Students",children:e.jsxs(M,{color:"green",children:[j.maxStudents," Max Students"]})}),!j.capacityFit&&e.jsxs(M,{color:"red",children:["No available Venue with capacity of ",j.maxStudents," Students for this course"]})]}),key:"sc-"+j.id,icon:e.jsx(Ve,{}),children:j.modules.length>0?j.modules.map(C=>({title:e.jsxs(e.Fragment,{children:[e.jsxs(O,{title:"Module Name",children:[C.name,e.jsx(M,{color:"green",children:C.code})]}),e.jsx(O,{title:"Number of Periods per Week",children:e.jsxs(M,{color:"green",children:[C.periodsPerWeek," Periods/Week"]})})]}),key:"sc-"+j.id+"-"+C.id,icon:e.jsx(Ve,{}),children:C.teachers.length>0?C.teachers.map(F=>({title:e.jsxs(e.Fragment,{children:[F.fullName," - ",e.jsx(M,{color:"green",children:F.phone})," ",e.jsx(M,{color:"blue",children:F.email})]}),key:"sc-"+j.id+"-"+C.id+"-"+F.id})):[{title:e.jsx(e.Fragment,{children:e.jsx(M,{color:"red",children:"No available Teacher for this course"})}),key:"sc-"+j.id+"-"+C.id+"-0"}]})):[{title:"No Module Found",key:"sc-"+j.id+"-0",icon:e.jsx(Ve,{})}]}))),T(r.data.map(j=>"sc-"+j.id)))},_=[{key:"1",label:"Validity Check Summary",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[p.canGenerate&&e.jsx(Se,{message:"Timetable can be generated, no errors found",type:"success"}),!p.canGenerate&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{message:"Timetable can't be generated, please fix the errors highlited",type:"error"}),e.jsx(me,{bordered:!0,dataSource:p.issues,renderItem:r=>e.jsx(me.Item,{children:e.jsx(me.Item.Meta,{avatar:e.jsx(Ge,{style:{color:"red"}}),title:e.jsx(Re.Text,{children:r})})})})]})]})},{key:"2",label:"Validity Check Details Tree",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[y.length>0&&e.jsx(xt,{showLine:!0,showIcon:!0,autoExpandParent:!0,expandedKeys:f,onExpand:r=>{T(r)},treeData:y}),y.length<=0&&e.jsx(Se,{message:"No Data Found",type:"error"})]})},{key:"3",label:"Venues",children:e.jsxs("div",{style:{maxHeight:"70vh",minHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:[p.venues&&e.jsx(me,{bordered:!0,dataSource:p.venues,renderItem:r=>e.jsx(me.Item,{children:e.jsx(me.Item.Meta,{avatar:r.capacity>0?e.jsx(Ct,{style:{color:"green"}}):e.jsx(Ge,{style:{color:"red"}}),title:e.jsxs(Re.Text,{children:[r.name,e.jsxs(M,{color:"green",style:{marginLeft:"10px"},children:[r.capacity," Max Students"]})]})})})}),!p.venues&&e.jsx(Se,{message:"No Venue Registered",type:"error"})]})}];return a.useEffect(()=>{P()},[t.randKey]),e.jsx("div",{style:{maxHeight:"80vh",minHeight:"80vh",overflowY:"auto",overflowX:"hidden"},children:e.jsx(It,{defaultActiveKey:"1",items:_,onChange:r=>{console.log(r)},tabBarExtraContent:e.jsxs(e.Fragment,{children:[p.canGenerate&&e.jsx(q,{type:"default",onClick:()=>I(),children:"Generate Timetable"}),!p.canGenerate&&e.jsx(Se,{message:"Timetable can't be generated, please fix the errors highlited",type:"error"})]})})})},ea=t=>{const[y,l]=a.useState(),[p,i]=a.useState([]),[f,T]=a.useState(0),[I,P]=a.useState(!0),[_,r]=a.useState(20),[c,j]=a.useState(""),[C]=u.useForm(),[F]=u.useForm(),[w]=u.useForm(),v=!ye.useBreakpoint().lg,[S,z]=a.useState(!1),[g,L]=a.useState(!1),[b,h]=a.useState(!1),[o,s]=a.useState(!1),[x,m]=a.useState(!1),[D,K]=a.useState(!1),oe=N=>{l(N),K(!0)},V=N=>{l(N),m(!0)},H=N=>{l(N),s(!0)},$=N=>{l(N),h(!0)},ae=N=>{l(N),L(!0)},Ae=async N=>{const{data:k}=await E.custom({url:"",method:"post",meta:{operation:"deleteSchoolTimetable",variables:{schoolTimetableId:{value:N,type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>(n.error("Error occured while Deleting School Venue"),{data:null})).then(Q=>Q);k&&(k.success?(n.success(k.message),i(p.filter(Q=>Q.id.toString()!==N.toString()))):n.error(k.message))},Le=async N=>{i([N,...p]),F.resetFields()},ze=async N=>{const k=p.findIndex(Q=>Q.id===N.id);p[k]=N,i([...p]),w.resetFields(),l(void 0),L(!1)},ke=async(N,k="",Q=20)=>{P(!0);const{data:ie}=await E.custom({url:"",method:"get",meta:{operation:"schoolTimetables",variables:{page:{value:N,type:"Int",required:!0},key:{value:k,type:"String",required:!1},pageSize:{value:Q,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","title","description","isPublished","startAt","endAt","timetableType","timetableTypeDisplay","year","forExamination",{timetableSchoolType:["id","name","code"]},{school:["id"]},{author:["id","firstName","middleName","lastName","fullName"]},{schoolExamination:["id","name"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>(n.error("Error occured while fetching roles"),{data:null})).then(fe=>fe);ie&&(T(ie.total),i([...ie.results])),P(!1)};return a.useEffect(()=>{ke(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{style:{marginTop:10},children:[e.jsx(B,{span:v?24:10,children:e.jsx(u,{layout:"vertical",form:C,onFinish:N=>{j(N.key),p.length=0,ke(1,N.key)},children:e.jsx(u.Item,{name:"key",children:e.jsx(U,{size:"large",placeholder:"Search ...",prefix:e.jsx(ce,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(B,{span:v?24:2,children:e.jsx(q,{icon:e.jsx(ce,{}),size:"large",onClick:()=>C.submit()})}),e.jsx(B,{span:v?24:12,children:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(O,{title:"Register a New Venue/Class",children:e.jsx(q,{icon:e.jsx(Te,{}),size:"large",onClick:()=>z(!0),children:"Add Timetable"})})})})]}),e.jsx(ge,{loading:I,columns:[{title:"Title",dataIndex:"title",fixed:!0,render:(N,k,Q)=>{var ie;return e.jsx("span",{children:e.jsxs("a",{children:[k.title,k.forExamination&&e.jsx(M,{color:"red",style:{marginLeft:10},children:(ie=k==null?void 0:k.schoolExamination)==null?void 0:ie.name})]})})}},{title:"Examination",dataIndex:"examination",fixed:!0,render:(N,k,Q)=>e.jsx("span",{children:e.jsx("a",{children:k.forExamination?e.jsx(M,{color:"green",children:"Yes"}):e.jsx(M,{color:"red",children:"No"})})})},{title:"Year",dataIndex:"year",fixed:!0,render:(N,k,Q)=>e.jsx("span",{children:e.jsx("a",{children:k.year})})},{title:"Timetable Type",dataIndex:"Timetable Type",fixed:!0,render:(N,k,Q)=>{var ie;return e.jsx("span",{children:e.jsx("a",{children:(ie=k==null?void 0:k.timetableSchoolType)==null?void 0:ie.name})})}},{title:"Start AT",dataIndex:"startAt",fixed:!0,render:(N,k,Q)=>e.jsx("span",{children:re(new Date(k.startAt)).format("MMM Do Y")})},{title:"End At",dataIndex:"endAt",fixed:!0,render:(N,k,Q)=>e.jsx("span",{children:re(new Date(k.endAt)).format("MMM Do Y")})},{title:"Date Created",dataIndex:"created",render:(N,k,Q)=>e.jsx(e.Fragment,{children:e.jsx("span",{children:new Date(k.created).toLocaleString()})})},{title:"Status",dataIndex:"isActive",render:(N,k,Q)=>e.jsx("a",{children:k!=null&&k.isActive?e.jsx("span",{style:{color:"green"},children:"Active"}):e.jsx("span",{style:{color:"red"},children:"Inactive"})})},{title:"",dataIndex:"action",render:(N,k,Q)=>{var ie,fe;return e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(Qe,{trigger:["click"],overlay:e.jsxs(he,{children:[e.jsx(he.Item,{icon:e.jsx(Ee,{}),disabled:!k.canDelete,children:e.jsx(te,{placement:"topLeft",title:`Are you sure you want to delete ${k.name} Timetable?`,onConfirm:()=>Ae(parseInt(k.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(he.Item,{icon:e.jsx(He,{}),disabled:!k.canEdit,onClick:()=>ae(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Edit"})}),["pr","osc","asc","	tert"].includes((ie=k==null?void 0:k.timetableSchoolType)==null?void 0:ie.code)&&e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>$(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Scheduler"})}),["uni","poly","col","ous"].includes((fe=k==null?void 0:k.timetableSchoolType)==null?void 0:fe.code)&&e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>H(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Scheduler"})}),e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>oe(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Auto Generate"})}),e.jsx(he.Item,{icon:e.jsx(xe,{}),disabled:!k.canManage,onClick:()=>V(k),children:e.jsx("a",{rel:"noopener noreferrer",children:"Schedules Drafts"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:Me=>Me.preventDefault(),children:e.jsx(it,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}}],dataSource:p,pagination:{onChange:(N,k)=>{r(k),ke(N,c,k)},total:f,pageSize:_,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0,y:"calc(80vh - 80px)"}}),e.jsx(de,{title:"Creating New School Timetable",width:"30vw",open:S,onClose:N=>z(N),children:e.jsx(Ut,{randKey:Math.random(),form:F,onFinish:Le})}),e.jsx(de,{title:"Edditing School Timetable",width:"30vw",open:g,onClose:N=>L(N),children:e.jsx(Xt,{randKey:Math.random(),form:w,onFinish:ze,schoolTimetable:y})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"School Timetable Education Levels"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:y==null?void 0:y.title})})]}),width:"60vw",open:b,onClose:N=>h(N),children:e.jsx(ot,{schoolTimetable:y,randKey:Math.random()})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetable Study Courses"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:y==null?void 0:y.title})})]}),width:"80vw",open:o,onClose:N=>s(N),children:e.jsx(Qt,{schoolTimetable:y,randKey:Math.random(),autoGenerate:()=>{K(!0)}})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetables Schedules Drafts"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:y==null?void 0:y.title})})]}),width:"90vw",open:x,onClose:N=>m(N),children:e.jsx(e.Fragment,{children:"Drafts"})}),e.jsx(de,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Timetable Auto Generation"}),e.jsx("span",{style:{marginLeft:10},children:e.jsx(M,{color:"green",children:y==null?void 0:y.title})})]}),width:"60vw",open:D,onClose:N=>K(N),children:e.jsx(Zt,{schoolTimetable:y,randKey:Math.random()})})]})},ta=()=>(a.useEffect(()=>(document.title=Ie.system_name+": School Timetables",document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(J.Item,{children:e.jsx(be,{to:"/timetable",children:"Home"})}),e.jsx(J.Item,{children:"Timetables"})]})}),e.jsx(ea,{})]})),Xa=t=>{const{page:y}=t;return y==="SchoolTimetablesPage"?e.jsx(ta,{}):y==="SchoolVenuesPage"?e.jsx(Gt,{}):y==="SchoolTimetableEducationLevelSchedulerPage"?e.jsx(Pt,{}):y==="SchoolTimetableStudyCourseSchedulerPage"?e.jsx(Dt,{}):y==="TimetableDashboardPage"?e.jsx(qt,{}):y==="SchoolTimetableSettingsPage"?e.jsx(zt,{}):e.jsx("div",{children:"Page not found ..."})};export{Xa as TimetablePages};
