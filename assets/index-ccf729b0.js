var Qt=Object.defineProperty;var er=(e,n,r)=>n in e?Qt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r;var M=(e,n,r)=>(er(e,typeof n!="symbol"?n+"":n,r),r);import{r as s,bK as Mt,bL as Pt,bG as tt,bM as tr,bN as rr,v as le,bO as bt,bP as _e,bQ as xt,bR as yt,bF as nr,b5 as Ot,bS as jt,bT as sr,bU as or,j as t,bV as Ve,bW as Tt,bX as Q,bY as Ct,bZ as ir,b_ as ar,b$ as Re,c0 as Ee,c1 as lr,c2 as Oe,aU as Be,$ as cr,av as Se,g as K,_ as T,c as rt,aQ as ur,ar as De,aZ as Te,c3 as Nt,aY as dr,ad as Ne,c4 as pr,c5 as hr,c6 as mr,c7 as fr,c8 as gr,c9 as vr,ca as ge,cb as br,cc as xr,cd as yr,ce as jr,cf as Cr,cg as Rt,aV as me,ch as wr,ci as kr,cj as Sr,aS as wt,ac as Ir,ck as Mr,cl as Xe,cm as Pr,cn as Or,co as kt,cp as Tr,B as je,cq as Nr,cr as Rr,cs as Ie,ct as Fe,cu as Er,cv as St}from"./index-351477c3.js";import{C as Ar}from"./change_password_form-1c68d760.js";import{D as fe}from"./index-4e600c89.js";import{T as Qe}from"./index-fe5f5443.js";import{A as Lr}from"./index-204a1fd3.js";import{A as ve}from"./index-6af680ed.js";import{G as nt}from"./index-ba2e3766.js";import{D as Et}from"./index-122c23d8.js";import{L as Ke}from"./index-a79ac33a.js";import{S as $r}from"./school_switcher_component-74c2a503.js";import{U as et}from"./index-a5d8814c.js";import{T as At}from"./index-d9a31a18.js";import{M as zr}from"./index-8b72edfc.js";import"./transButton-b6535c48.js";import"./index-f080e680.js";import"./InfoCircleFilled-9eecc8d9.js";import"./index-cbd0288c.js";import"./index-81b1f6d5.js";import"./ActionButton-40b0160f.js";import"./Upload-9b869cab.js";import"./fade-8ee215b5.js";import"./DialogWrap-e5db41da.js";import"./index-20e3f79b.js";const _r=e=>{const n=s.useRef({});return s.useEffect(()=>{n.current=e}),n.current},Lt=_r;function Br(e){const{badgeContent:n,invisible:r=!1,max:a=99,showZero:o=!1}=e,u=Lt({badgeContent:n,max:a});let i=r;r===!1&&n===0&&!o&&(i=!0);const{badgeContent:c,max:d=a}=i?u:e,f=c&&Number(c)>d?`${d}+`:c;return{badgeContent:c,invisible:i,max:d,displayValue:f}}function Fr(e){return Pt("MuiMenuItem",e)}const Vr=Mt("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),Me=Vr,Dr=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Ur=(e,n)=>{const{ownerState:r}=e;return[n.root,r.dense&&n.dense,r.divider&&n.divider,!r.disableGutters&&n.gutters]},qr=e=>{const{disabled:n,dense:r,divider:a,disableGutters:o,selected:u,classes:i}=e,d=Tt({root:["root",r&&"dense",n&&"disabled",!o&&"gutters",a&&"divider",u&&"selected"]},Fr,i);return le({},i,d)},Wr=tt(tr,{shouldForwardProp:e=>rr(e)||e==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:Ur})(({theme:e,ownerState:n})=>le({},e.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!n.disableGutters&&{paddingLeft:16,paddingRight:16},n.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Me.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:_e(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${Me.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:_e(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${Me.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:_e(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:_e(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${Me.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Me.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${xt.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${xt.inset}`]:{marginLeft:52},[`& .${yt.root}`]:{marginTop:0,marginBottom:0},[`& .${yt.inset}`]:{paddingLeft:36},[`& .${bt.root}`]:{minWidth:36}},!n.dense&&{[e.breakpoints.up("sm")]:{minHeight:"auto"}},n.dense&&le({minHeight:32,paddingTop:4,paddingBottom:4},e.typography.body2,{[`& .${bt.root} svg`]:{fontSize:"1.25rem"}}))),Gr=s.forwardRef(function(n,r){const a=nr({props:n,name:"MuiMenuItem"}),{autoFocus:o=!1,component:u="li",dense:i=!1,divider:c=!1,disableGutters:d=!1,focusVisibleClassName:f,role:j="menuitem",tabIndex:x,className:y}=a,b=Ot(a,Dr),C=s.useContext(jt),v=s.useMemo(()=>({dense:i||C.dense||!1,disableGutters:d}),[C.dense,i,d]),S=s.useRef(null);sr(()=>{o&&S.current&&S.current.focus()},[o]);const w=le({},a,{dense:v.dense,divider:c,disableGutters:d}),E=qr(a),V=or(S,r);let W;return a.disabled||(W=x!==void 0?x:-1),t.jsx(jt.Provider,{value:v,children:t.jsx(Wr,le({ref:V,role:j,tabIndex:W,component:u,focusVisibleClassName:Ve(E.focusVisible,f),className:Ve(E.root,y)},b,{ownerState:w,classes:E}))})}),Pe=Gr;function Hr(e){return Pt("MuiBadge",e)}const Kr=Mt("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),ae=Kr,Jr=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],Je=10,Ye=4,Yr=ir(),Zr=e=>{const{color:n,anchorOrigin:r,invisible:a,overlap:o,variant:u,classes:i={}}=e,c={root:["root"],badge:["badge",u,a&&"invisible",`anchorOrigin${Q(r.vertical)}${Q(r.horizontal)}`,`anchorOrigin${Q(r.vertical)}${Q(r.horizontal)}${Q(o)}`,`overlap${Q(o)}`,n!=="default"&&`color${Q(n)}`]};return Tt(c,Hr,i)},Xr=tt("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,n)=>n.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Qr=tt("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,n)=>{const{ownerState:r}=e;return[n.badge,n[r.variant],n[`anchorOrigin${Q(r.anchorOrigin.vertical)}${Q(r.anchorOrigin.horizontal)}${Q(r.overlap)}`],r.color!=="default"&&n[`color${Q(r.color)}`],r.invisible&&n.invisible]}})(({theme:e})=>{var n;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:Je*2,lineHeight:1,padding:"0 6px",height:Je*2,borderRadius:Je,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen}),variants:[...Object.keys(((n=e.vars)!=null?n:e).palette).filter(r=>{var a,o;return((a=e.vars)!=null?a:e).palette[r].main&&((o=e.vars)!=null?o:e).palette[r].contrastText}).map(r=>({props:{color:r},style:{backgroundColor:(e.vars||e).palette[r].main,color:(e.vars||e).palette[r].contrastText}})),{props:{variant:"dot"},style:{borderRadius:Ye,height:Ye*2,minWidth:Ye*2,padding:0}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})}}]}}),en=s.forwardRef(function(n,r){var a,o,u,i,c,d;const f=Yr({props:n,name:"MuiBadge"}),{anchorOrigin:j={vertical:"top",horizontal:"right"},className:x,component:y,components:b={},componentsProps:C={},children:v,overlap:S="rectangular",color:w="default",invisible:E=!1,max:V=99,badgeContent:W,slots:B,slotProps:D,showZero:O=!1,variant:G="standard"}=f,te=Ot(f,Jr),{badgeContent:I,invisible:N,max:U,displayValue:J}=Br({max:V,invisible:E,badgeContent:W,showZero:O}),z=Lt({anchorOrigin:j,color:w,overlap:S,variant:G,badgeContent:W}),m=N||I==null&&G!=="dot",{color:g=w,overlap:k=S,anchorOrigin:R=j,variant:_=G}=m?z:f,Y=_!=="dot"?J:void 0,A=le({},f,{badgeContent:I,invisible:m,max:U,displayValue:Y,showZero:O,anchorOrigin:R,color:g,overlap:k,variant:_}),p=Zr(A),L=(a=(o=B==null?void 0:B.root)!=null?o:b.Root)!=null?a:Xr,H=(u=(i=B==null?void 0:B.badge)!=null?i:b.Badge)!=null?u:Qr,se=(c=D==null?void 0:D.root)!=null?c:C.root,oe=(d=D==null?void 0:D.badge)!=null?d:C.badge,re=Ct({elementType:L,externalSlotProps:se,externalForwardedProps:te,additionalProps:{ref:r,as:y},ownerState:A,className:Ve(se==null?void 0:se.className,p.root,x)}),ce=Ct({elementType:H,externalSlotProps:oe,ownerState:A,className:Ve(p.badge,oe==null?void 0:oe.className)});return t.jsxs(L,le({},re,{children:[v,t.jsx(H,le({},ce,{children:Y}))]}))}),It=en,tn=ar(t.jsx("path",{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.39.08-.75.21-1.1.36l1.51 1.51c.32-.08.69-.13 1.09-.13M5.47 3.92 4.06 5.33 7.5 8.77c0 2.08 1.56 3.22 3.91 3.91l3.51 3.51c-.34.49-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.83-.55 2.46-1.12l2.22 2.22 1.41-1.41z"}),"MoneyOffOutlined");var st={},rn=Ee;Object.defineProperty(st,"__esModule",{value:!0});var $t=st.default=void 0,nn=rn(Re()),sn=t;$t=st.default=(0,nn.default)((0,sn.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");var ot={},on=Ee;Object.defineProperty(ot,"__esModule",{value:!0});var zt=ot.default=void 0,an=on(Re()),ln=t;zt=ot.default=(0,an.default)((0,ln.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle");var it={},cn=Ee;Object.defineProperty(it,"__esModule",{value:!0});var _t=it.default=void 0,un=cn(Re()),dn=t;_t=it.default=(0,un.default)((0,dn.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Mail");var at={},pn=Ee;Object.defineProperty(at,"__esModule",{value:!0});var Bt=at.default=void 0,hn=pn(Re()),mn=t;Bt=at.default=(0,hn.default)((0,mn.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications");var lt={},fn=Ee;Object.defineProperty(lt,"__esModule",{value:!0});var Ft=lt.default=void 0,gn=fn(Re()),vn=t;Ft=lt.default=(0,gn.default)((0,vn.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert");const bn=e=>{var d;const{data:n}=lr(),[r,a]=s.useState(!1),[o,u]=s.useState((d=e.user)==null?void 0:d.phone),i=async(f,j)=>{const{data:x}=await K.custom({url:"",method:"post",meta:{operation:"selfUpdateUserProfileInformations",variables:{phone:{value:j,type:"String",required:!1}},fields:["success","message"]}}).catch(y=>({data:null})).then(y=>y);x&&(x.success?(T.success(x.message),a(!1)):T.error(x.message))},c=async f=>{const{data:j}=await K.custom({url:"",method:"post",meta:{operation:"selfVerifyMobilePhoneNumber",variables:{phone:{value:f,type:"String",required:!0}},fields:["success","message","verified","otpSent"]}}).catch(x=>({data:null})).then(x=>x);if(j)if(j.success){if(j.otpSent)return!0}else T.error(j.message);return!1};return s.useEffect(()=>{},[e.randKey]),t.jsxs(t.Fragment,{children:[t.jsxs(fe,{title:"",column:1,labelStyle:{fontSize:22,fontWeight:"bolder"},contentStyle:{fontSize:20},children:[t.jsx(fe.Item,{label:"First Name",children:n==null?void 0:n.firstName}),t.jsx(fe.Item,{label:"Middle Name",children:n==null?void 0:n.middleName}),t.jsx(fe.Item,{label:"Last Name",children:n==null?void 0:n.lastName}),t.jsx(fe.Item,{label:"Email Address",children:t.jsx(Qe.Title,{level:4,style:{fontSize:20,width:"100%",fontWeight:"normal",marginTop:3},children:n==null?void 0:n.email})}),t.jsx(fe.Item,{label:"Gender",children:n==null?void 0:n.gender}),t.jsx(fe.Item,{label:"Mobile Phone Number",children:t.jsxs(Qe.Title,{editable:{onChange:async f=>{f&&(u(f),await c(f)&&a(!0))}},level:4,style:{fontSize:20,fontWeight:"normal",marginTop:5},children:[o&&t.jsx(t.Fragment,{children:o}),!o&&t.jsx(t.Fragment,{children:n==null?void 0:n.phone})]})})]}),t.jsx(Oe,{title:"Mobile Phone Number Verification",open:r,onClose:f=>a(f),children:t.jsx(xn,{user:n,phone:o,onFinish:i})})]})},xn=e=>{const[n]=Be.useForm(),[r,a]=s.useState(!1),o=async(u,i)=>{const{data:c}=await K.custom({url:"",method:"post",meta:{operation:"selfVerifyMobilePhoneNumber",variables:{phone:{value:u,type:"String",required:!0},otp:{value:i,type:"String",required:!1}},fields:["success","message","verified","otpSent"]}}).catch(d=>({data:null})).then(d=>d);if(c)if(c.success){if(c.verified)return!0}else T.error(c.message);return!1};return t.jsxs(t.Fragment,{children:[t.jsx(Lr,{message:`Verification code sent to ${e.phone}, check a recent SMS with four digits`,type:"info"}),t.jsxs(Be,{layout:"vertical",form:n,onFinish:u=>{e.onFinish(u.otp,e.phone)},requiredMark:!0,children:[t.jsx(Be.Item,{name:"otp",label:"Verification Code",rules:[({getFieldValue:u})=>({async validator(i,c){return c.length>=4?(a(!0),await o(e.phone,c)?Promise.resolve():Promise.reject(new Error("Verification Code is not valid"))):Promise.reject(new Error("Verification Code must be 4 characters long"))}})],children:t.jsx(cr,{size:"large",placeholder:"Enter Verification Code ..."})}),t.jsx(Be.Item,{children:t.jsx(Se,{size:"large",danger:!0,style:{float:"right"},disabled:!r,onClick:()=>{e.onFinish(n.getFieldValue("otp"),e.phone)},children:"Verify"})})]})]})},yn=e=>{const[n,r]=s.useTransition(),[a,o]=s.useState(!1),{push:u}=rt(),i=(c,d)=>c.length>d?c.substring(0,d)+"...":c;return t.jsx(t.Fragment,{children:t.jsx(ur,{span:e.colSize,children:t.jsx(Qe.Link,{disabled:!e.app.canAccess,children:t.jsx(De,{spinning:n,children:t.jsx("div",{onClick:()=>{e.app.isActive?r(()=>{u("/"+e.app.url),e.onClose()}):T("Under Construction")},onMouseOver:()=>{o(!0)},onMouseLeave:()=>{o(!1)},style:{position:a&&!e.last?"absolute":"static",zIndex:a&&!e.last?1:"auto",width:"100%",backgroundColor:a?"#f0f0f0":"transparent",borderRadius:10,border:a?"1px solid red":"1px solid transparent"},children:t.jsx("div",{style:{marginRight:10,marginTop:10},children:t.jsxs(Te,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center",textAlign:"center"},children:[t.jsx(ve,{size:{xs:24,sm:32,md:40,lg:40,xl:40,xxl:50},icon:t.jsx(Nt,{}),src:e.app.icon}),a?t.jsx("span",{style:{fontWeight:"bolder",fontSize:16},children:e.app.name}):t.jsx("span",{style:{fontWeight:"bolder",fontSize:16},children:i(e.app.name,9)})]})})})})})})})},Ce=()=>{const e=localStorage.getItem("apps");return e?JSON.parse(e):[]},jn=e=>{const[n,r]=s.useState(Ce()),[a,o]=s.useState(!0),i=!nt.useBreakpoint().lg,c=async()=>{o(!0);const{data:d}=await K.custom({url:"",method:"get",meta:{operation:"apps",fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","icon","url","created","updated","canAccess","isActive"]}]}});localStorage.setItem("apps",JSON.stringify(d.results)),r(d.results),o(!1)};return s.useEffect(()=>{c()},[]),t.jsxs(t.Fragment,{children:[Ce().length==0&&t.jsx("div",{style:{width:"100%",textAlign:"center",marginTop:20},children:t.jsx(De,{})}),Ce().length>0&&t.jsx(dr,{align:"top",style:{width:i?"100%":"500px"},children:Ce().map(d=>t.jsx(yn,{app:d,last:d.id===Ce()[Ce().length-1].id,colSize:i?12:8,onClose:()=>e.onClose()}))})]})},Cn=e=>{const[n,r]=s.useState([]),[a,o]=s.useState(!0);rt();const u=async()=>{const{data:c}=await K.custom({url:"",method:"get",meta:{operation:"myNotifications",fields:["pages","total","page","hasNext","hasPrev",{results:["id","message","url",{sender:["id","firstName","lastName","middleName","pic","fullName"]},{receiver:["id","firstName","lastName","middleName","pic","fullName"]},"isRead","created","updated","isActive"]}]}}).catch(d=>(T.error("Failed to get notifications"),{data:null})).then(d=>d);c&&r([...n,...c.results]),o(!1)},i=async()=>{const{data:c}=await K.custom({url:"",method:"post",meta:{operation:"clearNotifications",fields:["success","message"]}}).catch(d=>(T.error("Failed to clear notifications"),{data:null})).then(d=>d);c&&(c.success?(T.success(c.message),u()):T.error(c.message))};return s.useEffect(()=>{u()},[e.randKey,e.notifications]),t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{paddingLeft:20,display:"flex",justifyContent:"space-between",paddingTop:20},children:[t.jsx("h3",{children:"Notifications"}),t.jsxs("span",{children:[t.jsx(Ne,{title:"Clear All",children:t.jsx("a",{style:{marginRight:20},onClick:i,children:t.jsx(pr,{})})}),t.jsx("a",{style:{marginRight:20},onClick:()=>T("Notification Settings"),children:t.jsx(hr,{})})]})]}),t.jsx(Et,{style:{marginTop:0,marginBottom:0}}),t.jsx("div",{style:{maxHeight:"70vh",overflowY:"auto",overflowX:"hidden",paddingLeft:"20px"},children:t.jsx(De,{spinning:a,children:t.jsx(Ke,{itemLayout:"horizontal",dataSource:e.notifications,renderItem:c=>t.jsx("a",{children:t.jsx(Ke.Item,{onClick:()=>{e.onNotificationClick(c)},children:t.jsx(Ke.Item.Meta,{avatar:t.jsx(ve,{src:c.sender.pic}),title:t.jsx("a",{children:c.message}),description:mr(c.created).fromNow()})})})})})})]})},{Dragger:wn}=et,kn=e=>{const[n,r]=s.useState([]),a=o=>{const u=["png","jpg","jpeg","gif","bmp","webp","tiff","svg","psd"],i=o.name.split(".").pop();return u.indexOf(i)===-1?(T.error("File type not supported"),et.LIST_IGNORE):o.size/1024/1024>50?(T.error("File size too large"),et.LIST_IGNORE):(r([o,...n]),!0)};return s.useEffect(()=>{r([])},[e.random]),t.jsx(t.Fragment,{children:t.jsxs(wn,{customRequest:e.handleUpload,beforeUpload:a,fileList:n,multiple:!1,accept:"image/*",children:[t.jsx("p",{className:"ant-upload-drag-icon",children:t.jsx(fr,{})}),t.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload a Profile Picture"})]})})},{TabPane:Sn}=At,In=e=>{var i;const[n,r]=s.useState(!1),a=(c,d)=>{e.changeWidth(c),r(d)},o=async()=>{const{data:c}=await K.custom({url:"",method:"post",meta:{operation:"removeUserProfilePhoto",variables:{id:{value:parseInt(e.user.id),type:"Int",required:!0}},fields:["success","message"]}});c.success?(T.success(c.message),e.close(),window.location.reload()):T.error(c.message)},u=async c=>{const{onSuccess:d,onError:f,file:j,onProgress:x}=c,{data:y}=await K.custom({url:"",method:"post",meta:{operation:"uploadUserProfilePhoto",variables:{id:{value:parseInt(e.user.id),type:"Int",required:!0},photo:{value:j,type:"Upload",required:!0}},onUploadProgress:b=>{const{loaded:C,total:v}=b,S=Math.floor(C*100/v);x(S)},onError:b=>{f(b),T.error(b.message)},fields:["success","message",{user:["id","firstName","middleName","lastName","fullName","pic","email","isAdmin","isStaff","isActive"]}]}});if(y.success){d("ok"),T.success(y.message),localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(y.user));const b=localStorage.getItem("user"),{pic:C}=JSON.parse(b||"");y.user.pic===C&&window.location.reload()}else T.error(y.message)};return s.useEffect(()=>{e.triggerClose&&(r(!1),e.close())},[e.changeWidth]),t.jsx(t.Fragment,{children:n?t.jsx(At,{defaultActiveKey:"1",centered:!0,draggable:!0,children:t.jsxs(Sn,{tab:t.jsx("span",{style:{fontSize:18},children:"From Computer"}),children:[t.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:30,marginBottom:30},children:t.jsx(kn,{user:e.user,handleUpload:u})}),t.jsx("span",{style:{marginRight:10},children:t.jsx(Se,{icon:t.jsx(gr,{}),size:"large",onClick:()=>a(30,!1),children:"Back"})})]},"3")}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[t.jsx("span",{style:{fontSize:18,fontWeight:"bolder"},children:"Profile picture"}),t.jsx("span",{style:{display:"block",marginTop:10},children:"A picture helps people recognize you and lets you know when you’re signed in to your account"}),t.jsxs("span",{style:{display:"block",marginTop:10},children:[t.jsx(vr,{}),"Visible across ",ge.system_name," services.",t.jsx("a",{children:"Learn more"})]})]}),t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsx(ve,{src:(i=e.user)==null?void 0:i.pic,style:{width:225,height:225}})}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:30},children:[t.jsx("span",{style:{marginRight:10},children:t.jsx(Se,{icon:t.jsx(br,{}),size:"large",onClick:()=>a(60,!0),children:"Change"})}),t.jsx("span",{children:t.jsx(Se,{icon:t.jsx(xr,{}),size:"large",onClick:o,children:"Remove"})})]})]})})},{LogoutOutlined:Mn,UserOutlined:Pn}=Pr,On=()=>{const e=s.useContext(yr),{ready:n,value:r,send:a}=e,[o,u]=s.useTransition(),{data:i}=jr();Cr();const[c,d]=s.useState(0),[f,j]=s.useState(!1),[x,y]=s.useState(30),[b,C]=s.useState(!1),[v,S]=s.useState(0),[w,E]=s.useState(!1),[V,W]=s.useState(!1),[B,D]=s.useState(!1),{mutate:O}=Rt(),{push:G}=rt(),te=nt.useBreakpoint(),[I,N]=s.useState(!1),[U,J]=s.useState(!0),z=s.useRef(null),m=!te.lg,[g,k]=s.useState(!1),[R,_]=s.useState([]),[Y,A]=s.useState(!1),p=async()=>{const{data:h}=await K.custom({url:"",method:"get",meta:{operation:"myNotifications",fields:["pages","total","page","hasNext","hasPrev",{results:["id","message","url",{sender:["id","firstName","lastName","middleName","pic","fullName"]},{receiver:["id","firstName","lastName","middleName","pic","fullName"]},"isRead","created","updated","isActive"]}]}}).catch(()=>(T.remove(),T.error("Failed to get notifications"),{data:null})).then($=>$);if(h){const $=h.results.filter(Z=>!R.some(be=>be.id===Z.id));_([...$,...R])}},L=async h=>{const{data:$}=await K.custom({url:"",method:"post",meta:{operation:"markNotificationAsRead",variables:{notificationId:{value:parseInt(h.toString()),type:"Int",required:!0}},fields:["success","message"]}}).catch(()=>({data:null})).then(Z=>Z);$&&$.success&&(_(R.filter(Z=>Z.id.toString()!==h.toString())),d(c-1))},H=h=>{y(h)},se=async()=>{const{data:h}=await K.custom({url:"",method:"get",meta:{operation:"totalNotifications",fields:["total"]}}).catch(()=>({data:null})).then($=>$);h&&d(h.total)},oe=()=>{y(30),C(!0),S(Math.random())};s.useEffect(()=>{if(console.log("value:",r),Notification.permission!=="granted"&&Notification.requestPermission(),Notification.permission==="granted"&&r!==null&&r!==""&&r!==void 0&&r!=="null"&&r!="Nil")try{const h=JSON.parse(r);console.log("data:",h),"Notification"in window?(Notification.requestPermission().then($=>{if($==="granted"){const Z=new Notification(h.message.title,{body:h.message.body})}else console.error("Notification permission denied")}),p()):console.error("Notification API not supported")}catch(h){console.error(h)}se(),p(),k(m)},[n,r,a]);const re=t.jsx(De,{spinning:o,children:t.jsx(me,{style:{width:400,backgroundColor:"white",padding:20},children:t.jsxs("span",{ref:z,style:{margin:10,padding:30},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[t.jsx(ve,{src:i==null?void 0:i.pic,style:{width:75,height:75}}),t.jsx(Ne,{title:"Change Profile Picture",color:"green",placement:"left",children:t.jsx(Se,{shape:"circle",icon:t.jsx(wr,{}),style:{position:"absolute",marginLeft:75,marginTop:40},onClick:()=>j(!0)})})]}),t.jsx("div",{style:{display:"flex",justifyContent:"center",fontWeight:"bolder",color:"black",marginTop:20,marginBottom:30,fontSize:24},children:i==null?void 0:i.fullName}),t.jsx($r,{}),t.jsx(Et,{}),t.jsx(me.Item,{onClick:()=>D(!0),icon:t.jsx(Pn,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Profile"},"profile"),i!=null&&i.isStaff||i!=null&&i.isAdmin?t.jsxs(t.Fragment,{children:[t.jsx(me.Item,{onClick:()=>{u(()=>{G("/control/analytics")})},icon:t.jsx(kr,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Control Panel"},"controlpanel"),t.jsx(me.Item,{onClick:()=>{u(()=>{G("/opay")})},style:{fontSize:18,color:"black"},icon:t.jsx(tn,{style:{color:"red"}}),children:"Billing Management"},"controlpanel")]}):t.jsx(t.Fragment,{}),!(i!=null&&i.ldapAuth)&&t.jsx(Ne,{title:"Click to Change Your Password",color:"green",children:t.jsx(me.Item,{onClick:()=>E(!0),icon:t.jsx(Sr,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Change Password"},"accountChangePassword")}),t.jsx(me.Item,{onClick:()=>O(),icon:t.jsx(Mn,{style:{color:"red"}}),style:{fontSize:18,color:"black"},children:"Logout"},"logout")]})})}),ce=t.jsx(me,{style:{width:500,minHeight:50},children:t.jsx(Cn,{randKey:Math.random(),notifications:R,onNotificationClick:h=>{L(h.id),h.url&&(A(!1),G(h.url))}})});return t.jsxs(Te,{children:[t.jsx(Te,{style:{marginLeft:"0px",marginRight:"20px"},children:t.jsx(Tn,{})}),t.jsx(Te,{style:{marginLeft:"0px",marginRight:"20px"},children:t.jsx(wt,{overlay:ce,open:Y,trigger:["click"],overlayStyle:{zIndex:9999},children:t.jsx(Ne,{title:"Notifications",placement:"bottom",color:"green",children:t.jsx(Ir,{count:c,children:t.jsx("a",{onClick:()=>{A(!Y)},children:t.jsx(ve,{icon:t.jsx(Mr,{}),style:{backgroundColor:"silver"}})})})})})}),t.jsx(Te,{style:{marginLeft:"10px"},children:t.jsx(wt,{overlay:re,trigger:["click"],overlayStyle:{zIndex:9999},children:t.jsx("a",{onClick:()=>N(!I),children:(i==null?void 0:i.pic)&&t.jsx(ve,{src:i==null?void 0:i.pic,alt:i==null?void 0:i.fullName})})})}),t.jsx(Oe,{title:t.jsx(t.Fragment,{children:x>30&&t.jsx("span",{children:"Change Profile Picture"})||t.jsxs("span",{children:[ge.system_name," Account"]})}),open:f,width:x+"vw",onClose:h=>j(h),children:t.jsx(In,{user:i,changeWidth:H,triggerClose:b,close:oe})}),t.jsx(Oe,{title:"Change Password",open:w,width:"30vw",onClose:h=>E(h),children:t.jsx(Ar,{onFinish:()=>{J(!1)}})}),t.jsx(Oe,{title:"Account Payment Settings",destroyOnClose:!0,closable:!0,open:V,width:"40vw",onClose:h=>W(h),children:t.jsx("p",{children:"Account Payment Settings"})}),t.jsx(Oe,{title:(i==null?void 0:i.fullName)+" Profile Information's",open:B,width:"60vw",onClose:h=>D(h),children:t.jsx(bn,{randKey:Math.random(),user:i})})]})};function Tn(){const[e,n]=s.useState(null),r=!!e;nt.useBreakpoint().lg;const o=i=>{n(i.currentTarget)},u=()=>{n(null)};return t.jsxs("div",{children:[t.jsx(Ne,{title:"Apps",color:"green",placement:"left",children:t.jsx("span",{id:"basic-button","aria-controls":r?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":r?"true":void 0,onClick:o,style:{cursor:"pointer"},children:t.jsx(ve,{icon:t.jsx(Nt,{}),style:{backgroundColor:"silver"}})})}),t.jsx(Xe,{id:"basic-menu",anchorEl:e,open:r,onClose:u,MenuListProps:{"aria-labelledby":"basic-button",style:{borderRadius:50,padding:10}},children:t.jsx(jn,{onClose:()=>{u()}})})]})}var Nn=Object.create,Vt=Object.defineProperty,Rn=Object.getOwnPropertyDescriptor,En=Object.getOwnPropertyNames,An=Object.getPrototypeOf,Ln=Object.prototype.hasOwnProperty,$n=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),zn=(e,n,r,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of En(n))!Ln.call(e,o)&&o!==r&&Vt(e,o,{get:()=>n[o],enumerable:!(a=Rn(n,o))||a.enumerable});return e},_n=(e,n,r)=>(r=e!=null?Nn(An(e)):{},zn(n||!e||!e.__esModule?Vt(r,"default",{value:e,enumerable:!0}):r,e)),Bn=$n((e,n)=>{(function(r,a){typeof e=="object"&&typeof n<"u"?a(e):typeof define=="function"&&define.amd?define(["exports"],a):(r=typeof globalThis<"u"?globalThis:r||self,a(r.fastUniqueNumbers={}))})(e,function(r){var a=function(b){return function(C){var v=b(C);return C.add(v),v}},o=function(b){return function(C,v){return b.set(C,v),v}},u=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,i=536870912,c=i*2,d=function(b,C){return function(v){var S=C.get(v),w=S===void 0?v.size:S<c?S+1:0;if(!v.has(w))return b(v,w);if(v.size<i){for(;v.has(w);)w=Math.floor(Math.random()*c);return b(v,w)}if(v.size>u)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;v.has(w);)w=Math.floor(Math.random()*u);return b(v,w)}},f=new WeakMap,j=o(f),x=d(j,f),y=a(x);r.addUniqueNumber=y,r.generateUniqueNumber=x})});_n(Bn());var ne=(typeof window>"u"?"undefined":typeof window)=="object",ee={setTimeout:ne?setTimeout.bind(window):setTimeout,clearTimeout:ne?clearTimeout.bind(window):clearTimeout,setInterval:ne?setInterval.bind(window):setInterval,clearInterval:ne?clearInterval.bind(window):clearInterval};function Fn(e){ee.setTimeout=e.setTimeout,ee.clearTimeout=e.clearTimeout,ee.setInterval=e.setInterval,ee.clearInterval=e.clearInterval}var we={},Vn=class{constructor(e){M(this,"name");M(this,"closed",!1);M(this,"mc",new MessageChannel);this.name=e,we[e]=we[e]||[],we[e].push(this),this.mc.port1.start(),this.mc.port2.start(),this.onStorage=this.onStorage.bind(this),window.addEventListener("storage",this.onStorage)}onStorage(e){if(e.storageArea!==window.localStorage||e.key.substring(0,this.name.length)!==this.name||e.newValue===null)return;let n=JSON.parse(e.newValue);this.mc.port2.postMessage(n)}postMessage(e){if(this.closed)throw new Error("InvalidStateError");let n=JSON.stringify(e),r=`${this.name}:${String(Date.now())}${String(Math.random())}`;window.localStorage.setItem(r,n),ee.setTimeout(()=>{window.localStorage.removeItem(r)},500),we[this.name].forEach(a=>{a!==this&&a.mc.port2.postMessage(JSON.parse(n))})}close(){if(this.closed)return;this.closed=!0,this.mc.port1.close(),this.mc.port2.close(),window.removeEventListener("storage",this.onStorage);let e=we[this.name].indexOf(this);we[this.name].splice(e,1)}get onmessage(){return this.mc.port1.onmessage}set onmessage(e){this.mc.port1.onmessage=e}get onmessageerror(){return this.mc.port1.onmessageerror}set onmessageerror(e){this.mc.port1.onmessageerror=e}addEventListener(e,n){return this.mc.port1.addEventListener(e,n)}removeEventListener(e,n){return this.mc.port1.removeEventListener(e,n)}dispatchEvent(e){return this.mc.port1.dispatchEvent(e)}},Dn=typeof window>"u"?void 0:typeof window.BroadcastChannel=="function"?window.BroadcastChannel:Vn;function Un(e=0){return new Promise(n=>ee.setTimeout(n,e))}function Dt(){return Math.random().toString(36).substring(2)}var qn=class{constructor(e,n){M(this,"options");M(this,"channel");M(this,"token",Dt());M(this,"isLeader",!1);M(this,"isDead",!1);M(this,"isApplying",!1);M(this,"reApply",!1);M(this,"intervals",[]);M(this,"listeners",[]);M(this,"deferred");this.channel=e,this.options=n,this.apply=this.apply.bind(this),this.awaitLeadership=this.awaitLeadership.bind(this),this.sendAction=this.sendAction.bind(this)}async apply(){if(this.isLeader||this.isDead)return!1;if(this.isApplying)return this.reApply=!0,!1;this.isApplying=!0;let e=!1,n=r=>{let{token:a,action:o}=r.data;a!==this.token&&(o===0&&a>this.token&&(e=!0),o===1&&(e=!0))};this.channel.addEventListener("message",n);try{return this.sendAction(0),await Un(this.options.responseTime),this.channel.removeEventListener("message",n),this.isApplying=!1,e?this.reApply?this.apply():!1:(this.assumeLead(),!0)}catch{return!1}}awaitLeadership(){if(this.isLeader)return Promise.resolve();let e=!1,n=null;return new Promise(r=>{let a=()=>{if(e)return;e=!0;try{ee.clearInterval(n)}catch{}let u=this.intervals.indexOf(n);u>=0&&this.intervals.splice(u,1),this.channel.removeEventListener("message",o),r()};n=ee.setInterval(()=>{this.apply().then(()=>{this.isLeader&&a()})},this.options.fallbackInterval),this.intervals.push(n);let o=u=>{let{action:i}=u.data;i===2&&this.apply().then(()=>{this.isLeader&&a()})};this.channel.addEventListener("message",o)})}sendAction(e){this.channel.postMessage({action:e,token:this.token})}assumeLead(){this.isLeader=!0;let e=n=>{let{action:r}=n.data;r===0&&this.sendAction(1)};return this.channel.addEventListener("message",e),this.listeners.push(e),this.sendAction(1)}waitForLeadership(){return this.deferred?this.deferred:(this.deferred=this.awaitLeadership(),this.deferred)}close(){if(!this.isDead){this.isDead=!0,this.isLeader=!1,this.sendAction(2);try{this.listeners.forEach(e=>this.channel.removeEventListener("message",e)),this.intervals.forEach(e=>ee.clearInterval(e))}catch{}}}},Wn=class{constructor(e){M(this,"channel");M(this,"options");M(this,"elector");M(this,"token",Dt());M(this,"registry",new Map);M(this,"allIdle",!1);M(this,"isLastActive",!1);let{channelName:n}=e;if(this.options=e,this.channel=new Dn(n),this.registry.set(this.token,1),e.leaderElection){let r={fallbackInterval:2e3,responseTime:100};this.elector=new qn(this.channel,r),this.elector.waitForLeadership()}this.channel.addEventListener("message",r=>{let{action:a,token:o,data:u}=r.data;switch(a){case 3:this.registry.set(o,2);break;case 4:this.registry.delete(o);break;case 5:this.idle(o);break;case 6:this.active(o);break;case 7:this.prompt(o);break;case 8:this.start(o);break;case 9:this.reset(o);break;case 10:this.activate(o);break;case 11:this.pause(o);break;case 12:this.resume(o);break;case 13:this.options.onMessage(u);break}}),this.send(3)}get isLeader(){if(!this.elector)throw new Error('❌ Leader election is not enabled. To Enable it set the "leaderElection" property to true.');return this.elector.isLeader}prompt(e=this.token){this.registry.set(e,0);let n=[...this.registry.values()].every(r=>r===0);e===this.token&&this.send(7),n&&this.options.onPrompt()}idle(e=this.token){this.registry.set(e,2);let n=[...this.registry.values()].every(r=>r===2);e===this.token&&this.send(5),!this.allIdle&&n&&(this.allIdle=!0,this.options.onIdle())}active(e=this.token){this.allIdle=!1,this.registry.set(e,1);let n=[...this.registry.values()].some(r=>r===1);e===this.token&&this.send(6),n&&this.options.onActive(),this.isLastActive=e===this.token}start(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(8):this.options.start(!0),this.isLastActive=e===this.token}reset(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(9):this.options.reset(!0),this.isLastActive=e===this.token}activate(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(10):this.options.activate(!0),this.isLastActive=e===this.token}pause(e=this.token){e===this.token?this.send(11):this.options.pause(!0)}resume(e=this.token){e===this.token?this.send(12):this.options.resume(!0)}message(e){try{this.channel.postMessage({action:13,token:this.token,data:e})}catch{}}send(e){try{this.channel.postMessage({action:e,token:this.token})}catch{}}close(){this.options.leaderElection&&this.elector.close(),this.send(4),this.channel.close()}},Gn=ne?document:null,Hn=["mousemove","keydown","wheel","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","MSPointerDown","MSPointerMove","visibilitychange","focus"];function Kn(e,n){let r;function a(...o){r&&clearTimeout(r),r=setTimeout(()=>{e(...o),r=null},n)}return a.cancel=function(){clearTimeout(r)},a}function Ze(e,n){let r=0;return function(...a){let o=new Date().getTime();if(!(o-r<n))return r=o,e(...a)}}var P=()=>Date.now(),ke=2147483647;function Jn({timeout:e=1e3*60*20,promptTimeout:n=0,promptBeforeIdle:r=0,element:a=Gn,events:o=Hn,timers:u=void 0,immediateEvents:i=[],onPresenceChange:c=()=>{},onPrompt:d=()=>{},onIdle:f=()=>{},onActive:j=()=>{},onAction:x=()=>{},onMessage:y=()=>{},debounce:b=0,throttle:C=0,eventsThrottle:v=200,startOnMount:S=!0,startManually:w=!1,stopOnIdle:E=!1,crossTab:V=!1,name:W="idle-timer",syncTimers:B=0,leaderElection:D=!1,disabled:O=!1}={}){let G=s.useRef(P()),te=s.useRef(P()),I=s.useRef(null),N=s.useRef(null),U=s.useRef(0),J=s.useRef(0),z=s.useRef(0),m=s.useRef(0),g=s.useRef(!1),k=s.useRef(!1),R=s.useRef(!1),_=s.useRef(!0),Y=s.useRef(!1),A=s.useRef(null),p=s.useRef(null),L=s.useRef(e),H=s.useRef(0);s.useEffect(()=>{if(n&&console.warn("⚠️ IdleTimer -- The `promptTimeout` property has been deprecated in favor of `promptBeforeIdle`. It will be removed in the next major release."),r&&n)throw new Error("❌ Both promptTimeout and promptBeforeIdle can not be set. The promptTimeout property will be deprecated in a future version.");if(e>=ke)throw new Error(`❌ The value for the timeout property must fit in a 32 bit signed integer, ${ke}.`);if(n>=ke)throw new Error(`❌ The value for the promptTimeout property must fit in a 32 bit signed integer, ${ke}.`);if(r>=ke)throw new Error(`❌ The value for the promptBeforeIdle property must fit in a 32 bit signed integer, ${ke}.`);if(r>=e)throw new Error(`❌ The value for the promptBeforeIdle property must be less than the timeout property, ${e}.`);if(r?(L.current=e-r,H.current=r):(L.current=e,H.current=n),!_.current){if(w||O)return;g.current&&(xe.current(null,q),p.current&&p.current.active()),he()}},[e,n,r,w,O]);let se=s.useRef(E);s.useEffect(()=>{se.current=E},[E]);let oe=s.useRef(i),re=s.useRef(a),ce=s.useRef([...new Set([...o,...i]).values()]),h=s.useRef(O);s.useEffect(()=>{h.current=O,!_.current&&(O?$e():w||he())},[O]);let $=s.useRef(c);s.useEffect(()=>{$.current=c},[c]);let Z=s.useRef(d);s.useEffect(()=>{Z.current=d},[d]);let be=s.useRef(f);s.useEffect(()=>{be.current=f},[f]);let xe=s.useRef(j);s.useEffect(()=>{xe.current=j},[j]);let Ae=s.useRef(x);s.useEffect(()=>{Ae.current=x},[x]);let ye=s.useRef(y);s.useEffect(()=>{ye.current=y},[y]);let ue=s.useMemo(()=>{let l=(F,ze)=>Ae.current(F,ze);return b>0?Kn(l,b):C>0?Ze(l,C):l},[C,b]),ct=s.useRef();s.useEffect(()=>{V&&B&&(ct.current=Ze(()=>{p.current.active()},B))},[V,B]);let X=()=>{A.current!==null&&(ee.clearTimeout(A.current),A.current=null)},de=(l,F=!0)=>{X(),A.current=ee.setTimeout(qe,l||L.current),F&&(N.current=P())},ut=l=>{!k.current&&!g.current&&(Z.current(l,q),$.current({type:"active",prompted:!0},q)),m.current=0,z.current=P(),k.current=!0,de(H.current,!1)},dt=()=>{X(),g.current||(be.current(null,q),$.current({type:"idle"},q)),g.current=!0,I.current=P(),se.current?pe():k.current&&(z.current=0,k.current=!1)},Ue=l=>{X(),(g.current||k.current)&&(xe.current(l,q),$.current({type:"active",prompted:!1},q)),k.current=!1,z.current=0,g.current=!1,U.current+=P()-I.current,J.current+=P()-I.current,ie(),de()},qe=l=>{if(!g.current){ue.cancel&&ue.cancel();let F=P()-N.current;if(!(L.current+H.current<F)&&H.current>0&&!k.current){p.current?p.current.prompt():ut(l);return}p.current?p.current.idle():dt();return}p.current?p.current.active():Ue(l)},We=l=>{if(!S&&!N.current&&(N.current=P(),xe.current(null,q)),ue(l,q),k.current)return;if(X(),!g.current&&oe.current.includes(l.type)){qe(l);return}let F=P()-N.current;if(g.current&&!E||!g.current&&F>=L.current){qe(l);return}R.current=!1,m.current=0,z.current=0,de(),V&&B&&ct.current()},Le=s.useRef(We);s.useEffect(()=>{let l=Y.current;l&&pe(),v>0?Le.current=Ze(We,v):Le.current=We,l&&ie()},[v,C,b,Ae,V,B]);let ie=()=>{ne&&re.current&&(Y.current||(ce.current.forEach(l=>{re.current.addEventListener(l,Le.current,{capture:!0,passive:!0})}),Y.current=!0))},pe=(l=!1)=>{ne&&re.current&&(Y.current||l)&&(ce.current.forEach(F=>{re.current.removeEventListener(F,Le.current,{capture:!0})}),Y.current=!1)},he=s.useCallback(l=>h.current?!1:(X(),ie(),g.current=!1,k.current=!1,R.current=!1,m.current=0,z.current=0,p.current&&!l&&p.current.start(),de(),!0),[A,g,h,L,p]),Ge=s.useCallback(l=>h.current?!1:(X(),ie(),te.current=P(),U.current+=P()-I.current,J.current+=P()-I.current,U.current=0,g.current=!1,k.current=!1,R.current=!1,m.current=0,z.current=0,p.current&&!l&&p.current.reset(),w||de(),!0),[A,g,L,w,h,p]),pt=s.useCallback(l=>h.current?!1:(X(),ie(),(g.current||k.current)&&Ue(),g.current=!1,k.current=!1,R.current=!1,m.current=0,z.current=0,te.current=P(),p.current&&!l&&p.current.activate(),de(),!0),[A,g,k,h,L,p]),$e=s.useCallback((l=!1)=>h.current||R.current?!1:(m.current=ht(),R.current=!0,pe(),X(),p.current&&!l&&p.current.pause(),!0),[A,h,p]),He=s.useCallback((l=!1)=>h.current||!R.current?!1:(R.current=!1,k.current||ie(),g.current||de(m.current),z.current&&(z.current=P()),p.current&&!l&&p.current.resume(),!0),[A,L,h,m,p]),Ut=s.useCallback((l,F)=>(p.current?(F&&ye.current(l,q),p.current.message(l)):F&&ye.current(l,q),!0),[y]),qt=s.useCallback(()=>g.current,[g]),Wt=s.useCallback(()=>k.current,[k]),Gt=s.useCallback(()=>p.current?p.current.isLeader:null,[p]),Ht=s.useCallback(()=>p.current?p.current.isLastActive:null,[p]),Kt=s.useCallback(()=>p.current?p.current.token:null,[p]),ht=s.useCallback(()=>{if(R.current)return m.current;let l=m.current?m.current:H.current+L.current,F=N.current?P()-N.current:0,ze=Math.floor(l-F);return ze<0?0:Math.abs(ze)},[L,H,k,m,N]),mt=s.useCallback(()=>Math.round(P()-te.current),[te]),ft=s.useCallback(()=>Math.round(P()-G.current),[G]),Jt=s.useCallback(()=>I.current?new Date(I.current):null,[I]),Yt=s.useCallback(()=>N.current?new Date(N.current):null,[N]),gt=s.useCallback(()=>g.current?Math.round(P()-I.current+U.current):Math.round(U.current),[I,U]),vt=s.useCallback(()=>g.current?Math.round(P()-I.current+J.current):Math.round(J.current),[I,J]),Zt=s.useCallback(()=>{let l=Math.round(mt()-gt());return l>=0?l:0},[I,U]),Xt=s.useCallback(()=>{let l=Math.round(ft()-vt());return l>=0?l:0},[I,U]);s.useEffect(()=>{if(b>0&&C>0)throw new Error("❌ onAction can either be throttled or debounced, not both.");u&&Fn(u);let l=()=>{p.current&&p.current.close(),ue.cancel&&ue.cancel(),X(),pe(!0)};return ne&&window.addEventListener("beforeunload",l),()=>{ne&&window.removeEventListener("beforeunload",l),p.current&&p.current.close(),ue.cancel&&ue.cancel(),X(),pe(!0)}},[]),s.useEffect(()=>{p.current&&p.current.close(),V?p.current=new Wn({channelName:W,leaderElection:D,onPrompt:()=>{ut()},onIdle:()=>{dt()},onActive:()=>{Ue()},onMessage:l=>{ye.current(l,q)},start:he,reset:Ge,activate:pt,pause:$e,resume:He}):p.current=null},[V,W,D,Z,be,xe,ye,he,Ge,$e,He]),s.useEffect(()=>{_.current||(X(),pe(!0)),!(w||O)&&(S?he():ie())},[w,S,O,_]),s.useEffect(()=>{if(!_.current){let l=[...new Set([...o,...i]).values()];if(pe(),ce.current=l,re.current=a,oe.current=i,w||O)return;S?he():ie()}},[a,JSON.stringify(o),JSON.stringify(i),_,O,w,S]),s.useEffect(()=>{_.current&&(_.current=!1)},[_]);let q={message:Ut,start:he,reset:Ge,activate:pt,pause:$e,resume:He,isIdle:qt,isPrompted:Wt,isLeader:Gt,isLastActiveTab:Ht,getTabId:Kt,getRemainingTime:ht,getElapsedTime:mt,getTotalElapsedTime:ft,getLastIdleTime:Jt,getLastActiveTime:Yt,getIdleTime:gt,getTotalIdleTime:vt,getActiveTime:Zt,getTotalActiveTime:Xt,setOnPresenceChange:l=>{c=l,$.current=l},setOnPrompt:l=>{d=l,Z.current=l},setOnIdle:l=>{f=l,be.current=l},setOnActive:l=>{j=l,xe.current=l},setOnAction:l=>{x=l,Ae.current=l},setOnMessage:l=>{y=l,ye.current=l}};return q}var Yn=s.createContext(null);Yn.Consumer;const Zn=({onIdle:e,onAction:n,idleTime:r=1})=>{const a=1e3*r,[o,u]=s.useState(!1),i=()=>{u(!0)},c=Jn({timeout:a,promptTimeout:a/2,onPrompt:e,onIdle:i,debounce:500,crossTab:!0,onAction:n,events:["mousemove","keydown","mousedown","touchstart","scroll","click","focus","resize","visibilitychange","pagehide","pageshow","beforeunload"]});return{isIdle:o,setIdle:u,idleTimer:c}},Cs=e=>{const n=Or(),[r,a]=s.useState(!1),{mutate:o}=Rt(),u=()=>{a(!0)},i=()=>{const m=localStorage.getItem("lastLoginAttemp"),g=new Date(m??new Date),k=parseInt(localStorage.getItem("expires")??"600");console.log(g),g.setSeconds(g.getSeconds()+k),g.getTime()-new Date().getTime()<2e4&&z()},{idleTimer:c}=Zn({onIdle:u,idleTime:parseInt(localStorage.getItem("expires")??"600"),onAction:i}),d=()=>{o(),a(!1)},f=kt(m=>m.collapsed),[j,x]=s.useState(null),[y,b]=s.useState(""),[C,v]=s.useState(null),S=!!j,w=!!C,E=kt(m=>m.hasSidebar),{setSiderCollapsed:V,setMobileSiderOpen:W}=Tr(),B=m=>{x(m.currentTarget)},D=()=>{v(null)},O=()=>{x(null),D()},G=m=>{v(m.currentTarget)},te="primary-search-account-menu",I=t.jsxs(Xe,{anchorEl:j,anchorOrigin:{vertical:"top",horizontal:"right"},id:te,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:S,onClose:O,children:[t.jsx(Pe,{onClick:O,children:"Profile"}),t.jsx(Pe,{onClick:O,children:"My account"})]}),N="primary-search-account-menu-mobile",U=t.jsxs(Xe,{anchorEl:C,anchorOrigin:{vertical:"top",horizontal:"right"},id:N,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:w,onClose:D,children:[t.jsxs(Pe,{children:[t.jsx(Ie,{size:"large","aria-label":"show 4 new mails",color:"inherit",children:t.jsx(It,{badgeContent:4,color:"error",children:t.jsx(_t,{})})}),t.jsx("p",{children:"Messages"})]}),t.jsxs(Pe,{children:[t.jsx(Ie,{size:"large","aria-label":"show 17 new notifications",color:"inherit",children:t.jsx(It,{badgeContent:17,color:"error",children:t.jsx(Bt,{})})}),t.jsx("p",{children:"Notifications"})]}),t.jsxs(Pe,{onClick:B,children:[t.jsx(Ie,{size:"large","aria-label":"account of current user","aria-controls":"primary-search-account-menu","aria-haspopup":"true",color:"inherit",children:t.jsx(zt,{})}),t.jsx("p",{children:"Profile"})]})]}),J=ge.tenantNames,z=async()=>{const{data:m}=await K.custom({url:"",method:"post",meta:{operation:"refreshToken",variables:{token:{value:localStorage.getItem("token"),type:"String",required:!0},sessionKey:{value:localStorage.getItem("sessionKey"),type:"String",required:!1}},fields:["success","message","expires","token","sessionKey"]}}).catch(()=>({data:null})).then(g=>g);m!=null&&m.success?(localStorage.setItem("lastLoginAttemp",new Date().toString()),localStorage.setItem("token",m.token),localStorage.setItem("sessionKey",m.sessionKey),localStorage.setItem("expires",m.expires),a(!1),c.reset()):d()};return s.useEffect(()=>{b(n.pathname.split("/")[1].toString())},[n]),t.jsxs(je,{position:"fixed",sx:{width:"100%",zIndex:100},children:[t.jsx(Nr,{position:"fixed",children:t.jsxs(Rr,{children:[E&&t.jsx(Ie,{size:"large",edge:"start",color:"inherit","aria-label":"open drawer",sx:{mr:2},onClick:()=>{W(!0)},children:t.jsx($t,{})}),!E&&t.jsx(je,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:t.jsx(Fe,{to:"/",children:t.jsx(Er,{src:ge.brandLogo,sx:{width:50,height:50,mr:1,border:"1px solid #ccc"}})})}),!f&&y.length==0&&t.jsx(St,{variant:"h6",noWrap:!0,component:Fe,to:"/",sx:{display:{xs:"none",sm:"block"},textDecoration:"none",textTransform:"none",color:"black",fontWeight:"bold"},children:ge.system_name}),(f||ge.appWithNoSidebar.includes(y))&&t.jsxs(St,{variant:"h6",noWrap:!0,component:Fe,to:"/",sx:{display:{xs:"none",sm:"block"},textDecoration:"none",textTransform:"none",color:"black",fontWeight:"bold"},children:[ge.system_name," | ",J[y]||y]}),t.jsx(je,{sx:{flexGrow:1}}),t.jsx(je,{sx:{display:{xs:"flex",md:"flex"}},children:t.jsx(On,{})}),t.jsx(je,{sx:{display:{xs:"none",md:"none"}},children:t.jsx(Ie,{size:"large","aria-label":"show more","aria-controls":N,"aria-haspopup":"true",onClick:G,color:"inherit",children:t.jsx(Ft,{})})})]})}),U,I,t.jsx(zr,{closable:!1,centered:!0,open:r,onOk:()=>{},onCancel:()=>{},footer:[],children:t.jsxs(je,{sx:{padding:"20px",textAlign:"center",fontSize:"1.4em"},children:[t.jsx("p",{children:"Your session has expired. Please log in again."}),t.jsx(Fe,{to:"/login",children:t.jsx(Se,{children:"Login"})})]})})]})};export{Cs as Header};
