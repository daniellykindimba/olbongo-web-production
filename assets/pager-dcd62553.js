import{r as t,b$ as ne,aO as x,aY as e,aS as H,aK as f,Q as O,cY as G,ao as E,aN as ue,dw as Ae,dl as Le,aV as W,aT as te,c3 as ie,bZ as w,b_ as c,aU as ye,a6 as le,d6 as se,ak as pe,dx as J,S as Ce,di as _e,dy as Ke,dz as Ve,aM as ce,aP as V,c9 as de,dr as we,dA as Oe,cR as he,bY as $,c$ as je,dB as Se,c7 as ee,aI as I,cq as T,cG as me,c8 as xe,c0 as Ue,aQ as Re,cI as Be,cP as Ye,c4 as He,d0 as Ne}from"./index-ac5228cb.js";import{L as fe}from"./index-cfbb0375.js";import{C as z}from"./index-384ee336.js";import{A as Ie}from"./index-c7f5773f.js";import{S as Y}from"./index-55c320f4.js";import{A as oe}from"./index-c4649691.js";import{S as Fe}from"./Skeleton-b4db67c8.js";import{F as ke}from"./index-734b9047.js";import{M as ge}from"./index-c1373156.js";import{l as Ee}from"./index-4f663fa0.js";import{G as We}from"./index-13b6e876.js";import{P as ve}from"./index-0a9d8d37.js";import{U as $e}from"./index-0cf1a8d1.js";import"./index-ac0fffce.js";import"./InfoCircleFilled-90f624d0.js";import"./ActionButton-e56aae91.js";import"./DialogWrap-ada62788.js";import"./index-d74191b2.js";import"./fade-7f3413d3.js";import"./defineProperty-b1e80ea2.js";import"./useNotification-be586971.js";import"./index-1dfc1c2d.js";import"./localeData-e87a1016.js";import"./SinglePicker-f964697f.js";import"./useMutateObserver-d9f14f65.js";import"./index-ed41abf6.js";import"./InputNumber-a9aa6d2f.js";import"./Image-f2d7849f.js";import"./Upload-b7b3d26f.js";import"./index-6c4c70bc.js";import"./index-60fd95ea.js";const Qe=()=>{const[a,i]=t.useState([]),[r,s]=t.useState(!1),[d,n]=t.useState(!1),[h,l]=t.useState(20),[p,j]=t.useState(0),[F,k]=t.useState(1);t.useState(""),ne();const[P]=x.useForm(),D=async(y,b,C=20)=>{s(!0);const{data:S}=await w.custom({url:"",method:"get",meta:{operation:"messagesDispatches",variables:{page:{value:y,type:"Int",required:!0},key:{value:b,type:"String",required:!1},pageSize:{value:C,type:"Int",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","receipientPhoneNumber","carrier",{channelMessage:["id","message",{channel:["id","name","code"]}]},{receipient:["id","firstName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(M=>(c.error("Error fetching Recently Messages Dispatched"),{data:null})).then(M=>M);S&&(j(S.total),k(S.page+1),i([...a,...S.results])),s(!1),n(!1)},L=y=>{y.currentTarget.scrollHeight-y.currentTarget.scrollTop===window.innerHeight/1.4&&D(F,"",20)};return t.useEffect(()=>{D(F,"",20)},[]),e.jsx(e.Fragment,{children:e.jsxs(H,{children:[e.jsx(f,{children:e.jsx("span",{style:{fontSize:16,fontWeight:"bolder"},children:"Recently Dispatched Messages"})}),e.jsx(f,{span:20,style:{height:45},children:e.jsx(x,{layout:"vertical",form:P,onFinish:y=>{n(!0),D(F,y.key,h)},children:e.jsx(x.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:d,placeholder:"Search Phone Number(s)...",prefix:e.jsx(G,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-start",height:45},children:e.jsx(E,{size:"large",icon:e.jsx(G,{}),onClick:()=>{P.submit()},loading:d||r,disabled:d||r})}),e.jsxs(f,{span:24,children:[a.length===0&&e.jsx(ue,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No recently dispatched message ..."})}),e.jsx(fe,{style:{paddingRight:10},children:e.jsx(Ae,{data:a,height:window.innerHeight/1.4,itemHeight:47,itemKey:"phoneNumber",onScroll:L,children:y=>{var b,C;return e.jsx(z,{children:e.jsx(fe.Item,{children:e.jsx(fe.Item.Meta,{avatar:e.jsx(Ie,{icon:e.jsx(Le,{})}),title:e.jsxs("a",{children:[y.receipientPhoneNumber,e.jsxs("span",{style:{marginLeft:5},children:[e.jsx(W,{color:"green",children:(C=(b=y==null?void 0:y.channelMessage)==null?void 0:b.channel)==null?void 0:C.name}),y.carrier&&e.jsx(W,{color:"red",children:y.carrier})]})]}),description:e.jsx(e.Fragment,{children:e.jsxs(te,{direction:"vertical",children:[e.jsx("span",{children:y.channelMessage.message.length>100?y.channelMessage.message.substring(0,100)+"...":y.channelMessage.message}),e.jsxs("span",{children:[e.jsx("b",{children:"Dispatched"}),":"," ",ie(y.created).format("lll")]})]})})})},y.receipientPhoneNumber)})}})})]})]})})},Je=a=>{const[i,r]=t.useState([]);t.useState();const[s,d]=t.useState(!1),[n,h]=t.useState(!1),[l,p]=t.useState(20),[j,F]=t.useState(0),[k,P]=t.useState("");ne();const[D]=x.useForm(),L=async(b,C,S=20)=>{d(!0);const{data:M}=await w.custom({url:"",method:"get",meta:{operation:"channelMessageDispatches",variables:{page:{value:b,type:"Int",required:!0},key:{value:C,type:"String",required:!1},pageSize:{value:S,type:"Int",required:!1},filterType:{value:a.filterType,type:"String",required:!0},messageId:{value:a.messageId,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","receipientPhoneNumber","status","statusColor","carrier","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(R=>(c.error("Error fetching Dispatches"),{data:null})).then(R=>R);M&&(F(M.total),r(M.results)),d(!1),h(!1)},y=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(b,C,S)=>e.jsx("a",{onClick:()=>{},children:C.receipientPhoneNumber})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(b,C,S)=>e.jsx(W,{color:"green",children:C.carrier})},{title:"Created",dataIndex:"created",key:"created",render:(b,C,S)=>e.jsx(le,{title:ie(C.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:ie(C.created).format("Y-mm-d hh:mm:ss")})})},{title:"Status",dataIndex:"status",key:"status",render:(b,C,S)=>e.jsx(W,{color:C.statusColor,children:C.status})},{title:"",dataIndex:"Action",key:"action",render:(b,C,S)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"}})}];return t.useEffect(()=>{L(1,"",20)},[a.randKey,a.filterType]),e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsx(f,{span:24,children:e.jsx(x,{layout:"vertical",form:D,onFinish:b=>{h(!0),L(0,b.key,l)},children:e.jsx(x.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:n,placeholder:"Search Phone Number(s)...",prefix:e.jsx(G,{}),autoComplete:"off",allowClear:!0})})})})}),e.jsx(ye,{loading:s,columns:y,dataSource:i,pagination:{onChange:(b,C)=>{p(C),L(b,k,C)},total:j,pageSize:l,position:["bottomCenter"],showQuickJumper:!0},scroll:{x:!0,y:"40vh"}})]})},Ge=["receipients","delivered","notdelivered","failed"],Ze=["All Receipients","All Delivered","All Not Delivered","All Failed"],Me=a=>{var p;se(),ne();const[i,r]=t.useState(!1),[s,d]=t.useState(),[n,h]=t.useState("receipients"),l=async()=>{var F;r(!0);const{data:j}=await w.custom({url:"",method:"get",meta:{operation:"channelMessageDispatchAnalytics",variables:{messageId:{value:(F=a.channelMessage)==null?void 0:F.id,type:"Int",required:!0}},fields:["analytics"]}}).catch(k=>(c.error("Error fetching Message Dispatch analytics"),{data:null})).then(k=>k);j&&d(j.analytics),r(!1)};return t.useEffect(()=>{l()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(pe,{spinning:i,children:[e.jsxs(H,{style:{display:"flex",justifyContent:"center",marginTop:2},children:[e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>h("receipients"),children:e.jsx(z,{children:e.jsx(Y,{title:"Total Receipients",value:s==null?void 0:s.total_receipients,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>h("delivered"),children:e.jsx(z,{children:e.jsx(Y,{title:"Delivered",value:s==null?void 0:s.total_delivered,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>h("notdelivered"),children:e.jsx(z,{children:e.jsx(Y,{title:"Not Delievered",value:s==null?void 0:s.total_not_delivered,precision:0,valueStyle:{color:"#5E0321"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:6,children:e.jsx("a",{onClick:()=>h("failed"),children:e.jsx(z,{children:e.jsx(Y,{title:"Failed",value:s==null?void 0:s.total_failed,precision:0,valueStyle:{color:"#700107"},prefix:e.jsx(J,{})})})})})]}),e.jsxs("div",{style:{marginTop:2},children:[e.jsx("h3",{children:Ze[Ge.indexOf(n)]}),e.jsx(Je,{randKey:Math.random(),filterType:n,messageId:(p=a.channelMessage)==null?void 0:p.id})]})]})})},{TextArea:Xe}=O,es=a=>{const[i,r]=t.useState([]),[s,d]=t.useState([]),n=async(j=1,F=25,k="")=>{const{data:P}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:j,type:"Int",required:!0},pageSize:{value:F,type:"Int",required:!0},key:{value:k,type:"String",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code"]}]}}).catch(()=>(c.remove(),c.error("Error fetching Channels"),{data:null})).then(D=>D);P&&r(P.results)},h=async j=>{console.error(j);const{data:F}=await w.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelMessage",variables:{channels:{value:j.channels,type:"[Int]",required:!0},message:{value:j.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessages:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","dispatched","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(k=>(console.error(k),c.remove(),c.error("Error creating channel message"),{data:null})).then(k=>k);console.log(F),F&&(F.success?(c.success(F.message),a.onFinish(F.njiwaChannelMessages)):c.error(F.message))},l=j=>{d(j)},p=j=>{};return t.useEffect(()=>{n()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(x,{layout:"vertical",form:a.form,onFinish:j=>{console.log("values",j),j.channels=s,h(j)},requiredMark:!0,children:[e.jsx(x.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(Xe,{rows:4})}),e.jsx(x.Item,{name:"channels",label:"Channels",rules:[{required:!0,type:"array",message:"Please Choose Channels ..."}],children:e.jsx(Ce,{size:"large",showSearch:!0,allowClear:!0,mode:"multiple",placeholder:"Select a Channel ...",optionFilterProp:"children",onChange:l,onSearch:p,filterOption:(j,F)=>((F==null?void 0:F.label)??"").toLowerCase().includes(j.toLowerCase()),options:i.map(j=>({value:j.id,label:j.name+" --> "+j.code})),dropdownStyle:{zIndex:9999}})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},ss=a=>{const[i,r]=t.useState(!1),[s,d]=t.useState(),[n,h]=t.useState(""),[l,p]=t.useState(""),[j,F]=t.useState(!1),[k,P]=t.useState(""),[D,L]=t.useState(""),y=async C=>{r(!0);const{data:S}=await w.custom({url:"",method:"post",meta:{operation:"messagePreDispatchSummary",variables:{messageId:{value:C,type:"Int",required:!0}},fields:["success","message",{data:["data"]}]}}).catch(M=>(console.error(M),c.remove(),c.error(M.message),{data:null})).then(M=>M);S&&(d(S.data.data),S.success?h(S.message):p(S.message)),r(!1)},b=async C=>{r(!0);const{data:S}=await w.custom({url:"",method:"post",meta:{operation:"dispatchChannelMessage",variables:{channelMessageId:{value:C,type:"Int",required:!0}},fields:["success","message",{channelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","dispatched","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(M=>(c.remove(),c.error(M.message),{data:null})).then(M=>M);c.remove(),S&&(F(!0),S.success?(L(S.message),a.onDispatch(S.channelMessage)):P(S.message))};return t.useEffect(()=>{y(a.channelMessage.id)},[a.channelMessage.id]),j?e.jsxs(e.Fragment,{children:[D.length>0&&e.jsx(oe,{message:D,type:"success",showIcon:!0}),k.length>0&&e.jsx(oe,{message:k,type:"error",showIcon:!0})]}):e.jsxs(Fe,{loading:i,active:!0,children:[n.length>0&&e.jsx(oe,{message:n,type:"success",showIcon:!0}),l.length>0&&e.jsx(oe,{message:l,type:"error",showIcon:!0}),e.jsxs("div",{children:[e.jsxs("p",{children:["Message Count: ",s==null?void 0:s.totalMessages]}),e.jsxs("p",{children:["Message Units: ",s==null?void 0:s.messageUnits]}),e.jsxs("p",{children:["Total Contacts: ",s==null?void 0:s.totalContacts]})]}),e.jsx(ke,{gap:10,style:{marginTop:20},justify:"flex-end",children:e.jsx(E,{disabled:!(s!=null&&s.dispatchable),type:"primary",onClick:()=>b(a.channelMessage.id),children:"Dispatch"})})]})},Pe=a=>{const[i,r]=t.useState([]),[s,d]=t.useState(),[n,h]=t.useState(!1),[l,p]=t.useState(!1),[j,F]=t.useState(20);t.useState(""),ne(),x.useForm();const[k]=x.useForm(),[P,D]=t.useState(!1),[L,y]=t.useState(!1),[b,C]=t.useState(!1),S=async m=>{d(m),D(!0)},M=m=>{d(m),C(!0)},R=async m=>{const{data:U}=await w.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannelMessage",variables:{id:{value:m,type:"Int",required:!0}},fields:["success","message"]}});c.remove(),U.success?(c.success(U.message),r(i.filter(Z=>Z.id.toString()!==m.toString()))):c.error(U.message)},B=async m=>{r(i.map(U=>U.id===m.id?m:U))},N=m=>{ge.confirm({title:"Deleting Njiwa Channel Message",icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>R(parseInt(m.toString()))})},_=async(m,U,Z=20)=>{h(!0);const{data:ae}=await w.custom({url:"",method:"get",meta:{operation:"njiwaChannelsMessages",variables:{page:{value:m,type:"Int",required:!0},key:{value:U,type:"String",required:!1},pageSize:{value:Z,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"dispatched","messageCount","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(()=>({data:null})).then(re=>re);ae&&r(ae.results),h(!1),p(!1)},Q=async m=>{r([...m,...i]),y(!1)};return t.useEffect(()=>{_(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(x,{layout:"vertical",form:k,onFinish:m=>{p(!0),_(0,m.key,j)},children:e.jsx(x.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Channel Message(s)...",prefix:e.jsx(G,{}),autoComplete:"off",autoFocus:!0,allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(G,{}),onClick:()=>{k.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(le,{title:"Click to Create Message",placement:"top",color:"green",children:e.jsx(E,{size:"large",icon:e.jsx(_e,{}),onClick:()=>{y(!0)},loading:l||n,disabled:l||n,style:{marginRight:30}})})})]}),e.jsx(pe,{spinning:n,children:e.jsx("div",{style:{maxHeight:a.dash?"69vh":"",overflowY:"auto"},children:e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(ue,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Message Found ..."})})}),i.map(m=>{var U;return e.jsx(f,{span:24,children:e.jsxs(z,{hoverable:m.isActive,style:{marginRight:10,marginBottom:3},children:[e.jsxs(te,{style:{right:0,position:"absolute"},children:[m.dispatched?e.jsx(e.Fragment,{children:e.jsx(le,{title:"Dispatched",placement:"top",color:"green",children:e.jsx(Ke,{style:{color:"green"}})})}):e.jsx(e.Fragment,{children:e.jsx(le,{title:"Not Dispatched",placement:"top",color:"red",children:e.jsx(Ve,{style:{color:"red"}})})}),e.jsx(ce,{trigger:["click"],overlay:e.jsxs(V,{children:[e.jsx(V.Item,{icon:e.jsx(de,{}),onClick:()=>{N(m.id)},disabled:!(m!=null&&m.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}),!m.dispatched&&e.jsx(V.Item,{icon:e.jsx(we,{}),disabled:!(m!=null&&m.canDelete),onClick:()=>{M(m)},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch"})}),e.jsx(V.Item,{icon:e.jsx(Oe,{}),disabled:!(m!=null&&m.canDelete),onClick:()=>S(m),children:e.jsx("a",{rel:"noopener noreferrer",children:"Dispatch Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:Z=>Z.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})]}),e.jsxs(te,{direction:"vertical",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created By:"}),e.jsx("span",{style:{marginLeft:5},children:(U=m==null?void 0:m.creator)==null?void 0:U.fullName})]}),e.jsx("span",{children:m.message}),e.jsxs(te,{direction:"horizontal",children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created On:"}),e.jsx("span",{style:{marginLeft:5},children:ie(m.created).format("YYYY/MM/DD HH:MM")})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Channel:"}),e.jsxs("span",{style:{marginLeft:5},children:[m==null?void 0:m.channel.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(W,{color:"green",children:m==null?void 0:m.channel.code})})]})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Message Count:"}),e.jsx("span",{style:{marginLeft:5},children:e.jsx(W,{color:"green",children:m==null?void 0:m.messageCount})})]})]})]})]})})})]})})}),e.jsx($,{title:"Dispatch Report",width:"80vw",open:P,onClose:m=>D(m),children:e.jsx(Me,{randKey:Math.random(),channelMessage:s})}),e.jsx($,{title:"Creating Message",open:L,width:"40vw",onClose:m=>y(m),children:e.jsx(es,{onFinish:Q})}),e.jsx($,{title:"Dispatching Message",open:b,width:"40vw",onClose:m=>C(m),children:e.jsx(ss,{channelMessage:s,onDispatch:m=>B(m)})})]})},ts=a=>{const[i,r]=t.useState(!1),[s]=x.useForm(),[d,n]=t.useState(1),[h,l]=t.useState(),[p,j]=t.useState(""),[F,k]=t.useState(!1),P=async()=>{r(!0);const{data:y}=await w.custom({url:"",method:"get",meta:{operation:"systemSettings",fields:["smsCostPerUnit"]}}).catch(()=>(c.remove(),c.error("Error fetching system settings"),{data:null})).then(b=>b);y&&l(y),r(!1)},D=async y=>{console.log(y);const{data:b}=await w.custom({url:"",method:"post",meta:{operation:"purchaseSmsOrder",variables:{messages:{value:y.messages,type:"Int",required:!0},phone:{value:y.phone,type:"String",required:!0}},fields:["success","message"]}}).catch(C=>(c.remove(),console.error(C),c.error("Error creating order"),{data:null})).then(C=>C);b&&(b.success?(c.success(b.message),n(3)):(j(b.message),k(!0)))},L=y=>y.toLocaleString("en-US",{style:"currency",currency:"TZS"});return t.useEffect(()=>{P()},[a.randKey]),e.jsxs(Fe,{loading:i,active:!0,children:[F&&d===2&&e.jsx(oe,{message:p,type:"error",showIcon:!0}),d===1&&e.jsxs(x,{layout:"vertical",form:s,onFinish:()=>{j(""),k(!1),n(2)},requiredMark:!0,children:[e.jsx(oe,{message:"Please note that the minimum number of messages is 100",type:"info",showIcon:!0}),e.jsx(ke,{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",marginBottom:"10px"},children:e.jsx("div",{children:e.jsxs("h3",{children:["Cost per message: ",h==null?void 0:h.smsCostPerUnit," Tsh"]})})}),e.jsx(x.Item,{name:"messages",label:"Total Messages (5 Tsh per message)",rules:[{type:"number",min:100,message:"Minimum number of messages is 100"}],children:e.jsx(Ee.InputNumber,{min:100,style:{width:"100%"}})}),e.jsx(x.Item,{name:"phone",label:"Phone Number (will be used for payment)",rules:[{required:!0,message:"Please Enter Phone Number ..."}],children:e.jsx(O,{placeholder:"Enter Phone Number"})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Purchase"})})]}),d===2&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["Total Messages: ",s.getFieldValue("messages")," "]}),e.jsxs("h3",{children:["Total Amount: ",L(parseInt(s.getFieldValue("messages"))*parseFloat((h==null?void 0:h.smsCostPerUnit.toString())??"0.0"))," "]}),e.jsxs("h3",{children:["Phone Number: ",s.getFieldValue("phone")," "]})]}),e.jsxs("div",{children:[e.jsx(E,{type:"primary",size:"large",style:{float:"left"},onClick:()=>n(1),children:"Back"}),e.jsx(E,{type:"primary",size:"large",style:{float:"right"},onClick:()=>{D({messages:s.getFieldValue("messages"),phone:s.getFieldValue("phone")})},children:"Pay"})]})]}),d===3&&e.jsxs("div",{children:[e.jsxs("h3",{children:["Payment request sent to ",s.getFieldValue("phone"),", please check your phone and confirm the payment"]}),e.jsxs("div",{children:[e.jsx(E,{type:"primary",size:"large",style:{float:"left"},onClick:()=>n(2),children:"Back"}),e.jsx(E,{type:"primary",size:"large",style:{float:"right"},onClick:()=>a.onFinish(),children:"Finish"})]})]})]})},ns=a=>{const[i,r]=t.useState(!1),[s,d]=t.useState(),{push:n}=ne(),[h,l]=t.useState(!1),j=!We.useBreakpoint().lg,F=async()=>{r(!0);const{data:k}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolAnalytic",fields:["analytics"]}}).catch(()=>(c.remove(),c.error("Error fetching analytics"),{data:null})).then(P=>P);k&&d(k.analytics),r(!1)};return t.useEffect(()=>{F()},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(Ee.Skeleton,{loading:i,children:[e.jsxs(H,{style:{display:"flex",justifyContent:"center"},children:[e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>l(!0),children:e.jsx(z,{children:e.jsx(Y,{title:"Balances (Units)",value:s==null?void 0:s.balances,precision:0,valueStyle:{color:"#3f8600"}})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/channels"),children:e.jsx(z,{children:e.jsx(Y,{title:"Channels",value:s==null?void 0:s.channels,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/contacts/phonenumbers"),children:e.jsx(z,{children:e.jsx(Y,{title:"Phone Numbers",value:s==null?void 0:s.phone_numbers,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/contacts/emails"),children:e.jsx(z,{children:e.jsx(Y,{title:"Emails",value:s==null?void 0:s.emails,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages"),children:e.jsx(z,{children:e.jsx(Y,{title:"Messages",value:s==null?void 0:s.messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/sent"),children:e.jsx(z,{children:e.jsx(Y,{title:"Pending Messages",value:s==null?void 0:s.sent_messages,precision:0,valueStyle:{color:"#770622"},prefix:e.jsx(Se,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/sent"),children:e.jsx(z,{children:e.jsx(Y,{title:"Sent Messages",value:s==null?void 0:s.sent_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>n("/njiwa/messages/failed"),children:e.jsx(z,{children:e.jsx(Y,{title:"Failed Messages",value:s==null?void 0:s.failed_messages,precision:0,valueStyle:{color:"#861400"},prefix:e.jsx(Se,{})})})})})]}),e.jsxs(H,{children:[e.jsx(f,{span:12,children:e.jsxs("div",{style:{marginTop:20},children:[e.jsx("span",{style:{fontSize:16,fontWeight:"bolder"},children:"Messages"}),e.jsx(Pe,{dash:!0})]})}),e.jsx(f,{span:12,children:e.jsx("div",{style:{marginTop:20},children:e.jsx(Qe,{})})})]})]}),e.jsx($,{title:"Purchase Messages",open:h,onClose:k=>l(k),width:j?"100vw":"30vw",children:e.jsx(ts,{onFinish:()=>l(!1)})})]})},as=()=>(t.useEffect(()=>{document.title=ee.system_name+": Njiwa"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Channels"})]})}),e.jsx(ns,{})]})),{TextArea:rs}=O,De=a=>{const i=async r=>{const{data:s}=await w.custom({url:"",method:"post",meta:{operation:"createNjiwaChannel",variables:{name:{value:r.name,type:"String",required:!0},description:{value:r.description,type:"String",required:!1}},fields:["success","message",{njiwaChannel:["id","name","description","code","icon","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(d=>(c.error("Error creating channel"),{data:null})).then(d=>d);s&&(s.success?(c.success(s.message),a.onFinish(s.njiwaChannel)):c.error(s.message))};return t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(x,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,children:[e.jsx(x.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Channel Name ..."}],children:e.jsx(O,{size:"large",placeholder:"Enter Channel Name ..."})}),e.jsx(x.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(rs,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{TextArea:is}=O,ls=a=>{const i=async r=>{var d;const{data:s}=await w.custom({url:"",method:"post",meta:{operation:"updateNjiwaChannel",variables:{channelId:{value:(d=a.channel)==null?void 0:d.id,type:"Int",required:!0},name:{value:r.name,type:"String",required:!0},description:{value:r.description,type:"String",required:!1}},fields:["success","message",{njiwaChannel:["id","name","description","code","icon","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(n=>(c.error("Error Updating channel"),{data:null})).then(n=>n);s&&(s.success?(c.success(s.message),a.onFinish(s.njiwaChannel)):c.error(s.message))};return t.useEffect(()=>{var r,s;a.form.setFieldsValue({name:(r=a.channel)==null?void 0:r.name,description:(s=a.channel)==null?void 0:s.description})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(x,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,autoComplete:"off",children:[e.jsx(x.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Channel Name"}],children:e.jsx(O,{size:"large",placeholder:"Enter Channel Name ..."})}),e.jsx(x.Item,{name:"description",label:"Description",rules:[{required:!1,type:"string",message:"Please input Description"}],children:e.jsx(is,{rows:4,maxLength:6})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},os=a=>{const[i,r]=t.useState([]),[s,d]=t.useState(),[n,h]=t.useState(!1),[l,p]=t.useState(!1),[j,F]=t.useState(0),[k,P]=t.useState(1),[D,L]=t.useState(30),[y,b]=t.useState(""),{push:C}=ne(),[S,M]=t.useState(!1),[R,B]=t.useState(!1),[N]=x.useForm(),[_]=x.useForm(),[Q]=x.useForm(),m=o=>{P(o),A(o,y,D)},U=o=>{d(o),B(!0)},Z=()=>{M(!0)},ae=async o=>{r([o,...i]),N.resetFields(),M(!1)},re=async o=>{const u=i.findIndex(v=>v.id===o.id);i[u]=o,r([...i]),_.resetFields(),B(!1)},g=async o=>{const{data:u}=await w.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{channelId:{value:o,type:"Int",required:!0}},fields:["success","message"]}}).catch(v=>(c.error(v.message),{data:null})).then(v=>v);u&&(u.success?(c.success(u.message),r(i.filter(v=>v.id.toString()!==o.toString()))):c.error(u.message))},q=o=>{ge.confirm({title:e.jsxs(e.Fragment,{children:["Deleting ",o.name," Channel"]}),icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Yes",cancelText:"Cancel",onOk:()=>g(parseInt(o.id.toString()))})},A=async(o,u,v=20)=>{h(!0);const{data:K}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:o,type:"Int",required:!0},key:{value:u,type:"String",required:!1},pageSize:{value:v,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(X=>(c.error("Error fetching channels"),{data:null})).then(X=>X);K&&(F(K.total),r(K.results)),h(!1),p(!1)};return t.useEffect(()=>{A(1,y,D)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(x,{layout:"vertical",form:Q,onFinish:o=>{b(o.key),p(!0),A(0,o.key,D)},children:e.jsx(x.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Channel(s)...",prefix:e.jsx(G,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(G,{}),onClick:()=>{Q.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(E,{size:"large",disabled:n||l,onClick:()=>{N.resetFields(),Z()},children:[e.jsx(me,{}),"Create Channel"]})})]}),e.jsxs(pe,{spinning:n,size:"large",children:[e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(ue,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(E,{type:"primary",onClick:()=>{N.resetFields(),Z()},children:"Create Channel Now"})})}),i.map(o=>e.jsx(f,{span:4,children:e.jsxs(z,{hoverable:o.isActive,style:{marginRight:10},children:[e.jsx(te,{style:{right:0,position:"absolute"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(V,{children:[e.jsx(V.Item,{icon:e.jsx(xe,{}),onClick:()=>{U(o)},disabled:!(o!=null&&o.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(V.Item,{icon:e.jsx(de,{}),onClick:()=>{q(o)},disabled:!(o!=null&&o.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:u=>u.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsx("a",{onClick:()=>C("/njiwa/channel/"+o.id+"/"+o.name),children:e.jsxs(te,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsx(Ie,{size:{xs:24,sm:32,md:40,lg:40,xl:40,xxl:80},icon:e.jsx(Ue,{}),src:o.icon}),e.jsx(le,{title:o.name,children:o.name.length>10?o.name.substring(0,10)+"...":o.name}),e.jsx("span",{children:e.jsx(W,{color:"green",children:o.code})})]})})]})}))]}),i.length>0&&e.jsx(H,{style:{display:"flex",justifyContent:"center"},children:e.jsx("span",{style:{marginTop:20},children:e.jsx(Re,{showQuickJumper:!0,showTotal:(o,u)=>`Total ${o} Channels`,defaultCurrent:k,total:j,pageSize:D,onChange:m,showSizeChanger:!0,onShowSizeChange:(o,u)=>{L(u),A(o,y,u)},disabled:n||l})})})]}),e.jsx($,{title:"Create Njiwa Channel",width:"40vw",open:S,onClose:o=>M(o),children:e.jsx(De,{form:N,randKey:Math.random(),onFinish:ae})}),e.jsx($,{title:"Edit "+(s==null?void 0:s.name)+" Channel",width:"40vw",open:R,onClose:o=>B(o),children:e.jsx(ls,{form:_,randKey:Math.random(),onFinish:re,channel:s})})]})},cs=()=>(t.useEffect(()=>{document.title=ee.system_name+": Channels"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:5,marginBottom:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Channels"})]})}),e.jsx(os,{randKey:Math.random()})]})),ds=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Emails"})})),hs=a=>{const[i,r]=t.useState(!1),[s,d]=t.useState(),n=se(),h=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(p=>(c.error("Error fetching channel"),{data:null})).then(p=>p);l&&d(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel Emails",h()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:5,marginBottom:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(I.Item,{children:e.jsxs(T,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(W,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Emails"})]})}),e.jsx(ds,{randKey:Math.random(),channel:s})]})},us=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Failed Messages"})})),ms=a=>{const[i,r]=t.useState(!1),[s,d]=t.useState(),n=se(),h=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(p=>(c.error("Error fetching channel"),{data:null})).then(p=>p);l&&d(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Failed Messages",h()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(I.Item,{children:e.jsxs(T,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(W,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx(I.Item,{children:"Messages"}),e.jsx("span",{children:"Failed"})]})}),e.jsx(us,{randKey:Math.random(),channel:s})]})},{TextArea:xs}=O,ps=a=>{const i=se(),r=async s=>{const{data:d}=await w.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelMessage",variables:{channelId:{value:parseInt(i.channelId),type:"Int",required:!0},message:{value:s.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(n=>(c.error("Error creating channel message"),{data:null})).then(n=>n);d&&(d.success?(c.success(d.message),a.onFinish(d.njiwaChannelMessage)):c.error(d.message))};return t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(x,{layout:"vertical",form:a.form,onFinish:s=>{r(s)},requiredMark:!0,children:[e.jsx(x.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(xs,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},{TextArea:js}=O,gs=a=>{se();const i=async r=>{const{data:s}=await w.custom({url:"",method:"post",meta:{operation:"updateNjiwaChannelMessage",variables:{channelMessageId:{value:r.channel_message_id,type:"Int",required:!0},message:{value:r.message,type:"String",required:!1}},fields:["success","message",{njiwaChannelMessage:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"created","updated","isActive","canDelete","canEdit","canManage"]}]}}).catch(d=>(c.error("Error creating channel message"),{data:null})).then(d=>d);s&&(s.success?(c.success(s.message),a.onFinish(s.njiwaChannelMessage)):c.error(s.message))};return t.useEffect(()=>{var r;a.form.setFieldsValue({message:(r=a==null?void 0:a.channelMessage)==null?void 0:r.message})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(x,{layout:"vertical",form:a.form,onFinish:r=>{var s;r.channel_message_id=(s=a.channelMessage)==null?void 0:s.id,i(r)},requiredMark:!0,children:[e.jsx(x.Item,{name:"message",label:"Message",rules:[{required:!0,type:"string",message:"Please input Message"}],children:e.jsx(js,{rows:4})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},fs=a=>{const[i,r]=t.useState([]),[s,d]=t.useState(),[n,h]=t.useState(!1),[l,p]=t.useState(!1),[j,F]=t.useState(20);t.useState(""),ne();const[k,P]=t.useState(!1),[D,L]=t.useState(!1),[y,b]=t.useState(!1),[C]=x.useForm(),[S]=x.useForm(),[M]=x.useForm(),R=se(),B=g=>{d(g),b(!0)},N=g=>{d(g),L(!0)},_=()=>{P(!0)},Q=async g=>{r([g,...i]),C.resetFields(),P(!1)},m=async g=>{r(i.map(q=>q.id.toString()===g.id.toString()?g:q)),S.resetFields(),L(!1)},U=async g=>{const{data:q}=await w.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannelMessage",variables:{channelMessageId:{value:g,type:"Int",required:!0}},fields:["success","message"]}});q.success?(c.success(q.message),r(i.filter(A=>A.id.toString()!==g.toString()))):c.error(q.message)},Z=async g=>{c("dispatching");const{data:q}=await w.custom({url:"",method:"post",meta:{operation:"dispatchChannelMessage",variables:{channelMessageId:{value:g,type:"Int",required:!0}},fields:["success","message"]}}).catch(A=>(c.error(A.message),{data:null})).then(A=>A);q&&(q.success?c.success(q.message):c.error(q.message))},ae=g=>{ge.confirm({title:"Deleting Njiwa Channel Message",icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>U(parseInt(g.toString()))})},re=async(g,q,A=20)=>{const{data:o}=await w.custom({url:"",method:"get",meta:{operation:"njiwaChannelMessages",variables:{page:{value:g,type:"Int",required:!0},key:{value:q,type:"String",required:!1},pageSize:{value:A,type:"Int",required:!1},channelId:{value:parseInt(R.channelId),type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","message",{channel:["id","name","code"]},{creator:["id","firstName","middleName","lastName","fullName"]},"messageCount","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(u=>(c.error("Failed to fetch Channel Messages"),{data:null})).then(u=>u);o&&r(o.results),h(!1),p(!1)};return t.useEffect(()=>{re(1,"",20)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(x,{layout:"vertical",form:M,onFinish:g=>{p(!0),re(0,g.key,j)},children:e.jsx(x.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Channel Message(s)...",prefix:e.jsx(G,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(G,{}),onClick:()=>{M.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(E,{size:"large",disabled:n||l,onClick:()=>{C.resetFields(),_()},children:[e.jsx(me,{}),"Create Message"]})})]}),e.jsx(pe,{spinning:n,children:e.jsxs(H,{align:"top",children:[i.length===0&&!n&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(ue,{image:"/images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(E,{type:"primary",onClick:()=>{C.resetFields(),_()},children:"Create Message"})})}),i.map(g=>{var q;return e.jsx(f,{span:24,children:e.jsxs(z,{hoverable:g.isActive,style:{marginRight:10},children:[e.jsx(te,{style:{right:0,position:"absolute"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(V,{children:[e.jsx(V.Item,{icon:e.jsx(xe,{}),onClick:()=>{N(g)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(V.Item,{icon:e.jsx(de,{}),onClick:()=>{ae(g.id)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})}),e.jsx(V.Item,{icon:e.jsx(we,{}),disabled:!(g!=null&&g.canDelete),children:e.jsx(ve,{title:"Are you sure to Start Sending/Dispatching SMS?",onConfirm:()=>Z(g.id),onCancel:()=>{},okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch"})})}),e.jsx(V.Item,{icon:e.jsx(Be,{}),onClick:()=>{B(g)},disabled:!(g!=null&&g.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Dispatch Report"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:A=>A.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsxs(te,{direction:"vertical",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:[e.jsx("span",{children:g.message}),e.jsxs(te,{direction:"horizontal",children:[e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created On:"}),e.jsx("span",{style:{marginLeft:5},children:ie(g.created).format("YYYY/MM/DD HH:MM")})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Created By:"}),e.jsx("span",{style:{marginLeft:5},children:(q=g==null?void 0:g.creator)==null?void 0:q.fullName})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Channel:"}),e.jsx("span",{style:{marginLeft:5},children:g==null?void 0:g.channel.name})]}),e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bolder"},children:"Message Count:"}),e.jsx("span",{style:{marginLeft:5},children:e.jsx(W,{color:"green",children:g==null?void 0:g.messageCount})})]})]})]})]})})})]})}),e.jsx($,{title:"Create Njiwa Channel Message",width:"40vw",open:k,onClose:g=>P(g),children:e.jsx(ps,{form:C,randKey:Math.random(),onFinish:Q})}),e.jsx($,{title:"Edit Njiwa Channel Message",width:"40vw",open:D,onClose:g=>L(g),children:e.jsx(gs,{form:S,randKey:Math.random(),onFinish:m,channelMessage:s})}),e.jsx($,{title:"Dispatch Report",width:"50vw",open:y,onClose:g=>b(g),children:e.jsx(Me,{randKey:Math.random(),channelMessage:s})})]})},ys=a=>{const[i,r]=t.useState(!1),[s,d]=t.useState(),n=se(),h=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(p=>(c.error("Error fetching channel"),{data:null})).then(p=>p);l&&d(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel Messages",h()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(I.Item,{children:e.jsxs(T,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(W,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Messages"})]})}),e.jsx(fs,{randKey:Math.random(),channel:s})]})},Cs=a=>{const i=se(),{push:r}=ne(),[s,d]=t.useState(!1),[n,h]=t.useState(),l=async()=>{d(!0);const{data:p}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannelAnalytic",variables:{channelId:{value:parseInt(i.channelId),type:"Int",required:!0}},fields:["analytics"]}}).catch(j=>(c.error("Error fetching analytics"),{data:null})).then(j=>j);p&&h(p.analytics),d(!1)};return t.useEffect(()=>{l()},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(H,{style:{display:"flex",justifyContent:"center",marginTop:10},children:[e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{var p,j;return r("/njiwa/channel/"+((p=a.channel)==null?void 0:p.id)+"/"+((j=a.channel)==null?void 0:j.name)+"/phonenumbers")},children:e.jsx(z,{children:e.jsx(Y,{title:"Phone Numbers",value:n==null?void 0:n.phone_numbers,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(z,{children:e.jsx(Y,{title:"Emails",value:n==null?void 0:n.emails_addresses,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{var p,j;return r("/njiwa/channel/"+((p=a.channel)==null?void 0:p.id)+"/"+((j=a.channel)==null?void 0:j.name)+"/messages")},children:e.jsx(z,{children:e.jsx(Y,{title:"Messages",value:n==null?void 0:n.messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(z,{children:e.jsx(Y,{title:"Pending Messages",value:n==null?void 0:n.pending_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(z,{children:e.jsx(Y,{title:"Sent Messages",value:n==null?void 0:n.sent_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})}),e.jsx(f,{span:3,children:e.jsx("a",{onClick:()=>{},children:e.jsx(z,{children:e.jsx(Y,{title:"Failed Messages",value:n==null?void 0:n.failed_messages,precision:0,valueStyle:{color:"#3f8600"},prefix:e.jsx(J,{})})})})})]})})},vs=a=>{const[i,r]=t.useState(!1),[s,d]=t.useState(),n=se(),h=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(p=>(c.error("Error fetching channel"),{data:null})).then(p=>p);l&&d(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Channel",h()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa/channels",children:"Channels"})}),e.jsxs("span",{children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(W,{color:"green",children:s==null?void 0:s.code})})]})]})}),e.jsx(Cs,{randKey:Math.random(),channel:s})]})},qe=a=>{const[i,r]=t.useState([]),s=async n=>{const{data:h}=await w.custom({url:"",method:"post",meta:{operation:"createNjiwaChannelsPhoneNumber",variables:{phoneNumber:{value:n.phoneNumber,type:"String",required:!0},name:{value:n.name,type:"String",required:!1},channels:{value:n.channels,type:"[Int]",required:!0}},fields:["success","message"]}}).catch(l=>(c.error("Error creating channels phone number"),{data:null})).then(l=>l);h&&(h.success?(c.success(h.message),a.onFinish(h.njiwaChannel)):c.error(h.message))},d=async(n,h,l=20)=>{const{data:p}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:n,type:"Int",required:!0},key:{value:h,type:"String",required:!1},pageSize:{value:l,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(j=>(c.error("Error fetching channels"),{data:null})).then(j=>j);p&&r(p.results)};return t.useEffect(()=>{d(1,"",50)},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(x,{layout:"vertical",form:a.form,onFinish:n=>{n.channels=a.channel?[a.channel.id]:[],s(n)},requiredMark:!0,autoComplete:"off",children:[e.jsx(x.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,type:"string",message:"Please input Phone Number"}],children:e.jsx(O,{size:"large",placeholder:"Enter Phone Number ..."})}),e.jsx(x.Item,{name:"name",label:"Full Name",rules:[{required:!1,type:"string",message:"Please input Full Name"}],children:e.jsx(O,{size:"large",placeholder:"Enter Full Name ..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},ze=a=>{const i=async r=>{var d;const{data:s}=await w.custom({url:"",method:"post",meta:{operation:"updateNjiwaPhoneNumber",variables:{phoneNumberId:{value:(d=a.phoneNumber)==null?void 0:d.id,type:"Int",required:!0},phoneNumber:{value:r.phoneNumber,type:"String",required:!0},name:{value:r.name,type:"String",required:!1}},fields:["success","message",{phoneNumber:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(n=>(c.error("Error Updating Phone number"),{data:null})).then(n=>n);s&&(s.success?(c.success(s.message),a.onFinish(s.phoneNumber)):c.error(s.message))};return t.useEffect(()=>{var r,s;a.form.setFieldsValue({phoneNumber:(r=a.phoneNumber)==null?void 0:r.phoneNumber,name:(s=a.phoneNumber)==null?void 0:s.name})},[a.randKey]),e.jsx(e.Fragment,{children:e.jsxs(x,{layout:"vertical",form:a.form,onFinish:r=>{i(r)},requiredMark:!0,autoComplete:"off",children:[e.jsx(x.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,type:"string",message:"Please input Phone Number"}],children:e.jsx(O,{size:"large",placeholder:"Enter Phone Number ..."})}),e.jsx(x.Item,{name:"name",label:"Full Name",rules:[{required:!1,type:"string",message:"Please input Full Name"}],children:e.jsx(O,{size:"large",placeholder:"Enter Full Name ..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Update"})})]})})},{Option:bs}=Ce,Ss=a=>Array.isArray(a)?a:a==null?void 0:a.fileList,Te=a=>{const[i,r]=t.useState([]),s=async n=>{const{data:h}=await w.custom({url:"",method:"post",meta:{operation:"uploadNjiwaChannelsPhoneNumbers",variables:{channels:{value:n.channels,type:"[Int]",required:!0},file:{value:n.file,type:"Upload",required:!0}},fields:["success","message"]}}).catch(l=>(c.error("Error creating channels phone number"),{data:null})).then(l=>l);h&&(h.success?(c.success(h.message),a.onFinish(h.njiwaChannel)):c.error(h.message))},d=async(n,h,l=20)=>{const{data:p}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannels",variables:{page:{value:n,type:"Int",required:!0},key:{value:h,type:"String",required:!1},pageSize:{value:l,type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","code","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(j=>(c.error("Error fetching channels"),{data:null})).then(j=>j);p&&r(p.results)};return t.useEffect(()=>{d(1,"",50)},[a.randKey]),e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsxs("a",{target:"_blank",href:ee.base_url+"/static/templates/njiwa_channels_phone_numbers_template.xlsx",rel:"noreferrer",children:["Download Excel Template ",e.jsx(Ye,{})]})}),e.jsxs(x,{layout:"vertical",form:a.form,onFinish:n=>{n.channels=n.channels.map(h=>parseInt(h)),s(n)},requiredMark:!0,autoComplete:"off",children:[e.jsx(x.Item,{label:"Contacts File(Excel)",children:e.jsx(x.Item,{name:"file",valuePropName:"fileList",getValueFromEvent:Ss,noStyle:!0,rules:[{required:!0,type:"array",message:"Please upload students excel file"}],children:e.jsxs($e.Dragger,{name:"file",accept:".xls, .xlsx",multiple:!1,beforeUpload:()=>!1,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(He,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload."})]})})}),e.jsx(x.Item,{name:"channels",label:"Channels",rules:[{required:!0,type:"array",message:"Please select Channel(s)..."}],children:e.jsx(Ce,{size:"large",mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"Please select",defaultValue:[],dropdownStyle:{zIndex:9999},children:i.map(n=>e.jsxs(bs,{value:n.id,children:[n.name,e.jsx("span",{style:{marginLeft:5},children:e.jsx(W,{color:"green",children:n.code})})]},n.id))})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})]})},ws=a=>{const[i,r]=t.useState([]),[s,d]=t.useState(),[n,h]=t.useState(!1),[l,p]=t.useState(!1),[j,F]=t.useState(20),[k,P]=t.useState(0),[D,L]=t.useState("");ne();const[y,b]=t.useState(!1),[C,S]=t.useState(!1),[M,R]=t.useState(!1),[B]=x.useForm(),[N]=x.useForm(),[_]=x.useForm(),[Q]=x.useForm(),m=se(),U=u=>{d(u),S(!0)},Z=()=>{b(!0)},ae=async()=>{A(1,"",20),b(!1),B.resetFields()},re=async u=>{r(i.map(v=>v.id.toString()===u.id.toString()?u:v)),N.resetFields(),S(!1)},g=async()=>{A(1,"",20),_.resetFields(),R(!1)},q=async u=>{const{data:v}=await w.custom({url:"",method:"post",meta:{operation:"deleteChannelPhoneNumber",variables:{id:{value:u,type:"Int",required:!0}},fields:["success","message"]}});v.success?(c.success(v.message),r(i.filter(K=>K.id.toString()!==u.toString()))):c.error(v.message)},A=async(u,v,K=20)=>{h(!0);const{data:X}=await w.custom({url:"",method:"get",meta:{operation:"njiwaChannelPhoneNumbers",variables:{page:{value:u,type:"Int",required:!0},key:{value:v,type:"String",required:!1},pageSize:{value:K,type:"Int",required:!1},channelId:{value:parseInt(m.channelId),type:"Int",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id",{phoneContact:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]}]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(be=>(c.error("Error fetching phone numbers"),{data:null})).then(be=>be);X&&(P(X.total),r(X.results)),h(!1),p(!1)},o=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(u,v,K)=>e.jsx("a",{onClick:()=>{},children:v.phoneContact.phoneNumber})},{title:"Full Name",dataIndex:"fullName",key:"name",render:(u,v,K)=>e.jsx("span",{children:v.phoneContact.name})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(u,v,K)=>{var X;return e.jsx(W,{color:"green",children:(X=v.phoneContact.carrier)==null?void 0:X.name})}},{title:"Created",dataIndex:"created",key:"created",render:(u,v,K)=>e.jsx(le,{title:ie(v.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:ie(v.created).format("Y-mm-d hh:mm:ss")})})},{title:"",dataIndex:"Action",key:"action",render:(u,v,K)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(V,{children:[e.jsx(V.Item,{disabled:!v.canDelete,icon:e.jsx(de,{}),onClick:()=>{},children:e.jsx(ve,{placement:"topLeft",title:"Deleting Phone Number",onConfirm:()=>q(parseInt(v.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(V.Item,{disabled:!v.canEdit,icon:e.jsx(xe,{}),onClick:()=>U(v),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:X=>X.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}];return t.useEffect(()=>{A(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:8,children:e.jsx(x,{layout:"vertical",form:Q,onFinish:u=>{p(!0),A(0,u.key,j)},children:e.jsx(x.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Phone Number(s)...",prefix:e.jsx(G,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(G,{}),onClick:()=>{Q.submit()},loading:l||n,disabled:l||n})}),e.jsxs(f,{span:10,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(E,{size:"large",disabled:n||l,onClick:()=>{B.resetFields(),Z()},icon:e.jsx(me,{}),children:"Add Phone Number"}),e.jsx(E,{size:"large",disabled:n||l,onClick:()=>R(!0),icon:e.jsx(Ne,{}),children:"Upload Phone Numbers"})]})]}),e.jsx(ye,{loading:n,columns:o,dataSource:i,pagination:{onChange:(u,v)=>{F(v),A(u,D,v)},total:k,pageSize:j,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}}),e.jsx($,{title:"Adding Phone Number",width:"40vw",open:y,onClose:u=>b(u),children:e.jsx(qe,{form:B,onFinish:ae,randKey:Math.random(),channel:a.channel})}),e.jsx($,{title:"Editting Phone Number",width:"40vw",open:C,onClose:u=>S(u),children:e.jsx(ze,{form:N,onFinish:re,randKey:Math.random()})}),e.jsx($,{title:"Uploading Phone Numbers",width:"40vw",open:M,onClose:u=>R(u),children:e.jsx(Te,{form:_,onFinish:g,randKey:Math.random()})})]})},Ns=a=>{const[i,r]=t.useState(!1),[s,d]=t.useState(),n=se(),h=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(p=>(c.error("Error fetching channel"),{data:null})).then(p=>p);l&&d(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Phone Numbers",h()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(I.Item,{children:e.jsxs(T,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(W,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx("span",{children:"Phone Numbers"})]})}),e.jsx(ws,{randKey:Math.random(),channel:s})]})},Is=a=>(t.useEffect(()=>{},[a.randKey]),e.jsx(e.Fragment,{children:e.jsx("p",{children:"Channel Sent Messages"})})),Fs=a=>{const[i,r]=t.useState(!1),[s,d]=t.useState(),n=se(),h=async()=>{r(!0);const{data:l}=await w.custom({url:"",method:"get",meta:{operation:"njiwaSchoolChannel",variables:{channelId:{value:parseInt(n.channelId),type:"Int",required:!0}},fields:["id","name","description","code","isActive","created","updated","canEdit","canDelete","canManage"]}}).catch(p=>(c.error("Error fetching channel"),{data:null})).then(p=>p);l&&d(l),r(!1)};return t.useEffect(()=>{document.title=ee.system_name+": Sent Messages",h()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa/channels",children:"Channels"})}),e.jsx(I.Item,{children:e.jsxs(T,{to:"/njiwa/channel/"+(s==null?void 0:s.id)+"/"+(s==null?void 0:s.name),children:[s==null?void 0:s.name,e.jsx("span",{style:{marginLeft:10},children:e.jsx(W,{color:"green",children:s==null?void 0:s.code})})]})}),e.jsx(I.Item,{children:"Messages"}),e.jsx("span",{children:"Sent"})]})}),e.jsx(Is,{randKey:Math.random(),channel:s})]})},ks=a=>{const[i,r]=t.useState([]),[s,d]=t.useState(),[n,h]=t.useState(!1),[l,p]=t.useState(!1),[j,F]=t.useState(20);t.useState(""),ne();const[k,P]=t.useState(!1),[D,L]=t.useState(!1),[y]=x.useForm();x.useForm();const[b]=x.useForm(),C=N=>{d(N),L(!0)},S=()=>{P(!0)},M=async N=>{const{data:_}=await w.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{id:{value:N,type:"Int",required:!0}},fields:["success","message"]}});_.success?(c.success(_.message),r(i.filter(Q=>Q.id.toString()!==N.toString()))):c.error(_.message)},R=N=>{ge.confirm({title:"Deleting Njiwa Email Address",icon:e.jsx(je,{}),content:"Are you sure ...",okText:"Delete",cancelText:"Cancel",onOk:()=>M(parseInt(N.toString()))})},B=async(N,_,Q=20)=>{const{data:m}=await w.custom({url:"",method:"get",meta:{operation:"njiwaChannels",variables:{control:{value:!0,type:"Boolean",required:!0}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","icon","description","isActive","created","updated","canEdit","canDelete","canManage"]}]}});r(m.results),h(!1),p(!1)};return t.useEffect(()=>{B(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:14,children:e.jsx(x,{layout:"vertical",form:b,onFinish:N=>{p(!0),B(0,N.key,j)},children:e.jsx(x.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Channel(s)...",prefix:e.jsx(G,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(G,{}),onClick:()=>{b.submit()},loading:l||n,disabled:l||n})}),e.jsx(f,{span:4,style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(E,{size:"large",disabled:n||l,onClick:()=>{},children:[e.jsx(me,{}),"Add Email Address"]})})]}),e.jsxs(H,{align:"top",children:[i.length===0&&e.jsx(f,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(ue,{image:"images/nodata.png",imageStyle:{height:160},description:e.jsx("span",{style:{fontSize:16},children:"No Communication Channel Found ..."}),children:e.jsx(E,{type:"primary",onClick:()=>{y.resetFields(),S()},children:"Create Email Address Now"})})}),i.map(N=>e.jsx(f,{span:4,children:e.jsxs(z,{hoverable:N.isActive,style:{marginRight:10},children:[e.jsx(te,{style:{right:0,position:"absolute"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(V,{children:[e.jsx(V.Item,{icon:e.jsx(xe,{}),onClick:()=>{C(N)},disabled:!(N!=null&&N.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})}),e.jsx(V.Item,{icon:e.jsx(de,{}),onClick:()=>{R(N.id)},disabled:!(N!=null&&N.canDelete),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:_=>_.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})}),e.jsx(te,{direction:"vertical",align:"center",style:{width:"100%",justifyContent:"center"},onClick:()=>{},children:N.emailAddress})]})}))]}),e.jsx($,{title:"Create Njiwa Email Address",width:"40vw",open:k,onClose:N=>P(N),children:e.jsx(De,{})})]})},Es=()=>(t.useEffect(()=>{document.title=ee.system_name+": Emails"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Emails Addresses"})]})}),e.jsx(ks,{})]})),Ms=()=>(t.useEffect(()=>{document.title=ee.system_name+": Messages"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Messages"})]})}),e.jsx(Pe,{})]})),Ps=a=>(t.useEffect(()=>{},[]),e.jsx(e.Fragment,{children:e.jsx("span",{children:"Settings"})})),Ds=()=>(t.useEffect(()=>{document.title=ee.system_name+": Settings"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Settings"})]})}),e.jsx(Ps,{})]})),qs=a=>{const[i,r]=t.useState([]),[s,d]=t.useState(),[n,h]=t.useState(!1),[l,p]=t.useState(!1),[j,F]=t.useState(20),[k,P]=t.useState(0),[D,L]=t.useState("");ne();const[y,b]=t.useState(!1),[C,S]=t.useState(!1),[M,R]=t.useState(!1),[B]=x.useForm(),[N]=x.useForm(),[_]=x.useForm(),[Q]=x.useForm(),m=o=>{d(o),S(!0)},U=()=>{b(!0)},Z=async()=>{q(1,"",20),b(!1),B.resetFields()},ae=async o=>{r(i.map(u=>u.id.toString()===o.id.toString()?o:u)),N.resetFields(),S(!1)},re=async()=>{q(1,"",20),_.resetFields(),R(!1)},g=async o=>{const{data:u}=await w.custom({url:"",method:"post",meta:{operation:"deleteNjiwaChannel",variables:{id:{value:o,type:"Int",required:!0}},fields:["success","message"]}});u.success?(c.success(u.message),r(i.filter(v=>v.id.toString()!==o.toString()))):c.error(u.message)},q=async(o,u,v=20)=>{h(!0);const{data:K}=await w.custom({url:"",method:"get",meta:{operation:"njiwaChannelsPhoneContacts",variables:{page:{value:o,type:"Int",required:!0},key:{value:u,type:"String",required:!1},pageSize:{value:v,type:"Int",required:!1}},fields:["pages","total","page","hasNext","hasPrev",{results:["id","name","phoneNumber","countryCode",{carrier:["id","name"]},{user:["id","fullName","firstName","lastName"]},{owner:["id","fullName","firstName","lastName"]},"isActive","created","updated","canEdit","canDelete","canManage"]}]}}).catch(X=>(c.error("Error fetching phone numbers"),{data:null})).then(X=>X);K&&(P(K.total),r(K.results)),h(!1),p(!1)},A=[{title:"Phone Number",dataIndex:"phoneNumber",key:"phoneNumber",render:(o,u,v)=>e.jsx("a",{onClick:()=>{},children:u.phoneNumber})},{title:"Full Name",dataIndex:"fullName",key:"name",render:(o,u,v)=>e.jsx("span",{children:u.name})},{title:"Carrier",dataIndex:"carrier",key:"carrier",render:(o,u,v)=>{var K;return e.jsx(W,{color:"green",children:(K=u.carrier)==null?void 0:K.name})}},{title:"Created",dataIndex:"created",key:"created",render:(o,u,v)=>e.jsx(le,{title:ie(u.created).format("Y-mm-d hh:mm:ss"),children:e.jsx("span",{children:ie(u.created).format("Y-mm-d hh:mm:ss")})})},{title:"",dataIndex:"Action",key:"action",render:(o,u,v)=>e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(ce,{trigger:["click"],overlay:e.jsxs(V,{children:[e.jsx(V.Item,{disabled:!u.canDelete,icon:e.jsx(de,{}),onClick:()=>{},children:e.jsx(ve,{placement:"topLeft",title:"Deleting Phone Number",onConfirm:()=>g(parseInt(u.id)),okText:"Yes",cancelText:"No",overlayStyle:{zIndex:9999},children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Delete"})})}),e.jsx(V.Item,{disabled:!u.canEdit,icon:e.jsx(xe,{}),onClick:()=>m(u),children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",children:"Edit"})})]}),overlayStyle:{zIndex:9999},children:e.jsx("a",{className:"ant-dropdown-link",onClick:K=>K.preventDefault(),children:e.jsx(he,{style:{color:"orange",fontSize:28,fontWeight:"bold"}})})})})}];return t.useEffect(()=>{q(1,"",20)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(f,{span:8,children:e.jsx(x,{layout:"vertical",form:Q,onFinish:o=>{p(!0),q(0,o.key,j)},children:e.jsx(x.Item,{name:"key",children:e.jsx(O,{size:"large",disabled:l,placeholder:"Search Phone Number(s)...",prefix:e.jsx(G,{}),autoComplete:"off",allowClear:!0})})})}),e.jsx(f,{span:6,style:{display:"flex",justifyContent:"flex-start"},children:e.jsx(E,{size:"large",icon:e.jsx(G,{}),onClick:()=>{Q.submit()},loading:l||n,disabled:l||n})}),e.jsxs(f,{span:10,style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(E,{size:"large",disabled:n||l,onClick:()=>{B.resetFields(),U()},icon:e.jsx(me,{}),children:"Add Phone Number"}),e.jsx(E,{size:"large",disabled:n||l,onClick:()=>R(!0),icon:e.jsx(Ne,{}),children:"Upload Phone Numbers"})]})]}),e.jsx(ye,{loading:n,columns:A,dataSource:i,pagination:{onChange:(o,u)=>{F(u),q(o,D,u)},total:k,pageSize:j,position:["bottomCenter"],showQuickJumper:!1},scroll:{x:!0}}),e.jsx($,{title:"Adding Phone Number",width:"40vw",open:y,onClose:o=>b(o),children:e.jsx(qe,{form:B,onFinish:Z,randKey:Math.random()})}),e.jsx($,{title:"Editting Phone Number",width:"40vw",open:C,onClose:o=>S(o),children:e.jsx(ze,{phoneNumber:s,form:N,onFinish:ae,randKey:Math.random()})}),e.jsx($,{title:"Uploading Phone Numbers",width:"40vw",open:M,onClose:o=>R(o),children:e.jsx(Te,{form:_,onFinish:re,randKey:Math.random()})})]})},zs=()=>(t.useEffect(()=>{document.title=ee.system_name+": Phone Numbers"},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:5,marginTop:5},children:e.jsxs(I,{children:[e.jsx(I.Item,{children:e.jsx(T,{to:"/njiwa",children:"Home"})}),e.jsx("span",{children:"Phone Numbers"})]})}),e.jsx(qs,{})]})),ut=a=>{const{page:i}=a;return i==="PhoneNumbersPage"?e.jsx(zs,{}):i==="NjiwaSettingsPage"?e.jsx(Ds,{}):i==="MessagesPage"?e.jsx(Ms,{}):i==="EmailsPage"?e.jsx(Es,{}):i==="ChannelSentMessagesPage"?e.jsx(Fs,{}):i==="ChannelPhoneNumbersPage"?e.jsx(Ns,{}):i==="ChannelPage"?e.jsx(vs,{}):i==="ChannelMessagesPage"?e.jsx(ys,{}):i==="ChannelFailedMessagesPage"?e.jsx(ms,{}):i==="ChannelEmailsPage"?e.jsx(hs,{}):i==="ChannelsPage"?e.jsx(cs,{}):i==="NjiwaDashboardPage"?e.jsx(as,{}):e.jsx("div",{children:"Page not found ..."})};export{ut as NjiwaPages};
