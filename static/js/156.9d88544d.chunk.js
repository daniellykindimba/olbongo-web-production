"use strict";(self.webpackChunkolbongo=self.webpackChunkolbongo||[]).push([[156],{20156:function(e,t,n){n.r(t),n.d(t,{ControlRolesPage:function(){return b}});var r=n(78164),s=n(43504),i=n(74165),a=n(15861),o=n(29439),l=n(95027),c=n(82622),u=n(31752),d=n(11730),m=n(14057),f=n(840),p=n(72518),h=n(87012),x=n(72791),v=n(50333),j=n(80184),y=function(e){return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(f.l0,{layout:"vertical",form:e.form,onFinish:function(t){e.onFinish(t)},requiredMark:!1,children:[(0,j.jsx)(f.l0.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Name"}],children:(0,j.jsx)(f.II,{size:"large",placeholder:"Enter Name ..."})}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(f.zx,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},g=function(e){var t=(0,x.useState)(e.role.isActive),n=(0,o.Z)(t,2),r=n[0],s=n[1];return(0,x.useEffect)((function(){e.form.setFieldsValue({name:e.role.name,isActive:e.role.isActive})}),[e.form,e.role]),(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(f.l0,{layout:"vertical",form:e.form,onFinish:function(t){t.isActive=r,t.id=parseInt(e.role.id),e.onFinish(t)},requiredMark:!1,children:[(0,j.jsx)(f.l0.Item,{name:"name",label:"Name",rules:[{required:!0,type:"string",message:"Please input Name"}],children:(0,j.jsx)(f.II,{size:"large",placeholder:"Enter Name ..."})}),(0,j.jsx)(f.l0.Item,{name:"isActive",children:(0,j.jsx)(f.XZ,{checked:r,onChange:function(){return s(!r)},children:"Active"})}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(f.zx,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})},Z=n(29641),S=function(e){var t=(0,x.useState)(),n=(0,o.Z)(t,2),r=n[0],s=n[1],S=(0,x.useState)([]),w=(0,o.Z)(S,2),I=w[0],C=w[1],k=(0,x.useState)(1),b=(0,o.Z)(k,2),A=(b[0],b[1]),E=(0,x.useState)(0),F=(0,o.Z)(E,2),z=F[0],q=F[1],R=(0,x.useState)(20),D=(0,o.Z)(R,2),N=D[0],M=D[1],T=(0,x.useState)(""),P=(0,o.Z)(T,2),O=P[0],J=P[1],X=(0,x.useState)(!1),B=(0,o.Z)(X,2),V=(B[0],B[1]),_=(0,x.useState)(!0),H=(0,o.Z)(_,2),Q=H[0],K=H[1],U=((0,p.HJ)().push,f.l0.useForm()),Y=(0,o.Z)(U,1)[0],G=f.l0.useForm(),L=(0,o.Z)(G,1)[0],W=(f.rj.useBreakpoint().lg,(0,x.useState)(!1)),$=(0,o.Z)(W,2),ee=$[0],te=$[1],ne=(0,x.useState)(!1),re=(0,o.Z)(ne,2),se=re[0],ie=re[1],ae=(0,x.useState)(!1),oe=(0,o.Z)(ae,2),le=oe[0],ce=oe[1],ue=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.E.custom({url:"",method:"post",metaData:{operation:"updateSystemRole",variables:{id:{value:t.id,type:"Int",required:!0},name:{value:t.name,type:"String",required:!0},isActive:{value:t.isActive,type:"Boolean",required:!0}},fields:["success","message",{schoolType:["id","name","code","created","updated","isActive","canDelete","canEdit","canManage"]}]}});case 2:n=e.sent,(r=n.data).success?(f.yw.success(r.message),L.resetFields(),ce(!1),C(I.map((function(e){return parseInt(e.id.toString())===parseInt(t.id)?r.role:e})))):f.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.E.custom({url:"",method:"post",metaData:{operation:"createSystemRole",variables:{id:{value:t.id,type:"Int",required:!0},name:{value:t.name,type:"String",required:!0},isActive:{value:t.isActive,type:"Boolean",required:!0}},fields:["success","message",{ownership:["id","name","code","description","custom","created","updated","isActive","canDelete","canEdit","canManage"]}]}});case 2:n=e.sent,(r=n.data).success?(f.yw.success(r.message),L.resetFields(),ce(!1),C(I.map((function(e){return e.id===r.role.id?r.role:e})))):f.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),me=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.E.custom({url:"",method:"post",metaData:{operation:"deleteSystemRole",variables:{id:{value:parseInt(t.toString()),type:"Int",required:!0}},fields:["success","message"]}});case 2:n=e.sent,(r=n.data).success?(f.yw.success(r.message),C(I.filter((function(e){return e.id!==t})))):f.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fe=function(){f.yw.info("Canceled")},pe=[{title:"Name",dataIndex:"name",fixed:!0,render:function(e,t,n){return(0,j.jsx)("span",{children:(0,j.jsx)("a",{children:t.name})})}},{title:"Code",dataIndex:"code",fixed:!0,render:function(e,t,n){return(0,j.jsx)("span",{children:(0,j.jsx)("a",{children:e})})}},{title:"Custom Role",dataIndex:"custom",fixed:!0,render:function(e,t,n){return(0,j.jsx)("span",{children:t.custom?(0,j.jsx)(f.Vp,{color:"red",children:"Custom"}):(0,j.jsx)(f.Vp,{color:"green",children:"Not Custom"})})}},{title:"Created",dataIndex:"created",render:function(e,t,n){return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)("span",{children:(0,j.jsx)(v.Z,{date:new Date(t.created)})})})}},{title:"Status",dataIndex:"isActive",render:function(e,t,n){return(0,j.jsx)("a",{children:null!==t&&void 0!==t&&t.isActive?(0,j.jsx)("span",{style:{color:"green"},children:"Active"}):(0,j.jsx)("span",{style:{color:"red"},children:"Inactive"})})}},{title:"",dataIndex:"action",render:function(e,t,n){return(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,j.jsx)(f.u,{title:"Manage Role Permissions",placement:"left",children:(0,j.jsx)(f.zx,{icon:(0,j.jsx)(l.Z,{}),disabled:!(null!==t&&void 0!==t&&t.canManage),onClick:function(){return function(e){s(e),te(!0)}(t)}})}),(0,j.jsx)(f.gn,{title:"Are you sure to delete this School Ownership?",onConfirm:function(){return me(null===t||void 0===t?void 0:t.id)},onCancel:function(){return fe},okText:"Yes",cancelText:"No",disabled:!(null!==t&&void 0!==t&&t.canDelete),children:(0,j.jsx)(f.zx,{icon:(0,j.jsx)(c.Z,{}),disabled:!(null!==t&&void 0!==t&&t.canDelete)})}),(0,j.jsx)(f.u,{title:"Edit "+(null===t||void 0===t?void 0:t.name)+" Ownership",color:"green",placement:"left",children:(0,j.jsx)(f.zx,{icon:(0,j.jsx)(u.Z,{}),disabled:!(null!==t&&void 0!==t&&t.canEdit),onClick:function(){return function(e){s(e),ce(!0)}(t)}})})]})}}],he=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,s,a,o=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2&&void 0!==o[2]?o[2]:20,e.next=4,h.E.custom({url:"",method:"get",metaData:{operation:"systemRoles",variables:{page:{value:t,type:"Int",required:!0},key:{value:n,type:"String",required:!1},pageSize:{value:r,type:"Int",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:["id","name","code","description","custom","isActive","created","updated","canEdit","canDelete","canManage"]}]}});case 4:s=e.sent,a=s.data,A(a.page),q(a.total),V(a.hasNext),C(a.results),K(!1);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.E.custom({url:"",method:"post",metaData:{operation:"syncSystemRoles",variables:{},fields:["success","message"]}});case 2:t=e.sent,(n=t.data).success?(f.yw.success(n.message),I.length=0,C([]),he(1)):f.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,x.useEffect)((function(){he(1,"",20)}),[]),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(f.X2,{style:{marginTop:10},children:[(0,j.jsx)(f.JX,{span:8,children:(0,j.jsx)(f.l0,{layout:"vertical",form:Y,onFinish:function(e){A(1),I.length=0,J(e.key),he(1,e.key,N)},children:(0,j.jsx)(f.l0.Item,{name:"key",children:(0,j.jsx)(f.II,{size:"large",placeholder:"Search ...",prefix:(0,j.jsx)(d.Z,{}),autoComplete:"off",allowClear:!0})})})}),(0,j.jsx)(f.JX,{span:16,style:{display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(f.u,{title:"Synchronize Default Schools Roles",placement:"left",color:"green",children:(0,j.jsx)(f.zx,{size:"large",icon:(0,j.jsx)(m.Z,{}),style:{marginRight:10},onClick:function(){return xe()}})})})]}),(0,j.jsx)("div",{children:(0,j.jsx)(f.iA,{loading:Q,columns:pe,dataSource:I,scroll:{x:!0},pagination:{onChange:function(e,t){M(t),he(e,O,t)},total:z,pageSize:N,position:["bottomCenter"],showQuickJumper:!0}})}),(0,j.jsx)(f.u_,{title:"Edit System Role",width:"20%",visible:le,onOk:function(){ce(!1)},onCancel:function(){ce(!1)},footer:[],children:(0,j.jsx)(g,{form:L,role:r,onFinish:ue})}),(0,j.jsx)(f.u_,{title:"Create System Role",width:"20%",visible:se,onOk:function(){ie(!1)},onCancel:function(){ie(!1)},footer:[],children:(0,j.jsx)(y,{form:L,onFinish:de})}),(0,j.jsx)(f.u_,{title:"Manage Role Permissions",width:"70vw",visible:ee,onOk:function(){return te(!1)},onCancel:function(){return te(!1)},footer:[],children:(0,j.jsx)(Z.E,{role:r,randKey:Math.random()})})]})},w=n(20852),I=n(59174),C=n(5397),k=function(){return(0,j.jsxs)("div",{style:{marginTop:10},children:[(0,j.jsxs)(r.Z,{children:[(0,j.jsx)(r.Z.Item,{children:(0,j.jsx)(s.rU,{to:"/control/analytics",children:"Home"})}),(0,j.jsx)(r.Z.Item,{children:"Roles"})]}),(0,j.jsx)(S,{height:80})]})},b=function(){var e=(0,p.kS)().data;return(0,x.useEffect)((function(){!1!==(null===e||void 0===e?void 0:e.isStaff)&&!1!==(null===e||void 0===e?void 0:e.isAdmin)||(window.location.pathname="/home"),window.history.pushState({},"",(0,I.Z)())}),[]),(0,j.jsx)(w.u,{children:(0,j.jsx)(C.Q,{children:(0,j.jsx)(k,{})})})}}}]);
//# sourceMappingURL=156.9d88544d.chunk.js.map