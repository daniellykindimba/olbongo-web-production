{"version":3,"file":"static/js/719.054550d9.chunk.js","mappings":"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","sources":["apps/control/components/control_permissions_component.tsx","apps/control/pages/control_permissions_page.tsx"],"sourcesContent":["/* eslint-disable jsx-a11y/anchor-is-valid */\n/* eslint-disable react-hooks/exhaustive-deps */\nimport {SearchOutlined, SyncOutlined} from \"@ant-design/icons\";\nimport {Button, Form, Grid, Input, Table} from \"@pankod/refine-antd\";\nimport {useNavigation} from \"@pankod/refine-core\";\nimport {Col, message, Row, Spin, Tooltip} from \"@pankod/refine-antd\";\nimport {gqlDataProvider} from \"api\";\nimport {PermissionData} from \"apps/core/interfaces\";\nimport {useEffect, useState} from \"react\";\nimport InfiniteScroll from \"react-infinite-scroll-component\";\nimport ReactTimeAgo from \"react-time-ago\";\n\ninterface PermissionSearchFormData {\n  key: string;\n}\n\ninterface Props {\n  height?: any;\n  canAdd?: boolean;\n}\n\ninterface permissionFormData {\n  name: string;\n}\n\nexport const ControlPermissionsComponent: React.FC<Props> = (props: Props) => {\n  const [permissions, setPermissions] = useState<PermissionData[]>([]);\n  const [start, setStart] = useState(1);\n  const [total, setTotal] = useState(0);\n  const [limit, setLimit] = useState(20);\n  const [searchKey, setSearchKey] = useState(\"\");\n  const [hasNext, setHasNext] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const {push} = useNavigation();\n  const [searchForm] = Form.useForm<PermissionSearchFormData>();\n  const [form] = Form.useForm<permissionFormData>();\n  const breakpoint = Grid.useBreakpoint();\n  const isMobile = !breakpoint.lg;\n\n  const columns = [\n    {\n      title: \"Name\",\n      dataIndex: \"name\",\n      fixed: true,\n      render: (text: any, row: any, index: any) => (\n        <span>\n          <a>{row.name}</a>\n        </span>\n      ),\n    },\n    {\n      title: \"Code\",\n      dataIndex: \"code\",\n      fixed: true,\n      render: (text: any, row: any, index: any) => (\n        <span>\n          <a>{text}</a>\n        </span>\n      ),\n    },\n    {\n      title: \"Created\",\n      dataIndex: \"created\",\n      render: (text: any, row: any, index: any) => (\n        <>\n          <span>\n            <ReactTimeAgo date={new Date(row.created)} />\n          </span>\n        </>\n      ),\n    },\n    {\n      title: \"Status\",\n      dataIndex: \"isActive\",\n      render: (text: any, row: any, index: any) => (\n        <a>\n          {row?.isActive ? (\n            <span style={{color: \"green\"}}>Active</span>\n          ) : (\n            <span style={{color: \"red\"}}>Inactive</span>\n          )}\n        </a>\n      ),\n    },\n    {\n      title: \"\",\n      dataIndex: \"action\",\n      render: (text: any, row: any, index: any) => (\n        <div style={{display: \"flex\", justifyContent: \"flex-end\"}}></div>\n      ),\n    },\n  ];\n\n  const getSystemPermissions = async (\n    start: number,\n    key: string = \"\",\n    limit: number = 20\n  ) => {\n    const {data} = await gqlDataProvider.custom!({\n      url: \"\",\n      method: \"get\",\n      metaData: {\n        operation: \"systemPermissions\",\n        variables: {\n          page: {value: start, type: \"Int\", required: true},\n          key: {value: key, type: \"String\", required: false},\n          pageSize: {value: limit, type: \"Int\", required: false},\n        },\n        fields: [\n          \"total\",\n          \"page\",\n          \"pages\",\n          \"hasNext\",\n          \"hasPrev\",\n          {\n            results: [\n              \"id\",\n              \"name\",\n              \"code\",\n              \"isActive\",\n              \"created\",\n              \"updated\",\n              \"canEdit\",\n              \"canDelete\",\n              \"canManage\",\n            ],\n          },\n        ],\n      },\n    });\n    setStart(data.page);\n    setTotal(data.total);\n    setHasNext(data.hasNext);\n    setPermissions(data.results);\n    setLoading(false);\n  };\n\n  const syncSystemPermissions = async () => {\n    const {data} = await gqlDataProvider.custom!({\n      url: \"\",\n      method: \"post\",\n      metaData: {\n        operation: \"syncSystemPermissions\",\n        variables: {},\n        fields: [\"success\", \"message\"],\n      },\n    });\n\n    if (data.success) {\n      message.success(data.message);\n      permissions.length = 0;\n      setPermissions([]);\n      getSystemPermissions(1);\n    } else {\n      message.error(data.message);\n    }\n  };\n\n  useEffect(() => {\n    getSystemPermissions(1, \"\", 20);\n  }, []);\n\n  return (\n    <>\n      <Row style={{marginTop: 10}}>\n        <Col span={isMobile ? 24 : 20}>\n          <Form<PermissionSearchFormData>\n            layout=\"vertical\"\n            form={searchForm}\n            onFinish={(values) => {\n              setStart(1);\n              permissions.length = 0;\n              setSearchKey(values.key);\n              getSystemPermissions(1, values.key, limit);\n            }}\n          >\n            <Form.Item name=\"key\">\n              <Input\n                size=\"large\"\n                placeholder=\"Search ...\"\n                prefix={<SearchOutlined />}\n                autoComplete=\"off\"\n                allowClear\n              />\n            </Form.Item>\n          </Form>\n        </Col>\n\n        <Col\n          span={isMobile ? 24 : 4}\n          style={{display: \"flex\", justifyContent: \"flex-end\"}}\n        >\n          <Tooltip title={\"Synchronize Default School Ownerships\"}>\n            <Button\n              size=\"large\"\n              icon={<SyncOutlined />}\n              onClick={() => syncSystemPermissions()}\n            ></Button>\n          </Tooltip>\n        </Col>\n      </Row>\n\n      <div>\n        <Table\n          loading={loading}\n          columns={columns}\n          dataSource={permissions}\n          scroll={{x: true}}\n          pagination={{\n            onChange: (page, pageSize) => {\n              setLimit(pageSize);\n              getSystemPermissions(page, searchKey, pageSize);\n            },\n            total: total,\n            pageSize: limit,\n            position: [\"bottomCenter\"],\n            showQuickJumper: true,\n          }}\n        />\n      </div>\n    </>\n  );\n};\n","import {\n  Authenticated,\n  LayoutWrapper,\n  useGetIdentity,\n} from \"@pankod/refine-core\";\nimport {Breadcrumb} from \"antd\";\nimport {Link} from \"react-router-dom\";\nimport {ControlPermissionsComponent} from \"../components/control_permissions_component\";\nimport {ControlLayout} from \"../control_layout\";\nimport {ControlHeader} from \"../header\";\nimport {useEffect} from \"react\";\nimport urlAppendString from \"services/url_append_string\";\nimport {ControlPermitted} from \"../components/permissions/control_permission\";\n\nconst ControlPermissions: React.FC = () => {\n  return (\n    <div style={{marginTop: 10}}>\n      <Breadcrumb>\n        <Breadcrumb.Item>\n          <Link to={\"/control/analytics\"}>Home</Link>\n        </Breadcrumb.Item>\n        <Breadcrumb.Item>Permissions</Breadcrumb.Item>\n      </Breadcrumb>\n      <ControlPermissionsComponent height={80} />\n    </div>\n  );\n};\n\nexport const ControlPermissionsPage = () => {\n  const {data: user} = useGetIdentity();\n\n  const checkIfUserIsAdmin = () => {\n    if (user?.isStaff === false || user?.isAdmin === false) {\n      window.location.pathname = \"/home\";\n    }\n  };\n  useEffect(() => {\n    checkIfUserIsAdmin();\n    window.history.pushState({}, \"\", urlAppendString());\n  }, []);\n  return (\n    <ControlLayout>\n      <ControlPermitted>\n        <ControlPermissions />\n      </ControlPermitted>\n    </ControlLayout>\n  );\n};\n"],"names":["ControlPermissionsComponent","props","_useState","useState","_useState2","_slicedToArray","permissions","setPermissions","_useState3","_useState4","setStart","_useState5","_useState6","total","setTotal","_useState7","_useState8","limit","setLimit","_useState9","_useState10","searchKey","setSearchKey","_useState11","_useState12","setHasNext","_useState13","_useState14","loading","setLoading","_Form$useForm","useNavigation","push","Form","searchForm","_Form$useForm3","isMobile","Grid","lg","columns","title","dataIndex","fixed","render","text","row","index","_jsx","children","name","_Fragment","ReactTimeAgo","date","Date","created","isActive","style","color","display","justifyContent","getSystemPermissions","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","start","key","_yield","data","_args","arguments","wrap","_context","prev","next","length","undefined","gqlDataProvider","url","method","metaData","operation","variables","page","value","type","required","pageSize","fields","results","sent","hasNext","stop","_x","apply","syncSystemPermissions","_ref2","_callee2","_yield2","_context2","success","message","useEffect","_jsxs","Row","marginTop","Col","span","layout","form","onFinish","values","Input","size","placeholder","prefix","SearchOutlined","autoComplete","allowClear","Tooltip","Button","icon","SyncOutlined","onClick","Table","dataSource","scroll","x","pagination","onChange","position","showQuickJumper","ControlPermissions","Breadcrumb","Link","to","height","ControlPermissionsPage","user","useGetIdentity","isStaff","isAdmin","window","location","pathname","history","pushState","urlAppendString","ControlLayout","ControlPermitted"],"sourceRoot":""}