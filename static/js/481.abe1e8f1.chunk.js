"use strict";(self.webpackChunkolbongo=self.webpackChunkolbongo||[]).push([[481],{26481:function(e,r,n){n.r(r),n.d(r,{ControlUsersPage:function(){return M}});var s=n(78164),t=n(43504),a=n(93433),i=n(74165),l=n(15861),d=n(29439),o=n(82622),u=n(31752),c=n(82521),m=n(61753),p=n(11730),f=n(79286),h=n(78820),x=n(840),g=n(72518),j=n(87012),v=n(72791),y=n(50333),I=n(80184),b=(x.II.TextArea,function(e){var r=(0,v.useState)(e.member.isAdmin),n=(0,d.Z)(r,2),s=n[0],t=n[1],a=(0,v.useState)(e.member.isStaff),i=(0,d.Z)(a,2),l=i[0],o=i[1];return(0,v.useEffect)((function(){e.form.setFieldsValue({firstName:e.member.firstName,middleName:e.member.middleName,lastName:e.member.lastName,email:e.member.email,phone:e.member.phone,isAdmin:e.member.isAdmin,isStaff:e.member.isStaff})}),[e.form,e.member]),(0,I.jsx)(I.Fragment,{children:(0,I.jsxs)(x.l0,{layout:"vertical",form:e.form,onFinish:function(r){r.id=parseInt(e.member.id),r.isAdmin=s,r.isStaff=l,e.onFinish(r)},requiredMark:!0,children:[(0,I.jsx)(x.l0.Item,{name:"firstName",label:"First Name",rules:[{required:!0,type:"string",message:"Please input First Name"}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter First Name ..."})}),(0,I.jsx)(x.l0.Item,{name:"middleName",label:"Middle Name",rules:[{required:!1,type:"string",message:"Please input Middle Name"}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter Middle Name ..."})}),(0,I.jsx)(x.l0.Item,{name:"lastName",label:"Last Name",rules:[{required:!0,type:"string",message:"Please input Last Name"}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter Last Name ..."})}),(0,I.jsx)(x.l0.Item,{name:"email",label:"Email",rules:[{required:!1,type:"email",message:"Please input Email Address"}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter Email Address ..."})}),(0,I.jsx)(x.l0.Item,{name:"phone",label:"Mobile Phone Number",rules:[{required:!0,type:"string",message:"Please input Mobile Phone Number ..."}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter Mobile Phone Number ..."})}),(0,I.jsx)(x.l0.Item,{name:"isAdmin",rules:[{required:!1,type:"boolean"}],children:(0,I.jsx)(x.XZ,{defaultChecked:s,onChange:function(){t(!s)},children:"Admin"})}),(0,I.jsx)(x.l0.Item,{name:"isStaff",rules:[{required:!1,type:"boolean"}],children:(0,I.jsx)(x.XZ,{defaultChecked:l,checked:l,onChange:function(){o(!l)},children:"Staff"})}),(0,I.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,I.jsx)(x.zx,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})}),w=["id","firstName","lastName","email","middleName","fullName","phone","pic","username","isActive","isStaff","isAdmin","ldapAuth","created","updated","canEdit","canDelete","canManage"],N=function(e){var r=(0,v.useState)(!1),n=(0,d.Z)(r,2),s=n[0],t=n[1],a=(0,v.useState)(!1),o=(0,d.Z)(a,2),u=o[0],c=o[1],m=(0,v.useState)(!1),p=(0,d.Z)(m,2),f=p[0],h=p[1],g=function(){var r=(0,l.Z)((0,i.Z)().mark((function r(n){var s,t;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,j.E.custom({url:"",method:"post",metaData:{operation:"createUserExtended",variables:{firstName:{value:n.firstName,type:"String",required:!0},middleName:{value:n.middleName,type:"String",required:!0},lastName:{value:n.lastName,type:"String",required:!0},username:{value:n.username,type:"String",required:!1},email:{value:n.email,type:"String",required:!f},phone:{value:n.phone,type:"String",required:!0},password:{value:n.password,type:"String",required:!f},passwordRepeat:{value:n.passwordRepeat,type:"String",required:!f},isAdmin:{value:n.isAdmin,type:"Boolean",required:!1},isStaff:{value:n.isStaff,type:"Boolean",required:!1},ldapAuth:{value:n.ldapAuth,type:"Boolean",required:!1}},fields:["success","message",{user:w}]}});case 2:s=r.sent,(t=s.data).success?(x.yw.success(t.message),e.onFinish(t.user)):x.yw.error(t.message);case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();return(0,v.useEffect)((function(){}),[e.form]),(0,I.jsx)(I.Fragment,{children:(0,I.jsxs)(x.l0,{layout:"vertical",form:e.form,onFinish:function(e){e.isAdmin=s,e.isStaff=u,e.ldapAuth=f,f||(e.username=e.email),g(e)},requiredMark:!0,children:[(0,I.jsxs)("div",{style:{maxHeight:"70vh",overflowY:"auto",padding:20},children:[(0,I.jsx)(x.l0.Item,{name:"ldapAuth",rules:[{required:!1,type:"boolean"}],children:(0,I.jsx)(x.XZ,{defaultChecked:f,onChange:function(){h(!f)},children:"LDAP Authentication"})}),(0,I.jsx)(x.l0.Item,{name:"firstName",label:"First Name",rules:[{required:!0,type:"string",message:"Please input First Name"}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter First Name ..."})}),(0,I.jsx)(x.l0.Item,{name:"middleName",label:"Middle Name",rules:[{required:!0,type:"string",message:"Please input Middle Name"}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter Middle Name ..."})}),(0,I.jsx)(x.l0.Item,{name:"lastName",label:"Last Name",rules:[{required:!0,type:"string",message:"Please input Last Name"}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter Last Name ..."})}),(0,I.jsx)(x.l0.Item,{name:"email",label:(0,I.jsxs)(I.Fragment,{children:["Email Address",!f&&(0,I.jsx)(x.Vp,{color:"green",children:"Username"})]}),rules:[{required:!f,type:"email",message:"Please input Email Address"}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter Email Address ..."})}),f&&(0,I.jsx)(x.l0.Item,{name:"username",label:"Username",rules:[{required:f,type:"string",message:"Please input Username ..."}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter Username ..."})}),!f&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(x.l0.Item,{name:"password",label:"Password",rules:[{required:!f,type:"string",message:"Please input Password ..."}],children:(0,I.jsx)(x.II,{size:"large",type:"password",placeholder:"Enter Password ..."})}),(0,I.jsx)(x.l0.Item,{name:"passwordRepeat",label:"Password Confirm",rules:[{required:!f,type:"string",message:"Please input Password Confirm ..."}],children:(0,I.jsx)(x.II,{size:"large",type:"password",placeholder:"Enter Password Confirm ..."})})]}),(0,I.jsx)(x.l0.Item,{name:"phone",label:"Mobile Phone",rules:[{required:!0,type:"string",message:"Please input Mobile Phone"}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter Email Address ..."})}),(0,I.jsx)(x.l0.Item,{name:"isAdmin",rules:[{required:!1,type:"boolean"}],children:(0,I.jsx)(x.XZ,{defaultChecked:s,onChange:function(){t(!s)},children:"Admin"})}),(0,I.jsx)(x.l0.Item,{name:"isStaff",rules:[{required:!1,type:"boolean"}],children:(0,I.jsx)(x.XZ,{defaultChecked:u||f,checked:u||f,onChange:function(){c(!u)},children:"Staff"})})]}),(0,I.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,I.jsx)(x.zx,{size:"large",htmlType:"submit",danger:!0,children:"Save"})})]})})},S=n(150),Z=n(60438),q=n.n(Z),C=x.ZT.Paragraph,A=function(e){var r,n,s,t,a,o=x.l0.useForm(),u=(0,d.Z)(o,1)[0],c=function(){var r=(0,l.Z)((0,i.Z)().mark((function r(n){var s,t;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,j.E.custom({url:"",method:"post",metaData:{operation:"createLdapCredentials",variables:{userId:{value:n.userId,type:"Int",required:!0},username:{value:n.username,type:"String",required:!1},password:{value:n.password,type:"String",required:!1},passwordConfirm:{value:n.passwordConfirm,type:"String",required:!1}},fields:["success","message"]}});case 2:s=r.sent,(t=s.data).success?(x.yw.success(t.message),u.resetFields(),e.onFinish()):x.yw.error(t.message);case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();return(0,v.useEffect)((function(){}),[e.member]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("h2",{children:["Copy the link below and send it to the user to create their LDAP credentials",(0,I.jsx)("span",{style:{color:"red"},children:"Link Expires in 24Hours"})]}),(0,I.jsx)(S.Z,{type:"info",message:(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(C,{copyable:!0,style:{fontSize:"22px"},children:window.location.origin+"/auth/ldap/"+q()().add("h",24).valueOf()+"/"+(null===(r=e.member)||void 0===r?void 0:r.id)+"/login?fname="+(null===(n=e.member)||void 0===n?void 0:n.firstName)+"&lname="+(null===(s=e.member)||void 0===s?void 0:s.lastName)+"&mname="+(null===(t=e.member)||void 0===t?void 0:t.middleName)+"&email="+(null===(a=e.member)||void 0===a?void 0:a.email)})})}),(0,I.jsx)("div",{style:{marginTop:50},children:(0,I.jsxs)(x.l0,{layout:"vertical",form:u,onFinish:function(r){var n,s;r.userId=parseInt(null!==(n=null===(s=e.member)||void 0===s?void 0:s.id)&&void 0!==n?n:"0"),c(r)},requiredMark:!0,children:[(0,I.jsx)(x.l0.Item,{name:"username",label:"Username",rules:[{required:!0,type:"string",message:"Please input Username"}],children:(0,I.jsx)(x.II,{size:"large",placeholder:"Enter Username ..."})}),(0,I.jsx)(x.l0.Item,{name:"password",label:"Password",rules:[{required:!0,type:"string",message:"Please input Password"}],children:(0,I.jsx)(x.II,{size:"large",type:"password",placeholder:"Enter Password ..."})}),(0,I.jsx)(x.l0.Item,{name:"passwordConfirm",label:"Confirm Password",rules:[{required:!0,type:"string",message:"Please input Confirm Password"},function(e){var r=e.getFieldValue;return{validator:function(e,n){return n&&r("password")!==n?Promise.reject(new Error("The two passwords that you entered do not match!")):Promise.resolve()}}}],children:(0,I.jsx)(x.II,{size:"large",type:"password",placeholder:"Enter Confirm Password ..."})}),(0,I.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,I.jsx)(x.zx,{type:"primary",size:"large",htmlType:"submit",children:"Save"})})]})})]})},E=["id","firstName","lastName","email","middleName","fullName","phone","pic","username","isActive","isStaff","isAdmin","ldapAuth","created","updated","canEdit","canDelete","canManage"],P=function(e){var r=(0,v.useState)(),n=(0,d.Z)(r,2),s=n[0],t=n[1],w=(0,v.useState)([]),S=(0,d.Z)(w,2),Z=S[0],q=S[1],C=(0,v.useState)(1),P=(0,d.Z)(C,2),k=P[0],F=P[1],z=(0,v.useState)(0),U=(0,d.Z)(z,2),M=U[0],D=U[1],T=(0,v.useState)(20),L=(0,d.Z)(T,2),B=L[0],O=L[1],X=(0,v.useState)(""),V=(0,d.Z)(X,2),_=V[0],J=(V[1],(0,v.useState)(!1)),H=(0,d.Z)(J,2),Y=(H[0],H[1]),R=(0,v.useState)(!0),Q=(0,d.Z)(R,2),G=Q[0],K=Q[1],W=((0,g.HJ)().push,x.l0.useForm()),$=(0,d.Z)(W,1)[0],ee=x.l0.useForm(),re=(0,d.Z)(ee,1)[0],ne=(x.rj.useBreakpoint().lg,(0,v.useState)(!1)),se=(0,d.Z)(ne,2),te=se[0],ae=se[1],ie=(0,v.useState)(!1),le=(0,d.Z)(ie,2),de=le[0],oe=le[1],ue=(0,v.useState)(!1),ce=(0,d.Z)(ue,2),me=ce[0],pe=ce[1],fe=new URLSearchParams(window.location.search),he=fe.get("status")||"0",xe=fe.get("role")||"user",ge=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:pe(!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(r){var n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.E.custom({url:"",method:"post",metaData:{operation:"updateUser",variables:{id:{value:r.id,type:"Int",required:!0},firstName:{value:r.firstName,type:"String",required:!1},middleName:{value:r.middleName,type:"String",required:!1},lastName:{value:r.lastName,type:"String",required:!1},email:{value:r.email,type:"String",required:!1},phone:{value:r.phone,type:"String",required:!1},isAdmin:{value:r.isAdmin,type:"Boolean",required:!1},isStaff:{value:r.isStaff,type:"Boolean",required:!1},ldapAuth:{value:r.ldapAuth,type:"Boolean",required:!1}},fields:["success","message",{user:E}]}});case 2:n=e.sent,(s=n.data).success?(x.yw.success(s.message),re.resetFields(),ae(!1)):x.yw.error(s.message);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),ve=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:q([r].concat((0,a.Z)(Z))),oe(!1);case 2:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),ye=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(r){var n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.E.custom({url:"",method:"post",metaData:{operation:"deleteUser",variables:{id:{value:parseInt(r.toString()),type:"Int",required:!0}},fields:["success","message"]}});case 2:n=e.sent,(s=n.data).success?(x.yw.success(s.message),q(Z.filter((function(e){return e.id!==r})))):x.yw.error(s.message);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ie=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(r,n){var s,t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.E.custom({url:"",method:"post",metaData:{operation:"blockUnblockUser",variables:{id:{value:parseInt(r.toString()),type:"Int",required:!0},block:{value:n,type:"Boolean",required:!0}},fields:["success","message",{user:E}]}});case 2:s=e.sent,(t=s.data).success?(x.yw.success(t.message),q(Z.map((function(e){return e.id===r?t.user:e})))):x.yw.error(t.message);case 5:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}(),be=function(){x.yw.info("Canceled")},we=[{title:"Full Name",dataIndex:"full_name",fixed:!0,render:function(e,r,n){return(0,I.jsx)("span",{children:(0,I.jsx)("a",{children:r.fullName})})}},{title:"Username",dataIndex:"username",render:function(e,r,n){return(0,I.jsx)("span",{children:(0,I.jsx)("a",{children:r.username})})}},{title:"Email",dataIndex:"email",render:function(e,r,n){return(0,I.jsxs)("span",{children:[r.email&&(0,I.jsx)(x.Vp,{color:"green",children:r.email}),r.phone&&(0,I.jsx)(x.Vp,{color:"green",children:r.phone})]})}},{title:"LDAP Auth",dataIndex:"created",render:function(e,r,n){return(0,I.jsx)(I.Fragment,{children:(0,I.jsx)("span",{children:r.ldapAuth?(0,I.jsx)(x.Vp,{color:"green",children:"Yes"}):(0,I.jsx)(x.Vp,{color:"red",children:"No"})})})}},{title:"Date Joined",dataIndex:"created",render:function(e,r,n){return(0,I.jsx)(I.Fragment,{children:(0,I.jsx)("span",{children:(0,I.jsx)(y.Z,{date:new Date(r.created)})})})}},{title:"Status",dataIndex:"isActive",render:function(e,r,n){return(0,I.jsx)("a",{children:null!==r&&void 0!==r&&r.isActive?(0,I.jsx)("span",{style:{color:"green"},children:"Active"}):(0,I.jsx)("span",{style:{color:"red"},children:"Inactive"})})}},{title:"",dataIndex:"action",render:function(e,r,n){return(0,I.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[r.ldapAuth&&(0,I.jsx)(x.zx,{icon:(0,I.jsx)(h.SPH,{}),disabled:!(null!==r&&void 0!==r&&r.canEdit),onClick:function(){return function(e){t(e),pe(!0)}(r)},danger:!0}),(0,I.jsx)(x.gn,{title:"Are you sure to delete this member?",placement:"left",onConfirm:function(){return ye(null===r||void 0===r?void 0:r.id)},onCancel:function(){return be},okText:"Yes",cancelText:"No",disabled:!(null!==r&&void 0!==r&&r.canDelete),children:(0,I.jsx)(x.zx,{icon:(0,I.jsx)(o.Z,{}),disabled:!(null!==r&&void 0!==r&&r.canDelete),danger:!0})}),(0,I.jsx)(x.zx,{icon:(0,I.jsx)(u.Z,{}),disabled:!(null!==r&&void 0!==r&&r.canEdit),onClick:function(){return function(e){t(e),ae(!0)}(r)},danger:!0}),r.isActive?(0,I.jsx)(x.gn,{title:"Blocking User???",placement:"left",onConfirm:function(){return Ie(null===r||void 0===r?void 0:r.id,!1)},onCancel:function(){},okText:"Yes",cancelText:"No",children:(0,I.jsx)(x.zx,{icon:(0,I.jsx)(c.Z,{}),disabled:!(null!==r&&void 0!==r&&r.canManage),danger:!0})}):(0,I.jsx)(x.gn,{title:"Unblocking User???",placement:"left",onConfirm:function(){return Ie(null===r||void 0===r?void 0:r.id,!0)},onCancel:function(){},okText:"Yes",cancelText:"No",children:(0,I.jsx)(x.zx,{icon:(0,I.jsx)(m.Z,{}),disabled:!(null!==r&&void 0!==r&&r.canEdit),danger:!0})})]})}}],Ne=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(r){var n,s,t,a,l=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:"",s=l.length>2&&void 0!==l[2]?l[2]:20,e.next=4,j.E.custom({url:"",method:"get",metaData:{operation:"users",variables:{page:{value:r,type:"Int",required:!0},key:{value:n,type:"String",required:!1},pageSize:{value:s,type:"Int",required:!1},where:{value:{is_staff:"staff"===xe,is_admin:"adminstrator"===xe,is_active:1===parseInt(he)},type:"JSON",required:!1}},fields:["total","page","pages","hasNext","hasPrev",{results:E}]}});case 4:t=e.sent,a=t.data,F(a.page),D(a.total),Y(a.hasNext),q(a.results),K(!1);case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();return(0,v.useEffect)((function(){Ne(k)}),[fe.get("status"),fe.get("role")]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(x.X2,{style:{marginTop:10},children:[(0,I.jsx)(x.JX,{span:10,children:(0,I.jsx)(x.l0,{layout:"vertical",form:$,onFinish:function(e){F(1),Z.length=0,Ne(1,e.key)},children:(0,I.jsx)(x.l0.Item,{name:"key",children:(0,I.jsx)(x.II,{size:"large",placeholder:"Search ...",prefix:(0,I.jsx)(p.Z,{}),autoComplete:"off",allowClear:!0})})})}),(0,I.jsx)(x.JX,{span:14,style:{display:"flex",justifyContent:"end"},children:(0,I.jsx)(x.zx,{size:"large",icon:(0,I.jsx)(f.Z,{}),onClick:function(){return oe(!0)},danger:!0,children:"Create User"})})]}),(0,I.jsx)(x.iA,{loading:G,columns:we,dataSource:Z,scroll:{x:!0},pagination:{onChange:function(e,r){O(r),Ne(e,_,r)},total:M,pageSize:B,position:["bottomCenter"],showQuickJumper:!0}}),(0,I.jsx)(x.u_,{title:"Create User Form",destroyOnClose:!0,width:"50%",visible:de,onOk:function(){return oe(!1)},onCancel:function(){re.resetFields(),oe(!1)},footer:[],children:(0,I.jsx)(N,{form:re,onFinish:ve})}),(0,I.jsx)(x.u_,{title:"Edit User Informations",destroyOnClose:!0,width:"50%",visible:te,onOk:function(){ae(!1)},onCancel:function(){ae(!1)},footer:[],children:(0,I.jsx)(b,{form:re,member:s,onFinish:je})}),(0,I.jsx)(x.u_,{title:"Creating LDAP Credentials for User",destroyOnClose:!0,width:"50%",visible:me,onOk:function(){t(null),pe(!1)},onCancel:function(){t(null),pe(!1)},footer:[],children:(0,I.jsx)(A,{member:s,onFinish:ge})})]})},k=n(20852),F=n(59174),z=n(5397),U=function(){return(0,I.jsxs)("div",{style:{marginTop:10},children:[(0,I.jsxs)(s.Z,{children:[(0,I.jsx)(s.Z.Item,{children:(0,I.jsx)(t.rU,{to:"/control/analytics",children:"Home"})}),(0,I.jsx)(s.Z.Item,{children:"Users/Members"})]}),(0,I.jsx)(P,{height:80})]})},M=function(){return(0,v.useEffect)((function(){window.history.pushState({},"",(0,F.Z)())}),[]),(0,I.jsx)(k.u,{children:(0,I.jsx)(z.Q,{children:(0,I.jsx)(U,{})})})}}}]);
//# sourceMappingURL=481.abe1e8f1.chunk.js.map